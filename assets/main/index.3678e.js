window.__require=function t(e,o,r){function n(c,a){if(!o[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var u=o[c]={exports:{}};e[c][0].call(u.exports,function(t){return n(e[c][1][t]||t)},u,u.exports,t,e,o,r)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<r.length;c++)n(r[c]);return n}({1:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.LinkedList=class{constructor(...t){this._head=this._tail=null,this._length=0,t.length>0&&t.forEach(t=>{this.append(t)})}*iterator(){let t=this._head;for(;t;)yield t.value,t=t.next}[Symbol.iterator](){return this.iterator()}get head(){return this._head?this._head.value:null}get tail(){return this._tail?this._tail.value:null}get length(){return this._length}insert(t,e,o=!1){if(o&&this.isDuplicate(t))return!1;let n=new r(t),i=this._head;if(!i)return!1;for(;;){if(i.value===e)return n.next=i.next,n.prev=i,i.next=n,n.next?n.next.prev=n:this._tail=n,this._length++,!0;if(!i.next)return!1;i=i.next}}append(t,e=!1){if(e&&this.isDuplicate(t))return!1;let o=new r(t);return this._tail?(this._tail.next=o,o.prev=this._tail,this._tail=o):this._head=this._tail=o,this._length++,!0}prepend(t,e=!1){if(e&&this.isDuplicate(t))return!1;let o=new r(t);return this._head?(o.next=this._head,this._head.prev=o,this._head=o):this._head=this._tail=o,this._length++,!0}remove(t){let e=this._head;if(e){if(e.value===t)return this._head=e.next,this._head.prev=null,e.next=e.prev=null,this._length--,e.value;for(;;){if(e.value===t)return e.next?(e.prev.next=e.next,e.next.prev=e.prev,e.next=e.prev=null):(e.prev.next=null,this._tail=e.prev,e.next=e.prev=null),this._length--,e.value;if(!e.next)return;e=e.next}}}removeHead(){let t=this._head;if(t)return this._head.next?(this._head.next.prev=null,this._head=this._head.next,t.next=t.prev=null):(this._head=null,this._tail=null),this._length--,t.value}removeTail(){let t=this._tail;if(t)return this._tail.prev?(this._tail.prev.next=null,this._tail=this._tail.prev,t.next=t.prev=null):(this._head=null,this._tail=null),this._length--,t.value}first(t){let e=this.iterator(),o=[],r=Math.min(t,this.length);for(let n=0;n<r;n++){let t=e.next();o.push(t.value)}return o}toArray(){return[...this]}isDuplicate(t){return new Set(this.toArray()).has(t)}};class r{constructor(t){this.value=t,this.next=null,this.prev=null}}o.LinkedListItem=r},{}],2:[function(t,e,o){"use strict";var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const n=t("./expectationError"),i=t("./toBeSorted");class c{get not(){const t=new c;return t.notFlag=!this.notFlag,t}get toBeSorted(){return new i.ToBeSorted(this.notFlag)}toBeEqual(t,e,o){if(this.notFlag?t===e:t!==e)throw new n.ExpectationError(o||`Expected ${this.stringify(t)} ${this.notFlag?"not ":""}to equal ${this.stringify(e)}.`)}arraysToBeEqual(t,e,o){if(t.length!==e.length)throw new n.ExpectationError(o||"Expected sequences to be equal, but their lenghts were different.");for(const r in t)this.toBeEqual(t[r],e[r],o)}toBeGreater(t,e,o){if(!this.notFlag&&t<=e||this.notFlag&&t>e)throw new n.ExpectationError(o||`Expected ${t} ${this.notFlag?"not ":""}to be greater than ${e}.`)}toBeGreaterOrEqual(t,e,o){if(!this.notFlag&&t<e||this.notFlag&&t>=e)throw new n.ExpectationError(o||`Expected ${t} ${this.notFlag?"not ":""}to be greater than or equal to ${e}.`)}toBeLess(t,e,o){if(!this.notFlag&&t>=e||this.notFlag&&t<e)throw new n.ExpectationError(o||`Expected ${t} ${this.notFlag?"not ":""}to be less than ${e}.`)}toBeLessOrEqual(t,e,o){if(!this.notFlag&&t>e||this.notFlag&&t<=e)throw new n.ExpectationError(o||`Expected ${t} ${this.notFlag?"not ":""}to be less than or equal to ${e}.`)}toBeDefined(t,e){if(this.notFlag?void 0!==t:void 0===t)throw new n.ExpectationError(e||`Expected value ${this.notFlag?"not":""} to be defined.`)}toThrow(t,e){try{t()}catch(o){if(this.notFlag)throw new n.ExpectationError(e||"Expected function not to throw");return}if(!this.notFlag)throw new n.ExpectationError(e||"Expected function to throw")}toThrowAsync(t,e){return r(this,void 0,void 0,function*(){try{yield t()}catch(o){if(this.notFlag)throw new n.ExpectationError(e||"Expected function not to throw");return}if(!this.notFlag)throw new n.ExpectationError(e||"Expected function to throw")})}toBeTrue(t,e){if(this.notFlag?!0===t:!0!==t)throw new n.ExpectationError(e||`Expected ${t} to be true.`)}toBeFalse(t,e){if(this.notFlag?!1===t:!1!==t)throw new n.ExpectationError(e||`Expected ${t} to be false.`)}toBeTruthy(t,e){if(this.notFlag?t:!t)throw new n.ExpectationError(e||`Expected ${t} to be truthy.`)}toBeFalsy(t,e){if(this.notFlag?!t:t)throw new n.ExpectationError(e||`Expected ${t} to be falsy.`)}toMatch(t,e,o){const r=e.test(t);if(this.notFlag?r:!r)throw new n.ExpectationError(o||`Expected "${t}" to match ${e}.`)}toBeIn(t,e,o){const r=e.find(e=>e===t);if(this.notFlag?r:!r)throw new n.ExpectationError(o||`Expected ${t} to be in [${e.map(t=>this.stringify(t)).join(", ")}]`)}stringify(t){return"object"==typeof t?JSON.stringify(t):`${t}`}}o.expect=new c},{"./expectationError":3,"./toBeSorted":4}],3:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ExpectationError=class extends Error{}},{}],4:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r=t("./expectationError");var n;o.ToBeSorted=class{constructor(t){this.notFlag=t}inAscendingOrder(t,e,o){this.toBeOrdered(t,e,n.Ascending,o)}inDescendingOrder(t,e,o){this.toBeOrdered(t,e,n.Descending,o)}toBeOrdered(t,e,o,i){if(e||(e=t=>t),this.isOrdered(t,o,e))throw new r.ExpectationError(i||`Expected ${t} to be be sorted ${o===n.Ascending?"from low to high":"from high to low"}.`)}isOrdered(t,e,o){const r=t.every((t,r,n)=>0===r||this.compare(e,o,n[r-1],t));return this.notFlag?r:!r}compare(t,e,o,r){return t===n.Ascending?e(o)<=e(r):e(r)<=e(o)}},function(t){t[t.Ascending=0]="Ascending",t[t.Descending=1]="Descending"}(n||(n={}))},{"./expectationError":3}],5:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r=t("./utils");function n(){return(t,e,o)=>{r.getTestSuiteInstance(t).afterAllMethods.push(o.value)}}function i(){return(t,e,o)=>{r.getTestSuiteInstance(t).afterEachMethods.push(o.value)}}function c(){return(t,e,o)=>{r.getTestSuiteInstance(t).beforeAllMethods.push(o.value)}}function a(){return(t,e,o)=>{r.getTestSuiteInstance(t).beforeEachMethods.push(o.value)}}o.AfterAll=n,o.AfterEach=i,o.BeforeAll=c,o.BeforeEach=a,o.afterAll=function(){return n()},o.afterEach=function(){return i()},o.beforeAll=function(){return c()},o.beforeEach=function(){return a()}},{"./utils":10}],6:[function(t,e,o){"use strict";var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const n=t("../tests/test"),i=t("../tests/testSuite"),c=t("../testStatus"),a=t("./utils");function s(t){return p(t,c.TestStatus.Normal)}function l(t){return p(t,c.TestStatus.Focused)}function u(t){return p(t,c.TestStatus.Ignored)}function p(t,e){return(o,r,n)=>{const i=y(o,r),c=v(o,r),s=a.getTestSuiteInstance(o);if(t=t||r,s.has(t))throw new Error(`A test named "${t}" is already registered. Copy pasta much?`);s.set(t,d(t,c,e,n.value,i))}}function d(t,e,o,r,i){return e?h(t,r,e,o,i):new n.TestInstance(t,f(r),o,i)}function h(t,e,o,r,c){const a=new i.TestSuiteInstance;a.name=t;for(const i of o){const t=f(e,i.args);a.set(i.name,new n.TestInstance(i.name,t,r,c))}return a}function f(t,e=[]){return o=>r(this,void 0,void 0,function*(){yield t.bind(o)(...e)})}function y(t,e){return t.__timeouts?t.__timeouts[e]:void 0}function v(t,e){return t.__testCases?t.__testCases[e]:void 0}o.Test=s,o.FTest=l,o.XTest=u,o.test=function(t){return s(t)},o.ftest=function(t){return l(t)},o.xtest=function(t){return u(t)}},{"../testStatus":13,"../tests/test":14,"../tests/testSuite":15,"./utils":10}],7:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r=t("../testCaseInstance");o.TestCase=function(t,...e){return(o,n)=>{o.__testCases||(o.__testCases={}),o.__testCases[n]||(o.__testCases[n]=[]),o.__testCases[n].push(new r.TestCaseInstance(t,...e))}}},{"../testCaseInstance":12}],8:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r=t("../testStatus"),n=t("./utils");function i(t){return s(r.TestStatus.Normal,t)}function c(t){return s(r.TestStatus.Focused,t)}function a(t){return s(r.TestStatus.Ignored,t)}function s(t,e){return o=>(e=e||o.name,o.__testSuiteInstance=l(o,e,t),o)}function l(t,e,o){const r=new t,i=n.getTestSuiteInstance(r);return i.name=e,i.status=o,i.context=r,i}o.TestSuite=i,o.FTestSuite=c,o.XTestSuite=a,o.testSuite=function(t){return i(t)},o.ftestSuite=function(t){return c(t)},o.xtestSuite=function(t){return a(t)}},{"../testStatus":13,"./utils":10}],9:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.Timeout=function(t=2e3){return(e,o)=>{e.__timeouts||(e.__timeouts={}),e.__timeouts[o]=t}}},{}],10:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r=t("../tests/testSuite");o.getTestSuiteInstance=function(t){return t.__testSuiteInstance?t.__testSuiteInstance=t.__testSuiteInstance.clone():t.__testSuiteInstance=new r.TestSuiteInstance,t.__testSuiteInstance}},{"../tests/testSuite":15}],11:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.Success=0]="Success",t[t.Failure=1]="Failure",t[t.Skipped=2]="Skipped"}(o.TestResult||(o.TestResult={}))},{}],12:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.TestCaseInstance=class{constructor(t,...e){this.name=t,this.args=e}}},{}],13:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),function(t){t[t.Normal=0]="Normal",t[t.Focused=1]="Focused",t[t.Ignored=2]="Ignored"}(o.TestStatus||(o.TestStatus={}))},{}],14:[function(t,e,o){"use strict";var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});class n{constructor(t,e,o,r){this._name=t,this._func=e,this._status=o,this.timeout=r}get name(){return this._name}get status(){return this._status}get func(){return this._func}run(t,e){return r(this,void 0,void 0,function*(){return yield new Promise((o,n)=>r(this,void 0,void 0,function*(){try{let o=2e3;null!=(null==e?void 0:e.timeout)&&(o=e.timeout),null!=this.timeout&&(o=this.timeout);const i=setTimeout(()=>n("Test has timed out."),o);try{yield this.func(t)}finally{clearTimeout(i)}}catch(r){n(r)}o()}))})}accept(t){return r(this,void 0,void 0,function*(){return yield t.visitTest(this)})}clone(){return new n(this.name,this._func,this._status,this.timeout)}}o.TestInstance=n},{}],15:[function(t,e,o){"use strict";var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})};Object.defineProperty(o,"__esModule",{value:!0});const n=t("./test"),i=t("../testStatus");class c extends Map{constructor(){super(...arguments),this.beforeAllMethods=[],this.beforeEachMethods=[],this.afterEachMethods=[],this.afterAllMethods=[]}get testIds(){return Array.from(this.keys())}get(t){const e=super.get(t);return e instanceof Map?this.status!==i.TestStatus.Focused&&this.hasFocusedTests()?e.getNormalizedCopy():e:this.status!==i.TestStatus.Focused&&e.status!==i.TestStatus.Focused&&this.hasFocusedTests()?new n.TestInstance(e.name,e.func,i.TestStatus.Ignored):e}accept(t){return r(this,void 0,void 0,function*(){return yield t.visitTestSuite(this)})}hasFocusedTests(t=this){if(t.status===i.TestStatus.Focused)return!0;if(!(t instanceof Map))return!1;for(const e of Array.from(t.values()))if(this.hasFocusedTests(e))return!0;return!1}getNormalizedCopy(){if(this.status===i.TestStatus.Focused)return this;const t=this.clone();for(const e of this.testIds){const o=super.get(e);o instanceof Map?t.set(e,o.getNormalizedCopy()):t.set(e,new n.TestInstance(o.name,o.func,o.status===i.TestStatus.Focused?i.TestStatus.Focused:i.TestStatus.Ignored))}return t}clone(){const t=new c;t.name=this.name,t.status=this.status,t.context=this.context,t.afterAllMethods=this.afterAllMethods.slice(),t.afterEachMethods=this.afterEachMethods.slice(),t.beforeEachMethods=this.beforeEachMethods.slice(),t.beforeAllMethods=this.beforeAllMethods.slice();for(const e of this.testIds)t.set(e,super.get(e).clone());return t}}o.TestSuiteInstance=c},{"../testStatus":13,"./test":14}],16:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var r=t("./lib/decorators/test.decorator");o.Test=r.Test,o.FTest=r.FTest,o.XTest=r.XTest;var n=t("./lib/decorators/testSuite.decorator");o.TestSuite=n.TestSuite,o.FTestSuite=n.FTestSuite,o.XTestSuite=n.XTestSuite;var i=t("./lib/decorators/timeout.decorator");o.Timeout=i.Timeout;var c=t("./lib/decorators/testCase.decorator");o.TestCase=c.TestCase;var a=t("./lib/testCaseInstance");o.TestCaseInstance=a.TestCaseInstance;var s=t("./lib/decorators/afterAndBefore.decorator");o.AfterAll=s.AfterAll,o.AfterEach=s.AfterEach,o.BeforeEach=s.BeforeEach,o.BeforeAll=s.BeforeAll;var l=t("./lib/reporting/report/testResult");o.TestResult=l.TestResult;var u=t("./lib/decorators/afterAndBefore.decorator");o.afterAll=u.afterAll,o.afterEach=u.afterEach,o.beforeEach=u.beforeEach,o.beforeAll=u.beforeAll;var p=t("./lib/decorators/test.decorator");o.test=p.test,o.ftest=p.ftest,o.xtest=p.xtest;var d=t("./lib/decorators/testSuite.decorator");o.testSuite=d.testSuite,o.ftestSuite=d.ftestSuite,o.xtestSuite=d.xtestSuite;var h=t("./lib/assertion/expect");o.expect=h.expect},{"./lib/assertion/expect":2,"./lib/decorators/afterAndBefore.decorator":5,"./lib/decorators/test.decorator":6,"./lib/decorators/testCase.decorator":7,"./lib/decorators/testSuite.decorator":8,"./lib/decorators/timeout.decorator":9,"./lib/reporting/report/testResult":11,"./lib/testCaseInstance":12}],17:[function(t,e,o){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var r=Array(t),n=0;for(e=0;e<o;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,n++)r[n]=i[c];return r};Object.defineProperty(o,"__esModule",{value:!0}),o.StringBuilder=o.String=void 0;var n=function(){function t(){}return t.IsNullOrWhiteSpace=function(t){try{return null==t||"undefined"==t||t.toString().replace(/\s/g,"").length<1}catch(e){return console.log(e),!1}},t.Join=function(e){for(var o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];try{var i=o[0];if(Array.isArray(i)||i instanceof Array){for(var c=t.Empty,a=0;a<i.length;a++){var s=i[a];a<i.length-1?c+=s+e:c+=s}return c}if("object"==typeof i){var l=t.Empty,u=i,p=Object.keys(i);return p.forEach(function(t){l+=u[t]+e}),l=l.slice(0,l.length-e.length)}var d=o;return t.join.apply(t,r([e],d))}catch(h){return console.log(h),t.Empty}},t.Format=function(e){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];try{return e.match(t.regexNumber)?t.format(t.regexNumber,e,o):e.match(t.regexObject)?t.format(t.regexObject,e,o,!0):e}catch(n){return console.log(n),t.Empty}},t.format=function(e,o,r,n){return void 0===n&&(n=!1),o.replace(e,function(e,o){var i,c=e.split(":");return c.length>1&&(o=c[0].replace("{",""),e=c[1].replace("}","")),null==(i=n?r[0][o]:r[o])||null==i||e.match(/{\d+}/)?i:void 0!==(i=t.parsePattern(e,i))&&null!=i?i:t.Empty})},t.parsePattern=function(e,o){switch(e){case"L":return o.toLocaleLowerCase();case"U":return o.toLocaleUpperCase();case"d":if("string"==typeof o)return t.getDisplayDateFromString(o);if(o instanceof Date)return t.Format("{0:00}.{1:00}.{2:0000}",o.getDate(),o.getMonth(),o.getFullYear());break;case"s":if("string"==typeof o)return t.getSortableDateFromString(o);if(o instanceof Date)return t.Format("{0:0000}-{1:00}-{2:00}",o.getFullYear(),o.getMonth(),o.getDate());break;case"n":"string"!=typeof o&&(o=o.toString());var n=o.replace(/,/g,".");if(isNaN(parseFloat(n))||n.length<=3)break;var i=n.split(/[^0-9]+/g),c=i;i.length>1&&(c=[t.join.apply(t,r([""],i.splice(0,i.length-1))),i[i.length-1]]);var a=c[0],s=a.length%3,l=s>0?a.substring(0,s):t.Empty,u=a.substring(s).match(/.{3}/g);return(l=l+"."+t.Join(".",u))+(c.length>1?","+c[1]:"");case"x":return this.decimalToHexString(o);case"X":return this.decimalToHexString(o,!0)}return"number"!=typeof o&&isNaN(o)||isNaN(+e)||t.IsNullOrWhiteSpace(o)?o:t.formatNumber(o,e)},t.decimalToHexString=function(t,e){void 0===e&&(e=!1);var o=parseFloat(t).toString(16);return e?o.toLocaleUpperCase():o},t.getDisplayDateFromString=function(t){var e;if((e=t.split("-")).length<=1)return t;var o=e[e.length-1],r=e[e.length-2],n=e[e.length-3];return(o=(o=o.split("T")[0]).split(" ")[0])+"."+r+"."+n},t.getSortableDateFromString=function(e){var o=e.replace(",","").split(".");if(o.length<=1)return e;var r=o[o.length-1].split(" "),n=t.Empty;r.length>1&&(n=r[r.length-1]);var i=o[o.length-1].split(" ")[0]+"-"+o[o.length-2]+"-"+o[o.length-3];return!t.IsNullOrWhiteSpace(n)&&n.length>1?i+="T"+n:i+="T00:00:00",i},t.formatNumber=function(t,e){var o=e.length,r=t.toString();if(o<=r.length)return r;var n=o-r.length;return new Array(n+=1).join("0")+r},t.join=function(e){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];for(var n=t.Empty,i=0;i<o.length;i++)if(!("string"==typeof o[i]&&t.IsNullOrWhiteSpace(o[i])||"number"!=typeof o[i]&&"string"!=typeof o[i])){var c=""+o[i];n+=c;for(var a=i+1;a<o.length;a++)if(!t.IsNullOrWhiteSpace(o[a])){n+=e,i=a-1;break}}return n},t.regexNumber=/{(\d+(:\w*)?)}/g,t.regexObject=/{(\w+(:\w*)?)}/g,t.Empty="",t}();o.String=n;var i=function(){function t(t){this.Values=[],n.IsNullOrWhiteSpace(t)||(this.Values=new Array(t))}return t.prototype.ToString=function(){return this.Values.join("")},t.prototype.Append=function(t){this.Values.push(t)},t.prototype.AppendLine=function(t){this.Values.push("\r\n"+t)},t.prototype.AppendFormat=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];this.Values.push(n.Format.apply(n,r([t],e)))},t.prototype.AppendLineFormat=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];this.Values.push("\r\n"+n.Format.apply(n,r([t],e)))},t.prototype.Clear=function(){this.Values=[]},t}();o.StringBuilder=i},{}],Act:[function(t,e,o){"use strict";cc._RF.push(e,"123a7yTZwpP9pkvWBEmAOA1","Act"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleActRaw=void 0,o.ruleActRaw=[{act:0,enemyCount:0,spawnCool:0,maxLevel:1},{act:1,enemyCount:16,spawnCool:1.2,maxLevel:100}],cc._RF.pop()},{}],App:[function(t,e,o){"use strict";cc._RF.push(e,"b6b85k6jj5Iu4j/QobrKsgP","App");var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.app=o.App=o.SceneType=void 0;var i=t("./common/util/EventHandler"),c=t("./common/util/Utils");(function(t){t[t.Intro="Intro"]="Intro",t[t.World="World"]="World"})(o.SceneType||(o.SceneType={}));var a=function(){function t(){this.onSceneLoaded=new i.EventHandlerT1,this.mainUI=null,this.ready=!1,this.loadingScene=!1}return t.prototype.loadScene=function(t,e){return r(this,void 0,void 0,function(){var o=this;return n(this,function(r){switch(r.label){case 0:return this.loadingScene?[2]:(this.loadingScene=!0,cc.director.getCollisionManager().enabled=!0,cc.director.getPhysicsManager().enabled=!0,e&&this.mainUI.playFadeOut(),[4,c.Utils.sleep(.25)]);case 1:return r.sent(),cc.director.loadScene(t.toString(),function(){o.loadingScene=!1,o.onSceneLoaded.fire(t)}),[2]}})})},t}();o.App=a,o.app=new a,cc._RF.pop()},{"./common/util/EventHandler":"EventHandler","./common/util/Utils":"Utils"}],Artifact:[function(t,e,o){"use strict";cc._RF.push(e,"efc8262UxJJXrGExT1K9H6p","Artifact"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleArtifactRaw=void 0,o.ruleArtifactRaw=[{code:601,category:"Rune",type:"PhysicalAttack",minV:3,maxV:3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:602,category:"Rune",type:"PhysicalAttack",minV:3,maxV:3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:603,category:"Rune",type:"PhysicalAttack",minV:3,maxV:3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:604,category:"Rune",type:"CoolReduction",minV:.08,maxV:.08,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:605,category:"Rune",type:"CoolReduction",minV:.08,maxV:.08,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:606,category:"Rune",type:"FireAttack",minV:3,maxV:3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:607,category:"Rune",type:"FireAttack",minV:3,maxV:3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:608,category:"Rune",type:"ColdAttack",minV:2,maxV:2,ccType:"Slow",ccEffect:"Cold",ccFireRate:.3,ccDuration:2,ccV1:.3,ccV2:0,ccV3:0},{code:609,category:"Rune",type:"ColdAttack",minV:2,maxV:2,ccType:"Slow",ccEffect:"Cold",ccFireRate:.3,ccDuration:2,ccV1:.3,ccV2:0,ccV3:0},{code:610,category:"Rune",type:"LightningAttack",minV:2,maxV:2,ccType:"Hurt",ccEffect:"None",ccFireRate:.3,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:611,category:"Rune",type:"LightningAttack",minV:2,maxV:2,ccType:"Hurt",ccEffect:"None",ccFireRate:.3,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:612,category:"Rune",type:"PoisonAttack",minV:2,maxV:2,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.3,ccDuration:2,ccV1:2,ccV2:0,ccV3:0},{code:613,category:"Rune",type:"PoisonAttack",minV:2,maxV:2,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.3,ccDuration:2,ccV1:2,ccV2:0,ccV3:0},{code:614,category:"Rune",type:"AttackBoostLessHp",minV:.3,maxV:.3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:615,category:"Rune",type:"AttackBoostLessHp",minV:.3,maxV:.3,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:631,category:"Food",type:"Life",minV:7,maxV:7,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:632,category:"Food",type:"Life",minV:7,maxV:7,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:633,category:"Food",type:"Life",minV:7,maxV:7,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:634,category:"Food",type:"Life",minV:7,maxV:7,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:635,category:"Food",type:"Defense",minV:70,maxV:70,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:636,category:"Food",type:"Defense",minV:70,maxV:70,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:637,category:"Food",type:"Defense",minV:70,maxV:70,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:638,category:"Food",type:"PhysicalResist",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:639,category:"Food",type:"PhysicalResist",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:640,category:"Food",type:"MagicResist",minV:.15,maxV:.15,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:641,category:"Food",type:"MagicResist",minV:.15,maxV:.15,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:642,category:"Food",type:"MagicDurationReduction",minV:.2,maxV:.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:643,category:"Food",type:"MagicDurationReduction",minV:.2,maxV:.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:644,category:"Food",type:"LifeStolenPerHit",minV:.0015,maxV:.0015,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:645,category:"Food",type:"LifeStolenPerHit",minV:.0015,maxV:.0015,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:661,category:"Special",type:"DropBonus",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:662,category:"Special",type:"DropBonus",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:663,category:"Special",type:"BonusChest",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:664,category:"Special",type:"BonusChest",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:665,category:"Special",type:"BonusBarrel",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:666,category:"Special",type:"BonusBarrel",minV:.1,maxV:.1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:667,category:"Special",type:"CircleSpeed",minV:.12,maxV:.12,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:668,category:"Special",type:"GhostDR",minV:.25,maxV:.25,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:669,category:"Special",type:"MeteorCR",minV:-.2,maxV:-.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:670,category:"Special",type:"BonusLifeLB",minV:.2,maxV:.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:671,category:"Special",type:"MagicBombBM",minV:1,maxV:1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:672,category:"Special",type:"IcePillarCR",minV:-.2,maxV:-.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:673,category:"Special",type:"LightningStrikeCR",minV:-.2,maxV:-.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:674,category:"Special",type:"LightningShieldCR",minV:-.2,maxV:-.2,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:675,category:"Special",type:"BonusSkill",minV:1,maxV:1,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0}],cc._RF.pop()},{}],AverageFilter:[function(t,e,o){"use strict";cc._RF.push(e,"6e07eE6MQ5FBZcsp/GPNkJo","AverageFilter"),Object.defineProperty(o,"__esModule",{value:!0}),o.AverageFilterV2=o.FilterV2Item=void 0;var r=t("linked-list-typescript");o.FilterV2Item=function(){};var n=function(){function t(t){this.sumTime=0,this.inputCount=0,this.sumValue=cc.Vec2.ZERO,this.avg=cc.Vec2.ZERO,this.clear(),this.time=t}return t.prototype.getValue=function(){return this.avg},t.prototype.clear=function(){this.raw=new r.LinkedList,this.sumValue=cc.Vec2.ZERO,this.avg=cc.Vec2.ZERO,this.sumTime=0,this.inputCount=0},t.prototype.filter=function(t,e){if(this.time<this.sumTime){var o=this.raw.head;this.sumTime-=o.dt,this.sumValue=this.sumValue.subtract(o.value),this.raw.removeHead()}return this.raw.append({dt:e,value:t}),this.sumTime+=e,this.sumValue=this.sumValue.add(t),this.avg=this.sumValue.div(this.raw.length),this.inputCount++,this.avg},t}();o.AverageFilterV2=n,cc._RF.pop()},{"linked-list-typescript":1}],BeanContainer:[function(t,e,o){"use strict";cc._RF.push(e,"89473cFIf9FD57kIir0SHv5","BeanContainer");var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.beanContainer=void 0;var i=t("../util/Utils"),c=function(){function t(){this.beans=new Array,this.map=new Map}return t.prototype.addBean=function(t){this.map.has(t.name)?console.error("Same service exist "+t.name):(this.beans.push(t),this.map.set(t.name,t))},t.prototype.getBean=function(t){return this.map.get(t)},t.prototype.get=function(t){return this.map.get(t).instance},t.prototype.initialize=function(t){return void 0===t&&(t=null),r(this,void 0,void 0,function(){var e,o,r,c,a,s,l,u,p,d;return n(this,function(n){switch(n.label){case 0:console.debug("Initialize "+this.beans.length+" bean(s)"),e=0,o=0,r=this.beans,n.label=1;case 1:return o<r.length?null==(d=r[o]).instance?(console.error("no instance found"),[3,4]):null==d.instance.initialize?[3,3]:(c=i.Utils.currentTimeMillis(),[4,d.instance.initialize()]):[3,5];case 2:a=n.sent(),s=i.Utils.currentTimeMillis(),l=s-c,a?console.warn(d.name+" initialized done: "+l+"ms"):console.warn(d.name+" initialized failed!"),n.label=3;case 3:e++,t&&t(e/this.beans.length),n.label=4;case 4:return o++,[3,1];case 5:console.debug("Start "+this.beans.length+" bean(s)"),u=0,p=this.beans,n.label=6;case 6:return u<p.length?void 0===(d=p[u]).instance.onStart?[3,8]:[4,d.instance.onStart()]:[3,9];case 7:n.sent(),n.label=8;case 8:return u++,[3,6];case 9:return[2]}})})},t}();o.beanContainer=new c,cc._RF.pop()},{"../util/Utils":"Utils"}],Bec:[function(t,e,o){"use strict";cc._RF.push(e,"ed9caKw6utG8Zl8CRTKRju8","Bec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.Bec=void 0;var n=t("../bean/Decorators"),i=t("./Utils"),c=function(){function t(){this.defaultThreshold=.5,this.buttons=new Map}return t.prototype.can_=function(){return this.canFor_("default")},t.prototype.canFor_=function(t){return this.canEnter_(t,this.defaultThreshold)},t.prototype.canEnter_=function(t,e){var o=i.Utils.currentTimeMillis(),r=this.buttons.get(t);return!(r&&(o-r)/1e3<e)&&(this.buttons.set(t,o),this.soundService.playFx("click"),!0)},t.can=function(){return t.ready().can_()},t.canFor=function(e){return t.ready().canFor_(e)},t.canEnter=function(e,o){return t.ready().canEnter_(e,o)},t.ready=function(){return t.instance||(t.instance=new t),t.instance},t.instance=null,r([n.autoWired("SoundService")],t.prototype,"soundService",void 0),t}();o.Bec=c,cc._RF.pop()},{"../bean/Decorators":"Decorators","./Utils":"Utils"}],BlackPanel:[function(t,e,o){"use strict";cc._RF.push(e,"dd126q0kZNJCJOI86YTLh1U","BlackPanel");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=t("./GoItem"),s=t("../bean/Decorators"),l=t("./Bec"),u=t("../coroutine/EaseRoutine"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ob=null,e.routine=null,e}return n(e,t),e.prototype.onLoad=function(){this.node.opacity=0},e.prototype.display=function(t){var e=this;this.ob=t,this.node.active=!0,this.updatePosition(),null!=this.routine&&this.routine.stop();var o=255*t.queryBlackPanelAlpha();this.routine=this.startRoutine().easeNoTimeScaled(u.EaseType.easeOutQuad,.1,function(){return e.node.opacity},function(t,r){e.node.opacity=u.Ease.lerp(t,o,r)},function(){return e.routine=null})},e.prototype.hide=function(){var t=this;null!=this.routine&&this.routine.stop(),this.routine=this.startRoutine().easeNoTimeScaled(u.EaseType.easeInQuad,.1,function(){return t.node.opacity},function(e,o){t.node.opacity=u.Ease.lerp(e,0,o)},function(){t.routine=null,t.goPooler.returnGo(t)})},e.prototype.onClickBlackPanel=function(){l.Bec.can()&&this.ob.onClickBlackPanel()},e.prototype.updatePosition=function(){var t=this.ob.queryBlackTargetPanel();this.node.parent=t.parent;var e=this.node.getSiblingIndex(),o=t.getSiblingIndex();e<o&&o--,this.node.setSiblingIndex(o),this.node.setPosition(cc.v2(0,0))},i([s.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(a.default);o.default=p,cc._RF.pop()},{"../bean/Decorators":"Decorators","../coroutine/EaseRoutine":"EaseRoutine","./Bec":"Bec","./GoItem":"GoItem"}],CcUtils:[function(t,e,o){"use strict";cc._RF.push(e,"54cd20Z+gtN15qUBDFdA6TF","CcUtils"),Object.defineProperty(o,"__esModule",{value:!0}),o.CcUtils=void 0;var r=function(){function t(){}return t.setTimeScale=function(e){t.timeScale=e,cc.director.calculateDeltaTime=function(t){t||(t=performance.now()),this._deltaTime=(t-this._lastUpdate)/1e3,this._deltaTime*=e,this._lastUpdate=t}},t.timeScale=1,t}();o.CcUtils=r,cc._RF.pop()},{}],CoContainer:[function(t,e,o){"use strict";cc._RF.push(e,"6576eiRJyBH2INV0mOlkL9V","CoContainer");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.CoContainer=o.CoroutineKey=void 0;var i=t("./WaitRoutine"),c=t("./EaseRoutine"),a=t("../util/CcUtils"),s=function(){function t(){this.routines=new Array,this.current=null}return t.prototype.next=function(t){return this.routines.push(t),this},t.prototype.wait=function(t,e){return void 0===e&&(e=null),this.next(new i.WaitRoutine(t,e,!0))},t.prototype.waitNoTimeScaled=function(t,e){return void 0===e&&(e=null),this.next(new i.WaitRoutine(t,e,!1))},t.prototype.do=function(t){return void 0===t&&(t=null),this.next(new i.WaitRoutine(0,t,!0))},t.prototype.doNoTimeScaled=function(t){return void 0===t&&(t=null),this.next(new i.WaitRoutine(0,t,!1))},t.prototype.ease=function(t,e,o,r,n){return void 0===n&&(n=null),this.next(new c.EaseRoutine(t,e,o,r,n,!0))},t.prototype.easeNoTimeScaled=function(t,e,o,r,n){return void 0===n&&(n=null),this.next(new c.EaseRoutine(t,e,o,r,n,!1))},t.prototype.move=function(t,e,o,r,n){return void 0===n&&(n=null),this.ease(e,o,function(){return t.getPosition()},function(e,o){var n=cc.v2();n=cc.Vec2.lerp(n,e,r,o),t.setPosition(n)},n)},t.prototype.moveNoTimeScaled=function(t,e,o,r,n){return void 0===n&&(n=null),this.easeNoTimeScaled(e,o,function(){return t.getPosition()},function(e,o){var n=cc.v2();n=cc.Vec2.lerp(n,e,r,o),t.setPosition(n)},n)},t.prototype.scale=function(t,e,o,r,n){return void 0===n&&(n=null),this.ease(e,o,function(){return t.scale},function(e,o){t.scale=c.Ease.lerp(e,r,o)},n)},t.prototype.scaleNoTimeScaled=function(t,e,o,r,n){return void 0===n&&(n=null),this.easeNoTimeScaled(e,o,function(){return t.scale},function(e,o){t.scale=c.Ease.lerp(e,r,o)},n)},t.prototype.scaleXY=function(t,e,o,r,n){void 0===n&&(n=null);var i=cc.v2();return this.ease(e,o,function(){return t.getScale(i)},function(e,o){var r=cc.v2(0,0);r=cc.Vec2.lerp(r,e,r,o),t.setScale(r)},n)},t.prototype.scaleXYNoTimeScaled=function(t,e,o,r,n){void 0===n&&(n=null);var i=cc.v2();return this.easeNoTimeScaled(e,o,function(){return t.getScale(i)},function(e,o){var r=cc.v2(0,0);r=cc.Vec2.lerp(r,e,r,o),t.setScale(r)},n)},t.prototype.opacity=function(t,e,o,r,n){return void 0===n&&(n=null),this.ease(e,o,function(){return t.opacity},function(e,o){t.opacity=c.Ease.lerp(e,r,o)},n)},t.prototype.opacityNoTimeScaled=function(t,e,o,r,n){return void 0===n&&(n=null),this.easeNoTimeScaled(e,o,function(){return t.opacity},function(e,o){t.opacity=c.Ease.lerp(e,r,o)},n)},t.prototype.isDone=function(){return 0==this.routines.length&&null==this.current},t.prototype.onUpdate=function(t){if(0!=this.routines.length||null!=this.current){this.current||(this.current=this.routines[0],this.current.onStart(),this.routines.splice(0,1));var e=t;this.current.timeScaled()||(e/=a.CcUtils.timeScale),this.current.onUpdate(e),this.current.isDone()&&(this.current=null)}},t.prototype.stop=function(){this.routines=[],this.current=null},t}();o.CoroutineKey=s;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.routines=new Set,e}return n(e,t),e.prototype.onDisable=function(){this.routines.clear()},e.prototype.startRoutine=function(){var t=new s;return this.routines.add(t),t},e.prototype.stopCoroutineSafe=function(t){t&&t.stop()},e.prototype.update=function(t){var e=this;if(0!=this.routines.size){var o=null;this.routines.forEach(function(e){e.onUpdate(t),e.isDone()&&(o||(o=new Array),o.push(e))}),null!=o&&o.forEach(function(t){e.routines.delete(t)})}},e}(cc.Component);o.CoContainer=l,cc._RF.pop()},{"../util/CcUtils":"CcUtils","./EaseRoutine":"EaseRoutine","./WaitRoutine":"WaitRoutine"}],ColorPanel:[function(t,e,o){"use strict";cc._RF.push(e,"0b11eFO3jFPdK7aFsIreSJ9","ColorPanel");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator.ccclass,l=t("./Utils"),u=t("../bean/Decorators"),p=t("../coroutine/EaseRoutine"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.routine=null,e}return n(e,t),e.prototype.onLoad=function(){},e.prototype.init=function(t,e){this.node.color=t,this.node.opacity=e,this.node.active=!0},e.prototype.show=function(t){return c(this,void 0,void 0,function(){var e,o=this;return a(this,function(r){switch(r.label){case 0:e=!1,null!=this.routine&&this.routine.stop(),this.routine=this.startRoutine().easeNoTimeScaled(p.EaseType.easeOutQuad,t,function(){return o.node.opacity},function(t,e){o.node.opacity=p.Ease.lerp(t,255,e)},function(){o.routine=null,e=!0}),r.label=1;case 1:return e?[3,3]:[4,l.Utils.sleep(.01)];case 2:return r.sent(),[3,1];case 3:return[2]}})})},e.prototype.hide=function(t){return c(this,void 0,void 0,function(){var e,o=this;return a(this,function(r){switch(r.label){case 0:e=!1,null!=this.routine&&this.routine.stop(),this.routine=this.startRoutine().easeNoTimeScaled(p.EaseType.easeInQuad,t,function(){return o.node.opacity},function(t,e){o.node.opacity=p.Ease.lerp(t,0,e)},function(){e=!0,o.routine=null,o.node.active=!1}),r.label=1;case 1:return e?[3,3]:[4,l.Utils.sleep(.01)];case 2:return r.sent(),[3,1];case 3:return[2]}})})},e.prototype.blink=function(t,e,o){return void 0===t&&(t=.25),void 0===e&&(e=.5),void 0===o&&(o=.25),c(this,void 0,void 0,function(){return a(this,function(r){switch(r.label){case 0:return[4,this.show(t)];case 1:return r.sent(),[4,l.Utils.sleep(e)];case 2:return r.sent(),[4,this.hide(o)];case 3:return r.sent(),[2]}})})},i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([s],e)}(t("../coroutine/CoContainer").CoContainer);o.default=d,cc._RF.pop()},{"../bean/Decorators":"Decorators","../coroutine/CoContainer":"CoContainer","../coroutine/EaseRoutine":"EaseRoutine","./Utils":"Utils"}],CommonAlertBox:[function(t,e,o){"use strict";cc._RF.push(e,"81c6aAyxVtExrE0gT3djCgX","CommonAlertBox");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AlertResultType=o.AlertType=void 0;var s,l=cc._decorator.ccclass,u=cc._decorator.property,p=t("./Utils"),d=t("./Popup"),h=t("../../App");(function(t){t[t.Ok="Ok"]="Ok",t[t.OkCancel="OkCancel"]="OkCancel",t[t.YesNo="YesNo"]="YesNo"})(o.AlertType||(o.AlertType={})),function(t){t[t.None="None"]="None",t[t.Ok="Ok"]="Ok",t[t.Cancel="Cancel"]="Cancel",t[t.Yes="Yes"]="Yes",t[t.No="No"]="No"}(s=o.AlertResultType||(o.AlertResultType={}));var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.messageLabel=null,e.footers=null,e.result=s.None,e}return n(e,t),e.prototype.show=function(t,e){return c(this,void 0,Promise,function(){var o;return a(this,function(r){switch(r.label){case 0:return this.node.active=!0,this.node.opacity=1,this.result=s.None,this.messageLabel.string=t,[4,p.Utils.sleep(.01)];case 1:return r.sent(),o=this.messageLabel.node.height,this.node.height=Math.max(400,o+200),this.node.active=!1,[4,p.Utils.sleep(.01)];case 2:r.sent(),this.node.active=!0,this.footers.children.forEach(function(t){t.active=t.name==e.toString()}),this.display(null,null),r.label=3;case 3:return this.result!=s.None?[3,5]:[4,p.Utils.sleep(.1)];case 4:return r.sent(),[3,3];case 5:return this.hide(),[2,this.result]}})})},e.prototype.onDisplay=function(){h.app.mainUI.showBlackPanel(this)},e.prototype.onHide=function(){h.app.mainUI.hideBlackPanel(this)},e.prototype.onClickOk=function(){this.result=s.Ok},e.prototype.onClickCancel=function(){this.result=s.Cancel},e.prototype.onClickYes=function(){this.result=s.Yes},e.prototype.onClickNo=function(){this.result=s.No},e.prototype.onClickBlackPanel=function(){},e.prototype.queryBlackPanelAlpha=function(){return.5},e.prototype.queryBlackTargetPanel=function(){return this.node},i([u(cc.Label)],e.prototype,"messageLabel",void 0),i([u(cc.Node)],e.prototype,"footers",void 0),i([l],e)}(d.PopupBase);o.default=f,cc._RF.pop()},{"../../App":"App","./Popup":"Popup","./Utils":"Utils"}],Coroutine:[function(t,e,o){"use strict";cc._RF.push(e,"92d67JUb89C6ZmoGf1FAemr","Coroutine"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],Decorators:[function(t,e,o){"use strict";cc._RF.push(e,"32edcOsBl9CnKB61wU292ms","Decorators"),Object.defineProperty(o,"__esModule",{value:!0}),o.autoWired=o.controller=o.component=o.repository=o.service=void 0;var r=t("./BeanContainer");function n(t,e,o){i(t.constructor,e,o)}function i(t,e,o){var n="__"+e;Object.defineProperty(t.prototype,e,{enumerable:!0,get:function(){return this[n]?this[n]:this[n]=r.beanContainer.getBean(o).instance},set:function(t){this[n]=t}})}o.service=function(t){return function(e){var o=new e;r.beanContainer.addBean({name:t,instance:o})}},o.repository=function(t){return function(e){var o=new e;r.beanContainer.addBean({name:t,instance:o})}},o.component=function(t){return function(e){var o=new e;r.beanContainer.addBean({name:t,instance:o})}},o.controller=function(t){return function(e){var o=new e;r.beanContainer.addBean({name:t,instance:o})}},o.autoWired=function(t){return function(e,o){return n(e,o,t)}},cc._RF.pop()},{"./BeanContainer":"BeanContainer"}],Drop:[function(t,e,o){"use strict";cc._RF.push(e,"3cb74aiz+FCHqfYg2Osey2M","Drop"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleDropRaw=void 0,o.ruleDropRaw=[{type:"Item",rate:.05,levelBonus:0},{type:"NormalItemR",rate:1e3,levelBonus:0},{type:"MagicItemR",rate:400,levelBonus:0},{type:"RareItemR",rate:5,levelBonus:0},{type:"Chest",rate:.04,levelBonus:0},{type:"ChestItemR",rate:1e3,levelBonus:0},{type:"ChestArtifactR",rate:20,levelBonus:.025},{type:"ChestResourceR",rate:500,levelBonus:0},{type:"ChestGoldR",rate:0,levelBonus:0},{type:"Resource",rate:.1,levelBonus:0}],cc._RF.pop()},{}],EaseRoutine:[function(t,e,o){"use strict";var r;cc._RF.push(e,"d9634IZq1FH/ISoY/xUHeaW","EaseRoutine"),Object.defineProperty(o,"__esModule",{value:!0}),o.Ease=o.EaseRoutine=o.EaseType=void 0,function(t){t[t.linear=0]="linear",t[t.easeInQuad=1]="easeInQuad",t[t.easeOutQuad=2]="easeOutQuad",t[t.easeInOutQuad=3]="easeInOutQuad",t[t.easeInSine=4]="easeInSine",t[t.easeOutSine=5]="easeOutSine",t[t.easeInOutSine=6]="easeInOutSine"}(r=o.EaseType||(o.EaseType={}));var n=function(){function t(t,e,o,n,i,c){this.done=!1,this.duration=1,this.play=0,this.easeType=r.easeOutQuad,this.from=null,this.timeScaleAffected=!0,this.easeType=t,this.duration=e,this.onBegin=o,this.onProgress=n,this.onDone=i,this.timeScaleAffected=c}return t.prototype.onStart=function(){null!=this.onBegin&&(this.from=this.onBegin()),this.onProgress(this.from,this.getValue(0))},t.prototype.onUpdate=function(t){if(!this.isDone()){var e=0;this.approximately(this.duration,0)?e=1:(this.play+=t,e=this.play/this.duration),e=Math.min(e,1),this.onProgress(this.from,this.getValue(e)),this.play>=this.duration&&!this.done&&(this.done=!0,this.onDone&&this.onDone())}},t.prototype.isDone=function(){return this.done},t.prototype.stop=function(){this.done=!0},t.prototype.timeScaled=function(){return this.timeScaleAffected},t.prototype.getValue=function(t){return i.run(this.easeType,0,1,t)},t.prototype.approximately=function(t,e){return Math.abs(t-e)<1e-4},t}();o.EaseRoutine=n;var i=function(){function t(){}return t.run=function(e,o,n,i){switch(e){case r.linear:return t.linear(o,n,i);case r.easeInQuad:return t.easeInQuad(o,n,i);case r.easeOutQuad:return t.easeOutQuad(o,n,i);case r.easeInOutQuad:return t.easeInOutQuad(o,n,i);case r.easeInSine:return t.easeInSine(o,n,i);case r.easeOutSine:return t.easeOutSine(o,n,i);case r.easeInOutSine:return t.easeInOutSine(o,n,i)}return 0},t.lerp=function(t,e,o){return t+(e-t)*o},t.linear=function(e,o,r){return t.lerp(e,o,r)},t.easeInQuad=function(e,o,r){return t.lerp(e,o,r*r)},t.easeOutQuad=function(e,o,r){return t.lerp(e,o,-r*(r-2))},t.easeInOutQuad=function(e,o,r){return t.easeInOutSine(e,o,r)},t.easeInSine=function(e,o,r){return t.lerp(e,o,1-Math.cos(r*t.kHalfPi))},t.easeOutSine=function(e,o,r){return t.lerp(e,o,Math.sin(r*t.kHalfPi))},t.easeInOutSine=function(e,o,r){return t.lerp(e,o,.5*(1-Math.cos(Math.PI*r)))},t.kHalfPi=.5*Math.PI,t.kDoublePi=2*Math.PI,t}();o.Ease=i,cc._RF.pop()},{}],EnemyLevel:[function(t,e,o){"use strict";cc._RF.push(e,"07a2bH8JKRLnpHHVytQREG0","EnemyLevel"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleEnemyLevelRaw=void 0,o.ruleEnemyLevelRaw=[{level:1,lifeBoost:0,attackBoost:0,defenseBoost:0},{level:2,lifeBoost:.4,attackBoost:.3,defenseBoost:.1},{level:3,lifeBoost:.84,attackBoost:.63,defenseBoost:.21},{level:4,lifeBoost:1.32,attackBoost:.99,defenseBoost:.33},{level:5,lifeBoost:1.84,attackBoost:1.38,defenseBoost:.46},{level:6,lifeBoost:2.4,attackBoost:1.8,defenseBoost:.6},{level:7,lifeBoost:3,attackBoost:2.25,defenseBoost:.75},{level:8,lifeBoost:3.64,attackBoost:2.73,defenseBoost:.91},{level:9,lifeBoost:4.32,attackBoost:3.24,defenseBoost:1.08},{level:10,lifeBoost:5.04,attackBoost:3.78,defenseBoost:1.26},{level:11,lifeBoost:5.8,attackBoost:4.35,defenseBoost:1.45},{level:12,lifeBoost:6.6,attackBoost:4.95,defenseBoost:1.65},{level:13,lifeBoost:7.44,attackBoost:5.58,defenseBoost:1.86},{level:14,lifeBoost:8.32,attackBoost:6.24,defenseBoost:2.08},{level:15,lifeBoost:9.24,attackBoost:6.93,defenseBoost:2.31},{level:16,lifeBoost:10.2,attackBoost:7.65,defenseBoost:2.55},{level:17,lifeBoost:11.2,attackBoost:8.4,defenseBoost:2.8},{level:18,lifeBoost:12.24,attackBoost:9.18,defenseBoost:3.06},{level:19,lifeBoost:13.32,attackBoost:9.99,defenseBoost:3.33},{level:20,lifeBoost:14.44,attackBoost:10.83,defenseBoost:3.61},{level:21,lifeBoost:15.6,attackBoost:11.7,defenseBoost:3.9},{level:22,lifeBoost:16.8,attackBoost:12.6,defenseBoost:4.2},{level:23,lifeBoost:18.04,attackBoost:13.53,defenseBoost:4.51},{level:24,lifeBoost:19.32,attackBoost:14.49,defenseBoost:4.83},{level:25,lifeBoost:20.64,attackBoost:15.48,defenseBoost:5.16},{level:26,lifeBoost:22,attackBoost:16.5,defenseBoost:5.5},{level:27,lifeBoost:23.4,attackBoost:17.55,defenseBoost:5.85},{level:28,lifeBoost:24.84,attackBoost:18.63,defenseBoost:6.21},{level:29,lifeBoost:26.32,attackBoost:19.74,defenseBoost:6.58},{level:30,lifeBoost:27.84,attackBoost:20.88,defenseBoost:6.96},{level:31,lifeBoost:29.4,attackBoost:22.05,defenseBoost:7.35},{level:32,lifeBoost:31,attackBoost:23.25,defenseBoost:7.75},{level:33,lifeBoost:32.64,attackBoost:24.48,defenseBoost:8.16},{level:34,lifeBoost:34.32,attackBoost:25.74,defenseBoost:8.58},{level:35,lifeBoost:36.04,attackBoost:27.03,defenseBoost:9.01},{level:36,lifeBoost:37.8,attackBoost:28.35,defenseBoost:9.45},{level:37,lifeBoost:39.6,attackBoost:29.7,defenseBoost:9.9},{level:38,lifeBoost:41.44,attackBoost:31.08,defenseBoost:10.36},{level:39,lifeBoost:43.32,attackBoost:32.49,defenseBoost:10.83},{level:40,lifeBoost:45.24,attackBoost:33.93,defenseBoost:11.31},{level:41,lifeBoost:47.2,attackBoost:35.4,defenseBoost:11.8},{level:42,lifeBoost:49.2,attackBoost:36.9,defenseBoost:12.3},{level:43,lifeBoost:51.24,attackBoost:38.43,defenseBoost:12.81},{level:44,lifeBoost:53.32,attackBoost:39.99,defenseBoost:13.33},{level:45,lifeBoost:55.44,attackBoost:41.58,defenseBoost:13.86},{level:46,lifeBoost:57.6,attackBoost:43.2,defenseBoost:14.4},{level:47,lifeBoost:59.8,attackBoost:44.85,defenseBoost:14.95},{level:48,lifeBoost:62.04,attackBoost:46.53,defenseBoost:15.51},{level:49,lifeBoost:64.32,attackBoost:48.24,defenseBoost:16.08},{level:50,lifeBoost:66.64,attackBoost:49.98,defenseBoost:16.66},{level:51,lifeBoost:69,attackBoost:51.75,defenseBoost:17.25},{level:52,lifeBoost:71.4,attackBoost:53.55,defenseBoost:17.85},{level:53,lifeBoost:73.84,attackBoost:55.38,defenseBoost:18.46},{level:54,lifeBoost:76.32,attackBoost:57.24,defenseBoost:19.08},{level:55,lifeBoost:78.84,attackBoost:59.13,defenseBoost:19.71},{level:56,lifeBoost:81.4,attackBoost:61.05,defenseBoost:20.35},{level:57,lifeBoost:84,attackBoost:63,defenseBoost:21},{level:58,lifeBoost:86.64,attackBoost:64.98,defenseBoost:21.66},{level:59,lifeBoost:89.32,attackBoost:66.99,defenseBoost:22.33},{level:60,lifeBoost:92.04,attackBoost:69.03,defenseBoost:23.01},{level:61,lifeBoost:94.8,attackBoost:71.1,defenseBoost:23.7},{level:62,lifeBoost:97.6,attackBoost:73.2,defenseBoost:24.4},{level:63,lifeBoost:100.44,attackBoost:75.33,defenseBoost:25.11},{level:64,lifeBoost:103.32,attackBoost:77.49,defenseBoost:25.83},{level:65,lifeBoost:106.24,attackBoost:79.68,defenseBoost:26.56},{level:66,lifeBoost:109.2,attackBoost:81.9,defenseBoost:27.3},{level:67,lifeBoost:112.2,attackBoost:84.15,defenseBoost:28.05},{level:68,lifeBoost:115.24,attackBoost:86.43,defenseBoost:28.81},{level:69,lifeBoost:118.32,attackBoost:88.74,defenseBoost:29.58},{level:70,lifeBoost:121.44,attackBoost:91.08,defenseBoost:30.36},{level:71,lifeBoost:124.6,attackBoost:93.45,defenseBoost:31.15},{level:72,lifeBoost:127.8,attackBoost:95.85,defenseBoost:31.95},{level:73,lifeBoost:131.04,attackBoost:98.28,defenseBoost:32.76},{level:74,lifeBoost:134.32,attackBoost:100.74,defenseBoost:33.58},{level:75,lifeBoost:137.64,attackBoost:103.23,defenseBoost:34.41},{level:76,lifeBoost:141,attackBoost:105.75,defenseBoost:35.25},{level:77,lifeBoost:144.4,attackBoost:108.3,defenseBoost:36.1},{level:78,lifeBoost:147.84,attackBoost:110.88,defenseBoost:36.96},{level:79,lifeBoost:151.32,attackBoost:113.49,defenseBoost:37.83},{level:80,lifeBoost:154.84,attackBoost:116.13,defenseBoost:38.71},{level:81,lifeBoost:158.4,attackBoost:118.8,defenseBoost:39.6},{level:82,lifeBoost:162,attackBoost:121.5,defenseBoost:40.5},{level:83,lifeBoost:165.64,attackBoost:124.23,defenseBoost:41.41},{level:84,lifeBoost:169.32,attackBoost:126.99,defenseBoost:42.33},{level:85,lifeBoost:173.04,attackBoost:129.78,defenseBoost:43.26},{level:86,lifeBoost:176.8,attackBoost:132.6,defenseBoost:44.2},{level:87,lifeBoost:180.6,attackBoost:135.45,defenseBoost:45.15},{level:88,lifeBoost:184.44,attackBoost:138.33,defenseBoost:46.11},{level:89,lifeBoost:188.32,attackBoost:141.24,defenseBoost:47.08},{level:90,lifeBoost:192.24,attackBoost:144.18,defenseBoost:48.06},{level:91,lifeBoost:196.2,attackBoost:147.15,defenseBoost:49.05},{level:92,lifeBoost:200.2,attackBoost:150.15,defenseBoost:50.05},{level:93,lifeBoost:204.24,attackBoost:153.18,defenseBoost:51.06},{level:94,lifeBoost:208.32,attackBoost:156.24,defenseBoost:52.08},{level:95,lifeBoost:212.44,attackBoost:159.33,defenseBoost:53.11},{level:96,lifeBoost:216.6,attackBoost:162.45,defenseBoost:54.15},{level:97,lifeBoost:220.8,attackBoost:165.6,defenseBoost:55.2},{level:98,lifeBoost:225.04,attackBoost:168.78,defenseBoost:56.26},{level:99,lifeBoost:229.32,attackBoost:171.99,defenseBoost:57.33},{level:100,lifeBoost:233.64,attackBoost:175.23,defenseBoost:58.41}],cc._RF.pop()},{}],Enemy:[function(t,e,o){"use strict";cc._RF.push(e,"c7c0flC0dpBEq6aN+VX0WOg","Enemy"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleEnemyRaw=void 0,o.ruleEnemyRaw=[{code:10,life:18,walkSpeed:"Normal",radius:.5,ai:"Default",body:"Default",attackType:"PhysicalAttack",attack:4,attackRange:"Shorter",attackSpeed:"Fast",defense:50,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:10,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:11,life:18,walkSpeed:"Fast",radius:.5,ai:"Default",body:"Default",attackType:"PhysicalAttack",attack:4,attackRange:"Shorter",attackSpeed:"Fast",defense:50,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:10,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:100,life:25,walkSpeed:"Normal",radius:.5,ai:"Default",body:"Default",attackType:"PoisonAttack",attack:5,attackRange:"Shorter",attackSpeed:"Normal",defense:100,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:5,v2:0,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.7,ccDuration:3,ccV1:1,ccV2:0,ccV3:0},{code:250,life:20,walkSpeed:"Slow",radius:.5,ai:"Default",body:"Default",attackType:"LightningAttack",attack:2,attackRange:"Long",attackSpeed:"Slower",defense:100,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"Hurt",ccEffect:"None",ccFireRate:.7,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:300,life:50,walkSpeed:"Normal",radius:.5,ai:"Default",body:"Default",attackType:"PhysicalAttack",attack:3,attackRange:"Shorter",attackSpeed:"Slow",defense:200,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:5,v2:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:20,life:20,walkSpeed:"Slow",radius:.5,ai:"Default",body:"Default",attackType:"FireAttack",attack:4,attackRange:"Long",attackSpeed:"Slow",defense:100,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:21,life:15,walkSpeed:"Slow",radius:.5,ai:"Default",body:"Default",attackType:"ColdAttack",attack:2,attackRange:"Normal",attackSpeed:"Slower",defense:100,physicalResist:0,magicResist:0,itemDropBoost:3,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"Slow",ccEffect:"Cold",ccFireRate:.7,ccDuration:.5,ccV1:.3,ccV2:0,ccV3:0},{code:22,life:15,walkSpeed:"Slow",radius:.5,ai:"Default",body:"Default",attackType:"LightningAttack",attack:4,attackRange:"Long",attackSpeed:"Slower",defense:100,physicalResist:0,magicResist:0,itemDropBoost:3,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"Hurt",ccEffect:"None",ccFireRate:.7,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:23,life:23,walkSpeed:"Slow",radius:.5,ai:"Default",body:"Default",attackType:"PoisonAttack",attack:4,attackRange:"Long",attackSpeed:"Slow",defense:100,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.7,ccDuration:3,ccV1:0,ccV2:0,ccV3:0},{code:40,life:22,walkSpeed:"Faster",radius:.5,ai:"Default",body:"Default",attackType:"PhysicalAttack",attack:4,attackRange:"Shorter",attackSpeed:"Normal",defense:100,physicalResist:0,magicResist:0,itemDropBoost:1,magicItemDropBoost:1,exp:20,s1:0,s2:0,s3:0,s4:0,v1:0,v2:0,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.3,ccDuration:2,ccV1:0,ccV2:0,ccV3:0}],cc._RF.pop()},{}],"EventHandler.spec":[function(t,e,o){"use strict";cc._RF.push(e,"ab25365L8FH5abZU1IfhY2e","EventHandler.spec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.EventHandlerTest=void 0;var n=t("testyts"),i=t("../EventHandler"),c=function(){function t(){var t=this;this.handler0=function(){t.num++}}return t.prototype.beforeAll=function(){this.num=0},t.prototype.simple=function(){var t=new i.EventHandler,e=0;t.addHandler(function(){e++}),n.expect.toBeEqual(e,0),t.fire(),n.expect.toBeEqual(e,1)},t.prototype.t1=function(){var t=new i.EventHandlerT1,e=0;t.addHandler(function(t){e=t}),n.expect.toBeEqual(e,0),t.fire(10),n.expect.toBeEqual(e,10)},t.prototype.removeHandler=function(){this.num=0;var t=new i.EventHandler;t.addHandler(this.handler0),t.fire(),n.expect.toBeEqual(this.num,1),t.removeHandler(this.handler0),t.fire(),n.expect.toBeEqual(this.num,1)},r([n.BeforeAll()],t.prototype,"beforeAll",null),r([n.Test()],t.prototype,"simple",null),r([n.Test()],t.prototype,"t1",null),r([n.Test()],t.prototype,"removeHandler",null),r([n.TestSuite()],t)}();o.EventHandlerTest=c,cc._RF.pop()},{"../EventHandler":"EventHandler",testyts:16}],EventHandler:[function(t,e,o){"use strict";cc._RF.push(e,"cb76c4U7ixJlqN8zHjvU+Qr","EventHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.EventHandlerT4=o.EventHandlerT3=o.EventHandlerT2=o.EventHandlerT1=o.EventHandler=void 0;var r=function(){function t(){this.handlers=new Array}return t.prototype.addHandler=function(t){this.handlers.push(t)},t.prototype.removeHandler=function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},t.prototype.fire=function(){Array.from(this.handlers).forEach(function(t){t()})},t}();o.EventHandler=r;var n=function(){function t(){this.handlers=new Array}return t.prototype.addHandler=function(t){this.handlers.push(t)},t.prototype.removeHandler=function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},t.prototype.fire=function(t){Array.from(this.handlers).forEach(function(e){e(t)})},t}();o.EventHandlerT1=n;var i=function(){function t(){this.handlers=new Array}return t.prototype.addHandler=function(t){this.handlers.push(t)},t.prototype.removeHandler=function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},t.prototype.fire=function(t,e){Array.from(this.handlers).forEach(function(o){o(t,e)})},t}();o.EventHandlerT2=i;var c=function(){function t(){this.handlers=new Array}return t.prototype.addHandler=function(t){this.handlers.push(t)},t.prototype.removeHandler=function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},t.prototype.fire=function(t,e,o){Array.from(this.handlers).forEach(function(r){r(t,e,o)})},t}();o.EventHandlerT3=c;var a=function(){function t(){this.handlers=new Array}return t.prototype.addHandler=function(t){this.handlers.push(t)},t.prototype.removeHandler=function(t){var e=this.handlers.indexOf(t);e>-1&&this.handlers.splice(e,1)},t.prototype.fire=function(t,e,o,r){Array.from(this.handlers).forEach(function(n){n(t,e,o,r)})},t}();o.EventHandlerT4=a,cc._RF.pop()},{}],GoItem:[function(t,e,o){"use strict";cc._RF.push(e,"ab179TVgAVIw7JmM0FyOfNW","GoItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.useCount=0,e}return n(e,t),e.prototype.isActive=function(){return this.node.active},e.prototype.onGettingOutPool=function(){},e.prototype.onGoingIntoPool=function(){},e}(t("../coroutine/CoContainer").CoContainer);o.default=i,cc._RF.pop()},{"../coroutine/CoContainer":"CoContainer"}],GoPooler:[function(t,e,o){"use strict";cc._RF.push(e,"e40adgpRGpOdItV4O1ldo8m","GoPooler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.GoPooler=void 0;var c=t("../util/GoItem"),a=t("../bean/Decorators"),s=t("../../App"),l=function(){function t(){var t=this;this.queue=new Map,this.prefabs=new Map,this.keyMap=new Map,this.keyCount=0,this.onSceneLoad=function(){t.prefabs.clear(),t.keyMap.clear(),t.queue.clear()}}return t.prototype.onStart=function(){return n(this,void 0,void 0,function(){return i(this,function(){return s.app.onSceneLoaded.addHandler(this.onSceneLoad),[2]})})},t.prototype.fromPrefab=function(t,e){if(!t)return console.error("invalid prefab"),null;var o=this.getKey(t);if(this.prefabs.set(o,t),this.queue.has(o)){var r=this.queue.get(o);if(r.length>0){var n=r.length-1,i=r[n];return r.splice(n,1),this.ready(i,e),i.getComponent(c.default)}}var a=this.newGo(o,e);return null==a?(console.error("can not load prefab "+o),null):a},t.prototype.newGo=function(t,e){var o=this.prefabs.get(t),r=cc.instantiate(o.node);if(null==r)return null;var n=r.getComponent(c.default);return this.ready(n,e),this.queue.set(t,new Array),n.path=t,n},t.prototype.returnGo=function(t){t&&(this.queue.has(t.path)?(this.queue.get(t.path).push(t),t.onGoingIntoPool(),t.node.active=!1,t.node.setPosition(999999,999999,0)):console.error("can not found queue: "+t.path))},t.prototype.returnGos=function(t){var e=this;t.forEach(function(t){e.returnGo(t)})},t.prototype.ready=function(t,e){t.node.setParent(e),t.node.setPosition(999999,999999,0),t.node.setScale(1,1,1),t.node.active=!0,t.useCount++,t.inPool=!1,t.onGettingOutPool()},t.prototype.getKey=function(t){if(this.keyMap.has(t))return this.keyMap.get(t);this.keyCount++;var e="@"+this.keyCount;return this.keyMap.set(t,e),e},r([a.component("GoPooler")],t)}();o.GoPooler=l,cc._RF.pop()},{"../../App":"App","../bean/Decorators":"Decorators","../util/GoItem":"GoItem"}],HeroLevel:[function(t,e,o){"use strict";cc._RF.push(e,"11fb02xItRLb4EKIKTPrIrG","HeroLevel"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleHeroLevelRaw=void 0,o.ruleHeroLevelRaw=[{level:1,exp:0},{level:2,exp:50},{level:3,exp:450},{level:4,exp:900},{level:5,exp:1400},{level:6,exp:1950},{level:7,exp:2550},{level:8,exp:3200},{level:9,exp:3900},{level:10,exp:4650},{level:11,exp:5450},{level:12,exp:6300},{level:13,exp:7200},{level:14,exp:8150},{level:15,exp:9150},{level:16,exp:10200},{level:17,exp:11300},{level:18,exp:12450},{level:19,exp:13650},{level:20,exp:14900}],cc._RF.pop()},{}],HeroStat:[function(t,e,o){"use strict";cc._RF.push(e,"25994nk5olLw5xKTHnDSQOD","HeroStat"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleHeroStatRaw=void 0,o.ruleHeroStatRaw=[{code:1,life:40,speed:4,sight:5,maxSkillCount:20}],cc._RF.pop()},{}],IntroPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"5b69euRLMtO1b8+WHCe0i1w","IntroPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=t("../App"),l=t("../common/bean/BeanContainer"),u=t("../common/util/UIPresenterBase"),p=cc._decorator.ccclass,d=cc._decorator.property,h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){this.initScene(!1)},e.prototype.start=function(){return c(this,void 0,void 0,function(){var t=this;return a(this,function(e){switch(e.label){case 0:return this.progressBar.progress=0,[4,l.beanContainer.initialize(function(e){t.fillGauge(e)})];case 1:return e.sent(),s.app.ready=!0,[4,s.app.loadScene(s.SceneType.World,!1)];case 2:return e.sent(),[2]}})})},e.prototype.fillGauge=function(t){this.progressBar.progress=t},i([d(cc.ProgressBar)],e.prototype,"progressBar",void 0),i([p],e)}(u.default);o.default=h,cc._RF.pop()},{"../App":"App","../common/bean/BeanContainer":"BeanContainer","../common/util/UIPresenterBase":"UIPresenterBase"}],ItemLevel:[function(t,e,o){"use strict";cc._RF.push(e,"9698ftJgEtAubQWZGXvDRUQ","ItemLevel"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleItemLevelRaw=void 0,o.ruleItemLevelRaw=[{level:1,boost:0},{level:2,boost:.2},{level:3,boost:.4},{level:4,boost:.6},{level:5,boost:.8},{level:6,boost:1},{level:7,boost:1.2},{level:8,boost:1.4},{level:9,boost:1.6},{level:10,boost:1.8},{level:11,boost:2},{level:12,boost:2.2},{level:13,boost:2.4},{level:14,boost:2.6},{level:15,boost:2.8},{level:16,boost:3},{level:17,boost:3.2},{level:18,boost:3.4},{level:19,boost:3.6},{level:20,boost:3.8},{level:21,boost:4},{level:22,boost:4.2},{level:23,boost:4.4},{level:24,boost:4.6},{level:25,boost:4.8},{level:26,boost:5},{level:27,boost:5.2},{level:28,boost:5.4},{level:29,boost:5.6},{level:30,boost:5.8},{level:31,boost:6},{level:32,boost:6.2},{level:33,boost:6.4},{level:34,boost:6.6},{level:35,boost:6.8},{level:36,boost:7},{level:37,boost:7.2},{level:38,boost:7.4},{level:39,boost:7.6},{level:40,boost:7.8},{level:41,boost:8},{level:42,boost:8.2},{level:43,boost:8.4},{level:44,boost:8.6},{level:45,boost:8.8},{level:46,boost:9},{level:47,boost:9.2},{level:48,boost:9.4},{level:49,boost:9.6},{level:50,boost:9.8},{level:51,boost:10},{level:52,boost:10.2},{level:53,boost:10.4},{level:54,boost:10.6},{level:55,boost:10.8},{level:56,boost:11},{level:57,boost:11.2},{level:58,boost:11.4},{level:59,boost:11.6},{level:60,boost:11.8},{level:61,boost:12},{level:62,boost:12.2},{level:63,boost:12.4},{level:64,boost:12.6},{level:65,boost:12.8},{level:66,boost:13},{level:67,boost:13.2},{level:68,boost:13.4},{level:69,boost:13.6},{level:70,boost:13.8},{level:71,boost:14},{level:72,boost:14.2},{level:73,boost:14.4},{level:74,boost:14.6},{level:75,boost:14.8},{level:76,boost:15},{level:77,boost:15.2},{level:78,boost:15.4},{level:79,boost:15.6},{level:80,boost:15.8},{level:81,boost:16},{level:82,boost:16.2},{level:83,boost:16.4},{level:84,boost:16.6},{level:85,boost:16.8},{level:86,boost:17},{level:87,boost:17.2},{level:88,boost:17.4},{level:89,boost:17.6},{level:90,boost:17.8},{level:91,boost:18},{level:92,boost:18.2},{level:93,boost:18.4},{level:94,boost:18.6},{level:95,boost:18.8},{level:96,boost:19},{level:97,boost:19.2},{level:98,boost:19.4},{level:99,boost:19.6},{level:100,boost:19.8},{level:101,boost:20},{level:102,boost:20.2},{level:103,boost:20.4}],cc._RF.pop()},{}],ItemMagic:[function(t,e,o){"use strict";cc._RF.push(e,"506eaSnZ1xETpL5QeVnU7mh","ItemMagic"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleItemMagicRaw=void 0,o.ruleItemMagicRaw=[{code:1,statType:"ItemAttackBoost",v1:.15,v2:.2,v3:0,v4:0,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:2,statType:"FireAttack",v1:.15,v2:.25,v3:.25,v4:.35,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:3,statType:"ColdAttack",v1:.15,v2:.25,v3:.25,v4:.35,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"Slow",ccEffect:"Cold",ccFireRate:.3,ccDuration:1,ccV1:.2,ccV2:0,ccV3:0},{code:4,statType:"LightningAttack",v1:.05,v2:.05,v3:.35,v4:.45,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"Hurt",ccEffect:"None",ccFireRate:.5,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:5,statType:"PoisonAttack",v1:.25,v2:.35,v3:.35,v4:.45,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"DotDamage",ccEffect:"Poison",ccFireRate:.7,ccDuration:2,ccV1:2,ccV2:0,ccV3:0},{code:6,statType:"Defense",v1:20,v2:30,v3:0,v4:0,v5:0,target1:"Armors",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:7,statType:"MagicResist",v1:.05,v2:.1,v3:0,v4:0,v5:0,target1:"Amulet",target2:"Ring",target3:"Armors",target4:"Weapons",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:8,statType:"DropBonus",v1:.1,v2:.2,v3:0,v4:0,v5:0,target1:"Amulet",target2:"Ring",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:9,statType:"Life",v1:10,v2:20,v3:0,v4:0,v5:0,target1:"Amulet",target2:"Armors",target3:"Ring",target4:"Shield",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:10,statType:"LifeStolenPerHit",v1:.001,v2:.002,v3:0,v4:0,v5:0,target1:"Amulet",target2:"Ring",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:11,statType:"MagicDurationReduction",v1:.2,v2:.3,v3:0,v4:0,v5:0,target1:"Armor",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:12,statType:"CoolReduction",v1:.05,v2:.15,v3:0,v4:0,v5:0,target1:"Weapons",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:13,statType:"WalkBoost",v1:.1,v2:.3,v3:0,v4:0,v5:0,target1:"Boots",target2:"None",target3:"None",target4:"None",ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0}],cc._RF.pop()},{}],Item:[function(t,e,o){"use strict";cc._RF.push(e,"9b59anoZJ5OXoVtI2GQ9Bnn","Item"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleItemRaw=void 0,o.ruleItemRaw=[{code:151,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:1,dropLvTo:3,v1:10,v2:12,v3:10,v4:12,power:1},{code:152,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:1,dropLvTo:3,v1:10,v2:12,v3:10,v4:12,power:1},{code:153,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:2,dropLvTo:4,v1:11,v2:13,v3:11,v4:13,power:1},{code:154,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:2,dropLvTo:4,v1:11,v2:13,v3:11,v4:13,power:1},{code:155,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:3,dropLvTo:5,v1:12,v2:14,v3:12,v4:14,power:1},{code:156,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:3,dropLvTo:5,v1:12,v2:14,v3:12,v4:14,power:1},{code:157,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:4,dropLvTo:999,v1:12,v2:14,v3:12,v4:14,power:1},{code:158,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:4,dropLvTo:999,v1:13,v2:14,v3:13,v4:14,power:1},{code:159,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:4,dropLvTo:999,v1:13,v2:14,v3:13,v4:14,power:1},{code:160,type:"Bow",attackSpeed:"Fast",attackRange:"Short",dropLvFrom:4,dropLvTo:999,v1:13,v2:14,v3:13,v4:14,power:1},{code:181,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:50,v2:60,v3:0,v4:0,power:0},{code:182,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:50,v2:60,v3:0,v4:0,power:0},{code:183,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:55,v2:65,v3:0,v4:0,power:0},{code:184,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:55,v2:65,v3:0,v4:0,power:0},{code:185,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:65,v2:75,v3:0,v4:0,power:0},{code:186,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:65,v2:75,v3:0,v4:0,power:0},{code:187,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:65,v2:75,v3:0,v4:0,power:0},{code:188,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:75,v2:85,v3:0,v4:0,power:0},{code:189,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:75,v2:85,v3:0,v4:0,power:0},{code:190,type:"Armor",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:75,v2:85,v3:0,v4:0,power:0},{code:211,type:"Helmet",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:17,v2:20,v3:0,v4:0,power:0},{code:212,type:"Helmet",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:20,v2:23,v3:0,v4:0,power:0},{code:213,type:"Helmet",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:214,type:"Helmet",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:215,type:"Helmet",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:26,v2:29,v3:0,v4:0,power:0},{code:241,type:"Shield",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:17,v2:20,v3:0,v4:0,power:0},{code:242,type:"Shield",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:20,v2:23,v3:0,v4:0,power:0},{code:243,type:"Shield",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:244,type:"Shield",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:245,type:"Shield",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:26,v2:29,v3:0,v4:0,power:0},{code:271,type:"Gloves",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:17,v2:20,v3:0,v4:0,power:0},{code:272,type:"Gloves",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:20,v2:23,v3:0,v4:0,power:0},{code:273,type:"Gloves",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:274,type:"Gloves",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:275,type:"Gloves",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:26,v2:29,v3:0,v4:0,power:0},{code:301,type:"Boots",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:3,v1:17,v2:20,v3:0,v4:0,power:0},{code:302,type:"Boots",attackSpeed:"None",attackRange:"None",dropLvFrom:2,dropLvTo:4,v1:20,v2:23,v3:0,v4:0,power:0},{code:303,type:"Boots",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:304,type:"Boots",attackSpeed:"None",attackRange:"None",dropLvFrom:3,dropLvTo:5,v1:23,v2:26,v3:0,v4:0,power:0},{code:305,type:"Boots",attackSpeed:"None",attackRange:"None",dropLvFrom:4,dropLvTo:999,v1:26,v2:29,v3:0,v4:0,power:0},{code:331,type:"Amulet",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:999,v1:0,v2:0,v3:0,v4:0,power:0},{code:361,type:"Ring",attackSpeed:"None",attackRange:"None",dropLvFrom:1,dropLvTo:999,v1:0,v2:0,v3:0,v4:0,power:0}],cc._RF.pop()},{}],Material:[function(t,e,o){"use strict";cc._RF.push(e,"36d316BwalKV5xi4m6JQ7y4","Material"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleMaterialRaw=void 0,o.ruleMaterialRaw=[{code:11,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:12,craftDuration:0,category:"Nature",mat1:11,mat1Count:4,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:13,craftDuration:0,category:"Nature",mat1:11,mat1Count:2,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:21,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:22,craftDuration:0,category:"Nature",mat1:21,mat1Count:4,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:31,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:32,craftDuration:0,category:"Nature",mat1:31,mat1Count:4,mat2:13,mat2Count:1,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:33,craftDuration:0,category:"Nature",mat1:32,mat1Count:4,mat2:13,mat2Count:1,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:41,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:42,craftDuration:0,category:"Nature",mat1:41,mat1Count:15,mat2:13,mat2Count:1,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:51,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:52,craftDuration:0,category:"Nature",mat1:51,mat1Count:15,mat2:13,mat2Count:1,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:61,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:62,craftDuration:0,category:"Nature",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:601,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:602,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:603,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:604,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:605,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:606,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:607,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:608,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:609,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:610,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:611,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:612,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:613,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:614,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:615,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:616,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:631,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:632,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:633,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:634,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:635,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:636,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:637,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:638,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:639,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:640,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:641,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:642,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:643,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:644,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:645,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:646,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:661,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:662,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:663,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:664,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:665,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:666,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:667,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:668,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:669,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:670,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:671,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:672,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:673,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:674,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:675,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0},{code:676,craftDuration:0,category:"Artifact",mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0,deco:"None",v1:0,v2:0}],cc._RF.pop()},{}],Model:[function(t,e,o){"use strict";cc._RF.push(e,"b17289ZQIxBm6Naf9c0sF/h","Model");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.RuleUnlock=o.RuleSkillSet=o.RuleSkill=o.RulePotion=o.RulePlayerExp=o.RulePickaxe=o.RuleObject=o.RuleMaterial=o.RuleItemMagic=o.RuleItemLevel=o.RuleItem=o.RuleHeroLevel=o.RuleHeroStat=o.RuleEnemyLevel=o.RuleEnemy=o.RuleDropCalculated=o.RuleDrop=o.RuleCc=o.RuleArtifact=o.RuleAct=o.RuleWithRecipe=o.RuleWithCc=o.WdItemCategory=o.WdCamShake=o.WdStatMagicType=o.WdArtifactCategory=o.WdResourceType=o.WdSkillType=o.WdObjectType=o.WdResourceCategory=o.WdDropType=o.WdCcEffectType=o.WdEquipSlotType=o.WdStatType=o.WdWalkSpeed=o.WdAttackSpeed=o.WdItemType=o.WdCcType=o.WdAttackRange=void 0;var i,c,a,s=t("../../world/core/object/material/WdMaterialDAO");(function(t){t[t.None="None"]="None",t[t.Shorter="Shorter"]="Shorter",t[t.Short="Short"]="Short",t[t.Normal="Normal"]="Normal",t[t.Long="Long"]="Long",t[t.Longer="Longer"]="Longer"})(o.WdAttackRange||(o.WdAttackRange={})),function(t){t[t.None="None"]="None",t[t.Slow="Slow"]="Slow",t[t.Fast="Fast"]="Fast",t[t.AttackSpeedUp="AttackSpeedUp"]="AttackSpeedUp",t[t.MoveSpeedUp="MoveSpeedUp"]="MoveSpeedUp",t[t.Freeze="Freeze"]="Freeze",t[t.AttackBuff="AttackBuff"]="AttackBuff",t[t.DefenseNuff="DefenseNuff"]="DefenseNuff",t[t.DotDamage="DotDamage"]="DotDamage",t[t.Hurt="Hurt"]="Hurt",t[t.Ghost="Ghost"]="Ghost"}(i=o.WdCcType||(o.WdCcType={})),function(t){t[t.None="None"]="None",t[t.Weapons="Weapons"]="Weapons",t[t.Bow="Bow"]="Bow",t[t.Staff="Staff"]="Staff",t[t.Sword="Sword"]="Sword",t[t.Axe="Axe"]="Axe",t[t.Armors="Armors"]="Armors",t[t.Armor="Armor"]="Armor",t[t.Helmet="Helmet"]="Helmet",t[t.Shield="Shield"]="Shield",t[t.Gloves="Gloves"]="Gloves",t[t.Boots="Boots"]="Boots",t[t.Accessories="Accessories"]="Accessories",t[t.Amulet="Amulet"]="Amulet",t[t.Ring="Ring"]="Ring",t[t.Pickaxe="Pickaxe"]="Pickaxe"}(c=o.WdItemType||(o.WdItemType={})),function(t){t[t.None="None"]="None",t[t.Slowest="Slowest"]="Slowest",t[t.Slower="Slower"]="Slower",t[t.Slow="Slow"]="Slow",t[t.Normal="Normal"]="Normal",t[t.Fast="Fast"]="Fast",t[t.Faster="Faster"]="Faster",t[t.Fastest="Fastest"]="Fastest"}(o.WdAttackSpeed||(o.WdAttackSpeed={})),function(t){t[t.None="None"]="None",t[t.Slowest="Slowest"]="Slowest",t[t.Slower="Slower"]="Slower",t[t.Slow="Slow"]="Slow",t[t.Normal="Normal"]="Normal",t[t.Fast="Fast"]="Fast",t[t.Faster="Faster"]="Faster",t[t.Fastest="Fastest"]="Fastest"}(o.WdWalkSpeed||(o.WdWalkSpeed={})),function(t){t[t.None="None"]="None",t[t.Life="Life"]="Life",t[t.LifeBoost="LifeBoost"]="LifeBoost",t[t.PhysicalAttack="PhysicalAttack"]="PhysicalAttack",t[t.FireAttack="FireAttack"]="FireAttack",t[t.ColdAttack="ColdAttack"]="ColdAttack",t[t.LightningAttack="LightningAttack"]="LightningAttack",t[t.PoisonAttack="PoisonAttack"]="PoisonAttack",t[t.ItemAttackBoost="ItemAttackBoost"]="ItemAttackBoost",t[t.UnitAttackBoost="UnitAttackBoost"]="UnitAttackBoost",t[t.Defense="Defense"]="Defense",t[t.PhysicalResist="PhysicalResist"]="PhysicalResist",t[t.MagicResist="MagicResist"]="MagicResist",t[t.MagicDurationReduction="MagicDurationReduction"]="MagicDurationReduction",t[t.LifeStolenPerHit="LifeStolenPerHit"]="LifeStolenPerHit",t[t.CoolReduction="CoolReduction"]="CoolReduction",t[t.WalkBoost="WalkBoost"]="WalkBoost",t[t.DropBonus="DropBonus"]="DropBonus",t[t.ArtifactDropBonus="ArtifactDropBonus"]="ArtifactDropBonus",t[t.GoldDrop="GoldDrop"]="GoldDrop",t[t.RubyDrop="RubyDrop"]="RubyDrop",t[t.BonusSkill="BonusSkill"]="BonusSkill",t[t.Potion="Potion"]="Potion",t[t.AttackBoostLessHp="AttackBoostLessHp"]="AttackBoostLessHp",t[t.BonusChest="BonusChest"]="BonusChest",t[t.BonusBarrel="BonusBarrel"]="BonusBarrel",t[t.CircleSpeed="CircleSpeed"]="CircleSpeed",t[t.GhostDR="GhostDR"]="GhostDR",t[t.MeteorCR="MeteorCR"]="MeteorCR",t[t.BonusLifeLB="BonusLifeLB"]="BonusLifeLB",t[t.MagicBombBM="MagicBombBM"]="MagicBombBM",t[t.IcePillarCR="IcePillarCR"]="IcePillarCR",t[t.LightningStrikeCR="LightningStrikeCR"]="LightningStrikeCR",t[t.LightningShieldCR="LightningShieldCR"]="LightningShieldCR"}(o.WdStatType||(o.WdStatType={})),function(t){t[t.None="None"]="None",t[t.Weapon="Weapon"]="Weapon",t[t.Shield="Shield"]="Shield",t[t.Armor="Armor"]="Armor",t[t.Helmet="Helmet"]="Helmet",t[t.Amulet="Amulet"]="Amulet",t[t.Ring1="Ring1"]="Ring1",t[t.Ring2="Ring2"]="Ring2",t[t.Gloves="Gloves"]="Gloves",t[t.Boots="Boots"]="Boots",t[t.Pickaxe="Pickaxe"]="Pickaxe"}(o.WdEquipSlotType||(o.WdEquipSlotType={})),function(t){t[t.None="None"]="None",t[t.Cold="Cold"]="Cold",t[t.Poison="Poison"]="Poison",t[t.Ghost="Ghost"]="Ghost"}(a=o.WdCcEffectType||(o.WdCcEffectType={})),function(t){t[t.Item="Item"]="Item",t[t.NormalItemR="NormalItemR"]="NormalItemR",t[t.MagicItemR="MagicItemR"]="MagicItemR",t[t.RareItemR="RareItemR"]="RareItemR",t[t.Chest="Chest"]="Chest",t[t.ChestArtifactR="ChestArtifactR"]="ChestArtifactR",t[t.ChestResourceR="ChestResourceR"]="ChestResourceR",t[t.ChestGoldR="ChestGoldR"]="ChestGoldR",t[t.ChestItemR="ChestItemR"]="ChestItemR",t[t.Resource="Resource"]="Resource"}(o.WdDropType||(o.WdDropType={})),function(t){t[t.None="None"]="None",t[t.Nature="Nature"]="Nature",t[t.Key="Key"]="Key",t[t.Book="Book"]="Book",t[t.Artifact="Artifact"]="Artifact"}(o.WdResourceCategory||(o.WdResourceCategory={})),function(t){t[t.None="None"]="None",t[t.Decoration="Decoration"]="Decoration",t[t.Chest="Chest"]="Chest",t[t.Frame="Frame"]="Frame",t[t.Gate="Gate"]="Gate",t[t.Waypoint="Waypoint"]="Waypoint",t[t.Portal="Portal"]="Portal",t[t.Trap="Trap"]="Trap"}(o.WdObjectType||(o.WdObjectType={})),function(t){t[t.None="None"]="None",t[t.Repeater="Repeater"]="Repeater",t[t.MultiArrow="MultiArrow"]="MultiArrow",t[t.Ricochet="Ricochet"]="Ricochet",t[t.SlowEnemyArrow="SlowEnemyArrow"]="SlowEnemyArrow",t[t.PiercingShot="PiercingShot"]="PiercingShot",t[t.UnitAttackBoost="UnitAttackBoost"]="UnitAttackBoost",t[t.AttackSpeedUp="AttackSpeedUp"]="AttackSpeedUp",t[t.HpBoost="HpBoost"]="HpBoost",t[t.ColdCircle="ColdCircle"]="ColdCircle",t[t.FireCircle="FireCircle"]="FireCircle",t[t.LightningCircle="LightningCircle"]="LightningCircle",t[t.PoisonCircle="PoisonCircle"]="PoisonCircle",t[t.Meteor="Meteor"]="Meteor",t[t.MagicBomb="MagicBomb"]="MagicBomb",t[t.LightningStrike="LightningStrike"]="LightningStrike",t[t.LightningShield="LightningShield"]="LightningShield",t[t.IcePillar="IcePillar"]="IcePillar",t[t.Ghost="Ghost"]="Ghost",t[t.BonusLife="BonusLife"]="BonusLife"}(o.WdSkillType||(o.WdSkillType={})),function(t){t[t.None="None"]="None",t[t.Material="Material"]="Material",t[t.Item="Item"]="Item",t[t.Artifact="Artifact"]="Artifact",t[t.Pickaxe="Pickaxe"]="Pickaxe",t[t.Building="Building"]="Building",t[t.Skill="Skill"]="Skill",t[t.ScRune="ScRune"]="ScRune",t[t.ScFood="ScFood"]="ScFood",t[t.ScSpecial="ScSpecial"]="ScSpecial",t[t.RandomItem="RandomItem"]="RandomItem",t[t.RandomWeapons="RandomWeapons"]="RandomWeapons",t[t.RandomArmors="RandomArmors"]="RandomArmors",t[t.RandomRing="RandomRing"]="RandomRing",t[t.RandomAccessories="RandomAccessories"]="RandomAccessories"}(o.WdResourceType||(o.WdResourceType={})),function(t){t[t.None="None"]="None",t[t.Rune="Rune"]="Rune",t[t.Food="Food"]="Food",t[t.Special="Special"]="Special"}(o.WdArtifactCategory||(o.WdArtifactCategory={})),function(t){t[t.None="None"]="None",t[t.MagicBoosted="MagicBoosted"]="MagicBoosted",t[t.Magic="Magic"]="Magic"}(o.WdStatMagicType||(o.WdStatMagicType={})),function(t){t[t.None="None"]="None",t[t.Lower="Lower"]="Lower",t[t.Low="Low"]="Low",t[t.Normal="Normal"]="Normal",t[t.High="High"]="High",t[t.Higher="Higher"]="Higher"}(o.WdCamShake||(o.WdCamShake={})),function(t){t[t.None="None"]="None",t[t.Normal="Normal"]="Normal",t[t.Magic="Magic"]="Magic",t[t.Rare="Rare"]="Rare",t[t.Unique="Unique"]="Unique",t[t.Set="Set"]="Set"}(o.WdItemCategory||(o.WdItemCategory={}));var l=function(){function t(){this.cc=null}return t.prototype.buildCc=function(){this.ccType!=i.None&&(this.cc={type:this.ccType,fireRate:this.ccFireRate,effect:this.ccEffect,duration:this.ccDuration,v1:this.ccV1,v2:this.ccV2,v3:this.ccV3})},t}();o.RuleWithCc=l;var u=function(){function t(){}return t.prototype.buildRecipe=function(){this.recipe=new Array,this.mat1Count>0&&this.recipe.push(s.WdMaterialDAO.build(this.mat1,this.mat1Count)),this.mat2Count>0&&this.recipe.push(s.WdMaterialDAO.build(this.mat2,this.mat2Count)),this.mat3Count>0&&this.recipe.push(s.WdMaterialDAO.build(this.mat3,this.mat3Count))},t}();o.RuleWithRecipe=u;o.RuleAct=function(){};var p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildCc()},e}(l);o.RuleArtifact=p;o.RuleCc=function(){this.type=i.None,this.effect=a.None,this.fireRate=0,this.duration=0,this.v1=0,this.v2=0,this.v3=0};o.RuleDrop=function(){};var d=function(){function t(){}return t.build=function(e,o){var r=new t;return r.type=e,r.rate=o,r},t}();o.RuleDropCalculated=d;var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildCc()},e}(l);o.RuleEnemy=h;o.RuleEnemyLevel=function(){};o.RuleHeroStat=function(){};o.RuleHeroLevel=function(){};o.RuleItem=function(){};o.RuleItemLevel=function(){};var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildCc(),this.targets=new Set,this.addType(this.target1),this.addType(this.target2),this.addType(this.target3),this.addType(this.target4),this.target1!=c.None&&this.targets.add(this.target1),this.target2!=c.None&&this.targets.add(this.target2),this.target3!=c.None&&this.targets.add(this.target3),this.target4!=c.None&&this.targets.add(this.target4)},e.prototype.addType=function(t){t!=c.None&&(t==c.Weapons?(this.targets.add(c.Axe),this.targets.add(c.Bow),this.targets.add(c.Sword),this.targets.add(c.Staff)):t==c.Armors?(this.targets.add(c.Armor),this.targets.add(c.Boots),this.targets.add(c.Gloves),this.targets.add(c.Helmet)):this.targets.add(t))},e}(l);o.RuleItemMagic=f;var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildRecipe()},e}(u);o.RuleMaterial=y;o.RuleObject=function(){};var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildRecipe()},e}(u);o.RulePickaxe=v;o.RulePlayerExp=function(){};o.RulePotion=function(){};var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.ready=function(){this.buildCc()},e}(l);o.RuleSkill=m;var g=function(){function t(t){this.code=t,this.skills=new Map}return t.prototype.addSkill=function(t){this.skills.set(t.level,t),this.maxLevel<t.level&&(this.maxLevel=t.level)},t}();o.RuleSkillSet=g;o.RuleUnlock=function(){},cc._RF.pop()},{"../../world/core/object/material/WdMaterialDAO":"WdMaterialDAO"}],MyCanvasScaler:[function(t,e,o){"use strict";cc._RF.push(e,"7e900sjawhD26qVgod6bBdz","MyCanvasScaler");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.MyCanvasScaler=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=cc.Canvas,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultUI=null,e.minWidth_=720,e.maxWidth_=720,e.minHeight_=1280,e.maxHeight_=1400,e.canvas=null,e.cropSize=cc.Size.ZERO,e.originSize=cc.Size.ZERO,e.lastScreenSize=cc.Size.ZERO,e.refresh=function(){if(null!=e.canvas&&null!=e.defaultUI){var t=e.getScreenSize(),o=e.minWidth/t.width,r=e.minHeight/t.height,n=Math.max(o,r),i=new cc.Size(t.width*n,t.height*n);e.originSize=i.clone(),e.cropSize=i.clone(),e.cropSize.width=Math.min(e.maxWidth,i.width),e.cropSize.height=Math.min(e.maxHeight,i.height),e.canvas.designResolution=e.originSize,e.defaultUI.setContentSize(e.cropSize)}},e}return n(e,t),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this.maxWidth_*this.getScaler()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minWidth",{get:function(){return this.minWidth_*this.getScaler()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minHeight",{get:function(){return this.minHeight_*this.getScaler()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxHeight",{get:function(){return this.maxHeight_*this.getScaler()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.canvas=this.getComponent(s),this.refresh()},e.prototype.getCropSize=function(){return this.cropSize.width<=0&&this.refresh(),this.cropSize},e.prototype.getOriginSize=function(){return this.originSize.width<=0&&this.refresh(),this.originSize},e.prototype.getScreenSize=function(){return cc.view.getFrameSize()},e.prototype.getScale=function(){var t=this.getScreenSize();return this.getOriginSize().width/t.width},e.prototype.getScaler=function(){return 1},e.prototype.update=function(){var t=this.getScreenSize();t.equals(this.lastScreenSize)||(this.lastScreenSize=t,this.refresh())},i([a(cc.Node)],e.prototype,"defaultUI",void 0),i([a(cc.Float)],e.prototype,"minWidth_",void 0),i([a(cc.Float)],e.prototype,"maxWidth_",void 0),i([a(cc.Float)],e.prototype,"minHeight_",void 0),i([a(cc.Float)],e.prototype,"maxHeight_",void 0),i([c],e)}(cc.Component);o.MyCanvasScaler=l,cc._RF.pop()},{}],Object:[function(t,e,o){"use strict";cc._RF.push(e,"864ff7g22xOf4Buy0gWT0f/","Object"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleObjectRaw=void 0,o.ruleObjectRaw=[{key:"object.name.51",ko:"Chest1",en:"Chest1","":"",code:51,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.52",ko:"Chest2",en:"Chest2","":"",code:52,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.53",ko:"Chest3",en:"Chest3","":"",code:53,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.54",ko:"Chest4",en:"Chest4","":"",code:54,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.55",ko:"Chest5",en:"Chest5","":"",code:55,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.56",ko:"Chest6",en:"Chest1","":"",code:56,type:"Chest",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.100",ko:"Tree",en:"Tree","":"",code:100,type:"Decoration",width:1,height:1,hpLv1:100,p1:0,p2:0},{key:"object.name.221",ko:"StairA1",en:"StairA1","":"",code:221,type:"Gate",width:1,height:1,hpLv1:100,p1:1,p2:0},{key:"object.name.222",ko:"StairA2",en:"StairA2","":"",code:222,type:"Gate",width:1,height:1,hpLv1:100,p1:-1,p2:0},{key:"object.name.223",ko:"Waypoint",en:"Waypoint","":"",code:223,type:"Waypoint",width:1,height:1,hpLv1:100,p1:0,p2:0}],cc._RF.pop()},{}],OrderByY:[function(t,e,o){"use strict";cc._RF.push(e,"964e2AGqsFHr7QCQyrRMgjI","OrderByY");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.OrderByY=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.interval=2,e.tick=0,e}return n(e,t),e.prototype.update=function(){this.tick%this.interval==0&&this.refresh(),this.tick++},e.prototype.refresh=function(){var t=new Array;(t=t.concat(this.node.children)).sort(function(t,e){return e.y-t.y});var e=0;t.forEach(function(t){t.zIndex=e++})},i([a(cc.Integer)],e.prototype,"interval",void 0),i([c],e)}(cc.Component);o.OrderByY=s,cc._RF.pop()},{}],Pickaxe:[function(t,e,o){"use strict";cc._RF.push(e,"c8668hipzlD7rHnePx0udcI","Pickaxe"),Object.defineProperty(o,"__esModule",{value:!0}),o.rulePickaxeRaw=void 0,o.rulePickaxeRaw=[{level:1,moreDrop:0,moreDropRate:0,mat1:0,mat1Count:0,mat2:0,mat2Count:0,mat3:0,mat3Count:0},{level:2,moreDrop:1,moreDropRate:10,mat1:33,mat1Count:1,mat2:12,mat2Count:2,mat3:0,mat3Count:0},{level:3,moreDrop:1,moreDropRate:20,mat1:42,mat1Count:3,mat2:33,mat2Count:1,mat3:12,mat3Count:2},{level:4,moreDrop:2,moreDropRate:30,mat1:52,mat1Count:3,mat2:33,mat2Count:1,mat3:12,mat3Count:2}],cc._RF.pop()},{}],PlayerExp:[function(t,e,o){"use strict";cc._RF.push(e,"157f333KdFJhpQc6RIoNMPf","PlayerExp"),Object.defineProperty(o,"__esModule",{value:!0}),o.rulePlayerExpRaw=void 0,o.rulePlayerExpRaw=[{level:1,exp:0},{level:2,exp:3},{level:3,exp:53},{level:4,exp:153},{level:5,exp:303},{level:6,exp:503},{level:7,exp:753},{level:8,exp:1053},{level:9,exp:1403},{level:10,exp:1803},{level:11,exp:2253},{level:12,exp:2753},{level:13,exp:3303},{level:14,exp:3903},{level:15,exp:4553},{level:16,exp:5253},{level:17,exp:6003},{level:18,exp:6803},{level:19,exp:7653},{level:20,exp:8553},{level:21,exp:9503},{level:22,exp:10503},{level:23,exp:11553},{level:24,exp:12653},{level:25,exp:13803}],cc._RF.pop()},{}],Popup:[function(t,e,o){"use strict";cc._RF.push(e,"bc1b4227dNDg7Z8QKLzMSk3","Popup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.PopupPanelEaserPop=o.PopupPanelAlphaPresenter=o.PopupPanelHardPresenter=o.PopupBaseBP=o.PopupBase=void 0;var i=t("../../App"),c=t("../coroutine/CoContainer"),a=t("../coroutine/EaseRoutine"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isShown=!1,e}return n(e,t),e.prototype.display=function(t,e){this.isShown||(this.hideCallback=e,this.isShown=!0,this.node.active=!0,i.app.mainUI.addPopup(this),this.popupEaser||(this.popupEaser=this.getPopupEaser()),this.popupEaser.show(),this.onDisplay(t))},e.prototype.hide=function(){this.isShown&&(this.isShown=!1,i.app.mainUI.removePopup(this),this.popupEaser.hide(),this.onHide(),this.hideCallback&&this.hideCallback())},e.prototype.getPopupEaser=function(){return new p(this)},e.prototype.getKey=function(){return null},e.prototype.onDisplay=function(){},e.prototype.onHide=function(){},e}(c.CoContainer);o.PopupBase=s;var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.display=function(e,o){t.prototype.display.call(this,e,o),i.app.mainUI.showBlackPanel(this)},e.prototype.hide=function(){t.prototype.hide.call(this),i.app.mainUI.hideBlackPanel(this)},e.prototype.onClickBlackPanel=function(){this.hide()},e.prototype.queryBlackPanelAlpha=function(){return.5},e.prototype.queryBlackTargetPanel=function(){return this.node},e}(s);o.PopupBaseBP=l;var u=function(){function t(t){this.target=null,this.target=t}return t.prototype.show=function(){this.target.node.active=!0},t.prototype.hide=function(){this.target.node.active=!1},t}();o.PopupPanelHardPresenter=u;var p=function(){function t(t){this.target=null,this.routine=null,this.target=t,this.target.node.opacity=0}return t.prototype.show=function(){var t=this;null!=this.routine&&this.routine.stop(),this.target.node.active=!0,this.routine=this.target.startRoutine().easeNoTimeScaled(a.EaseType.easeOutQuad,.1,function(){return t.target.node.opacity},function(e,o){t.target.node.opacity=a.Ease.lerp(e,255,o)},function(){return t.routine=null})},t.prototype.hide=function(){var t=this;null!=this.routine&&this.routine.stop(),this.routine=this.target.startRoutine().easeNoTimeScaled(a.EaseType.easeInQuad,.1,function(){return t.target.node.opacity},function(e,o){t.target.node.opacity=a.Ease.lerp(e,0,o)},function(){t.routine=null,t.target.node.active=!1})},t}();o.PopupPanelAlphaPresenter=p;var d=function(){function t(t,e){this.routine=null,this.target=t,this.parent=e,this.target.node.opacity=0,this.target.node.scale=.95}return t.prototype.show=function(){var t,e,o=this;null!=this.routine&&this.routine.stop(),this.target.node.active=!0;var r=this.target.node.scale,n=null!==(e=null===(t=this.parent)||void 0===t?void 0:t.scale)&&void 0!==e?e:1;this.routine=this.target.startRoutine().easeNoTimeScaled(a.EaseType.easeOutQuad,.15,function(){return o.target.node.opacity},function(t,e){o.target.node.opacity=a.Ease.lerp(t,255,e),o.target.node.scale=a.Ease.lerp(r,1,e),o.parent&&(o.parent.scale=a.Ease.lerp(n,.95,e))},function(){return o.routine=null})},t.prototype.hide=function(){var t,e,o=this;null!=this.routine&&this.routine.stop();var r=this.target.node.scale,n=null!==(e=null===(t=this.parent)||void 0===t?void 0:t.scale)&&void 0!==e?e:1;this.routine=this.target.startRoutine().easeNoTimeScaled(a.EaseType.easeInQuad,.15,function(){return o.target.node.opacity},function(t,e){o.target.node.opacity=a.Ease.lerp(t,0,e),o.target.node.scale=a.Ease.lerp(r,.95,e),o.parent&&(o.parent.scale=a.Ease.lerp(n,1,e))},function(){o.routine=null,o.target.node.active=!1})},t}();o.PopupPanelEaserPop=d,cc._RF.pop()},{"../../App":"App","../coroutine/CoContainer":"CoContainer","../coroutine/EaseRoutine":"EaseRoutine"}],Potion:[function(t,e,o){"use strict";cc._RF.push(e,"59bdfIr6zRBI7xQN2/89lvI","Potion"),Object.defineProperty(o,"__esModule",{value:!0}),o.rulePotionRaw=void 0,o.rulePotionRaw=[{code:451,hp:12},{code:452,hp:24}],cc._RF.pop()},{}],Radio:[function(t,e,o){"use strict";cc._RF.push(e,"e423cazMNFB+K+BaDsbWQa4","Radio");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.Radio=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../coroutine/CoContainer"),l=t("../coroutine/EaseRoutine"),u=t("../util/Bec"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.offColor=new cc.Color(203,203,203),e.onColor=cc.Color.GREEN,e.background=null,e.core=null,e.changeRoutine=null,e}return n(e,t),e.prototype.display=function(t,e){this.onChanged=e,this.setChecked(t,!1)},e.prototype.setChecked=function(t,e){var o=this;this.isChecked=t;var r=this.background.color,n=t?this.onColor:this.offColor,i=this.core.getPosition(),c=t?cc.v2(20,0):cc.v2(-20,0);if(0==e)return this.background.color=n,void this.core.setPosition(c);this.changeRoutine&&this.changeRoutine.stop(),this.changeRoutine=this.startRoutine().easeNoTimeScaled(l.EaseType.easeInOutQuad,.2,function(){return r},function(t,e){var a=new cc.Color,s=cc.v2();o.background.color=cc.Color.lerp(a,r,n,e),o.core.setPosition(cc.Vec2.lerp(s,i,c,e))},function(){return o.changeRoutine=null})},e.prototype.onClickItem=function(){u.Bec.can()&&(this.setChecked(!this.isChecked,!0),this.onChanged&&this.onChanged(this.isChecked))},i([a(cc.Color)],e.prototype,"offColor",void 0),i([a(cc.Color)],e.prototype,"onColor",void 0),i([a(cc.Node)],e.prototype,"background",void 0),i([a(cc.Node)],e.prototype,"core",void 0),i([c],e)}(s.CoContainer);o.Radio=p,cc._RF.pop()},{"../coroutine/CoContainer":"CoContainer","../coroutine/EaseRoutine":"EaseRoutine","../util/Bec":"Bec"}],"Repository.spec":[function(t,e,o){"use strict";cc._RF.push(e,"cc9bcw88tdJdJnrdLB8C7o5","Repository.spec");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdRepositoryTest=void 0;var c,a=t("testyts/build/lib/decorators/testSuite.decorator"),s=t("../Repository1"),l=t("../../../world/core/object/material/WdMaterialDAO"),u=t("testyts/build/lib/decorators/test.decorator"),p=t("testyts/build/lib/assertion/expect"),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(s.Repository1),h=(c=s.Repository1,n(function(){return null!==c&&c.apply(this,arguments)||this},c),function(){function t(){}return t.prototype.crudTest=function(){var t=new d;t.create(l.WdMaterialDAO.build(1,2)),t.create(l.WdMaterialDAO.build(2,3)),t.create(l.WdMaterialDAO.build(3,4)),p.expect.toBeEqual(t.read(1).code,1),p.expect.toBeEqual(t.read(1).amount,2),p.expect.toBeEqual(t.readAll().length,3),t.delete(2),p.expect.toBeEqual(t.readAll().length,2)},i([u.Test()],t.prototype,"crudTest",null),i([a.TestSuite()],t)}());o.WdRepositoryTest=h,cc._RF.pop()},{"../../../world/core/object/material/WdMaterialDAO":"WdMaterialDAO","../Repository1":"Repository1","testyts/build/lib/assertion/expect":2,"testyts/build/lib/decorators/test.decorator":6,"testyts/build/lib/decorators/testSuite.decorator":8}],Repository1:[function(t,e,o){"use strict";cc._RF.push(e,"946b7vhFQxHl4+FMj1fSqLS","Repository1"),Object.defineProperty(o,"__esModule",{value:!0}),o.Repository1=void 0;var r=function(){function t(){this.dirty=!1,this.table=new Map,this.maxPK=0}return t.prototype.clear=function(){this.table.clear(),this.maxPK=0},t.prototype.create=function(t){this.table.set(t.getPk(),t),this.maxPK<t.getPk()&&(this.maxPK=t.getPk()),this.dirty=!0},t.prototype.load=function(t){var e=this;this.clear(),t.forEach(function(t){return e.create(t)})},t.prototype.delete=function(t){this.table.delete(t),this.dirty=!0},t.prototype.getMaxPK=function(){return this.maxPK},t.prototype.read=function(t){return this.table.get(t)},t.prototype.readAll=function(){return Array.from(this.table.values())},t.prototype.serialize=function(){return JSON.stringify(this.readAll())},t.prototype.update=function(t){this.table.set(t.getPk(),t),this.dirty=!0},t}();o.Repository1=r,cc._RF.pop()},{}],Repository2:[function(t,e,o){"use strict";cc._RF.push(e,"a161aGDk7pOP57e1qvEn7h8","Repository2"),Object.defineProperty(o,"__esModule",{value:!0}),o.Repository2=void 0;var r=function(){function t(){this.dirty=!1,this.table=new Map,this.idx1Table=new Map,this.maxPK=0}return t.prototype.clear=function(){this.table.clear(),this.idx1Table.clear(),this.maxPK=0},t.prototype.create=function(t){this.table.set(t.getPk(),t),this.idx1Table.has(t.getIndex1())||this.idx1Table.set(t.getIndex1(),new Array),this.idx1Table.get(t.getIndex1()).push(t),this.maxPK<t.getPk()&&(this.maxPK=t.getPk()),this.dirty=!0},t.prototype.load=function(t){var e=this;this.clear(),t.forEach(function(t){return e.create(t)})},t.prototype.delete=function(t){var e=this.read(t);if(e){this.table.delete(t);var o=this.idx1Table.get(e.getIndex1());if(o){for(var r=0;r<o.length;r++)if(o[r].getPk()==t){o.splice(r,1);break}this.dirty=!0}}},t.prototype.getMaxPK=function(){return this.maxPK},t.prototype.read=function(t){return this.table.get(t)},t.prototype.readAll=function(){return Array.from(this.table.values())},t.prototype.readAllIndex1=function(t){return this.idx1Table.get(t)},t.prototype.update=function(t){this.table.set(t.getPk(),t),this.dirty=!0},t}();o.Repository2=r,cc._RF.pop()},{}],Repository:[function(t,e,o){"use strict";cc._RF.push(e,"2bcd4Jh6X5J3bKKsdWgXAjc","Repository"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"RuleService.spec":[function(t,e,o){"use strict";cc._RF.push(e,"21bbeWbGVpDq7TFnavByQLd","RuleService.spec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.RuleServiceTest=void 0;var c=t("testyts"),a=t("../../common/bean/Decorators"),s=t("../RuleService"),l=t("testyts/build/lib/decorators/afterAndBefore.decorator"),u=t("../../common/bean/BeanContainer"),p=function(){function t(){}return t.prototype.beforeAll=function(){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return s.RuleService.readyTest(),[4,u.beanContainer.initialize()];case 1:return t.sent(),[2]}})})},t.prototype.loadTest=function(){var t=this.ruleService.acts.size;c.expect.toBeGreater(t,0);var e=0;this.ruleService.artifacts.forEach(function(t){t.cc&&e++}),c.expect.toBeGreater(e,0)},r([a.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([l.BeforeAll()],t.prototype,"beforeAll",null),r([c.Test()],t.prototype,"loadTest",null),r([c.TestSuite()],t)}();o.RuleServiceTest=p,cc._RF.pop()},{"../../common/bean/BeanContainer":"BeanContainer","../../common/bean/Decorators":"Decorators","../RuleService":"RuleService",testyts:16,"testyts/build/lib/decorators/afterAndBefore.decorator":5}],RuleService:[function(t,e,o){"use strict";cc._RF.push(e,"1354f0Cdz9I9I8StaCXl90M","RuleService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.RuleService=void 0;var c=t("../common/bean/Decorators"),a=t("./model/Model"),s=t("./rules/Act"),l=t("./rules/HeroStat"),u=t("./rules/HeroLevel"),p=t("./rules/Artifact"),d=t("./rules/Drop"),h=t("./rules/Enemy"),f=t("./rules/EnemyLevel"),y=t("./rules/Item"),v=t("./rules/ItemLevel"),m=t("./rules/ItemMagic"),g=t("./rules/Material"),W=t("./rules/Object"),b=t("./rules/PlayerExp"),S=t("./rules/Potion"),_=t("./rules/Skill"),A=t("./rules/Unlock"),P=t("../world/core/common/WdVec"),R=function(){function t(){this.lastBdPage=0,this.maxHeroLevel=0,this.maxPickaxeLevel=0,this.maxPlayerLevel=0}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){var t=this;return i(this,function(){return this.acts=new Map,this.load(s.ruleActRaw,a.RuleAct.prototype,function(e){t.acts.set(e.act,e)}),this.artifacts=new Map,this.load(p.ruleArtifactRaw,a.RuleArtifact.prototype,function(e){e.ready(),t.artifacts.set(e.code,e)}),this.drops=new Map,this.load(d.ruleDropRaw,a.RuleDrop.prototype,function(e){t.drops.set(e.type,e)}),this.enemies=new Map,this.load(h.ruleEnemyRaw,a.RuleEnemy.prototype,function(e){e.ready(),t.enemies.set(e.code,e)}),this.enemyLevels=new Map,this.load(f.ruleEnemyLevelRaw,a.RuleEnemyLevel.prototype,function(e){t.enemyLevels.set(e.level,e)}),this.heroStats=new Map,this.load(l.ruleHeroStatRaw,a.RuleHeroStat.prototype,function(e){t.heroStats.set(e.code,e)}),this.heroLevels=new Map,this.load(u.ruleHeroLevelRaw,a.RuleHeroLevel.prototype,function(e){t.heroLevels.set(e.level,e),t.maxHeroLevel=Math.max(t.maxHeroLevel,e.level)}),this.items=new Map,this.load(y.ruleItemRaw,a.RuleItem.prototype,function(e){t.items.set(e.code,e)}),this.itemLevels=new Map,this.load(v.ruleItemLevelRaw,a.RuleItemLevel.prototype,function(e){t.itemLevels.set(e.level,e)}),this.itemMagics=new Map,this.load(m.ruleItemMagicRaw,a.RuleItemMagic.prototype,function(e){e.ready(),t.itemMagics.set(e.code,e)}),this.materials=new Map,this.load(g.ruleMaterialRaw,a.RuleMaterial.prototype,function(e){e.ready(),t.materials.set(e.code,e)}),this.objects=new Map,this.load(W.ruleObjectRaw,a.RuleObject.prototype,function(e){t.objects.set(e.code,e)}),this.playerExp=new Map,this.load(b.rulePlayerExpRaw,a.RulePlayerExp.prototype,function(e){t.playerExp.set(e.level,e),t.maxPlayerLevel=Math.max(t.maxPlayerLevel,e.level)}),this.potions=new Map,this.load(S.rulePotionRaw,a.RulePotion.prototype,function(e){t.potions.set(e.code,e)}),this.skills=new Map,this.load(_.ruleSkillRaw,a.RuleSkill.prototype,function(e){e.ready();var o=t.skills.get(e.code);o||(o=new a.RuleSkillSet(e.code),t.skills.set(e.code,o)),o.addSkill(e)}),this.unlocks=new Map,this.unlockMaps=new Map,this.load(A.ruleUnlockRaw,a.RuleUnlock.prototype,function(e){t.unlocks.set(e.no,e),t.unlockMaps.set(P.WdVec.build(e.x,e.y).pack(),e)}),this.readyMaterialUsage(),[2,!0]})})},t.prototype.load=function(t,e,o){t.forEach(function(t){var r=Object.setPrototypeOf(t,e);o(r)})},t.prototype.getUnlockRule=function(t,e){for(var o=0,r=Array.from(this.unlocks.values());o<r.length;o++){var n=r[o];if(n.type==t&&(!e||e==n.code))return n}return null},t.prototype.getUnlockNeighbors=function(t){for(var e=new Array,o=new P.WdVec(t.x,t.y),r=0,n=P.WdVec.news;r<n.length;r++){var i=n[r],c=o.add(i),a=this.unlockMaps.get(c.pack());a&&e.push(a)}return e},t.readyTest=function(){},t.prototype.getSkill=function(t){return this.skills.get(t.code).skills.get(t.level)},t.prototype.getSkillMaxLevel=function(t){return this.skills.get(t).maxLevel},t.prototype.addUsage=function(t,e){e.forEach(function(e){if(e.mat1>0){var o=t.get(e.mat1)+e.mat1Count;t.set(e.mat1,o)}e.mat2>0&&(o=t.get(e.mat2)+e.mat2Count,t.set(e.mat2,o)),e.mat3>0&&(o=t.get(e.mat3)+e.mat3Count,t.set(e.mat3,o))})},t.prototype.readyMaterialUsage=function(){var t=this,e=new Map;this.materials.forEach(function(t){t.code<60&&e.set(t.code,0)}),this.matUsage=new Map,this.matUsage.set(11,e.get(11)),this.matUsage.set(21,e.get(21)),this.matUsage.set(31,e.get(31)),this.matUsage.set(41,e.get(41)),this.matUsage.set(51,e.get(51)),this.materials.forEach(function(o){0==o.mat1||o.code>=60||t.getRawMat(o.code,e.get(o.code)).forEach(function(e,o){t.matUsage.set(o,t.matUsage.get(o)+e)})})},t.prototype.getRawMat=function(t,e){if(0==t)return new Map;var o=this.materials.get(t);if(0==o.mat1){var r=new Map;return r.set(t,e),r}var n=this.getRawMat(o.mat1,o.mat1Count*e);return this.getRawMat(o.mat2,o.mat2Count*e).forEach(function(t,e){var o=n.get(e);o?n.set(e,o+t):n.set(e,t)}),this.getRawMat(o.mat3,o.mat3Count*e).forEach(function(t,e){var o=n.get(e);o?n.set(e,o+t):n.set(e,t)}),n},r([c.service("RuleService")],t)}();o.RuleService=R,cc._RF.pop()},{"../common/bean/Decorators":"Decorators","../world/core/common/WdVec":"WdVec","./model/Model":"Model","./rules/Act":"Act","./rules/Artifact":"Artifact","./rules/Drop":"Drop","./rules/Enemy":"Enemy","./rules/EnemyLevel":"EnemyLevel","./rules/HeroLevel":"HeroLevel","./rules/HeroStat":"HeroStat","./rules/Item":"Item","./rules/ItemLevel":"ItemLevel","./rules/ItemMagic":"ItemMagic","./rules/Material":"Material","./rules/Object":"Object","./rules/PlayerExp":"PlayerExp","./rules/Potion":"Potion","./rules/Skill":"Skill","./rules/Unlock":"Unlock"}],Screenshot:[function(t,e,o){"use strict";cc._RF.push(e,"fcaceX4lNJJn7TE4OVe0Iwx","Screenshot"),Object.defineProperty(o,"__esModule",{value:!0});var r=function(){function t(){}return t.init=function(e){if(void 0===e&&(e=-1),!this.texture){var o=cc.Canvas.instance.designResolution,r=o.width,n=o.height,i=cc.size(r,n);this.texture=new cc.RenderTexture,this.texture.initWithSize(i.width,i.height,cc.RenderTexture.DepthStencilFormat.RB_FMT_S8)}t.getCamera(e).targetTexture=this.texture},t.getCamera=function(t){return void 0===t&&(t=-1),cc.Camera.cameras.find(function(e){return e.depth==t})},t.shot=function(e,o,r){void 0===e&&(e=-1),this.init(e);var n=t.getCamera(e);n.render(void 0);var i=this.texture.readPixels();n.targetTexture=null;var c=this.texture.width,a=this.texture.height,s=document.createElement("canvas"),l=s.getContext("2d");s.width=c,s.height=a;for(var u=4*c,p=0;p<a;p++){for(var d=a-p-1,h=l.createImageData(c,1),f=d*c*4,y=0;y<u;y++)h.data[y]=i[f+y];l.putImageData(h,0,p)}o||(o=cc.v2(0,0)),r||(r=cc.v2(c,a));var v=l.getImageData(o.x,o.y,r.x,r.y),m=document.createElement("canvas");m.id="cropCanvas",m.width=r.x,m.height=r.y;var g=m.getContext("2d");return g.rect(0,0,r.x,r.y),g.fillStyle="white",g.fill(),g.putImageData(v,0,0),this.savedBase64Img=m.toDataURL("image/jpeg"),this.savedBase64Img},t.showTexture=function(t){if(this.savedBase64Img){var e=new Image;e.src=this.savedBase64Img,e.onload=function(){var o=new cc.Texture2D;o.initWithElement(e),o.handleLoadedTexture();var r=new cc.SpriteFrame(o);t.spriteFrame=r}}},t.downloadImg=function(){if(this.savedBase64Img){var t=this.savedBase64Img.replace(/^data:image[^;]*/,"data:image/octet-stream");document.location.href=t}},t.savedBase64Img=null,t}();o.default=r,cc._RF.pop()},{}],SettingService:[function(t,e,o){"use strict";cc._RF.push(e,"30992x/nZtGGZn8hFwLDBJq","SettingService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.SettingService=void 0;var c=t("../bean/Decorators"),a=t("../model/Setting"),s=t("../util/EventHandler"),l=function(){function t(){this.value=new a.Setting,this.onSettingUpdate=new s.EventHandler}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){return i(this,function(){return this.load(),[2,!0]})})},t.prototype.sync=function(){var t=JSON.stringify(this.value);cc.sys.localStorage.setItem("fb-setting",t),this.onSettingUpdate.fire()},t.prototype.load=function(){var t=cc.sys.localStorage.getItem("fb-setting");if(t)try{this.value=Object.setPrototypeOf(JSON.parse(t),a.Setting.prototype)}catch(e){this.value=new a.Setting}},r([c.service("SettingService")],t)}();o.SettingService=l,cc._RF.pop()},{"../bean/Decorators":"Decorators","../model/Setting":"Setting","../util/EventHandler":"EventHandler"}],Setting:[function(t,e,o){"use strict";cc._RF.push(e,"840e1S3aWVNW5IQCfHpzXSF","Setting"),Object.defineProperty(o,"__esModule",{value:!0}),o.Setting=void 0;o.Setting=function(){this.language="en",this.bgm=!0,this.soundFx=!0,this.vibration=!0},cc._RF.pop()},{}],Skill:[function(t,e,o){"use strict";cc._RF.push(e,"f12e3ihckNAtIq0x+7IjADr","Skill"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleSkillRaw=void 0,o.ruleSkillRaw=[{code:1,level:1,type:"Repeater",v1:.1,v2:.1,v3:1,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:1,level:2,type:"Repeater",v1:.2,v2:.2,v3:2,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:1,level:3,type:"Repeater",v1:.3,v2:.3,v3:3,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:2,level:1,type:"MultiArrow",v1:.25,v2:1,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:3,level:1,type:"Ricochet",v1:.2,v2:.3,v3:1,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:3,level:2,type:"Ricochet",v1:.2,v2:.3,v3:2,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:5,level:1,type:"PiercingShot",v1:.3,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:6,level:1,type:"UnitAttackBoost",v1:.1,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:6,level:2,type:"UnitAttackBoost",v1:.2,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:6,level:3,type:"UnitAttackBoost",v1:.3,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:6,level:4,type:"UnitAttackBoost",v1:.4,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:6,level:5,type:"UnitAttackBoost",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:7,level:1,type:"AttackSpeedUp",v1:.1,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:7,level:2,type:"AttackSpeedUp",v1:.2,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:7,level:3,type:"AttackSpeedUp",v1:.3,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:10,level:1,type:"HpBoost",v1:.15,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:10,level:2,type:"HpBoost",v1:.3,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:10,level:3,type:"HpBoost",v1:.45,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:10,level:4,type:"HpBoost",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:15,level:1,type:"ColdCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"Slow",ccEffect:"Cold",ccFireRate:.5,ccDuration:2,ccV1:.3,ccV2:0,ccV3:0},{code:15,level:2,type:"ColdCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"Slow",ccEffect:"Cold",ccFireRate:.5,ccDuration:2.4,ccV1:.4,ccV2:0,ccV3:0},{code:16,level:1,type:"FireCircle",v1:.6,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:16,level:2,type:"FireCircle",v1:.7,v2:0,v3:0,cool:0,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:17,level:1,type:"LightningCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:.5,ccDuration:.4,ccV1:0,ccV2:0,ccV3:0},{code:17,level:2,type:"LightningCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:.5,ccDuration:.6,ccV1:0,ccV2:0,ccV3:0},{code:18,level:1,type:"PoisonCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:1,ccDuration:2,ccV1:2,ccV2:0,ccV3:0},{code:18,level:2,type:"PoisonCircle",v1:.5,v2:0,v3:0,cool:0,duration:0,ccType:"DotDamage",ccEffect:"Poison",ccFireRate:1,ccDuration:2,ccV1:2,ccV2:0,ccV3:0},{code:51,level:1,type:"Ghost",v1:0,v2:0,v3:0,cool:8,duration:0,ccType:"Ghost",ccEffect:"Ghost",ccFireRate:1,ccDuration:2,ccV1:0,ccV2:0,ccV3:0},{code:51,level:2,type:"Ghost",v1:0,v2:0,v3:0,cool:7,duration:0,ccType:"Ghost",ccEffect:"Ghost",ccFireRate:1,ccDuration:2.5,ccV1:0,ccV2:0,ccV3:0},{code:52,level:1,type:"LightningStrike",v1:1,v2:0,v3:0,cool:6,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:1,ccDuration:.5,ccV1:0,ccV2:0,ccV3:0},{code:52,level:2,type:"LightningStrike",v1:1,v2:0,v3:0,cool:5,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:1,ccDuration:.8,ccV1:0,ccV2:0,ccV3:0},{code:53,level:1,type:"MagicBomb",v1:1.5,v2:3,v3:0,cool:7,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:53,level:2,type:"MagicBomb",v1:1.5,v2:4,v3:0,cool:7,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:54,level:1,type:"IcePillar",v1:1,v2:0,v3:0,cool:8,duration:0,ccType:"Slow",ccEffect:"Cold",ccFireRate:1,ccDuration:2,ccV1:.3,ccV2:0,ccV3:0},{code:54,level:2,type:"IcePillar",v1:1,v2:0,v3:0,cool:7,duration:0,ccType:"Slow",ccEffect:"Cold",ccFireRate:1,ccDuration:2.4,ccV1:.4,ccV2:0,ccV3:0},{code:55,level:1,type:"LightningShield",v1:1,v2:0,v3:0,cool:5,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:1,ccDuration:.4,ccV1:0,ccV2:0,ccV3:0},{code:55,level:2,type:"LightningShield",v1:1,v2:0,v3:0,cool:4,duration:0,ccType:"Hurt",ccEffect:"None",ccFireRate:1,ccDuration:.6,ccV1:0,ccV2:0,ccV3:0},{code:56,level:1,type:"Meteor",v1:2,v2:0,v3:0,cool:9,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:56,level:2,type:"Meteor",v1:2,v2:0,v3:0,cool:7,duration:0,ccType:"None",ccEffect:"None",ccFireRate:0,ccDuration:0,ccV1:0,ccV2:0,ccV3:0},{code:57,level:1,type:"BonusLife",v1:.2,v2:0,v3:0,cool:0,duration:0,ccType:"Ghost",ccEffect:"Ghost",ccFireRate:1,ccDuration:2,ccV1:0,ccV2:0,ccV3:0}],cc._RF.pop()},{}],SoundBucket:[function(t,e,o){"use strict";cc._RF.push(e,"89ad5aXD+1Hy5y6RLpfPiEo","SoundBucket");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.SoundBucket=void 0;var c=cc._decorator.property,a=cc._decorator.ccclass,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.clips=[],e.clipMap=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.clips.forEach(function(e){t.clipMap.set(e.name,e)})},e.prototype.getClip=function(t){return this.clipMap.get(t)},i([c(cc.AudioClip)],e.prototype,"clips",void 0),i([a],e)}(cc.Component);o.SoundBucket=s,cc._RF.pop()},{}],SoundService:[function(t,e,o){"use strict";cc._RF.push(e,"87b07/ub61PDbEjN6X6zzNF","SoundService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.SoundService=void 0;var c=t("../bean/Decorators"),a=t("../../App"),s=function(){function t(){this.baseEffectVolume=1,this.baseMusicVolume=1}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){return i(this,function(){return this.baseEffectVolume=cc.audioEngine.getEffectsVolume(),this.baseMusicVolume=cc.audioEngine.getMusicVolume(),[2,!0]})})},t.prototype.playFx=function(t){if(this.settingService.value.soundFx&&null!=t&&0!=t.length){var e=this.getClip(t);e?cc.audioEngine.playEffect(e,!1):console.error("can not found audio clip: "+t)}},t.prototype.getClip=function(t){return a.app.mainUI.getSoundBucket().getClip(t)},t.prototype.stopBGM=function(){cc.audioEngine.stopMusic()},t.prototype.playBGM=function(t){if(this.settingService.value.bgm){var e=this.getClip(t);e?cc.audioEngine.playMusic(e,!0):console.error("can not found audio clip: "+t)}},t.prototype.pause=function(){cc.audioEngine.setEffectsVolume(0),cc.audioEngine.setMusicVolume(0)},t.prototype.resume=function(){cc.audioEngine.setEffectsVolume(this.baseEffectVolume),cc.audioEngine.setMusicVolume(this.baseMusicVolume)},r([c.autoWired("SettingService")],t.prototype,"settingService",void 0),r([c.service("SoundService")],t)}();o.SoundService=s,cc._RF.pop()},{"../../App":"App","../bean/Decorators":"Decorators"}],StringBundleService:[function(t,e,o){"use strict";cc._RF.push(e,"3fa19LDEBtB94T7Zd2givBv","StringBundleService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},c=this&&this.__spreadArrays||function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var r=Array(t),n=0;for(e=0;e<o;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,n++)r[n]=i[c];return r};Object.defineProperty(o,"__esModule",{value:!0}),o.StringBundleService=o.Language=void 0;var a,s=t("../bean/Decorators"),l=t("../util/Utils"),u=t("typescript-string-operations");(function(t){t[t.EN=0]="EN",t[t.KO=1]="KO",t[t.JA=2]="JA"})(a=o.Language||(o.Language={}));var p=function(){function t(){this.strings=new Map}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){return i(this,function(t){switch(t.label){case 0:return this.lang=a.EN,[4,this.load()];case 1:return t.sent(),[2,!0]}})})},t.prototype.getLang=function(){return this.lang},t.prototype.load=function(){return n(this,void 0,void 0,function(){var t,e=this;return i(this,function(o){switch(o.label){case 0:t=!1,cc.resources.loadDir("strings/",cc.JsonAsset,function(o,r){t=!0,null==o?r.forEach(function(t){var o=t.json;o.forEach(function(t){var o=t;e.strings.set(o.key.toLowerCase(),o)}),console.debug(o.length+" strings loaded")}):console.error("can not load string bundles")}),o.label=1;case 1:return t?[3,3]:[4,l.Utils.sleep(.01)];case 2:return o.sent(),[3,1];case 3:return[2]}})})},t.prototype.get=function(t){return null==t?"":(t=t.toLowerCase(),this.strings.get(t)?this.getWithLang(t,this.lang).split("\\n").join("\n"):t)},t.prototype.format=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var r=this.get(t);if(null==r)return t;var n=new u.StringBuilder;return n.AppendFormat.apply(n,c([r],e)),n.ToString()},t.prototype.getWithLang=function(t,e){var o=this.strings.get(t);if(null!=o){switch(e){case a.EN:return o.en;case a.KO:return o.ko;case a.JA:return o.ja}return o.en}return t},r([s.service("StringBundleService")],t)}();o.StringBundleService=p,cc._RF.pop()},{"../bean/Decorators":"Decorators","../util/Utils":"Utils","typescript-string-operations":17}],Table:[function(t,e,o){"use strict";cc._RF.push(e,"22cc0bB+9NM86S1l8mJafgu","Table"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],TextLocale:[function(t,e,o){"use strict";cc._RF.push(e,"af5dcs+9zFKAbrbdClCAZ0N","TextLocale");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../bean/Decorators"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.langKey="",e}return n(e,t),e.prototype.onLoad=function(){this.node.getComponent(cc.Label).string=this.sb.get(this.langKey)},i([a(cc.String)],e.prototype,"langKey",void 0),i([s.autoWired("StringBundleService")],e.prototype,"sb",void 0),i([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../bean/Decorators":"Decorators"}],UIPresenterBase:[function(t,e,o){"use strict";cc._RF.push(e,"eda5bhCdshDXLAl+LkAqTJS","UIPresenterBase");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var s=cc._decorator.ccclass,l=cc._decorator.property,u=t("./BlackPanel"),p=t("./CommonAlertBox"),d=t("./Utils"),h=t("./ColorPanel"),f=t("../bean/Decorators"),y=t("../../App"),v=t("./MyCanvasScaler"),m=t("./SoundBucket"),g=t("./WaitingPanel"),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.blackPanelPrefab=null,e.commonAlertBox=null,e.colorPanel=null,e.waitingPanel=null,e.canvasScaler=null,e.soundBucket=null,e}return n(e,t),e.prototype.initScene=function(t){void 0===t&&(t=!0),y.app.mainUI=this,this.canvas=this.getComponent(cc.Canvas),this.popups=new Set,this.blackPanels=new Map,this.setCanvas(),t&&this.playFadeIn()},e.prototype.setCanvas=function(){var t=this.canvas.designResolution,e=cc.view.getFrameSize(),o=e.height*(t.width/e.width);o=Math.min(1420,o),o=Math.max(o,t.height),t.height=o,this.canvas.designResolution=t},e.prototype.playFadeOut=function(){this.colorPanel.init(cc.Color.BLACK,0),this.colorPanel.show(.25)},e.prototype.playFadeIn=function(){this.colorPanel.init(cc.Color.BLACK,255),this.colorPanel.hide(.25)},e.prototype.getColorPanel=function(){return this.colorPanel},e.prototype.getCanvasScaler=function(){return this.canvasScaler},e.prototype.getSoundBucket=function(){return this.soundBucket},e.prototype.addPopup=function(t){this.popups.add(t)},e.prototype.removePopup=function(t){this.popups.delete(t)},e.prototype.getPopups=function(){return this.popups},e.prototype.showCommonAlertKey=function(t,e){return c(this,void 0,Promise,function(){return a(this,function(){return[2,this.showCommonAlert(this.sb.get(t),e)]})})},e.prototype.showCommonAlert=function(t,e){return c(this,void 0,Promise,function(){return a(this,function(o){switch(o.label){case 0:return this.commonAlertBox.isShown?[4,d.Utils.sleep(.1)]:[3,2];case 1:return o.sent(),[3,0];case 2:return[4,this.commonAlertBox.show(t,e)];case 3:return[2,o.sent()]}})})},e.prototype.showBlackPanel=function(t){if(this.blackPanels.has(t))console.error("duplicated");else{var e=this.goPooler.fromPrefab(this.blackPanelPrefab,t.queryBlackTargetPanel().parent);this.blackPanels.set(t,e),e.display(t)}},e.prototype.hideBlackPanel=function(t){if(this.blackPanels.has(t)){var e=this.blackPanels.get(t);this.blackPanels.delete(t),e.hide()}},e.prototype.showWaiting=function(){var t;null===(t=this.waitingPanel)||void 0===t||t.show()},e.prototype.hideWaiting=function(){var t;null===(t=this.waitingPanel)||void 0===t||t.hide()},i([l(u.default)],e.prototype,"blackPanelPrefab",void 0),i([l(p.default)],e.prototype,"commonAlertBox",void 0),i([l(h.default)],e.prototype,"colorPanel",void 0),i([l(g.WaitingPanel)],e.prototype,"waitingPanel",void 0),i([l(v.MyCanvasScaler)],e.prototype,"canvasScaler",void 0),i([l(m.SoundBucket)],e.prototype,"soundBucket",void 0),i([f.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([f.autoWired("StringBundleService")],e.prototype,"sb",void 0),i([s],e)}(cc.Component);o.default=W,cc._RF.pop()},{"../../App":"App","../bean/Decorators":"Decorators","./BlackPanel":"BlackPanel","./ColorPanel":"ColorPanel","./CommonAlertBox":"CommonAlertBox","./MyCanvasScaler":"MyCanvasScaler","./SoundBucket":"SoundBucket","./Utils":"Utils","./WaitingPanel":"WaitingPanel"}],Unlock:[function(t,e,o){"use strict";cc._RF.push(e,"599933kZGhByIrY69XJNNVS","Unlock"),Object.defineProperty(o,"__esModule",{value:!0}),o.ruleUnlockRaw=void 0,o.ruleUnlockRaw=[{no:1,type:"Building",code:1,x:0,y:0},{no:2,type:"Building",code:2,x:0,y:1},{no:3,type:"Building",code:7,x:1,y:0},{no:4,type:"Building",code:3,x:0,y:-1},{no:5,type:"Skill",code:51,x:-1,y:0},{no:6,type:"Material",code:33,x:0,y:2},{no:7,type:"Building",code:8,x:1,y:1},{no:8,type:"Building",code:6,x:2,y:0},{no:9,type:"Building",code:4,x:1,y:-1},{no:10,type:"Building",code:5,x:0,y:-2},{no:11,type:"Building",code:10,x:-1,y:-1},{no:12,type:"Skill",code:52,x:-2,y:0},{no:13,type:"Skill",code:53,x:-1,y:1},{no:14,type:"Material",code:42,x:1,y:2},{no:15,type:"Material",code:52,x:2,y:1},{no:16,type:"ScRune",code:0,x:2,y:-1},{no:17,type:"ScFood",code:0,x:1,y:-2},{no:18,type:"Building",code:11,x:-1,y:-2},{no:19,type:"Building",code:9,x:-2,y:-1},{no:20,type:"Skill",code:54,x:-2,y:1},{no:21,type:"Skill",code:55,x:-1,y:2},{no:22,type:"Skill",code:56,x:2,y:2},{no:23,type:"ScSpecial",code:0,x:2,y:-2},{no:24,type:"Building",code:12,x:-2,y:-2},{no:25,type:"Skill",code:57,x:-2,y:2}],cc._RF.pop()},{}],Utils:[function(t,e,o){"use strict";cc._RF.push(e,"9fbe5BrM7tCZZF4dQd7My6N","Utils");var r=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},n=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.Utils=void 0;var i=function(){function t(){}return t.currentTimeMillis=function(){return Date.now()},t.sleep=function(t){return r(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,(o=1e3*t,new Promise(function(t){return setTimeout(t,o)}))];case 1:return[2,e.sent()]}var o})})},t.shuffle=function(t){for(var e,o,r=t.length;0!==r;)o=Math.floor(Math.random()*r),e=t[r-=1],t[r]=t[o],t[o]=e;return t},t}();o.Utils=i,cc._RF.pop()},{}],WaitRoutine:[function(t,e,o){"use strict";cc._RF.push(e,"97f1dKoUdhDpJqPV50EaGke","WaitRoutine"),Object.defineProperty(o,"__esModule",{value:!0}),o.WaitRoutine=void 0;var r=function(){function t(t,e,o){this.playTime=0,this.done=!1,this.timeScaleAffected=!0,this.duration=t,this.onDone=e,this.timeScaleAffected=o}return t.prototype.onStart=function(){},t.prototype.isDone=function(){return this.done},t.prototype.onUpdate=function(t){this.playTime+=t,!this.done&&this.playTime>=this.duration&&(this.done=!0,this.onDone&&this.onDone())},t.prototype.timeScaled=function(){return this.timeScaleAffected},t.prototype.stop=function(){this.playTime=this.duration},t}();o.WaitRoutine=r,cc._RF.pop()},{}],WaitingPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5776620Q9RMj4E41V1Wg85j","WaitingPanel");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WaitingPanel=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.core=null,e}return n(e,t),e.prototype.update=function(t){var e=this.core.rotation+90*t;this.core.rotation=e%360},e.prototype.show=function(){this.node.active=!0},e.prototype.hide=function(){this.node.active=!1},i([a(cc.Node)],e.prototype,"core",void 0),i([c],e)}(cc.Component);o.WaitingPanel=s,cc._RF.pop()},{}],WdActionHistoryDAO:[function(t,e,o){"use strict";var r;cc._RF.push(e,"c9f30uMQsBDhaqc/FtT1S1T","WdActionHistoryDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdActionHistoryDAO=o.WdActionHistoryType=void 0,function(t){t[t.None=0]="None",t[t.BasicTutorial1=1]="BasicTutorial1",t[t.BasicTutorial2=2]="BasicTutorial2",t[t.BasicTutorial3=3]="BasicTutorial3",t[t.Unlock=10]="Unlock",t[t.Build=11]="Build",t[t.SwitchApp=12]="SwitchApp"}(r=o.WdActionHistoryType||(o.WdActionHistoryType={}));var n=function(){function t(){this.type=r.None}return t.prototype.getPk=function(){return this.type},t}();o.WdActionHistoryDAO=n,cc._RF.pop()},{}],WdActionHistoryRepository:[function(t,e,o){"use strict";cc._RF.push(e,"a542efrWfpB8Zjmk+OEGvWq","WdActionHistoryRepository");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdActionHistoryRepository=void 0;var c=t("../../../common/repository/Repository1"),a=t("../../../common/bean/Decorators"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([a.repository("WdActionHistoryRepository")],e)}(c.Repository1);o.WdActionHistoryRepository=s,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/repository/Repository1":"Repository1"}],WdAreaDAO:[function(t,e,o){"use strict";cc._RF.push(e,"dc300gOvTpDDaIVWPlpxMla","WdAreaDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdAreaDAO=void 0;var r=function(){function t(){}return t.prototype.getPk=function(){return this.key.getCode()},t.build=function(e){var o=new t;return o.key=e,o},t}();o.WdAreaDAO=r,cc._RF.pop()},{}],WdAreaKey:[function(t,e,o){"use strict";cc._RF.push(e,"ca41eJ6trZIDZyPQVhtpnCB","WdAreaKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdAreaKey=void 0;var r=function(){function t(t,e){this.act=0,this.level=0,void 0!==t&&(this.act=t),void 0!==e&&(this.level=e)}return t.prototype.getCode=function(){return 100*this.act+this.level},t.prototype.isEmpty=function(){return 0==this.getCode()},t.prototype.isVillage=function(){return 0==this.act},t.prototype.isShelter=function(){return 0==this.act},t.prototype.isDungeon=function(){return this.act>=1},t.prototype.toString=function(){return this.act+"-"+this.level},t.prototype.clone=function(){return new t(this.act,this.level)},t.from=function(e){return new t(Math.round(e/100),e%100)},t.build=function(e,o){return new t(e,o)},t.prototype.before=function(){return new t(this.act,this.level-1)},t.prototype.next=function(){return new t(this.act,this.level+1)},t.village=new t(0,1),t.empty=new t(0,0),t}();o.WdAreaKey=r,cc._RF.pop()},{}],WdAreaPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"dbb4fXmN+VFYJ0+YFjfVry7","WdAreaPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdBucketLevel=void 0;var s,l=cc._decorator.property,u=cc._decorator.ccclass,p=t("./WdFloorDungeon"),d=t("../../../common/bean/Decorators"),h=t("../common/WduTransitionPanelDefault"),f=t("../../core/world/WdISharedRes"),y=t("../../../common/util/CcUtils");(function(t){t[t.Ground=0]="Ground",t[t.Normal=1]="Normal",t[t.Overlay=2]="Overlay"})(s=o.WdBucketLevel||(o.WdBucketLevel={}));var v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.floorDungeon_=null,e.unitBucketGround_=null,e.unitBucketNormal_=null,e.unitBucketOverlay_=null,e.transitionPanel=null,e.onAreaStart=function(t,o){e.refreshArea(),e.transitionPanel.hide(),t.act!=o.act&&e.playSound(o)},e.onChangeState=function(){e.world.state==f.WorldState.Pause?y.CcUtils.setTimeScale(1e-4):y.CcUtils.setTimeScale(1)},e.onAreaEnd=function(){e.transitionPanel.show()},e}return n(e,t),Object.defineProperty(e.prototype,"floorDungeon",{get:function(){return this.floorDungeon_},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){},e.prototype.boot=function(t){this.world=t,this.world.eventBus.onAreaStart.addHandler(this.onAreaStart),this.world.eventBus.onAreaEnd.addHandler(this.onAreaEnd),this.world.eventBus.onChangeState.addHandler(this.onChangeState),this.floorDungeon.boot(t),this.refreshArea(),this.transitionPanel.hide(),this.playSound(t.area.getKey())},e.prototype.test=function(){return c(this,void 0,void 0,function(){return a(this,function(){return this.world.setState(f.WorldState.Pause),this.world.setState(f.WorldState.Play),[2]})})},e.prototype.onClickCancelBoard=function(){this.world.setState(f.WorldState.Play)},e.prototype.playSound=function(t){this.soundService.playBGM(t.isVillage()?"village":"dungeon")},e.prototype.refreshArea=function(){this.floorDungeon.node.active=this.world.area.getKey().isDungeon()},e.prototype.getUnitBucket=function(t){switch(t){case s.Ground:return this.unitBucketGround_;case s.Normal:return this.unitBucketNormal_;case s.Overlay:return this.unitBucketOverlay_}return null},i([l(p.WdFloorDungeon)],e.prototype,"floorDungeon_",void 0),i([l(cc.Node)],e.prototype,"unitBucketGround_",void 0),i([l(cc.Node)],e.prototype,"unitBucketNormal_",void 0),i([l(cc.Node)],e.prototype,"unitBucketOverlay_",void 0),i([l(h.WduTransitionPanelDefault)],e.prototype,"transitionPanel",void 0),i([d.autoWired("WorldService")],e.prototype,"worldService",void 0),i([d.autoWired("WdAreaService")],e.prototype,"areaService",void 0),i([d.autoWired("SoundService")],e.prototype,"soundService",void 0),i([u],e)}(cc.Component);o.default=v,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/util/CcUtils":"CcUtils","../../core/world/WdISharedRes":"WdISharedRes","../common/WduTransitionPanelDefault":"WduTransitionPanelDefault","./WdFloorDungeon":"WdFloorDungeon"}],WdAreaService:[function(t,e,o){"use strict";cc._RF.push(e,"9e192eD5u1HabaFrYL08/5P","WdAreaService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdAreaService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("../../player/WdBattleBook"),c=t("./WdAreaDAO"),a=t("../../../../rule/model/Model"),s=t("../../player/WdPotion"),l=function(){function t(){}return t.prototype.build=function(t,e){var o=this,r=this.playerService.getPlayer();if(e.act>=1&&1==e.level){var n=++r.battleCount;r.battleBook=new i.WdBattleBook(n);var c=this.heroService.getHero().stats.getAll(a.WdStatType.Potion),l=1;c.forEach(function(t){var e=Math.round(t.minV),n=o.ruleService.potions.get(e),i=new s.WdPotion;i.no=l++,i.code=e,i.hp=n.hp,r.battleBook.potions.push(i)})}},t.prototype.newArea=function(t,e){return this.build(t,e),this.area=c.WdAreaDAO.build(e),this.area},r([n.autoWired("WdHeroService")],t.prototype,"heroService",void 0),r([n.autoWired("WdPlayerService")],t.prototype,"playerService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdAreaService")],t)}();o.WdAreaService=l,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../player/WdBattleBook":"WdBattleBook","../../player/WdPotion":"WdPotion","./WdAreaDAO":"WdAreaDAO"}],WdArea:[function(t,e,o){"use strict";cc._RF.push(e,"13c62B59XtNM7qvrJcQfPj8","WdArea");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdArea=void 0;var n=t("../../common/WdVec"),i=t("../unit/WdUnitKey"),c=t("../../../../rule/model/Model"),a=t("../enemy/WdEnemy"),s=t("../object/WdObject"),l=t("../dropItem/WdDropItem"),u=t("../../../../common/bean/Decorators"),p=t("../../common/WdRandom"),d=t("./pulsar/WdDungeonPulsar"),h=t("./pulsar/WdVillagePulsar"),f=function(){function t(t){var e=this;this.enemies=new Map,this.objects=new Map,this.dropItems=new Map,this.pulsars=new Array,this.occupied=new Map,this.enemyRemainCount=0,this.enemyKillCount=0,this.onTearDown=function(t){e.ws.eventBus.onAreaTearDown.fire(t)},this.onEnemyDead=function(t){var o=t.getDao().rewardRate,r=Math.round(t.getRule().exp*o);e.heroService.addExp(r),e.enemies.delete(t.getNo()),e.enemyService.delete(t.getNo()),e.enemyKillCount++,e.ws.player.battleBook.score++,e.ws.eventBus.onEnemyDead.fire(t);var n=e.diService.newItemFromDeadEnemy(e.getKey(),t.getRule(),t.getPos(),o);if(null!=n){var i=new l.WdDropItem(n);e.addDropItem(i,!0,i.getPos()),i.boot(e.ws)}},this.onDropItemDead=function(t){var o=new Set(e.ws.hero.getDao().equips.values());e.itemService.addDropItem(t.getDao()),e.itemService.removeOverflow(10,o),e.ws.eventBus.onItemUpdate.fire(),e.ws.hero.getDao().hasNewItem=!0,e.ws.eventBus.onHeroUpdated.fire()},this.dao=t}return t.prototype.boot=function(t){var e=this;if(this.rule=this.ruleService.acts.get(this.getKey().act),this.enemyRemainCount=this.rule.enemyCount,this.enemyKillCount=0,this.ws=t,this.enemyService.getEnemies().forEach(function(o){var r=new a.WdEnemy(o);r.boot(t),e.addEnemy(r,!1)}),this.objectService.getObjects().forEach(function(o){var r=new s.WdObject(o);r.boot(t),e.addObject(r,!1)}),this.diService.getDropItems().forEach(function(o){var r=new l.WdDropItem(o);r.boot(t),e.addDropItem(r,!1)}),this.getKey().isDungeon())(o=new d.WdDungeonPulsar(this.ws)).boot(),this.pulsars.push(o);else if(this.getKey().isVillage()){var o;(o=new h.WdVillagePulsar(this.ws)).boot(),this.pulsars.push(o)}},t.prototype.getKey=function(){return this.dao.key},t.prototype.addEnemy=function(t,e){void 0===e&&(e=!0),this.enemyRemainCount--,this.enemies.set(t.getNo(),t),e&&this.ws.eventBus.onEnemyBorn.fire(t)},t.prototype.addObject=function(t,e){void 0===e&&(e=!0),this.objects.set(t.getNo(),t),e&&this.ws.eventBus.onObjectBorn.fire(t)},t.prototype.addDropItem=function(t,e,o){void 0===e&&(e=!0),void 0===o&&(o=n.WdVec.zero),this.dropItems.set(t.getNo(),t),e&&this.ws.eventBus.onDropItemBorn.fire(o,t)},t.prototype.onTick=function(t){this.pulsars.forEach(function(e){e.onTick(t)}),this.tickEnemies(t),this.tickObjects(t),this.tickDropItem(t)},t.prototype.tickUnit=function(t,e,o){var r=null;e.forEach(function(e){e.onTick(t),e.isDead()&&(null==r&&(r=new Array),r.push(e))}),null!=r&&r.forEach(function(t){o(t)})},t.prototype.tickEnemies=function(t){this.tickUnit(t,this.enemies,this.onEnemyDead)},t.prototype.tickObjects=function(t){var e=this;this.tickUnit(t,this.objects,function(t){e.objectService.delete(t.getNo()),e.objects.delete(t.getNo()),e.ws.eventBus.onObjectDead.fire(t)})},t.prototype.tickDropItem=function(t){var e=this;this.tickUnit(t,this.dropItems,function(t){e.diService.delete(t.getNo()),e.dropItems.delete(t.getNo()),e.ws.eventBus.onDropItemDead.fire(t),e.onDropItemDead(t)})},t.prototype.getEnemy=function(t){return this.enemies.get(t)},t.prototype.getObject=function(t){return this.objects.get(t)},t.prototype.getDropItem=function(t){return this.dropItems.get(t)},t.prototype.getRandomDropPos=function(t){var e,o,r=this.ws.hero.getPos(),n=t.getPos();e=r.x<n.x?p.WdRandom.getRangeFloat(0,.5):p.WdRandom.getRangeFloat(-.5,0),o=.5*-t.getSize().y,o+=p.WdRandom.getRangeFloat(-.25,0);var i=n.clone();return i.x+=80*e,i.y+=80*o,i},t.prototype.readItems=function(){this.ws.hero.getDao().hasNewItem=!1,this.ws.eventBus.onHeroUpdated.fire()},t.prototype.getUnit=function(t){var e=t.type,o=t.no;return e==i.WdUnitType.Hero?this.ws.hero:e==i.WdUnitType.Enemy?this.getEnemy(o):e==i.WdUnitType.Object?this.getObject(o):e==i.WdUnitType.DropItem?this.getDropItem(o):null},t.prototype.receiveReward=function(t,e){var o=this;e.forEach(function(e){if(e.type!=c.WdResourceType.Material){var r=o.getRandomDropPos(t),n=o.diService.newRewardItem(o.getKey(),e,r),i=new l.WdDropItem(n);i.boot(o.ws),o.addDropItem(i,!0,t.getPos())}})},r([u.autoWired("WdEnemyService")],t.prototype,"enemyService",void 0),r([u.autoWired("WdObjectService")],t.prototype,"objectService",void 0),r([u.autoWired("WdDropItemService")],t.prototype,"diService",void 0),r([u.autoWired("WdMaterialService")],t.prototype,"materialService",void 0),r([u.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([u.autoWired("WdHeroService")],t.prototype,"heroService",void 0),r([u.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdArea=f,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdRandom":"WdRandom","../../common/WdVec":"WdVec","../dropItem/WdDropItem":"WdDropItem","../enemy/WdEnemy":"WdEnemy","../object/WdObject":"WdObject","../unit/WdUnitKey":"WdUnitKey","./pulsar/WdDungeonPulsar":"WdDungeonPulsar","./pulsar/WdVillagePulsar":"WdVillagePulsar"}],WdArtifactDAO:[function(t,e,o){"use strict";cc._RF.push(e,"8c23dc5in1An4kejFZvLzON","WdArtifactDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdArtifactDAO=void 0;var r=function(){function t(){}return t.prototype.getPk=function(){return this.code},t.build=function(e){var o=new t;return o.code=e,o},t}();o.WdArtifactDAO=r,cc._RF.pop()},{}],WdArtifactRepository:[function(t,e,o){"use strict";cc._RF.push(e,"ef049tVwG1JY4kr9jOUuNFY","WdArtifactRepository");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdArtifactRepository=void 0;var c=t("../../../../common/repository/Repository1"),a=t("../../../../common/bean/Decorators"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([a.repository("WdArtifactRepository")],e)}(c.Repository1);o.WdArtifactRepository=s,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/repository/Repository1":"Repository1"}],WdArtifactService:[function(t,e,o){"use strict";cc._RF.push(e,"435caH6zZ5GqIFBzx24i4kY","WdArtifactService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdArtifactService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("../unit/WdStat"),c=t("../../../../rule/model/Model"),a=t("./WdArtifactDAO"),s=t("../../common/WdRandom"),l=function(){function t(){}return t.prototype.getArtifacts=function(){return this.repository.readAll()},t.prototype.getArtifact=function(t){return this.repository.read(t)},t.prototype.getAllStats=function(t){var e=this,o=new Array;return t.forEach(function(t){o=o.concat(e.getStat(t))}),o},t.prototype.getStat=function(t){var e=new Array,o=this.ruleService.artifacts.get(t),r=new i.WdStat;return r.type=o.type,r.minV=o.minV,r.maxV=o.maxV,r.cc=o.cc,e.push(r),e},t.prototype.getSlotCount=function(t){return this.isAdditionalSlotUnlocked(t)?5:3},t.prototype.isAdditionalSlotUnlocked=function(t){var e,o=this;switch(t){case c.WdArtifactCategory.Rune:e=c.WdResourceType.ScRune;break;case c.WdArtifactCategory.Food:e=c.WdResourceType.ScFood;break;case c.WdArtifactCategory.Special:e=c.WdResourceType.ScSpecial;break;default:return!1}var r=!0;return this.ruleService.unlocks.forEach(function(t){t.type==e&&(r=o.worldService.getPlayer().isUnlocked(t.no))}),r},t.prototype.isFull=function(){return this.getArtifacts().length==this.ruleService.artifacts.size},t.prototype.newRandomArtifact=function(){var t=this.getArtifacts(),e=new Set,o=new Array;if(t.forEach(function(t){return e.add(t.code)}),this.ruleService.artifacts.forEach(function(t){e.has(t.code)||o.push(t.code)}),0==o.length)return console.error("Already full"),null;var r=s.WdRandom.getNextInt(o.length);return this.newArtifact(o[r])},t.prototype.newArtifact=function(t){var e=a.WdArtifactDAO.build(t);return this.repository.create(e),this.worldService.getEventBus().onNewArtifact.fire(t),e},r([n.autoWired("WdArtifactRepository")],t.prototype,"repository",void 0),r([n.autoWired("WdMaterialService")],t.prototype,"materialService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdArtifactService")],t)}();o.WdArtifactService=l,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdRandom":"WdRandom","../unit/WdStat":"WdStat","./WdArtifactDAO":"WdArtifactDAO"}],"WdAttackCalculator.spec":[function(t,e,o){"use strict";cc._RF.push(e,"71289OsDTVCbYRs7comcjk1","WdAttackCalculator.spec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdAttackCalculatorTest=void 0;var c=t("testyts"),a=t("../../../../../common/bean/Decorators"),s=t("../../../../../rule/RuleService"),l=t("../../../../../common/bean/BeanContainer"),u=t("../../../../../rule/model/Model"),p=t("../WdStat"),d=t("../../hero/WdHero"),h=t("../../hero/WdHeroDAO"),f=t("../../../common/WdVec"),y=t("../../enemy/WdEnemy"),v=t("../../enemy/WdEnemyDAO"),m=t("../WdAttackCalculator"),g=t("../WdAttack"),W=function(){function t(){}return t.prototype.beforeAll=function(){return n(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return s.RuleService.readyTest(),[4,l.beanContainer.initialize()];case 1:return e.sent(),(t=new h.WdHeroDAO).code=1,t.exp=1,t.level=1,t.pos=new f.WdVec(0,0),this.me=new d.WdHero(t),[2]}})})},t.prototype.newEnemy=function(){var t=new v.WdEnemyDAO;t.code=10,t.no=1,t.pos=f.WdVec.zero,t.sight=6;var e=new Array,o=new p.WdStat;return o.type=u.WdStatType.Life,o.minV=100,o.maxV=100,e.push(o),t.stats.refresh(e),new y.WdEnemy(t)},t.prototype.baseTest=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy(),o=new g.WdAttack;o.attacks.push(p.WdStat.build(u.WdStatType.PhysicalAttack,50,50));var r=t.makeDamages(o,e);c.expect.toBeEqual(r.damages.length,1),c.expect.toBeEqual(r.damages[0].amount,50);var n=new g.WdAttack;n.attacks.push(p.WdStat.build(u.WdStatType.PhysicalAttack,10,10)),n.attackBoost=1.5,n.attackRate=1.5,n.cool=2;var i=t.makeDamages(n,e);c.expect.toBeEqual(i.damages.length,1),c.expect.toBeEqual(i.damages[0].amount,45)},t.prototype.physicalAttack=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy();e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.Defense,1e3,1e3));var o=new g.WdAttack;o.attacks.push(p.WdStat.build(u.WdStatType.PhysicalAttack,40,40));var r=t.makeDamages(o,e);c.expect.toBeEqual(r.damages.length,1),c.expect.toBeEqual(r.damages[0].amount,20),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.PhysicalResist,.5,.5));var n=t.makeDamages(o,e);c.expect.toBeEqual(n.damages.length,1),c.expect.toBeEqual(n.damages[0].amount,10)},t.prototype.fireAttack=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy(),o=new g.WdAttack;o.attacks.push(p.WdStat.build(u.WdStatType.FireAttack,50,50));var r=t.makeDamages(o,e);c.expect.toBeEqual(r.damages.length,1),c.expect.toBeEqual(r.damages[0].amount,50),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicResist,.5,.5));var n=t.makeDamages(o,e);c.expect.toBeEqual(n.damages.length,1),c.expect.toBeEqual(n.damages[0].amount,25)},t.prototype.lightningAttack=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy(),o=new g.WdAttack;o.attacks.push(p.WdStat.build(u.WdStatType.LightningAttack,50,50));var r=t.makeDamages(o,e);c.expect.toBeEqual(r.damages.length,1),c.expect.toBeEqual(r.damages[0].amount,50),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicResist,.25,.25)),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicResist,.25,.25));var n=t.makeDamages(o,e);c.expect.toBeEqual(n.damages.length,1),c.expect.toBeEqual(n.damages[0].amount,25)},t.prototype.coldAttack=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy(),o=new u.RuleCc;o.type=u.WdCcType.Slow,o.duration=5,o.fireRate=1,o.v1=.5;var r=new g.WdAttack;r.attacks.push(p.WdStat.build(u.WdStatType.ColdAttack,50,50,o));var n=t.makeDamages(r,e);c.expect.toBeEqual(n.damages.length,1),c.expect.toBeEqual(n.damages[0].amount,50),c.expect.toBeEqual(n.damages[0].cc.remain,5),c.expect.toBeEqual(n.damages[0].cc.v1,.5),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicResist,.5,.5));var i=t.makeDamages(r,e);c.expect.toBeEqual(i.damages[0].amount,25),c.expect.toBeEqual(i.damages[0].cc.remain,5),c.expect.toBeEqual(i.damages[0].cc.v1,.5),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicDurationReduction,.5,.5));var a=t.makeDamages(r,e);c.expect.toBeEqual(a.damages[0].amount,25),c.expect.toBeEqual(a.damages[0].cc.remain,2.5),c.expect.toBeEqual(a.damages[0].cc.v1,.5)},t.prototype.poisonDamage=function(){var t=new m.WdAttackCalculator(this.me),e=this.newEnemy(),o=new u.RuleCc;o.type=u.WdCcType.DotDamage,o.duration=5,o.fireRate=1;var r=new g.WdAttack;r.attacks.push(p.WdStat.build(u.WdStatType.PoisonAttack,50,50,o));var n=t.makeDamages(r,e);c.expect.toBeEqual(n.damages.length,1),c.expect.toBeEqual(n.damages[0].amount,1),c.expect.toBeEqual(n.damages[0].cc.v1,10),c.expect.toBeEqual(n.damages[0].cc.remain,5),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicResist,.5,.5));var i=t.makeDamages(r,e);c.expect.toBeEqual(i.damages[0].amount,1),c.expect.toBeEqual(i.damages[0].cc.v1,5),c.expect.toBeEqual(i.damages[0].cc.remain,5),e.getDao().stats.all.push(p.WdStat.build(u.WdStatType.MagicDurationReduction,.5,.5));var a=t.makeDamages(r,e);c.expect.toBeEqual(a.damages[0].amount,1),c.expect.toBeEqual(a.damages[0].cc.v1,5),c.expect.toBeEqual(a.damages[0].cc.remain,2.5)},r([a.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([a.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([c.BeforeAll()],t.prototype,"beforeAll",null),r([c.Test()],t.prototype,"baseTest",null),r([c.Test()],t.prototype,"physicalAttack",null),r([c.Test()],t.prototype,"fireAttack",null),r([c.Test()],t.prototype,"lightningAttack",null),r([c.Test()],t.prototype,"coldAttack",null),r([c.Test()],t.prototype,"poisonDamage",null),r([c.TestSuite()],t)}();o.WdAttackCalculatorTest=W,cc._RF.pop()},{"../../../../../common/bean/BeanContainer":"BeanContainer","../../../../../common/bean/Decorators":"Decorators","../../../../../rule/RuleService":"RuleService","../../../../../rule/model/Model":"Model","../../../common/WdVec":"WdVec","../../enemy/WdEnemy":"WdEnemy","../../enemy/WdEnemyDAO":"WdEnemyDAO","../../hero/WdHero":"WdHero","../../hero/WdHeroDAO":"WdHeroDAO","../WdAttack":"WdAttack","../WdAttackCalculator":"WdAttackCalculator","../WdStat":"WdStat",testyts:16}],WdAttackCalculator:[function(t,e,o){"use strict";cc._RF.push(e,"b3553WLtJJH1ZntY6rZnQ5U","WdAttackCalculator"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdAttackCalculator=void 0;var r=t("../../../../rule/model/Model"),n=t("../../common/WdRandom"),i=t("./WdDamage"),c=t("./WdUnitUtil"),a=t("./WdCc"),s=function(){function t(t){var e=this;this.physical=function(){var t=e.attackValue();if(null==e.target.getStats())return null;var o=e.target.getStats().getAvgSum(r.WdStatType.Defense),n=t-t*(o/(o+1e3)),c=e.target.getStats().getAvgSum(r.WdStatType.PhysicalResist);c<0?n+=-c*n:c>1?n=0:n-=n*c;var a=new i.WdDamage;return a.from=e.me.getKey(),a.to=e.target.getKey(),a.amount=n,a},this.magicDamage=function(t){var o,n,c=e.attackValue(),a=e.target.getStats().getAvgSum(r.WdStatType.MagicResist);a<0?c+=-a*c:a>=1?c=0:c-=c*a;var s=new i.WdDamage;if(s.from=e.me.getKey(),s.to=e.target.getKey(),t==r.WdStatType.PoisonAttack?s.amount=1:s.amount=c,c>0){var l=null!==(n=null===(o=e.currentAttack.cc)||void 0===o?void 0:o.type)&&void 0!==n?n:r.WdCcType.None;l==r.WdCcType.Slow?s.cc=e.makeSlow():l==r.WdCcType.DotDamage?s.cc=e.makeDotDamage(c):l==r.WdCcType.Hurt&&(s.cc=e.makeHurt())}return s},this.me=t,this.random=new n.WdRandom(t.getKey().no),this.handlers=new Map,this.handlers.set(r.WdStatType.PhysicalAttack,this.physical),this.handlers.set(r.WdStatType.FireAttack,this.magicDamage),this.handlers.set(r.WdStatType.ColdAttack,this.magicDamage),this.handlers.set(r.WdStatType.PoisonAttack,this.magicDamage),this.handlers.set(r.WdStatType.LightningAttack,this.magicDamage)}return t.prototype.makeDamagesFrom=function(t,e,o){var r=this;this.attack=t;var n=new Array;t.attacks.forEach(function(t){var o=r.makeDamage(t,e);o&&n.push(o)});var a=c.WdUnitUtil.getDirection(o,e.getPos()),s=new i.WdDamageSet;return s.damages=n,s.direction=a,s.power=t.power,s.delay=t.delay,s.shake=t.shake,s},t.prototype.makeDamages=function(t,e){return this.makeDamagesFrom(t,e,this.me.getPos())},t.prototype.makeDamage=function(t,e){if(this.currentAttack=t,this.target=e,null==e)return null;var o=this.handlers.get(t.type);return o?o(t.type):null},t.prototype.attackValue=function(){var t=this.random.rangeFloat(this.currentAttack.minV,this.currentAttack.maxV);return t*this.attack.attackRate*this.attack.cool*this.attack.attackBoost},t.prototype.getCcFireRate=function(){var t=this.target.getStats().getAvgSum(r.WdStatType.MagicResist);return this.currentAttack.cc.fireRate*(1-Math.min(1,t))},t.prototype.getCcDuration=function(){var t=this.target.getStats().getAvgSum(r.WdStatType.MagicDurationReduction);return this.currentAttack.cc.duration*(1-Math.min(1,t))},t.prototype.makeHurt=function(){var t=this.currentAttack.cc,e=this.getCcFireRate(),o=this.getCcDuration();if(t.duration<=0||this.random.nextFloat(1)>=e)return null;var r=new a.WdCc;return r.type=t.type,r.effect=t.effect,r.remain=o,r},t.prototype.makeSlow=function(){var t=this.currentAttack.cc,e=this.getCcFireRate(),o=this.getCcDuration();if(t.duration<=0||this.random.nextFloat(1)>=e)return null;var r=new a.WdCc;return r.type=t.type,r.effect=t.effect,r.remain=o,r.v1=t.v1,r},t.prototype.makeDotDamage=function(t){var e=this.currentAttack.cc,o=this.getCcFireRate(),r=this.getCcDuration();if(e.duration<=0||this.random.nextFloat(1)>=o)return null;var n=new a.WdCc;return n.type=e.type,n.effect=e.effect,n.remain=r,n.v1=t/e.duration,n},t}();o.WdAttackCalculator=s,cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdRandom":"WdRandom","./WdCc":"WdCc","./WdDamage":"WdDamage","./WdUnitUtil":"WdUnitUtil"}],WdAttack:[function(t,e,o){"use strict";cc._RF.push(e,"dd8af8jNztA3YHzxGfWf37a","WdAttack"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdAttack=void 0;var r=t("../../../../rule/model/Model");o.WdAttack=function(){this.attacks=new Array,this.cool=1,this.attackRate=1,this.attackBoost=1,this.ricochet=0,this.piercing=!1,this.ricochetReduce=0,this.piercingReduce=0,this.power=0,this.delay=0,this.shake=r.WdCamShake.None},cc._RF.pop()},{"../../../../rule/model/Model":"Model"}],WdBattleBook:[function(t,e,o){"use strict";cc._RF.push(e,"b62c9f9twlJvqT23A5h+JJI","WdBattleBook"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdBattleBook=void 0;o.WdBattleBook=function(t){this.battleId=0,this.score=0,this.potions=new Array,this.keepMats=new Array,this.loseMats=new Array,this.getAll=!1,this.battleId=t},cc._RF.pop()},{}],WdCamera:[function(t,e,o){"use strict";cc._RF.push(e,"d2edesjpkVA+buELg9jeUx3","WdCamera");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdCamera=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../unit/WdUnitRadar"),l=t("../../../common/util/AverageFilter"),u=t("../../../App"),p=t("../../../rule/model/Model"),d=t("../../../common/coroutine/CoContainer"),h=t("../../../common/coroutine/EaseRoutine"),f=t("../../core/common/WdRandom"),y=t("../../core/common/WdUtil"),v=t("../../../common/util/CcUtils"),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.camera_=null,e.anchor_=null,e.radar_=null,e.target_=null,e.baseSize=5,e.filter=new l.AverageFilterV2(.15),e.ready=!1,e}return n(e,t),Object.defineProperty(e.prototype,"cam",{get:function(){return this.camera_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radar",{get:function(){return this.radar_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.target_},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.refreshSize()},e.prototype.refreshSize=function(){var t=u.app.mainUI.getCanvasScaler().getOriginSize();this.baseSize=t.height/80*.5,this.cam.orthoSize=this.baseSize},e.prototype.boot=function(t){var e=this;this.radar.boot(),this.ready=!0,this.scheduleOnce(function(){return e.setTarget(t.hero)},.01)},e.prototype.resetEasing=function(){this.filter.clear()},e.prototype.setTarget=function(t){this.target_=t,this.updatePosition(.015)},e.prototype.zoom=function(){},e.prototype.playZoomInAndBackEffect=function(){},e.prototype.playShakePreset=function(t){switch(t){case p.WdCamShake.None:break;case p.WdCamShake.Lower:this.playShake(5,.1,1);break;case p.WdCamShake.Low:this.playShake(6,.1,1);break;case p.WdCamShake.Normal:this.playShake(8,.1,1);break;case p.WdCamShake.High:this.playShake(12,.2,2);break;case p.WdCamShake.Higher:this.playShake(15,.3,3)}},e.prototype.playShake=function(t,e,o){this.shakeRoutine&&this.shakeRoutine.stop(),this.shake(t,.023*e,o)},e.prototype.shake=function(t,e,o){var r=this;this.shakeRoutine=this.startRoutine();for(var n=function(n){var c=1-h.Ease.easeInQuad(0,1,n/o);c=Math.max(.2,c);var a=cc.Vec2.RIGHT.mul(f.WdRandom.getRangeFloat(.9*t,t)*c);a=a.rotate(f.WdRandom.getRangeFloat(0,360)*y.WdUtil.deg2Rad),i.shakeRoutine.ease(h.EaseType.easeOutSine,e*c,function(){return r.anchor_.getPosition()},function(t,e){var o=cc.v2();cc.Vec2.lerp(o,t,a,e),r.anchor_.setPosition(o)})},i=this,c=0;c<o;c++)n(c);this.shakeRoutine.ease(h.EaseType.easeOutSine,e*(1/o),function(){return r.anchor_.getPosition()},function(t,e){var o=cc.v2();cc.Vec2.lerp(o,t,cc.Vec2.ZERO,e),r.anchor_.setPosition(o)}).wait(0,function(){return r.shakeRoutine=null})},e.prototype.update=function(e){t.prototype.update.call(this,e),this.ready&&this.updatePosition(e)},e.prototype.updatePosition=function(t){var e=this.target.getCamFocusPos(),o=this.filter.filter(cc.v2(e.x,e.y),t/v.CcUtils.timeScale);this.node.setPosition(o)},i([a(cc.Camera)],e.prototype,"camera_",void 0),i([a(cc.Node)],e.prototype,"anchor_",void 0),i([a(s.WdUnitRadar)],e.prototype,"radar_",void 0),i([c],e)}(d.CoContainer);o.WdCamera=m,cc._RF.pop()},{"../../../App":"App","../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../../common/util/AverageFilter":"AverageFilter","../../../common/util/CcUtils":"CcUtils","../../../rule/model/Model":"Model","../../core/common/WdRandom":"WdRandom","../../core/common/WdUtil":"WdUtil","../unit/WdUnitRadar":"WdUnitRadar"}],WdCcEffectCold:[function(t,e,o){"use strict";cc._RF.push(e,"dbbfbl38v9Gc7leFFMnKR1Q","WdCcEffectCold"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCcEffectCold=void 0;var r=function(){function t(){}return t.prototype.display=function(t,e){e.color=cc.Color.BLUE},t.prototype.clear=function(){},t}();o.WdCcEffectCold=r,cc._RF.pop()},{}],WdCcEffectGhost:[function(t,e,o){"use strict";cc._RF.push(e,"44c090cP5ZMFqy5lcnzAzMq","WdCcEffectGhost"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCcEffectGhost=void 0;var r=function(){function t(){}return t.prototype.display=function(t,e){e.opacity=128},t.prototype.clear=function(){},t}();o.WdCcEffectGhost=r,cc._RF.pop()},{}],WdCcEffectPoison:[function(t,e,o){"use strict";cc._RF.push(e,"af8f39QzPlKh730Le6ZypJQ","WdCcEffectPoison"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCcEffectPoison=void 0;var r=function(){function t(){}return t.prototype.display=function(t,e){e.color=cc.Color.GREEN},t.prototype.clear=function(){},t}();o.WdCcEffectPoison=r,cc._RF.pop()},{}],WdCcEffectPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"ff30cuff+tCYrMPSl0/Lee3","WdCcEffectPresenter"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCcEffectPresenter=void 0;var r=t("../../../../rule/model/Model"),n=t("./WdICcEffect"),i=t("./WdCcEffectCold"),c=t("./WdCcEffectPoison"),a=t("./WdCcEffectGhost"),s=function(){function t(){this.presenters=new Map,this.presenters.set(r.WdCcEffectType.Cold,new i.WdCcEffectCold),this.presenters.set(r.WdCcEffectType.Poison,new c.WdCcEffectPoison),this.presenters.set(r.WdCcEffectType.Ghost,new a.WdCcEffectGhost)}return t.prototype.display=function(t,e){var o=this,r=new n.WdCcEffectOption;e.forEach(function(e){var n=o.presenters.get(e);n&&n.display(t,r)}),t.setBaseColor(r.color),t.setBaseTint(r.tint),t.setOpacity(r.opacity),t.setBaseAnimSpeed(t.unit.getStats().atkSpdBoost)},t.prototype.clear=function(){this.presenters.forEach(function(t){t.clear()})},t}();o.WdCcEffectPresenter=s,cc._RF.pop()},{"../../../../rule/model/Model":"Model","./WdCcEffectCold":"WdCcEffectCold","./WdCcEffectGhost":"WdCcEffectGhost","./WdCcEffectPoison":"WdCcEffectPoison","./WdICcEffect":"WdICcEffect"}],WdCc:[function(t,e,o){"use strict";cc._RF.push(e,"339d8arM5dADp5baV+2T98C","WdCc"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCc=void 0;var r=t("../../../../rule/model/Model");o.WdCc=function(){this.type=r.WdCcType.None,this.effect=r.WdCcEffectType.None,this.v1=0,this.v2=0,this.remain=0,this.nextTick=0},cc._RF.pop()},{"../../../../rule/model/Model":"Model"}],WdChestMaterialRepository:[function(t,e,o){"use strict";cc._RF.push(e,"8d26abWx+xGOJyL9fiDMMlr","WdChestMaterialRepository");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdChestMaterialRepository=void 0;var c=t("../../../../common/bean/Decorators"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([c.repository("WdChestMaterialRepository")],e)}(t("../../../../common/repository/Repository1").Repository1);o.WdChestMaterialRepository=a,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/repository/Repository1":"Repository1"}],WdChestValue:[function(t,e,o){"use strict";cc._RF.push(e,"6ccbabYcPRClrfCYixUfe/w","WdChestValue"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdChestValue=void 0;o.WdChestValue=function(t){this.opened=!1,this.rewards=new Array,this.rewards=t},cc._RF.pop()},{}],WdDamage:[function(t,e,o){"use strict";cc._RF.push(e,"21e09fhA7pDf4iZhDsNngwb","WdDamage"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdDamageSet=o.WdDamage=void 0;var r=t("../../../../rule/model/Model"),n=t("../../common/WdVec"),i=t("./WdUnitKey");o.WdDamage=function(){this.from=i.WdUnitKey.empty,this.to=i.WdUnitKey.empty,this.amount=0,this.cc=null};o.WdDamageSet=function(){this.damages=null,this.power=0,this.delay=0,this.shake=r.WdCamShake.None,this.direction=n.WdVec.zero},cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdVec":"WdVec","./WdUnitKey":"WdUnitKey"}],WdDataService:[function(t,e,o){"use strict";cc._RF.push(e,"be722LgtUNOTrbpnahS9PHD","WdDataService"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdDropItemActor:[function(t,e,o){"use strict";cc._RF.push(e,"4d829nrDDBOrbmaNl3oqAfj","WdDropItemActor");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItemActor=void 0;var c=t("../unit/WdUnitActor"),a=t("../../core/common/WdVec"),s=cc._decorator.ccclass,l=cc._decorator.property,u=t("../../../common/bean/Decorators"),p=t("../../core/common/WdRandom"),d=t("../../../common/coroutine/EaseRoutine"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor_=null,e.shadow=null,e.dropItem_=null,e}return n(e,t),Object.defineProperty(e.prototype,"anchor",{get:function(){return this.anchor_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this.dropItem_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropItem",{get:function(){return this.dropItem_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.getPos()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){},e.prototype.onGoingIntoPool=function(){t.prototype.onGoingIntoPool.call(this),this.goPooler.returnGo(this.core),this.dropItem.getWs().eventBus.onDropItemActorReturn.fire(this.dropItem),this.dropItem.removeActor(),this.damageRoutine=null},e.prototype.boot=function(t,e){var o=this;this.dropItem_=t,this.core_=e,this.onSetPosition(t.getPos()),this.core.node.setPosition(cc.Vec2.ZERO),this.core.boot(t),this.dropItem.setActor(this),this.scheduleOnce(function(){return o.absorb()},.8),this.shadow.spriteFrame=this.spritePooler.getItem(t.getCode())},e.prototype.playPop=function(t,e){var o=p.WdRandom.getRangeFloat(.4,.5),r=1.75*o;this.node.setPosition(t),this.startRoutine().move(this.node,d.EaseType.linear,r,e),this.core.playPop(o)},e.prototype.absorb=function(){var t=this,e=this.dropItem.getWs().hero,o=e.getPos(),r=this.dropItem.getPos().subtract(o);if(r.len2()>=14400)this.scheduleOnce(function(){return t.absorb()},.1);else{var n=r.len()/100*.15;this.startRoutine().ease(d.EaseType.easeInQuad,n,function(){return t.node.getPosition()},function(o,r){var n=cc.v2();n=cc.Vec2.lerp(n,o,e.getPos(),r),t.node.setPosition(n)},function(){t.dropItem.kill()})}},e.prototype.onSetPosition=function(t){this.node.setPosition(cc.v2(t.x,t.y))},e.prototype.onHit=function(t){this.playDamageEffect(),this.worldService.presenters.mainCam.playShakePreset(t.shake)},e.prototype.onDead=function(){this.core.onDead(),this.goPooler.returnGo(this)},e.prototype.onChangeState=function(){},e.prototype.update=function(e){t.prototype.update.call(this,e)},e.prototype.getPos=function(){var t=this.node.getPosition();return new a.WdVec(t.x,t.y)},i([l(cc.Node)],e.prototype,"anchor_",void 0),i([l(cc.Sprite)],e.prototype,"shadow",void 0),i([u.autoWired("WdSpritePooler")],e.prototype,"spritePooler",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([s],e)}(c.WdUnitActor);o.WdDropItemActor=h,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../core/common/WdRandom":"WdRandom","../../core/common/WdVec":"WdVec","../unit/WdUnitActor":"WdUnitActor"}],WdDropItemDAO:[function(t,e,o){"use strict";cc._RF.push(e,"07c67YGVNJFvbFYfbe/UP43","WdDropItemDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItemDAO=void 0;var r=t("../../../../rule/model/Model"),n=t("../../common/WdVec"),i=function(){function t(){this.pos=n.WdVec.zero,this.code=0,this.dna=0,this.level=1,this.category=r.WdItemCategory.Normal,this.magics=new Array}return t.prototype.getPk=function(){return this.no},t.prototype.getIndex1=function(){return this.area.getCode()},t}();o.WdDropItemDAO=i,cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdVec":"WdVec"}],WdDropItemFactory:[function(t,e,o){"use strict";cc._RF.push(e,"969a1tICbRJTo8YGqXGG5aJ","WdDropItemFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItemFactory=void 0;var c=cc._decorator.ccclass,a=t("./WdDropItemActor"),s=cc._decorator.property,l=t("../unit/WdUnitActorCore"),u=t("../../../common/bean/Decorators"),p=t("../area/WdAreaPresenter"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dropItem_=null,e.dropItemCore_=null,e}return n(e,t),e.prototype.generate=function(t){var e=this.worldService.presenters.areaPresenter.getUnitBucket(p.WdBucketLevel.Normal),o=this.goPooler.fromPrefab(this.dropItem_,e),r=this.goPooler.fromPrefab(this.dropItemCore_,o.anchor);return r.mainSprite.spriteFrame=this.spritePooler.getItem(t.getCode()),o.boot(t,r),o},i([s(a.WdDropItemActor)],e.prototype,"dropItem_",void 0),i([s(l.WdUnitActorCore)],e.prototype,"dropItemCore_",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("WdSpritePooler")],e.prototype,"spritePooler",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdDropItemFactory=d,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../area/WdAreaPresenter":"WdAreaPresenter","../unit/WdUnitActorCore":"WdUnitActorCore","./WdDropItemActor":"WdDropItemActor"}],WdDropItemPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"e1c00c4sO1DAKMBZthok4b2","WdDropItemPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItemPresenter=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/bean/Decorators"),l=t("./WdDropItemFactory"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.factory=null,e.actors=new Map,e.onAreaTearDown=function(){e.actors.forEach(function(t){e.goPooler.returnGo(t)}),e.actors.clear()},e.onAreaStart=function(){e.playAll()},e.onDropItemBorn=function(t,o){var r=e.playDropItem(o),n=o.getPos();r.playPop(cc.v2(t.x,t.y),cc.v2(n.x,n.y)),e.soundService.playFx("drop1")},e.onDropItemActorReturn=function(t){e.actors.delete(t.getKey().pack())},e}return n(e,t),e.prototype.boot=function(t){this.world=t,this.playAll(),t.eventBus.onDropItemBorn.addHandler(this.onDropItemBorn),t.eventBus.onDropItemActorReturn.addHandler(this.onDropItemActorReturn),t.eventBus.onAreaTearDown.addHandler(this.onAreaTearDown),t.eventBus.onAreaStart.addHandler(this.onAreaStart)},e.prototype.playAll=function(){var t=this;this.world.area.dropItems.forEach(function(e){t.playDropItem(e)})},e.prototype.playDropItem=function(t){var e=this.factory.generate(t);return null!=e&&this.actors.set(t.getKey().pack(),e),e},i([a(l.WdDropItemFactory)],e.prototype,"factory",void 0),i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([s.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([s.autoWired("SoundService")],e.prototype,"soundService",void 0),i([c],e)}(cc.Component);o.WdDropItemPresenter=u,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WdDropItemFactory":"WdDropItemFactory"}],WdDropItemService:[function(t,e,o){"use strict";cc._RF.push(e,"6f8d69wfF9AO5fu30t5cNqK","WdDropItemService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItemService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdDropItemDAO"),c=t("../../../../rule/model/Model"),a=t("../../common/WdRandom"),s=t("../../common/WdRandomUtil"),l=t("../item/WdItemDAO"),u=function(){function t(){this.items=new Map,this.no=1}return t.prototype.getDropItems=function(){return Array.from(this.items.values())},t.prototype.onReadyDungeon=function(){this.items.clear(),this.no=1},t.prototype.onStartArea=function(){this.onReadyDungeon()},t.prototype.delete=function(t){this.items.delete(t)},t.prototype.getRate=function(t,e){var o=this.ruleService.drops.get(e);return o.rate*Math.min(2,1+o.levelBonus*t.level)},t.prototype.newItemFromDeadEnemy=function(t,e,o,r){var n=this.getRate(t,c.WdDropType.Item)*(1+this.heroService.getDropBonus())*e.itemDropBoost*r;if(a.WdRandom.getNextFloat(1)>=n)return null;var i=null;switch(this.getNextItemDropType(t,!1,e.magicItemDropBoost).type){case c.WdDropType.RareItemR:i=this.newRareItem(t,0,o,null);break;case c.WdDropType.MagicItemR:i=this.newMagicItem(t,0,o,null);break;default:i=this.newNormalItem(t,0,o,null)}return null!=i&&(i.level=t.level+1,i.level>1&&a.WdRandom.get().succeed100(20)?i.level--:a.WdRandom.get().succeed100(10)&&i.level++,this.items.set(i.no,i)),i},t.prototype.getNextItemDropType=function(t,e,o){var r=new Array;return r.push(c.RuleDropCalculated.build(c.WdDropType.MagicItemR,this.getRate(t,c.WdDropType.MagicItemR)*o)),r.push(c.RuleDropCalculated.build(c.WdDropType.RareItemR,this.getRate(t,c.WdDropType.RareItemR)*o)),e||r.push(c.RuleDropCalculated.build(c.WdDropType.NormalItemR,this.getRate(t,c.WdDropType.NormalItemR))),s.WdRandomUtil.next(r)},t.prototype.newRewardItem=function(t,e,o){var r=0,n=!1,i=null;e.type==c.WdResourceType.RandomAccessories?((i=new Set).add(c.WdItemType.Amulet),i.add(c.WdItemType.Ring),n=!0):e.type==c.WdResourceType.RandomWeapons?(i=new Set).add(c.WdItemType.Bow):e.type==c.WdResourceType.RandomArmors?((i=new Set).add(c.WdItemType.Armor),i.add(c.WdItemType.Shield),i.add(c.WdItemType.Boots),i.add(c.WdItemType.Gloves)):e.type==c.WdResourceType.Item&&(r=e.code);var s=null;switch(this.getNextItemDropType(t,n,1).type){case c.WdDropType.RareItemR:s=this.newRareItem(t,r,o,i);break;case c.WdDropType.MagicItemR:s=this.newMagicItem(t,r,o,i);break;default:s=this.newNormalItem(t,r,o,i)}return null!=s&&(s.level=t.level,s.level>1&&a.WdRandom.get().succeed100(20)?s.level--:a.WdRandom.get().succeed100(10)&&s.level++,this.items.set(s.no,s)),s},t.prototype.newNormalItem=function(t,e,o,r){if(0==e){var n=new Array;if(this.ruleService.items.forEach(function(e){e.dropLvFrom<=t.level&&e.dropLvTo>=t.level&&e.type!=c.WdItemType.Amulet&&e.type!=c.WdItemType.Ring&&(null==r||r.has(e.type))&&n.push(e)}),s.WdRandomUtil.shuffle(n),0==n.length)return null;e=n[0].code}var a=new i.WdDropItemDAO;return a.no=this.no++,a.area=t.clone(),a.pos=o.clone(),a.category=c.WdItemCategory.Normal,a.code=e,a.dna=this.getRandomDna(),a},t.prototype.newMagics=function(t,e){var o=new Array;this.ruleService.itemMagics.forEach(function(e){e.targets.has(t.type)&&o.push(e)}),s.WdRandomUtil.shuffle(o);for(var r=new Set,n=new Array,i=0,c=o;i<c.length;i++){var a=c[i];if(!r.has(a.statType)&&(n.push(l.WdItemMagic.build(a.code,this.getRandomDna())),r.add(a.statType),n.length==e))break}return n},t.prototype.newRareItem=function(t,e,o,r){if(0==e){var n=new Array;if(this.ruleService.items.forEach(function(e){e.dropLvFrom<=t.level&&e.dropLvTo>=t.level&&(null==r||r.has(e.type))&&n.push(e)}),s.WdRandomUtil.shuffle(n),0==n.length)return null;e=n[0].code}var l=this.ruleService.items.get(e),u=new i.WdDropItemDAO;return u.no=this.no++,u.area=t.clone(),u.pos=o.clone(),u.category=c.WdItemCategory.Rare,u.code=l.code,u.dna=this.getRandomDna(),u.magics=this.newMagics(l,a.WdRandom.getRangeInt(3,5)),u},t.prototype.newMagicItem=function(t,e,o,r){if(0==e){var n=new Array;if(this.ruleService.items.forEach(function(e){e.dropLvFrom<=t.level&&e.dropLvTo>=t.level&&(null==r||r.has(e.type))&&n.push(e)}),s.WdRandomUtil.shuffle(n),0==n.length)return null;e=n[0].code}var l=this.ruleService.items.get(e),u=new i.WdDropItemDAO;return u.no=this.no++,u.area=t.clone(),u.pos=o.clone(),u.category=c.WdItemCategory.Magic,u.code=l.code,u.dna=this.getRandomDna(),u.magics=this.newMagics(l,a.WdRandom.getRangeInt(1,3)),u},t.prototype.getRandomDna=function(){return a.WdRandom.getRangeInt(0,101)},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("WdHeroService")],t.prototype,"heroService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdDropItemService")],t)}();o.WdDropItemService=u,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdRandom":"WdRandom","../../common/WdRandomUtil":"WdRandomUtil","../item/WdItemDAO":"WdItemDAO","./WdDropItemDAO":"WdDropItemDAO"}],WdDropItem:[function(t,e,o){"use strict";cc._RF.push(e,"b8e04f4w/ZK7qmtGVYmosos","WdDropItem"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdDropItem=void 0;var r=t("../../common/WdVec"),n=t("../unit/WdUnitKey"),i=t("../unit/WdUnitState"),c=function(){function t(t){this.dao=t,this.hp=1}return t.prototype.getType=function(){return n.WdUnitType.DropItem},t.prototype.getState=function(){return i.WdUnitState.Idle},t.prototype.getCore=function(){var t,e;return null!==(e=null===(t=this.actor)||void 0===t?void 0:t.core)&&void 0!==e?e:null},t.prototype.getStats=function(){return null},t.prototype.getKey=function(){return new n.WdUnitKey(this.getType(),this.getNo())},t.prototype.getWs=function(){return this.ws},t.prototype.getNo=function(){return this.dao.no},t.prototype.getCode=function(){return this.dao.code},t.prototype.getPos=function(){return this.dao.pos},t.prototype.getGatePos=function(){return this.getPos()},t.prototype.getSize=function(){return r.WdVec.one},t.prototype.getDirection=function(){return r.WdVec.zero},t.prototype.getCamFocusPos=function(){return this.getPos()},t.prototype.getTalkBoxPos=function(){return this.actor.core.balloonAnchor},t.prototype.getHpRate=function(){return this.hp},t.prototype.getRadius=function(){return.5},t.prototype.getDao=function(){return this.dao},t.prototype.boot=function(t){this.ws=t},t.prototype.setActor=function(t){this.actor=t},t.prototype.removeActor=function(){this.actor=null},t.prototype.isDead=function(){return this.hp<=0},t.prototype.setState=function(){},t.prototype.onTick=function(){},t.prototype.kill=function(){this.hp=0,this.actor.onDead()},t.prototype.setPosition=function(t){this.dao.pos=t.clone(),this.actor.onSetPosition(t.clone())},t.prototype.setFaceSide=function(){},t.prototype.makeWalkAction=function(){},t.prototype.walkTo=function(){},t.prototype.onTarget=function(){},t.prototype.playAction=function(){},t.prototype.playActions=function(){},t.prototype.lookAt=function(){},t.prototype.getName=function(){return""},t}();o.WdDropItem=c,cc._RF.pop()},{"../../common/WdVec":"WdVec","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState"}],WdDungeonPulsar:[function(t,e,o){"use strict";cc._RF.push(e,"afdc0/glkhDfKBwZHP5whW0","WdDungeonPulsar");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdDungeonPulsar=void 0;var n=t("../../../../../common/bean/Decorators"),i=t("../../../../../rule/model/Model"),c=t("../../../common/WdVec"),a=t("../../../common/WdRandom"),s=t("../../enemy/WdEnemy"),l=t("../../../common/WdRandomUtil"),u=t("../../unit/WdUnitRewardValue"),p=t("../../object/value/WdChestValue"),d=t("../../object/WdObject"),h=function(){function t(){}return t.build=function(e,o){var r=new t;return r.code=e,r.rate=o,r},t}(),f=function(){function t(t){this.lastGen=0,this.gateGen=!1,this.remainChest=0,this.remainMaterial=0,this.totalEnemyCount=0,this.chestGetTick=0,this.dropMaterials=new Array,this.chestRewards=new Array,this.enemyCodes=new Array,this.enemyGenerated=0,this.ws=t,this.lastGen=-this.getSpawnCool()}return t.prototype.boot=function(){this.totalEnemyCount=this.ws.area.rule.enemyCount;var t=this.ws.hero.getStats().getAvgSum(i.WdStatType.BonusBarrel);this.remainMaterial=Math.round(this.totalEnemyCount*this.getRate(i.WdDropType.Resource)),this.remainMaterial=Math.round(this.remainMaterial*(1+t));var e=this.ws.hero.getStats().getAvgSum(i.WdStatType.BonusChest);this.remainChest=Math.round(this.totalEnemyCount*this.getRate(i.WdDropType.Chest)),this.remainChest=Math.round(this.remainChest*(1+e)),this.chestGetTick=Math.round(this.totalEnemyCount/(this.remainChest+1)),this.readyEnemy(),this.readyMaterials(),this.readyChest()},t.prototype.readyEnemy=function(){for(var t=this.ws.area.rule.enemyCount-3,e=0;e<t;e++)this.enemyCodes.push(10);for(e=0;e<3;e++)this.enemyCodes.push(21);for(e=0;e<4;e++)this.enemyCodes.push(22);l.WdRandomUtil.shuffle(this.enemyCodes)},t.prototype.readyMaterials=function(){this.dropMaterials.push(h.build(11,this.ruleService.matUsage.get(11))),this.dropMaterials.push(h.build(21,this.ruleService.matUsage.get(21))),this.dropMaterials.push(h.build(31,this.ruleService.matUsage.get(31)))},t.prototype.readyChest=function(){this.chestRewards.push(i.RuleDropCalculated.build(i.WdDropType.ChestItemR,this.getRate(i.WdDropType.ChestItemR)))},t.prototype.getRate=function(t){var e=this.ruleService.drops.get(t),o=this.ws.area.getKey();return e.rate*Math.min(2,1+e.levelBonus*o.level)},t.prototype.getSpawnCool=function(){return 2.2},t.prototype.onTick=function(t){if(!this.ws.hero.isDead()){var e=this.getSpawnCool();this.lastGen+e>t.timestamp||(this.ws.area.enemyRemainCount<=0?0!=this.ws.area.enemies.size||this.gateGen||(this.generateGate(),this.gateGen=!0):this.ws.area.enemies.size>30||(this.lastGen=t.timestamp,this.newEnemy(),0!=this.ws.area.enemyRemainCount&&(this.totalEnemyCount-this.ws.area.enemyRemainCount)%this.chestGetTick==0&&this.newChest()))}},t.prototype.getRandomGenPos=function(){for(var t=new c.WdVec(640,0),e=this.ws.hero,o=0;o<20&&((t=t.rotate(a.WdRandom.getRangeFloat(0,2*Math.PI)).add(e.getPos())).x=Math.round(t.x),t.y=Math.round(t.y),this.ws.area.occupied.has(t.round().pack()));o++);return t},t.prototype.getRandomMaterialCode=function(){return l.WdRandomUtil.next(this.dropMaterials).code},t.prototype.newEnemy=function(){var t=this.getRandomGenPos(),e=this.ws.area.getKey(),o=this.enemyCodes[this.enemyGenerated++],r=this.enemyService.newEnemy(e,o,e.level,1,t),n=new s.WdEnemy(r);n.boot(this.ws),this.ws.area.addEnemy(n)},t.prototype.newChest=function(){var t;switch(0==this.chestRewards.length&&this.readyChest(),l.WdRandomUtil.next(this.chestRewards).type){case i.WdDropType.ChestItemR:t=i.WdResourceType.RandomItem}var e=new Array;e.push(u.WdUnitRewardValue.build(t,0,1));var o=this.getRandomGenPos(),r=this.objectService.newObject(this.ws.area.getKey(),52,o);r.value=new p.WdChestValue(e);var n=new d.WdObject(r);n.boot(this.ws),this.ws.area.addObject(n)},t.prototype.generateGate=function(){},r([n.autoWired("WdEnemyService")],t.prototype,"enemyService",void 0),r([n.autoWired("WdObjectService")],t.prototype,"objectService",void 0),r([n.autoWired("WdArtifactService")],t.prototype,"artifactService",void 0),r([n.autoWired("WdMaterialService")],t.prototype,"materialService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdDungeonPulsar=f,cc._RF.pop()},{"../../../../../common/bean/Decorators":"Decorators","../../../../../rule/model/Model":"Model","../../../common/WdRandom":"WdRandom","../../../common/WdRandomUtil":"WdRandomUtil","../../../common/WdVec":"WdVec","../../enemy/WdEnemy":"WdEnemy","../../object/WdObject":"WdObject","../../object/value/WdChestValue":"WdChestValue","../../unit/WdUnitRewardValue":"WdUnitRewardValue"}],WdEaAttackHandler:[function(t,e,o){"use strict";cc._RF.push(e,"e4eaesVGFBGfZFiYIfUver3","WdEaAttackHandler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEaAttackHandler=void 0;var n=t("../../../../common/bean/Decorators"),i=t("../../../core/object/unit/WdUnitKey"),c=t("./attacks/WdEmAttackFactory"),a=function(){function t(t){this.done=!1,this.action=null,this.enemy=t}return t.prototype.onStart=function(t){var e=this.worldService.presenters.unitFactory.getProjectileAgency(i.WdUnitType.Enemy);this.attackHandler=c.WdEmAttackFactory.newAttack(this.enemy,e),this.attackHandler.onStart(t),this.done=!1},t.prototype.onAnimEvent=function(t){this.attackHandler.onAnimEvent(t)},t.prototype.onTick=function(t){this.done||(this.attackHandler.onTick(t),this.done=this.attackHandler.done)},t.prototype.onDead=function(){this.attackHandler.onDead()},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),t}();o.WdEaAttackHandler=a,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../core/object/unit/WdUnitKey":"WdUnitKey","./attacks/WdEmAttackFactory":"WdEmAttackFactory"}],WdEaHandler:[function(t,e,o){"use strict";cc._RF.push(e,"19411ihk4pFv7/c+V/235Cq","WdEaHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEaHandler=void 0;var r=t("../../../core/object/unit/WdUnitAction"),n=t("../../../core/object/unit/WdUnitState"),i=t("../../unit/action/WdUaStopHandler"),c=t("../../unit/action/WdUaWalkHandler"),a=t("./WdEaAttackHandler"),s=function(){function t(t){this.currentHandler=null,this.actions=new Array,this.enemy=t}return t.prototype.playActions=function(t){var e,o,r;0==t.length||this.enemy.isDead()||null!==(r=null===(o=null===(e=this.currentHandler)||void 0===e?void 0:e.action)||void 0===o?void 0:o.irrevocable)&&void 0!==r&&r||this.enemy.getState()!=n.WdUnitState.Hurt&&(this.actions=t,this.currentHandler=null)},t.prototype.onTick=function(t){if(null==this.currentHandler){if(this.actions.length>0){var e=this.actions[0];this.actions.splice(0,1),this.enemy.onActionStart(e),this.start(e)}}else this.currentHandler.onTick(t),this.currentHandler.done&&(this.enemy.onActionDone(this.currentHandler.action),this.currentHandler=null)},t.prototype.start=function(t){var e=this.newHandler(t.type);null!=e&&(this.currentHandler=e,e.onStart(t))},t.prototype.onAnimEvent=function(t){var e;null===(e=this.currentHandler)||void 0===e||e.onAnimEvent(t)},t.prototype.newHandler=function(t){switch(t){case r.WdUnitActionType.Walk:return new c.WdUaWalkHandler(this.enemy);case r.WdUnitActionType.Stop:return new i.WdUaStopHandler(this.enemy);case r.WdUnitActionType.Attack1:return new a.WdEaAttackHandler(this.enemy)}return null},t.prototype.stopAction=function(){this.currentHandler=null,this.actions=[]},t.prototype.onDead=function(){},t}();o.WdEaHandler=s,cc._RF.pop()},{"../../../core/object/unit/WdUnitAction":"WdUnitAction","../../../core/object/unit/WdUnitState":"WdUnitState","../../unit/action/WdUaStopHandler":"WdUaStopHandler","../../unit/action/WdUaWalkHandler":"WdUaWalkHandler","./WdEaAttackHandler":"WdEaAttackHandler"}],WdEffectFactory:[function(t,e,o){"use strict";cc._RF.push(e,"92ea1oTqqxGW5HmtAJYbMGZ","WdEffectFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEffectFactory=void 0;var c=cc._decorator.ccclass,a=t("../../../common/bean/Decorators"),s=t("./WdPxEffect"),l=t("../../../App"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prefabs=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;l.app.ready&&this.node.children.forEach(function(e){var o=e.getComponent(s.WdPxEffect);null!=o&&t.prefabs.set(o.effectType,o)})},e.prototype.getEffect=function(t,e){var o=this.prefabs.get(t);return o?this.goPooler.fromPrefab(o,null!=e?e:this.node):(console.error("Can not found prefab effect "+t),null)},e.prototype.playEffect=function(t,e){var o=this.getEffect(t,null);null!=o&&(o.node.setPosition(e),o.play())},i([a.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdEffectFactory=u,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","./WdPxEffect":"WdPxEffect"}],WdEffectType:[function(t,e,o){"use strict";cc._RF.push(e,"e56977EYmhJX4TzvER15/9d","WdEffectType"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdPixelAnimState=o.WdEffectType=void 0,function(t){t[t.None=0]="None",t[t.Hit1=1]="Hit1",t[t.FireExp1=2]="FireExp1",t[t.PoisonExp1=3]="PoisonExp1",t[t.StaticLightning1=4]="StaticLightning1",t[t.BloodSpurt1=5]="BloodSpurt1",t[t.Impact1=6]="Impact1",t[t.Impact2=7]="Impact2",t[t.BombExp1=8]="BombExp1",t[t.Meteor1=9]="Meteor1",t[t.Crack1=10]="Crack1",t[t.Crack2=11]="Crack2",t[t.Crack3=12]="Crack3",t[t.Crack4=13]="Crack4",t[t.ExplosionLight1=14]="ExplosionLight1",t[t.MeteorExp=15]="MeteorExp",t[t.LightningStrike1=16]="LightningStrike1",t[t.LightningShield1=17]="LightningShield1",t[t.IcePillar1=18]="IcePillar1",t[t.Heal1=91]="Heal1",t[t.Sub=999]="Sub"}(o.WdEffectType||(o.WdEffectType={})),function(t){t[t.None="None"]="None",t[t.Birth="Birth"]="Birth",t[t.Play="Play"]="Play",t[t.Death="Death"]="Death"}(o.WdPixelAnimState||(o.WdPixelAnimState={})),cc._RF.pop()},{}],WdEmAttack10:[function(t,e,o){"use strict";cc._RF.push(e,"cb746AjzYJNwoCxBRAzitm2","WdEmAttack10");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmAttack10=void 0;var i=function(t){function e(e,o){return t.call(this,e,o)||this}return n(e,t),e}(t("./common/WdEmMeleeAttack").WdEmMeleeAttack);o.WdEmAttack10=i,cc._RF.pop()},{"./common/WdEmMeleeAttack":"WdEmMeleeAttack"}],WdEmAttack21:[function(t,e,o){"use strict";cc._RF.push(e,"9ad3cGqz4ZHnZTReA77iard","WdEmAttack21");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmAttack21=void 0;var i=function(t){function e(e,o){return t.call(this,e,o)||this}return n(e,t),e}(t("./common/WdEmProjectileAttack").WdEmProjectileAttack);o.WdEmAttack21=i,cc._RF.pop()},{"./common/WdEmProjectileAttack":"WdEmProjectileAttack"}],WdEmAttack22:[function(t,e,o){"use strict";cc._RF.push(e,"d0500EDKUBAWodZ/Vt5DrtD","WdEmAttack22");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmAttack22=void 0;var i=function(t){function e(e,o){return t.call(this,e,o)||this}return n(e,t),e}(t("./common/WdEmProjectileAttack").WdEmProjectileAttack);o.WdEmAttack22=i,cc._RF.pop()},{"./common/WdEmProjectileAttack":"WdEmProjectileAttack"}],WdEmAttackFactory:[function(t,e,o){"use strict";cc._RF.push(e,"008f83+uWFCELGUp50E1vic","WdEmAttackFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmAttackFactory=void 0;var r=t("./WdEmAttack10"),n=t("./WdEmAttack21"),i=t("./WdEmAttack22"),c=function(){function t(){}return t.newAttack=function(t,e){switch(t.getCode()){case 10:return new r.WdEmAttack10(t,e);case 21:return new n.WdEmAttack21(t,e);case 22:return new i.WdEmAttack22(t,e)}},t}();o.WdEmAttackFactory=c,cc._RF.pop()},{"./WdEmAttack10":"WdEmAttack10","./WdEmAttack21":"WdEmAttack21","./WdEmAttack22":"WdEmAttack22"}],WdEmMeleeAttack:[function(t,e,o){"use strict";cc._RF.push(e,"4c9c7VpcAVAEZrTvXB67HqE","WdEmMeleeAttack"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmMeleeAttack=void 0;var r=t("../../../../../core/object/unit/WdAttackCalculator"),n=t("../../../../../core/object/unit/WdUnitState"),i=t("../../../../../core/object/unit/WdUnitUtil"),c=t("../../../../../core/common/WdUtil"),a=t("../../../../../../rule/model/Model"),s=t("../../../../../core/object/unit/WdAttack"),l=function(){function t(t,e){this.done=!1,this.enemy=null,this.prjAgency=null,this.calculator=null,this.action=null,this.remainToDone=0,this.enemy=t,this.prjAgency=e,this.calculator=new r.WdAttackCalculator(t)}return t.prototype.onStart=function(t){this.action=t,this.enemy.getActor().attackTo(this.enemy.getWs().hero,n.WdUnitState.Attack1),this.remainToDone=this.enemy.getCore().getAnimLen(n.WdUnitState.Attack1)},t.prototype.onTick=function(t){this.remainToDone-=t,this.remainToDone<=0&&(this.done=!0,this.enemy.setState(n.WdUnitState.Idle))},t.prototype.onAnimEvent=function(){this.meleeAttack(this.action.target)},t.prototype.meleeAttack=function(){var t=this.enemy.getWs().hero;if(null!=t&&!t.isDead()){var e=i.WdUnitUtil.getDistance(t,this.enemy)/100;if(!(c.WdUtil.valueForAr(this.enemy.getRule().attackRange)<e)){var o=c.WdUtil.valueForAs(this.enemy.getRule().attackSpeed),r=1+this.enemy.getStats().getAvgSum(a.WdStatType.UnitAttackBoost),n=new s.WdAttack;n.attacks=this.enemy.getStats().getAllAttacks(),n.cool=o,n.attackRate=1,n.attackBoost=r;var l=this.calculator.makeDamages(n,t);this.enemy.attack(t,l)}}},t.prototype.onDead=function(){},t}();o.WdEmMeleeAttack=l,cc._RF.pop()},{"../../../../../../rule/model/Model":"Model","../../../../../core/common/WdUtil":"WdUtil","../../../../../core/object/unit/WdAttack":"WdAttack","../../../../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../../../../core/object/unit/WdUnitState":"WdUnitState","../../../../../core/object/unit/WdUnitUtil":"WdUnitUtil"}],WdEmProjectileAttack:[function(t,e,o){"use strict";cc._RF.push(e,"1ad9d6AuD5GE7h+0qdK3XUN","WdEmProjectileAttack"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEmProjectileAttack=void 0;var r=t("../../../../../core/object/unit/WdUnitState"),n=t("../../../../../core/common/WdUtil"),i=t("../../../../../../rule/model/Model"),c=t("../../../../../core/object/unit/WdAttack"),a=t("../../../../../core/common/WdVec"),s=t("../../../../area/WdAreaPresenter"),l=function(){function t(t,e){var o=this;this.done=!1,this.enemy=null,this.prjAgency=null,this.action=null,this.targetPos=a.WdVec.zero,this.hasGuide=!1,this.remainToDone=1,this.onUpdateGuide=function(t){o.targetPos=t},this.enemy=t,this.prjAgency=e}return t.prototype.onStart=function(t){this.action=t,this.enemy.getActor().attackTo(this.enemy.getWs().hero,r.WdUnitState.Attack1),this.remainToDone=this.enemy.getCore().getAnimLen(r.WdUnitState.Attack1),this.hasGuide=!1},t.prototype.onTick=function(t){this.remainToDone-=t,this.remainToDone<=0&&(this.done=!0,this.enemy.setState(r.WdUnitState.Idle))},t.prototype.onAnimEvent=function(t){"fire"==t?this.fireProjectile(this.action.target,1):"guide"==t&&(this.fireGuide(),this.hasGuide=!0)},t.prototype.fireGuide=function(){var t=this.prjAgency.getGuide(),e=this.enemy.getWs().hero;t.play(this.enemy,e,.5,this.onUpdateGuide)},t.prototype.fireProjectile=function(){var t=this.enemy.getWs().hero;if(null!=t&&!t.isDead()){var e=this.prjAgency.get(this.enemy.getCode(),s.WdBucketLevel.Overlay);if(null!=e){var o=n.WdUtil.valueForAs(this.enemy.getRule().attackSpeed),r=1+this.enemy.getStats().getAvgSum(i.WdStatType.UnitAttackBoost),a=new c.WdAttack;a.attacks=this.enemy.getStats().getAllAttacks(),a.cool=o,a.attackRate=1,a.attackBoost=r,a.ricochet=1;var l=this.enemy.getActor().core.prjAnchor,u=this.targetPos;this.hasGuide||(u=t.getActor().core.bodyAnchor),e.fire(this.enemy,a,l,u)}else console.error("no project found for: "+this.enemy.getCode())}},t.prototype.onDead=function(){},t}();o.WdEmProjectileAttack=l,cc._RF.pop()},{"../../../../../../rule/model/Model":"Model","../../../../../core/common/WdUtil":"WdUtil","../../../../../core/common/WdVec":"WdVec","../../../../../core/object/unit/WdAttack":"WdAttack","../../../../../core/object/unit/WdUnitState":"WdUnitState","../../../../area/WdAreaPresenter":"WdAreaPresenter"}],WdEnemyAI:[function(t,e,o){"use strict";cc._RF.push(e,"1fde2EOdvlG0LJ2SLIHB9OG","WdEnemyAI"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyAI=void 0;var r=t("../../common/WdUtil"),n=t("../unit/WdUnitUtil"),i=t("../unit/WdUnitAction"),c=function(){function t(t){this.lastTick=0,this.interval=.1,this.attackRange=.1,this.enemy=t,this.attackRange=r.WdUtil.valueForAr(t.getRule().attackRange)}return t.prototype.onTick=function(t){t.timestamp-this.lastTick<this.interval||(this.lastTick=t.timestamp,n.WdUnitUtil.isAttackState(this.enemy.getState())||this.enemy.getWs().hero.isDead()||(n.WdUnitUtil.getDistance(this.enemy,this.enemy.getWs().hero)/100<this.attackRange?this.enemy.fireAttack(i.WdUnitActionType.Attack1):this.enemy.makeWalkAction(this.enemy.getWs().hero.getPos())))},t}();o.WdEnemyAI=c,cc._RF.pop()},{"../../common/WdUtil":"WdUtil","../unit/WdUnitAction":"WdUnitAction","../unit/WdUnitUtil":"WdUnitUtil"}],WdEnemyActor:[function(t,e,o){"use strict";cc._RF.push(e,"877fcGgSmZJXYXCuk4OZguq","WdEnemyActor");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyActor=void 0;var c=t("../unit/WdUnitActor"),a=t("../../core/common/WdVec"),s=t("../../core/object/unit/WdUnit"),l=cc._decorator.ccclass,u=cc._decorator.property,p=t("../../core/object/unit/WdUnitState"),d=t("../unit/ccEffect/WdCcEffectPresenter"),h=t("../../../common/bean/Decorators"),f=t("./action/WdEaHandler"),y=t("../../core/object/unit/WdUnitKey"),v=t("../../core/common/WdUtil"),m=t("../../../rule/model/Model"),g=t("../../UI/common/WduGauge"),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor_=null,e.gauge=null,e.enemy_=null,e.rbody=null,e.nextAnim=p.WdUnitState.None,e.actionHandler=null,e.ccPresenter=null,e.ccDirty=!1,e.walkTarget=a.WdVec.zero,e.doingReturn=!1,e.onUnitEnter=function(t){t.getType()==y.WdUnitType.Hero&&e.enemy.setFoundHero(!0)},e.onAnimEvent=function(t){var o;null===(o=e.actionHandler)||void 0===o||o.onAnimEvent(t)},e}return n(e,t),Object.defineProperty(e.prototype,"anchor",{get:function(){return this.anchor_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this.enemy_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enemy",{get:function(){return this.enemy_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.getPos()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.rbody=this.getComponent(cc.RigidBody),this.ccPresenter=new d.WdCcEffectPresenter},e.prototype.onGoingIntoPool=function(){t.prototype.onGoingIntoPool.call(this),this.goPooler.returnGo(this.core),this.core.onAnimEventFired.removeHandler(this.onAnimEvent),this.side=s.WdUnitFaceSide.None,this.nextAnim=p.WdUnitState.None,this.actionHandler=null,this.enemy.getWs().eventBus.onEnemyActorReturn.fire(this.enemy),this.enemy.removeActor(),this.ccPresenter.clear(),this.radar.onUnitEnter.removeHandler(this.onUnitEnter),this.damageRoutine=null},e.prototype.walkTo=function(t){this.enemy.isDead()||(this.walkTarget=t,this.enemy.setState(p.WdUnitState.Walk),this.lookAt(t))},e.prototype.attackTo=function(t,e){this.enemy.setState(e),this.lookAt(t.getPos())},e.prototype.boot=function(t,e){this.enemy_=t,this.core_=e,this.ccDirty=!0,this.doingReturn=!1,this.setBaseColor(cc.Color.WHITE),this.setBaseTint(cc.Color.BLACK),this.setBaseAnimSpeed(1),this.onSetPosition(t.getPos()),this.core.node.setPosition(cc.Vec2.ZERO),this.core.onAnimEventFired.addHandler(this.onAnimEvent),this.core.boot(t),this.enemy.setActor(this),this.actionHandler=new f.WdEaHandler(t),this.radar.onUnitEnter.addHandler(this.onUnitEnter),this.gauge.node.active=!1,this.gauge.setValue(1,!1)},e.prototype.onSetPosition=function(t){this.node.setPosition(cc.v2(t.x,t.y))},e.prototype.onHit=function(t){if(this.playDamageEffect(),this.worldService.presenters.mainCam.playShakePreset(t.shake),t.power>0&&this.rbody){var e=t.power,o=t.direction;v.WdUtil.approximately(o.len2(),0)&&(o=a.WdVec.right);var r=this.node.convertToWorldSpaceAR(cc.v2(-o.x,-o.y));o=o.scalar(100*e),this.rbody.applyLinearImpulse(cc.v2(o.x,o.y),r,!0)}this.gauge.node.active=!0,this.gauge.setValue(this.enemy.getStats().hpRate,!0)},e.prototype.onDead=function(){this.clear(),this.gauge.node.active=!1},e.prototype.clear=function(){var t,e=this;if(this.doingReturn)console.error("double clear");else{this.doingReturn=!0;var o=this.core.getAnimLen(p.WdUnitState.Death);this.scheduleOnce(function(){return e.goPooler.returnGo(e)},o+.3),this.core.onDead(),null===(t=this.actionHandler)||void 0===t||t.onDead()}},e.prototype.playAction=function(t){var e=new Array;e.push(t),this.playActions(e)},e.prototype.playActions=function(t){var e;null===(e=this.actionHandler)||void 0===e||e.playActions(t)},e.prototype.stopAction=function(){var t;null===(t=this.actionHandler)||void 0===t||t.stopAction()},e.prototype.onChangeState=function(t,e){this.nextAnim=e},e.prototype.update=function(e){var o;t.prototype.update.call(this,e),this.nextAnim!=p.WdUnitState.None&&(this.core.setAnimation(this.nextAnim),this.nextAnim=p.WdUnitState.None),null===(o=this.actionHandler)||void 0===o||o.onTick(e);var r=this.getPos();if(this.enemy.getState()==p.WdUnitState.Walk){var n=this.walkTarget.subtract(r);if(v.WdUtil.approximately(n.len2(),0))return;var i=v.WdUtil.valueForWs(this.enemy.getRule().walkSpeed)*this.enemy.getStats().moveSpdBoost*80;n=n.normalize();var c=r.add(n.scalar(i*e));this.enemy.setPosition(c)}else this.enemy.getDao().pos=r.clone();this.ccDirty&&this.displayCcEffect(),this.core.node.setPosition(cc.Vec2.ZERO)},e.prototype.onCcAttached=function(t){t.type==m.WdCcType.Hurt&&(this.nextAnim=p.WdUnitState.Hurt,this.stopAction()),this.ccDirty=!0},e.prototype.onCcRemoved=function(){this.ccDirty=!0},e.prototype.displayCcEffect=function(){var t=new Array;this.enemy.getStats().ccs.forEach(function(e){t=t.concat(e)});var e=new Array;t.forEach(function(t){return e.push(t.effect)}),this.ccPresenter.clear(),this.ccPresenter.display(this,e),this.ccDirty=!1},e.prototype.getPos=function(){var t=this.node.getPosition();return new a.WdVec(t.x,t.y)},i([u(cc.Node)],e.prototype,"anchor_",void 0),i([u(g.WduGauge)],e.prototype,"gauge",void 0),i([h.autoWired("WorldService")],e.prototype,"worldService",void 0),i([h.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l],e)}(c.WdUnitActor);o.WdEnemyActor=W,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","../../UI/common/WduGauge":"WduGauge","../../core/common/WdUtil":"WdUtil","../../core/common/WdVec":"WdVec","../../core/object/unit/WdUnit":"WdUnit","../../core/object/unit/WdUnitKey":"WdUnitKey","../../core/object/unit/WdUnitState":"WdUnitState","../unit/WdUnitActor":"WdUnitActor","../unit/ccEffect/WdCcEffectPresenter":"WdCcEffectPresenter","./action/WdEaHandler":"WdEaHandler"}],WdEnemyAttackCore:[function(t,e,o){"use strict";cc._RF.push(e,"34841pvLCdB4IbZPEvU3ciQ","WdEnemyAttackCore"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyAttackCore=void 0;var r=t("../unit/WdUnitAction"),n=t("../unit/WdUnitState"),i=t("../../common/WdUtil"),c=t("../unit/WdUnitKey"),a=function(){function t(t,e,o){this.lastAttack=0,this.lastCool=0,this.baseCoolTime=0,this.me=t,this.baseCoolTime=e,this.actionType=o,this.lastAttack=this.me.getWs().time.timestamp-.5*e}return t.prototype.isReadyToAttack=function(t){if(this.me.getState()!=n.WdUnitState.Idle&&this.me.getState()!=n.WdUnitState.Walk)return!1;var e=t.timestamp-this.lastAttack,o=this.updateCool();return!(o<=i.WdUtil.epsilon)&&e>=o-i.WdUtil.epsilon},t.prototype.updateCool=function(){var t=this.baseCoolTime,e=this.me.getStats().atkSpdBoost;return e<=i.WdUtil.epsilon?0:(t/=e,this.lastCool=t,this.lastCool)},t.prototype.fireAttack=function(){if(this.me.isDead())return!1;var t=this.me.getWs().time;if(!this.isReadyToAttack(t))return!1;var e=this.me.getWs().hero,o=new r.WdUnitAction;return o.type=this.actionType,o.irrevocable=!0,o.target=c.WdUnitKey.build(c.WdUnitType.Hero,e.getNo()),this.me.playAction(o),!0},t.prototype.onActionStart=function(t){if(t.type==this.actionType){var e=this.me.getWs().time;e.timestamp-this.lastAttack>this.lastCool+e.deltaTime?this.lastAttack=e.timestamp:this.lastAttack+=this.lastCool}},t.prototype.onActionDone=function(){},t}();o.WdEnemyAttackCore=a,cc._RF.pop()},{"../../common/WdUtil":"WdUtil","../unit/WdUnitAction":"WdUnitAction","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState"}],WdEnemyDAO:[function(t,e,o){"use strict";cc._RF.push(e,"f24993dP0xOY7icboND5qgx","WdEnemyDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyDAO=void 0;var r=t("../unit/WdStats"),n=t("../../common/WdVec"),i=function(){function t(){this.no=0,this.area=null,this.code=0,this.sight=0,this.level=0,this.rewardRate=0,this.pos=n.WdVec.zero,this.stats=new r.WdStats,this.boss=!1}return t.prototype.getPk=function(){return this.no},t.prototype.getIndex1=function(){return this.area.getCode()},t}();o.WdEnemyDAO=i,cc._RF.pop()},{"../../common/WdVec":"WdVec","../unit/WdStats":"WdStats"}],WdEnemyFactory:[function(t,e,o){"use strict";cc._RF.push(e,"a3d69R4phNPiaJ6g2B7BylC","WdEnemyFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyFactory=void 0;var c=cc._decorator.ccclass,a=t("./WdEnemyActor"),s=cc._decorator.property,l=t("../unit/WdUnitActorCore"),u=t("../../../common/bean/Decorators"),p=t("../area/WdAreaPresenter"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enemy_=null,e.cores=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.children.forEach(function(e){var o=e.getComponent(l.WdUnitActorCore);o&&t.cores.set(o.code,o)})},e.prototype.newCore=function(t,e){var o=this.cores.get(t);return o?this.goPooler.fromPrefab(o,e):(console.error("Enemy "+t+" is not ready yet"),null)},e.prototype.generate=function(t){var e=this.worldService.presenters.areaPresenter.getUnitBucket(p.WdBucketLevel.Normal),o=this.goPooler.fromPrefab(this.enemy_,e),r=this.newCore(t.getCode(),o.anchor);return o.boot(t,r),o},i([s(a.WdEnemyActor)],e.prototype,"enemy_",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdEnemyFactory=d,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../area/WdAreaPresenter":"WdAreaPresenter","../unit/WdUnitActorCore":"WdUnitActorCore","./WdEnemyActor":"WdEnemyActor"}],WdEnemyPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"c414cpxQs9B1qdxrAg/hS+g","WdEnemyPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyPresenter=void 0;var c=cc._decorator.ccclass,a=t("../../../common/bean/Decorators"),s=cc._decorator.property,l=t("./WdEnemyFactory"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.factory=null,e.actors=new Map,e.onAreaTearDown=function(){e.actors.forEach(function(t){e.goPooler.returnGo(t)}),e.actors.clear()},e.onAreaStart=function(){e.playAll()},e.onEnemyBorn=function(t){e.playEnemy(t)},e.onEnemyActorReturn=function(t){e.actors.delete(t.getKey().pack())},e}return n(e,t),e.prototype.boot=function(t){this.world=t,this.playAll(),t.eventBus.onEnemyBorn.addHandler(this.onEnemyBorn),t.eventBus.onEnemyActorReturn.addHandler(this.onEnemyActorReturn),t.eventBus.onAreaTearDown.addHandler(this.onAreaTearDown),t.eventBus.onAreaStart.addHandler(this.onAreaStart)},e.prototype.playAll=function(){var t=this;this.world.area.enemies.forEach(function(e){t.playEnemy(e)})},e.prototype.playEnemy=function(t){var e=this.factory.generate(t);null!=e&&this.actors.set(t.getKey().pack(),e)},i([s(l.WdEnemyFactory)],e.prototype,"factory",void 0),i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([a.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdEnemyPresenter=u,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WdEnemyFactory":"WdEnemyFactory"}],WdEnemyService:[function(t,e,o){"use strict";cc._RF.push(e,"8947dh1GC5OwLZZCbGSXBPq","WdEnemyService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemyService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdEnemyDAO"),c=function(){function t(){this.enemies=new Map,this.no=1}return t.prototype.getEnemies=function(){return Array.from(this.enemies.values())},t.prototype.onReadyDungeon=function(){this.enemies.clear(),this.no=1},t.prototype.onStartArea=function(){this.onReadyDungeon()},t.prototype.newEnemy=function(t,e,o,r,n,c){void 0===c&&(c=!1);var a=new i.WdEnemyDAO;return a.no=this.no++,a.area=t.clone(),a.code=e,a.level=o,a.pos=n.clone(),a.sight=6,a.rewardRate=r,a.boss=c,this.enemies.set(a.no,a),a},t.prototype.delete=function(t){this.enemies.delete(t)},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdEnemyService")],t)}();o.WdEnemyService=c,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","./WdEnemyDAO":"WdEnemyDAO"}],WdEnemy:[function(t,e,o){"use strict";cc._RF.push(e,"041c2Yrd4dGIoN59aNkZ0a6","WdEnemy");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdEnemy=void 0;var n=t("../../common/WdVec"),i=t("../unit/WdUnitKey"),c=t("../unit/WdUnitState"),a=t("../unit/WdUnitAction"),s=t("../../../../rule/model/Model"),l=t("../../../../common/bean/Decorators"),u=t("./WdEnemyAI"),p=t("./WdEnemyAttackCore"),d=t("../../common/WdUtil"),h=t("../unit/WdStat"),f=t("../unit/WdDamage"),y=t("../unit/WdUnitUtil"),v=function(){function t(t){this.direction=n.WdVec.zero,this.attackCores=new Map,this.attached=new Array,this.foundHero=!1,this.dao=t}return t.prototype.getType=function(){return i.WdUnitType.Enemy},t.prototype.getState=function(){return this.state},t.prototype.getCore=function(){var t,e;return null!==(e=null===(t=this.actor)||void 0===t?void 0:t.core)&&void 0!==e?e:null},t.prototype.getStats=function(){return this.dao.stats},t.prototype.getKey=function(){return new i.WdUnitKey(this.getType(),this.getNo())},t.prototype.getWs=function(){return this.ws},t.prototype.getNo=function(){return this.dao.no},t.prototype.getCode=function(){return this.dao.code},t.prototype.getPos=function(){return this.dao.pos},t.prototype.getGatePos=function(){return this.getPos()},t.prototype.getSize=function(){return n.WdVec.one},t.prototype.getDirection=function(){return this.direction},t.prototype.getCamFocusPos=function(){return this.getPos()},t.prototype.getTalkBoxPos=function(){return this.actor.core.balloonAnchor},t.prototype.getHpRate=function(){return this.getStats().hpRate},t.prototype.getRadius=function(){return this.rule.radius},t.prototype.getLevel=function(){return this.dao.level},t.prototype.getRule=function(){return this.rule},t.prototype.getDao=function(){return this.dao},t.prototype.getActor=function(){return this.actor},t.prototype.boot=function(t){this.ws=t,this.rule=this.ruleService.enemies.get(this.dao.code),this.state=c.WdUnitState.Idle;var e=d.WdUtil.valueForAs(this.rule.attackSpeed);this.attackCores.set(a.WdUnitActionType.Attack1,new p.WdEnemyAttackCore(this,e,a.WdUnitActionType.Attack1)),this.attached=[],this.dao.stats.refresh(this.calculateStats())},t.prototype.calculateStats=function(){var t=this.ruleService.enemyLevels.get(this.getLevel()),e=1+t.lifeBoost,o=1+t.attackBoost,r=1+t.defenseBoost,n=new Array,i=this.rule.life*e;n.push(h.WdStat.build(s.WdStatType.Life,i,i));var c=this.rule.attack*o;n.push(h.WdStat.build(this.rule.attackType,c,c,this.rule.cc));var a=this.rule.defense*r;if(n.push(h.WdStat.build(s.WdStatType.Defense,a,a)),this.rule.physicalResist>0){var l=this.rule.physicalResist;n.push(h.WdStat.build(s.WdStatType.PhysicalResist,l,l))}return this.rule.magicResist>0&&(l=this.rule.magicResist,n.push(h.WdStat.build(s.WdStatType.MagicResist,l,l))),n},t.prototype.setActor=function(t){this.actor=t,this.ai=new u.WdEnemyAI(this)},t.prototype.removeActor=function(){this.actor=null,this.ai=null},t.prototype.isDead=function(){return this.getStats().isDead()},t.prototype.setState=function(t){var e=this.state;e!=t&&(this.isDead()&&t!=c.WdUnitState.Death||(this.state=t,this.actor.onChangeState(e,t)))},t.prototype.onTick=function(t){var e;this.isDead()||(null===(e=this.ai)||void 0===e||e.onTick(t),this.getStats().onTick(t),this.attached.length>0&&this.onCcAttached(),null!=this.actor&&this.getStats().removed.length>0&&this.onCcRemoved(),this.getStats().dotDamages.length>0&&this.ccHit(this.getStats().dotDamages))},t.prototype.onCcRemoved=function(){this.actor.onCcRemoved(this.getStats().removed),this.getStats().hasCc(s.WdCcType.Hurt)||this.state!=c.WdUnitState.Hurt||this.setState(c.WdUnitState.Idle)},t.prototype.onCcAttached=function(){var t=this;this.attached.forEach(function(e){return t.actor.onCcAttached(e)}),this.attached=[],this.getStats().hasCc(s.WdCcType.Hurt)&&this.setState(c.WdUnitState.Hurt)},t.prototype.addCc=function(t){this.getStats().addCc(t),this.attached.push(t)},t.prototype.attack=function(t,e){t.hit(e)},t.prototype.hit=function(t){var e=this;if(this.isDead())return 0;var o=this.getStats(),r=o.getHp();return t.damages.forEach(function(t){o.reduceHp(t.amount),null!=t.cc&&e.addCc(t.cc)}),this.ws.eventBus.onAttack.fire(t),this.actor.onHit(t),this.isDead()?(this.setState(c.WdUnitState.Death),this.actor.onDead()):this.foundHero||this.ws.area.getUnit(t.damages[0].from).getType()==i.WdUnitType.Hero&&this.setFoundHero(!0),o.getHp()-r},t.prototype.setFoundHero=function(t){var e=this;this.foundHero=!0,!this.isDead()&&this.actor&&t&&null!=this.actor.radar&&this.actor.radar.enemies.forEach(function(t){y.WdUnitUtil.getDistance(t,e)<2&&t.setFoundHero(!1)})},t.prototype.ccHit=function(t){var e=this;if(!this.isDead()){t.forEach(function(t){e.getStats().reduceHp(t.amount)});var o=new f.WdDamageSet;o.damages=t,this.actor.onHit(o),this.isDead()&&(this.setState(c.WdUnitState.Death),this.actor.onDead())}},t.prototype.kill=function(){this.getStats().kill(),this.actor.onDead()},t.prototype.setPosition=function(t){this.dao.pos=t.clone(),this.actor.onSetPosition(t)},t.prototype.onActionStart=function(t){this.attackCores.forEach(function(e){e.onActionStart(t)})},t.prototype.onActionDone=function(t){this.attackCores.forEach(function(e){e.onActionDone(t)})},t.prototype.fireAttack=function(t){var e=this.attackCores.get(t);return!!e&&e.fireAttack()},t.prototype.setFaceSide=function(t){this.actor.setFaceSide(t)},t.prototype.makeWalkAction=function(t){var e=new a.WdUnitAction;e.type=a.WdUnitActionType.Walk,e.to=t,e.range=5,this.direction=t.subtract(this.getPos()),this.direction=d.WdUtil.approximately(this.direction.len2(),0)?n.WdVec.zero:this.direction.normalize(),this.actor.playAction(e)},t.prototype.walkTo=function(t){this.actor.walkTo(t)},t.prototype.onTarget=function(){},t.prototype.playAction=function(t){var e;null===(e=this.actor)||void 0===e||e.playAction(t)},t.prototype.playActions=function(t){var e;null===(e=this.actor)||void 0===e||e.playActions(t)},t.prototype.lookAt=function(t){this.actor.lookAt(t)},t.prototype.getName=function(){return""},r([l.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdEnemy=v,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdUtil":"WdUtil","../../common/WdVec":"WdVec","../unit/WdDamage":"WdDamage","../unit/WdStat":"WdStat","../unit/WdUnitAction":"WdUnitAction","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState","../unit/WdUnitUtil":"WdUnitUtil","./WdEnemyAI":"WdEnemyAI","./WdEnemyAttackCore":"WdEnemyAttackCore"}],WdEventBus:[function(t,e,o){"use strict";cc._RF.push(e,"26f3fhVtCZLFrknCTzlUMhT","WdEventBus"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdEventBus=void 0;var r=t("../../../common/util/EventHandler");o.WdEventBus=function(){this.onChangeState=new r.EventHandler,this.onAreaEnd=new r.EventHandlerT2,this.onAreaTearDown=new r.EventHandlerT1,this.onAreaStart=new r.EventHandlerT3,this.onHeroDead=new r.EventHandler,this.onHeroBack=new r.EventHandler,this.onHeroTarget=new r.EventHandlerT1,this.onHeroExpUp=new r.EventHandler,this.onHeroLevelUp=new r.EventHandler,this.onHeroUpdated=new r.EventHandler,this.onAttack=new r.EventHandlerT1,this.onEnemyBorn=new r.EventHandlerT1,this.onEnemyDead=new r.EventHandlerT1,this.onEnemyActorReturn=new r.EventHandlerT1,this.onDropMaterialBorn=new r.EventHandlerT2,this.onDropMaterialDead=new r.EventHandlerT1,this.onDropMaterialActorReturn=new r.EventHandlerT1,this.onDropItemBorn=new r.EventHandlerT2,this.onDropItemDead=new r.EventHandlerT1,this.onDropItemActorReturn=new r.EventHandlerT1,this.onObjectBorn=new r.EventHandlerT1,this.onObjectDead=new r.EventHandlerT1,this.onObjectActorReturn=new r.EventHandlerT1,this.onMaterialUpdate=new r.EventHandler,this.onItemUpdate=new r.EventHandler,this.onItemDeleted=new r.EventHandlerT1,this.onPickaxeLevelUp=new r.EventHandler,this.onCoinUpdate=new r.EventHandler,this.onGemUpdate=new r.EventHandler,this.onUnlockPointUpdate=new r.EventHandler,this.onUnlock=new r.EventHandlerT1,this.onPotionDrink=new r.EventHandlerT1,this.onRewardReceived=new r.EventHandlerT1,this.onItemNew=new r.EventHandlerT1,this.onItemEquip=new r.EventHandlerT1,this.onItemDetach=new r.EventHandlerT1,this.onSkillEquip=new r.EventHandlerT1,this.onActionHistory=new r.EventHandlerT1,this.onEquipArtifact=new r.EventHandlerT1,this.onDetachArtifact=new r.EventHandlerT1,this.onNewArtifact=new r.EventHandlerT1},cc._RF.pop()},{"../../../common/util/EventHandler":"EventHandler"}],WdFloorBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"ea506t/lNJOqJbykElQGNhH","WdFloorBuilding");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdFloorBuilding=void 0;var c=t("../../../common/util/GoItem"),a=cc._decorator.ccclass,s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([a],e)}(c.default);o.WdFloorBuilding=s,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem"}],WdFloorDungeon:[function(t,e,o){"use strict";cc._RF.push(e,"6e533fayIZLxodp6e+Gm4Bp","WdFloorDungeon");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdFloorDungeon=void 0;var c=cc._decorator.property,a=cc._decorator.ccclass,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=null,e}return n(e,t),e.prototype.boot=function(t){this.world=t},e.prototype.update=function(){if(null!=this.world){var t=this.world.hero.getPos();this.node.setPosition(cc.v2(t.x,t.y));var e=cc.v2(t.x%640/640,-t.y%640/640);this.sprite.getMaterial(0).setProperty("uvOffset",e)}},i([c(cc.Sprite)],e.prototype,"sprite",void 0),i([a],e)}(cc.Component);o.WdFloorDungeon=s,cc._RF.pop()},{}],WdGateValue:[function(t,e,o){"use strict";cc._RF.push(e,"611dfrMRAZHUJfzzZjKcX3T","WdGateValue"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdGateValue=void 0;var r=t("../../area/WdAreaKey"),n=function(){function t(t){this.areaCode=t}return t.prototype.getAreaKey=function(){return r.WdAreaKey.from(this.areaCode)},t}();o.WdGateValue=n,cc._RF.pop()},{"../../area/WdAreaKey":"WdAreaKey"}],WdHaAttackHandler:[function(t,e,o){"use strict";cc._RF.push(e,"46d045chKlN96Ty3qKhQpSC","WdHaAttackHandler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHaAttackHandler=void 0;var n=t("./attacks/WdWpAttackArrow"),i=t("../../../../common/bean/Decorators"),c=t("../../../core/object/unit/WdUnitKey"),a=function(){function t(t){this.done=!1,this.action=null,this.hero=t}return t.prototype.onStart=function(t){this.attackHandler=this.newHandler(t),this.attackHandler.onStart(t),this.action=t},t.prototype.onAnimEvent=function(t){this.attackHandler.onAnimEvent(t)},t.prototype.onTick=function(t){this.attackHandler.done||(this.attackHandler.onTick(t),this.done=this.attackHandler.done)},t.prototype.onDead=function(){this.attackHandler.onDead()},t.prototype.newHandler=function(t){var e=this.worldService.presenters.unitFactory.getProjectileAgency(c.WdUnitType.Hero);return new n.WdWpAttackArrow(this.hero,t,e)},r([i.autoWired("WorldService")],t.prototype,"worldService",void 0),t}();o.WdHaAttackHandler=a,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../core/object/unit/WdUnitKey":"WdUnitKey","./attacks/WdWpAttackArrow":"WdWpAttackArrow"}],WdHaEnterAreaHandler:[function(t,e,o){"use strict";cc._RF.push(e,"dc64apMa3tAM7AhobPJfsFk","WdHaEnterAreaHandler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHaEnterAreaHandler=void 0;var n=t("../../../core/object/area/WdAreaKey"),i=t("../../../../common/bean/Decorators"),c=function(){function t(t){this.done=!1,this.action=null,this.hero=t}return t.prototype.onStart=function(t){var e=n.WdAreaKey.from(t.param1);this.worldService.world.changeArea(e),this.done=!0},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(){},t.prototype.onDead=function(){},r([i.autoWired("WorldService")],t.prototype,"worldService",void 0),t}();o.WdHaEnterAreaHandler=c,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../core/object/area/WdAreaKey":"WdAreaKey"}],WdHaHandler:[function(t,e,o){"use strict";cc._RF.push(e,"5de10lUZw1FrahDakGN76rl","WdHaHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHaHandler=void 0;var r=t("../../../core/object/unit/WdUnitAction"),n=t("../../unit/action/WdUaWalkHandler"),i=t("../../../core/object/unit/WdUnitState"),c=t("./WdHaAttackHandler"),a=t("./WdHaSkillHandler"),s=t("../../unit/action/WdUaPopupHandler"),l=t("../../unit/action/WdUaWrapUpHandler"),u=t("./WdHaEnterAreaHandler"),p=t("../../unit/action/WdUaHurtHandler"),d=t("../../unit/action/WdUaStopHandler"),h=function(){function t(t){this.currentHandler=null,this.actions=new Array,this.hero=t}return t.prototype.playActions=function(t){0==t.length||this.hero.isDead()||this.hasIrrevocable()||this.hero.getState()!=i.WdUnitState.Hurt&&(this.actions=t,this.currentHandler=null)},t.prototype.hasIrrevocable=function(){var t,e,o,r=null;return this.currentHandler?r=null!==(e=null===(t=this.currentHandler)||void 0===t?void 0:t.action)&&void 0!==e?e:null:this.actions.length>0&&(r=this.actions[0]),null!==(o=null==r?void 0:r.irrevocable)&&void 0!==o&&o},t.prototype.onTick=function(t){if(null==this.currentHandler){if(this.actions.length>0){var e=this.actions[0];this.actions.splice(0,1),this.start(e),this.hero.onActionStart(e)}}else this.currentHandler.onTick(t),this.currentHandler.done&&(this.hero.onActionDone(this.currentHandler.action),this.currentHandler.action.onDone&&this.currentHandler.action.onDone(),this.currentHandler=null)},t.prototype.start=function(t){var e=this.newHandler(t.type);null!=e&&(t.onStart&&t.onStart(),this.currentHandler=e,e.onStart(t))},t.prototype.onAnimEvent=function(t){var e;null===(e=this.currentHandler)||void 0===e||e.onAnimEvent(t)},t.prototype.newHandler=function(t){switch(t){case r.WdUnitActionType.Walk:return new n.WdUaWalkHandler(this.hero);case r.WdUnitActionType.Stop:return new d.WdUaStopHandler(this.hero);case r.WdUnitActionType.Attack1:return new c.WdHaAttackHandler(this.hero);case r.WdUnitActionType.Skill1:return new a.WdHaSkillHandler(this.hero);case r.WdUnitActionType.Popup:return new s.WdUaPopupHandler(this.hero);case r.WdUnitActionType.WrapUp:return new l.WdUaWrapUpHandler(this.hero);case r.WdUnitActionType.Hurt:return new p.WdUaHurtHandler(this.hero);case r.WdUnitActionType.EnterArea:return new u.WdHaEnterAreaHandler(this.hero)}return console.log("no handler for:"+t),null},t.prototype.stopAction=function(){this.currentHandler=null,this.actions=[]},t}();o.WdHaHandler=h,cc._RF.pop()},{"../../../core/object/unit/WdUnitAction":"WdUnitAction","../../../core/object/unit/WdUnitState":"WdUnitState","../../unit/action/WdUaHurtHandler":"WdUaHurtHandler","../../unit/action/WdUaPopupHandler":"WdUaPopupHandler","../../unit/action/WdUaStopHandler":"WdUaStopHandler","../../unit/action/WdUaWalkHandler":"WdUaWalkHandler","../../unit/action/WdUaWrapUpHandler":"WdUaWrapUpHandler","./WdHaAttackHandler":"WdHaAttackHandler","./WdHaEnterAreaHandler":"WdHaEnterAreaHandler","./WdHaSkillHandler":"WdHaSkillHandler"}],WdHaSkillHandler:[function(t,e,o){"use strict";cc._RF.push(e,"913d5yFhrdMCJmD/fmV61pJ","WdHaSkillHandler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHaSkillHandler=void 0;var n=t("../../../../rule/model/Model"),i=t("../../../core/object/unit/WdUnitKey"),c=t("../../../../common/bean/Decorators"),a=t("./attacks/WdWpSkillLightningStrike"),s=t("./attacks/WdWpSkillIcePillar"),l=t("./attacks/WdWpSkillLightningShield"),u=t("./attacks/WdWpSkillMeteor"),p=t("./attacks/WdWpSkillMagicBomb"),d=t("./attacks/WdWpSkillBonusLife"),h=function(){function t(t){this.done=!1,this.action=null,this.handler=null,this.hero=t}return t.prototype.onStart=function(t){var e;this.action=t;var o=this.ruleService.getSkill(t.skill);this.handler=this.makeHandler(o),null===(e=this.handler)||void 0===e||e.onStart(t)},t.prototype.onAnimEvent=function(t){var e;null===(e=this.handler)||void 0===e||e.onAnimEvent(t)},t.prototype.onTick=function(t){var e;null===(e=this.handler)||void 0===e||e.onTick(t)},t.prototype.onDead=function(){var t;null===(t=this.handler)||void 0===t||t.onDead()},t.prototype.makeHandler=function(t){var e=this.worldService.presenters.unitFactory.getProjectileAgency(i.WdUnitType.Hero);switch(t.type){case n.WdSkillType.LightningStrike:return new a.WdWpSkillLightningStrike(this.hero,t,e);case n.WdSkillType.LightningShield:return new l.WdWpSkillLightningShield(this.hero,t,e);case n.WdSkillType.IcePillar:return new s.WdWpSkillIcePillar(this.hero,t,e);case n.WdSkillType.Meteor:return new u.WdWpSkillMeteor(this.hero,t,e);case n.WdSkillType.MagicBomb:return new p.WdWpSkillMagicBomb(this.hero,t,e);case n.WdSkillType.BonusLife:return new d.WdWpSkillBonusLife(this.hero,t,e)}return null},r([c.autoWired("WorldService")],t.prototype,"worldService",void 0),r([c.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdHaSkillHandler=h,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../../core/object/unit/WdUnitKey":"WdUnitKey","./attacks/WdWpSkillBonusLife":"WdWpSkillBonusLife","./attacks/WdWpSkillIcePillar":"WdWpSkillIcePillar","./attacks/WdWpSkillLightningShield":"WdWpSkillLightningShield","./attacks/WdWpSkillLightningStrike":"WdWpSkillLightningStrike","./attacks/WdWpSkillMagicBomb":"WdWpSkillMagicBomb","./attacks/WdWpSkillMeteor":"WdWpSkillMeteor"}],WdHeroActor:[function(t,e,o){"use strict";cc._RF.push(e,"94882VPKSxKVbHyB4hk7jh7","WdHeroActor");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroActor=void 0;var c=t("../unit/WdUnitActor"),a=cc._decorator.ccclass,s=t("../../core/common/WdVec"),l=t("../../core/object/unit/WdUnit"),u=t("../../core/object/unit/WdUnitState"),p=cc._decorator.property,d=t("./WdHeroTargetMarker"),h=t("./WdHeroRip"),f=t("./WdHeroLevelUp"),y=t("../../../common/bean/Decorators"),v=t("./WdHeroCircle"),m=t("./action/WdHaHandler"),g=t("../unit/ccEffect/WdCcEffectPresenter"),W=t("../../core/common/WdUtil"),b=t("../../../rule/model/Model"),S=t("../../UI/common/WduGauge"),_=t("./WdHeroArrow"),A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor_=null,e.targetMarker=null,e.rip=null,e.levelUp=null,e.gauge=null,e.arrow=null,e.hero_=null,e.rbody=null,e.nextAnim=u.WdUnitState.None,e.circle=null,e.actionHandler=null,e.ccPresenter=null,e.ccDirty=!1,e.walkTarget=s.WdVec.zero,e.ripRoutine=null,e.onAnimEvent=function(t){var o;null===(o=e.actionHandler)||void 0===o||o.onAnimEvent(t)},e.onAnimDone=function(){},e}return n(e,t),Object.defineProperty(e.prototype,"anchor",{get:function(){return this.anchor_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this.hero_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hero",{get:function(){return this.hero_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.getPos()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.rbody=this.getComponent(cc.RigidBody),this.circle=this.getComponentInChildren(v.WdHeroCircle),this.ccPresenter=new g.WdCcEffectPresenter},e.prototype.onGoingIntoPool=function(){t.prototype.onGoingIntoPool.call(this),this.goPooler.returnGo(this.core),this.core.onAnimEventFired.removeHandler(this.onAnimEvent),this.core.onAnimDone.removeHandler(this.onAnimDone),this.side=l.WdUnitFaceSide.None,this.nextAnim=u.WdUnitState.None,this.ccPresenter.clear(),this.circle.clear(),this.actionHandler=null,this.damageRoutine=null,this.stopCoroutineSafe(this.ripRoutine)},e.prototype.onSetPosition=function(t){this.node.setPosition(cc.v2(t.x,t.y))},e.prototype.setForward=function(t){var e=this.pos;t.x>e.x?this.setFaceSide(l.WdUnitFaceSide.Right):t.x<e.x&&this.setFaceSide(l.WdUnitFaceSide.Left)},e.prototype.walkTo=function(t){this.hero.isDead()||(this.hero.setState(u.WdUnitState.Walk),this.setForward(t),this.setNavDestination(t))},e.prototype.setNavDestination=function(t){this.walkTarget=t},e.prototype.boot=function(t,e){this.hero_=t,this.core_=e,this.ccDirty=!0,this.setBaseColor(cc.Color.WHITE),this.setBaseTint(cc.Color.BLACK),this.setBaseAnimSpeed(1),this.onSetPosition(t.getPos()),this.core.node.setPosition(cc.Vec2.ZERO),this.core.onAnimEventFired.addHandler(this.onAnimEvent),this.core.onAnimDone.addHandler(this.onAnimDone),this.core.boot(t),this.hero.setActor(this),this.targetMarker.boot(t),this.circle.boot(t),this.arrow.boot(t),this.anchor.setPosition(this.hero.isDead()?cc.v2(0,1e4):cc.v2()),this.rip.boot(t),this.actionHandler=new m.WdHaHandler(t),this.gauge.node.active=!1,this.gauge.setValue(1,!1)},e.prototype.attackTo=function(t,e){this.hero.setState(e),this.lookAt(t.getPos())},e.prototype.playAction=function(t){var e=new Array;e.push(t),this.playActions(e)},e.prototype.playActions=function(t){this.actionHandler.playActions(t)},e.prototype.stopAction=function(){this.actionHandler.stopAction()},e.prototype.onChangeState=function(t,e){this.nextAnim=e,e!=u.WdUnitState.Walk&&this.setNavDestination(this.pos)},e.prototype.onHit=function(t){if(this.playDamageEffect(),this.worldService.presenters.mainCam.playShakePreset(t.shake),this.gauge.node.active=!0,this.gauge.setValue(this.hero.getStats().hpRate,!0),t.power>0&&this.rbody){var e=t.power,o=t.direction;W.WdUtil.approximately(o.len2(),0)&&(o=s.WdVec.right);var r=this.node.convertToWorldSpaceAR(cc.v2(-o.x,-o.y));o=o.scalar(100*e),this.rbody.applyLinearImpulse(cc.v2(o.x,o.y),r,!0)}},e.prototype.onLifeStolen=function(){this.gauge.setValue(this.hero.getStats().hpRate,!0)},e.prototype.onRecover=function(){this.gauge.setValue(this.hero.getStats().hpRate,!0)},e.prototype.onDead=function(){var t=this;this.core.onDead(),this.setNavDestination(this.pos),this.gauge.node.active=!1,this.stopCoroutineSafe(this.ripRoutine),this.ripRoutine=this.startRoutine().wait(1,function(){t.anchor.setPosition(cc.v2(0,1e4)),t.rip.playAppear()})},e.prototype.onBack=function(){this.core.onBack(),this.anchor.setPosition(cc.v2()),this.rip.hide(),this.stopCoroutineSafe(this.ripRoutine),this.nextAnim=u.WdUnitState.Hurt},e.prototype.onSetTarget=function(t){this.targetMarker.setTarget(t)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.nextAnim!=u.WdUnitState.None&&(this.core.setAnimation(this.nextAnim),this.nextAnim=u.WdUnitState.None),this.actionHandler.onTick(e);var o=this.getPos();if(this.hero.getState()==u.WdUnitState.Walk){var r=this.walkTarget.subtract(o);if(W.WdUtil.approximately(r.len2(),0))return;var n=this.hero.getRule().speed*this.hero.getStats().moveSpdBoost*80;r=r.normalize();var i=o.add(r.scalar(n*e));i=this.validatePosition(i),this.hero.setPosition(i)}else this.hero.getDao().pos=o;this.ccDirty&&this.displayCcEffect()},e.prototype.validatePosition=function(t){if(!this.hero.getWs().area.getKey().isVillage())return t;var e=t.clone();return e.x=Math.max(-308,e.x),e.x=Math.min(388,e.x),e.y=Math.max(-548,e.y),e.y=Math.min(628,e.y),e},e.prototype.playLevelUp=function(){this.levelUp.playLevelUp()},e.prototype.onCcAttached=function(t){t.type==b.WdCcType.Hurt&&(this.nextAnim=u.WdUnitState.Hurt,this.stopAction()),this.ccDirty=!0},e.prototype.onCcRemoved=function(){this.ccDirty=!0},e.prototype.displayCcEffect=function(){var t=new Array;this.hero.getStats().ccs.forEach(function(e){t=t.concat(e)});var e=new Array;t.forEach(function(t){return e.push(t.effect)}),this.ccPresenter.clear(),this.ccPresenter.display(this,e),this.ccDirty=!1},e.prototype.getPos=function(){var t=this.node.getPosition();return new s.WdVec(t.x,t.y)},i([p(cc.Node)],e.prototype,"anchor_",void 0),i([p(d.WdHeroTargetMarker)],e.prototype,"targetMarker",void 0),i([p(h.WdHeroRip)],e.prototype,"rip",void 0),i([p(f.WdHeroLevelUp)],e.prototype,"levelUp",void 0),i([p(S.WduGauge)],e.prototype,"gauge",void 0),i([p(_.WdHeroArrow)],e.prototype,"arrow",void 0),i([y.autoWired("WorldService")],e.prototype,"worldService",void 0),i([y.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([y.autoWired("WdPlayerService")],e.prototype,"playerService",void 0),i([a],e)}(c.WdUnitActor);o.WdHeroActor=A,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","../../UI/common/WduGauge":"WduGauge","../../core/common/WdUtil":"WdUtil","../../core/common/WdVec":"WdVec","../../core/object/unit/WdUnit":"WdUnit","../../core/object/unit/WdUnitState":"WdUnitState","../unit/WdUnitActor":"WdUnitActor","../unit/ccEffect/WdCcEffectPresenter":"WdCcEffectPresenter","./WdHeroArrow":"WdHeroArrow","./WdHeroCircle":"WdHeroCircle","./WdHeroLevelUp":"WdHeroLevelUp","./WdHeroRip":"WdHeroRip","./WdHeroTargetMarker":"WdHeroTargetMarker","./action/WdHaHandler":"WdHaHandler"}],WdHeroArrow:[function(t,e,o){"use strict";cc._RF.push(e,"70465CBoFpD1J5jNfL667o2","WdHeroArrow");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroArrow=void 0;var c=t("../../core/common/WdVec"),a=cc._decorator.ccclass,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.targets=new Array,e.onAreaStart=function(){e.node.active=!1,e.targets=[]},e.onObjectBorn=function(t){221!=t.getCode()&&223!=t.getCode()||(e.targets.push(t),e.node.active=!0)},e.onHeroDead=function(){e.node.active=!1,e.targets=[]},e}return n(e,t),e.prototype.boot=function(t){this.hero=t,this.hero.getWs().eventBus.onObjectBorn.addHandler(this.onObjectBorn),this.hero.getWs().eventBus.onAreaStart.addHandler(this.onAreaStart),this.hero.getWs().eventBus.onHeroDead.addHandler(this.onHeroDead),this.targets=[],this.node.active=!1},e.prototype.update=function(){this.trace()},e.prototype.trace=function(){if(0!=this.targets.length){var t=this.hero.getPos(),e=c.WdVec.build(0,0);this.targets.forEach(function(t){e=e.add(t.getPos())});var o=(e=e.scalar(1/this.targets.length)).subtract(t);o.len2()<62500?this.node.opacity=0:this.node.opacity=255;var r=o.normalize(),n=Math.atan2(r.y,r.x);this.node.angle=cc.misc.radiansToDegrees(n);var i=r.scalar(100);this.node.setPosition(cc.v2(i.x,i.y))}},i([a],e)}(cc.Component);o.WdHeroArrow=s,cc._RF.pop()},{"../../core/common/WdVec":"WdVec"}],WdHeroAttackCore:[function(t,e,o){"use strict";cc._RF.push(e,"744d3+Ct65NUZOwYq3SuZtT","WdHeroAttackCore"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroAttackCore=void 0;var r=t("../unit/WdUnitAction"),n=t("../unit/WdUnitKey"),i=t("../../common/WdUtil"),c=t("../../../../rule/model/Model"),a=t("../unit/WdUnitState"),s=function(){function t(t){this.nearest=null,this.lastTarget=null,this.lastAttack=0,this.lastCool=0,this.nextCheck=0,this.me=t}return t.prototype.clearTarget=function(){this.nearest=null,this.lastTarget=null,this.lastAttack=0,this.nextCheck=0},t.prototype.findTarget=function(t){var e=this.me.getActor().radar;if(t&&this.lastTarget&&(null==e?void 0:e.isInRadar(this.lastTarget)))return this.lastTarget;var o=n.WdUnitType.Enemy;return this.lastTarget=e.getNearest(this.me,o),this.lastTarget},t.prototype.onTick=function(t){null!=this.me.getWeaponRule()&&this.findNearestTarget(t)},t.prototype.isReadyToAttack=function(t){var e=t.timestamp-this.lastAttack,o=this.updateCool();return!(o<=i.WdUtil.epsilon)&&this.me.getState()==a.WdUnitState.Idle&&e>=o-i.WdUtil.epsilon},t.prototype.updateCool=function(){var t=i.WdUtil.valueForAs(this.me.getWeaponRule().attackSpeed),e=this.me.getStats().atkSpdBoost;return e<=i.WdUtil.epsilon?0:(t/=e,this.lastCool=t,this.lastCool)},t.prototype.makeAttack=function(t){var e,o,n,i;if(this.isReadyToAttack(t)){var a=this.findTarget(!1);if(null!=a){var s=new r.WdUnitAction;s.type=r.WdUnitActionType.Attack1,s.weapon=null!==(o=null===(e=this.me.getWeaponRule())||void 0===e?void 0:e.code)&&void 0!==o?o:0,s.weaponType=null!==(i=null===(n=this.me.getWeaponRule())||void 0===n?void 0:n.type)&&void 0!==i?i:c.WdItemType.None,s.target=a.getKey(),s.irrevocable=!0,this.me.playAction(s)}}},t.prototype.findNearestTarget=function(t){t.timestamp<this.nextCheck||(this.nextCheck=t.timestamp+.1,(null==this.lastTarget||this.lastTarget.isDead())&&(this.lastTarget=null,this.nearest=this.me.getActor().radar.getNearest(this.me,n.WdUnitType.Enemy)))},t.prototype.onActionStart=function(t){if(t.type==r.WdUnitActionType.Attack1){var e=this.me.getWs().time;e.timestamp-this.lastAttack>this.lastCool+e.deltaTime?this.lastAttack=e.timestamp:this.lastAttack+=this.lastCool}},t.prototype.onActionDone=function(){},t.prototype.getTarget=function(){return this.lastTarget?this.lastTarget:this.nearest},t}();o.WdHeroAttackCore=s,cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdUtil":"WdUtil","../unit/WdUnitAction":"WdUnitAction","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState"}],WdHeroCircleOrb:[function(t,e,o){"use strict";cc._RF.push(e,"fd12e+r6LRO76yNOvRMqtqb","WdHeroCircleOrb");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroCircleOrb=void 0;var c=t("../../../common/util/GoItem"),a=t("../../../rule/model/Model"),s=t("../../core/object/unit/WdAttackCalculator"),l=t("../unit/WdUnitActorCore"),u=t("../../core/object/unit/WdUnitKey"),p=t("../../core/common/WdVec"),d=t("../../core/object/unit/WdAttack"),h=t("../../core/object/unit/WdStat"),f=t("../../core/common/WdUtil"),y=cc._decorator.ccclass,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=120,e.run=0,e.hero=null,e.rule=null,e.calculator=null,e.onCollisionEnter=function(t){var o=t.getComponent(l.WdUnitActorCore);if(null!=o&&o.unit.getType()==u.WdUnitType.Enemy){var r=o.enemy,n=e.getAttack(),i=e.node.getPosition(),c=e.calculator.makeDamagesFrom(n,r,p.WdVec.build(i.x,i.y));e.hero.attack(r,c)}},e}return n(e,t),e.prototype.boot=function(t,e,o){this.hero=t,this.run=o,this.rule=e,this.calculator=new s.WdAttackCalculator(t);var r=1+this.hero.getStats().getAvgSum(a.WdStatType.CircleSpeed);this.speed=120*r},e.prototype.getAttack=function(){switch(this.rule.type){case a.WdSkillType.FireCircle:return this.getMagicAttack(a.WdStatType.FireAttack);case a.WdSkillType.ColdCircle:return this.getMagicAttack(a.WdStatType.ColdAttack);case a.WdSkillType.LightningCircle:return this.getMagicAttack(a.WdStatType.LightningAttack);case a.WdSkillType.PoisonCircle:return this.getMagicAttack(a.WdStatType.PoisonAttack)}return null},e.prototype.getMagicAttack=function(t){var e=this.hero.getStats(),o=new Array,r=e.getMinSum(a.WdStatType.PhysicalAttack),n=e.getMaxSum(a.WdStatType.PhysicalAttack),i=e.getAvgSum(t);o.push(h.WdStat.build(t,r+i,n+i,this.rule.cc));var c=new d.WdAttack;return c.attacks=o,c.attackBoost=e.atkSpdBoost*this.rule.v1,c.attackRate=1,c.cool=1,c.piercing=!1,c.power=1,c.ricochet=1,c},e.prototype.update=function(t){this.run+=t*this.speed*this.hero.getStats().atkSpdBoost,this.run%=360;var e=p.WdVec.build(160,0);e=e.rotate(this.run*f.WdUtil.deg2Rad),this.node.setPosition(cc.v2(e.x,e.y))},i([y],e)}(c.default);o.WdHeroCircleOrb=v,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem","../../../rule/model/Model":"Model","../../core/common/WdUtil":"WdUtil","../../core/common/WdVec":"WdVec","../../core/object/unit/WdAttack":"WdAttack","../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../core/object/unit/WdStat":"WdStat","../../core/object/unit/WdUnitKey":"WdUnitKey","../unit/WdUnitActorCore":"WdUnitActorCore"}],WdHeroCircle:[function(t,e,o){"use strict";cc._RF.push(e,"dec18VR+4BDpr4Hvvz2woH2","WdHeroCircle");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroCircle=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("./WdHeroCircleOrb"),l=t("../../../common/bean/Decorators"),u=t("../../../rule/model/Model"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.orbFire_=null,e.orbCold_=null,e.orbLightning_=null,e.orbPoison_=null,e.anchor=null,e.orbs=new Array,e.onAreaStart=function(){e.refreshOrbs()},e.onAreaEnd=function(){e.clearOrbs()},e.onHeroDead=function(){e.clearOrbs()},e.onSkillUpdate=function(){e.refreshOrbs()},e}return n(e,t),e.prototype.boot=function(t){this.hero=t;var e=t.getWs();e.eventBus.onAreaStart.addHandler(this.onAreaStart),e.eventBus.onAreaEnd.addHandler(this.onAreaEnd),e.eventBus.onSkillEquip.addHandler(this.onSkillUpdate),e.eventBus.onHeroDead.addHandler(this.onHeroDead),this.refreshOrbs()},e.prototype.clear=function(){var t=this.hero.getWs();t.eventBus.onAreaStart.removeHandler(this.onAreaStart),t.eventBus.onAreaEnd.removeHandler(this.onAreaEnd),t.eventBus.onSkillEquip.removeHandler(this.onSkillUpdate),t.eventBus.onHeroDead.removeHandler(this.onHeroDead),this.clearOrbs()},e.prototype.refreshOrbs=function(){var t=this;if(this.clearOrbs(),0!=this.hero.getWs().area.getKey().act){var e=new Array;if(this.hero.getDao().skills.forEach(function(o){var r=t.ruleService.skills.get(o.code).skills.get(o.level);t.isCircle(r.type)&&e.push(r)}),0!=e.length){var o=360/e.length,r=0;e.forEach(function(e){var n=t.getCircle(e.type);t.orbs.push(n),n.boot(t.hero,e,o*r++)})}}},e.prototype.isCircle=function(t){return t==u.WdSkillType.FireCircle||t==u.WdSkillType.ColdCircle||t==u.WdSkillType.LightningCircle||t==u.WdSkillType.PoisonCircle},e.prototype.getCircle=function(t){var e=null;switch(t){case u.WdSkillType.FireCircle:e=this.orbFire_;break;case u.WdSkillType.ColdCircle:e=this.orbCold_;break;case u.WdSkillType.LightningCircle:e=this.orbLightning_;break;case u.WdSkillType.PoisonCircle:e=this.orbPoison_}return this.goPooler.fromPrefab(e,this.anchor)},e.prototype.clearOrbs=function(){var t=this;this.orbs.forEach(function(e){t.goPooler.returnGo(e)}),this.orbs=[]},i([a(s.WdHeroCircleOrb)],e.prototype,"orbFire_",void 0),i([a(s.WdHeroCircleOrb)],e.prototype,"orbCold_",void 0),i([a(s.WdHeroCircleOrb)],e.prototype,"orbLightning_",void 0),i([a(s.WdHeroCircleOrb)],e.prototype,"orbPoison_",void 0),i([a(cc.Node)],e.prototype,"anchor",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l.autoWired("RuleService")],e.prototype,"ruleService",void 0),i([l.autoWired("WdSkillService")],e.prototype,"skillService",void 0),i([c],e)}(cc.Component);o.WdHeroCircle=p,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","./WdHeroCircleOrb":"WdHeroCircleOrb"}],WdHeroDAO:[function(t,e,o){"use strict";cc._RF.push(e,"00e42RtT4VMOLARxUMrtqTY","WdHeroDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroDAO=void 0;var r=t("../../common/WdVec"),n=t("../unit/WdStats"),i=t("../../../../rule/model/Model"),c=t("../skill/WdSkillKey"),a=function(){function t(){this.code=0,this.pos=r.WdVec.zero,this.stats=new n.WdStats,this.skills=new Map,this.newSkills=new Array,this.level=0,this.exp=0,this.remainSkill=0,this.hasNewItem=!1,this.equips=new Map,this.equipsR=new Map}return t.prototype.equip=function(t,e){this.detach(t),this.equips.set(t,e),this.equipsR.set(e,t)},t.prototype.detach=function(t){var e=this.equips.get(t);e&&(this.equips.delete(t),this.equipsR.delete(e))},t.prototype.findSlot=function(t){return this.equipsR.get(t.no)||i.WdEquipSlotType.None},t.prototype.isEquipped=function(t){return this.equipsR.has(t.no)},t.prototype.equipSkill=function(t){var e=this.skills.get(t);e?e.level++:this.skills.set(t,c.WdSkillKey.build(t,1)),this.newSkills=[]},t.prototype.getSkillCount=function(){var t=0;return this.skills.forEach(function(e){t+=e.level}),t},t.prototype.clearDungeon=function(){this.hasNewItem=!1,this.skills.clear(),this.newSkills=[],this.equips.clear(),this.equipsR.clear(),this.level=1,this.exp=0,this.remainSkill=0},t.prototype.getPk=function(){return this.code},t}();o.WdHeroDAO=a,cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdVec":"WdVec","../skill/WdSkillKey":"WdSkillKey","../unit/WdStats":"WdStats"}],WdHeroFactory:[function(t,e,o){"use strict";cc._RF.push(e,"244d0oj+yVDKZIFi2nRiD7N","WdHeroFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroFactory=void 0;var c=cc._decorator.ccclass,a=t("./WdHeroActor"),s=cc._decorator.property,l=t("../unit/WdUnitActorCore"),u=t("../../../common/bean/Decorators"),p=t("../area/WdAreaPresenter"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero_=null,e.cores=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.children.forEach(function(e){var o=e.getComponent(l.WdUnitActorCore);o&&t.cores.set(o.code,o)})},e.prototype.newCore=function(t,e){var o=this.cores.get(t);return o?this.goPooler.fromPrefab(o,e):(console.error("Hero "+t+" is not ready yet"),null)},e.prototype.generate=function(t){var e=this.worldService.presenters.areaPresenter.getUnitBucket(p.WdBucketLevel.Normal),o=this.goPooler.fromPrefab(this.hero_,e),r=this.newCore(t.getCode(),o.anchor);return o.boot(t,r),o},i([s(a.WdHeroActor)],e.prototype,"hero_",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdHeroFactory=d,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../area/WdAreaPresenter":"WdAreaPresenter","../unit/WdUnitActorCore":"WdUnitActorCore","./WdHeroActor":"WdHeroActor"}],WdHeroLevelUp:[function(t,e,o){"use strict";cc._RF.push(e,"45853gxAk1J1LTG778oxPkP","WdHeroLevelUp");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroLevelUp=void 0;var c=cc._decorator.ccclass,a=t("../../../common/coroutine/CoContainer"),s=t("../../../common/coroutine/EaseRoutine"),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.playLevelUp=function(){var t=this;this.node.active=!0,this.node.opacity=255,this.startRoutine().move(this.node,s.EaseType.easeInQuad,1,cc.v2(0,80)),this.startRoutine().wait(.5).opacity(this.node,s.EaseType.easeInQuad,.5,0,function(){return t.node.active=!1})},i([c],e)}(a.CoContainer);o.WdHeroLevelUp=l,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine"}],WdHeroPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"86be5oj4ONK04yw7z7ZpGwM","WdHeroPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroPresenter=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/bean/Decorators"),l=t("./WdHeroFactory"),u=t("../../../App"),p=t("../../core/common/WdVec"),d=t("../../core/object/unit/WdUnitAction"),h=t("../../UI/touchPad/WduTouchPad"),f=t("../camera/WdCamera"),y=t("../effect/WdEffectType"),v=t("../../core/object/unit/WdUnitKey"),m=t("../../core/history/WdActionHistoryDAO"),g=t("../../UI/popups/WduPopups"),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.factory=null,e.pad_=null,e.cam_=null,e.movingArea=!1,e.onPotionDrink=function(){var t=e.worldService.presenters.unitFactory.effectFactory.getEffect(y.WdEffectType.Heal1,e.actor.node);t.node.setPosition(cc.Vec2.ZERO),t.play()},e.onLevelUp=function(){e.actor.playLevelUp(),e.soundService.playFx("levelUp")},e.onHeroTarget=function(t){if(t){var o=t.getWs().area.getKey(),r=e.worldService.presenters.ui.popups;t.getType()==v.WdUnitType.Enemy&&o.isDungeon()&&!e.historyService.hasActionHistory(m.WdActionHistoryType.BasicTutorial1)&&r.openPopup(g.WduPopupType.Tutorial,m.WdActionHistoryType.BasicTutorial1),t.getType()!=v.WdUnitType.Object||221!=t.getCode()&&223!=t.getCode()||(o.isDungeon()&&!e.historyService.hasActionHistory(m.WdActionHistoryType.BasicTutorial2)&&r.openPopup(g.WduPopupType.Tutorial,m.WdActionHistoryType.BasicTutorial2),o.isVillage()&&!e.historyService.hasActionHistory(m.WdActionHistoryType.BasicTutorial3)&&r.openPopup(g.WduPopupType.Tutorial,m.WdActionHistoryType.BasicTutorial3))}},e.onAreaStart=function(){var t=e.hero.getPos();e.movingArea=!1,e.hero.clearTarget(),e.hero.setPosition(t),e.hero.getActor().stopAction(),e.readyCam()},e.onAreaEnd=function(){e.movingArea=!0,e.stopAction()},e.onHeroBack=function(){e.cam.resetEasing()},e.onHeroDead=function(){},e.onTouch=function(){if(e.canMove()&&null!=e.hero.getTarget()&&!(u.app.mainUI.getPopups().size>0)){var t=e.hero.getWs().area.getUnit(e.hero.getTarget().getKey());null==t||t.onTarget(e.hero)}},e.onTouchPadMove=function(t){if(e.canMove()){var o=e.actor.hero.getPos().add(new p.WdVec(80*t.x,80*t.y));e.hero.makeWalkAction(o)}},e.onTouchPadDone=function(){e.canMove()&&e.stopAction()},e}return n(e,t),Object.defineProperty(e.prototype,"hero",{get:function(){return this.actor.hero},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pad",{get:function(){return this.pad_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cam",{get:function(){return this.cam_},enumerable:!1,configurable:!0}),e.prototype.boot=function(t){var e=t.hero;this.actor=this.factory.generate(e),t.eventBus.onAreaStart.addHandler(this.onAreaStart),t.eventBus.onAreaEnd.addHandler(this.onAreaEnd),t.eventBus.onHeroBack.addHandler(this.onHeroBack),t.eventBus.onHeroDead.addHandler(this.onHeroDead),t.eventBus.onHeroLevelUp.addHandler(this.onLevelUp),t.eventBus.onPotionDrink.addHandler(this.onPotionDrink),t.eventBus.onHeroTarget.addHandler(this.onHeroTarget),this.cam.boot(t),this.readyCam(),this.pad.boot(this.onTouchPadMove,this.onTouchPadDone,this.onTouch)},e.prototype.update=function(){u.app.ready},e.prototype.needLifeAlert=function(){return null!=this.actor&&!this.hero.isDead()&&this.hero.getStats().hpRate<.2},e.prototype.showLifeAlert=function(){},e.prototype.canMove=function(){return!this.movingArea},e.prototype.stopAction=function(){var t=new d.WdUnitAction;t.type=d.WdUnitActionType.Stop,this.actor.playAction(t)},e.prototype.readyCam=function(){this.cam.zoom(0,1),this.cam.setTarget(this.hero),this.cam.resetEasing()},i([a(l.WdHeroFactory)],e.prototype,"factory",void 0),i([a(h.WduTouchPad)],e.prototype,"pad_",void 0),i([a(f.WdCamera)],e.prototype,"cam_",void 0),i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([s.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([s.autoWired("SoundService")],e.prototype,"soundService",void 0),i([s.autoWired("WdHistoryService")],e.prototype,"historyService",void 0),i([c],e)}(cc.Component);o.WdHeroPresenter=W,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","../../UI/popups/WduPopups":"WduPopups","../../UI/touchPad/WduTouchPad":"WduTouchPad","../../core/common/WdVec":"WdVec","../../core/history/WdActionHistoryDAO":"WdActionHistoryDAO","../../core/object/unit/WdUnitAction":"WdUnitAction","../../core/object/unit/WdUnitKey":"WdUnitKey","../camera/WdCamera":"WdCamera","../effect/WdEffectType":"WdEffectType","./WdHeroFactory":"WdHeroFactory"}],WdHeroRadar:[function(t,e,o){"use strict";cc._RF.push(e,"5c7d6HLxhpE357qQxUHIBB4","WdHeroRadar");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroRadar=void 0;var c=cc._decorator.ccclass,a=t("../../../common/util/EventHandler"),s=t("./WdUnitActorCore"),l=t("../../core/object/unit/WdUnitKey"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.onHeroEnter=new a.EventHandlerT1,e.onHeroExit=new a.EventHandlerT1,e.onCollisionEnter=function(t){var o=t.getComponent(s.WdUnitActorCore);null!=o&&o.unit.getType()==l.WdUnitType.Hero&&e.onHeroEnter.fire(o.hero)},e.onCollisionExit=function(t){var o=t.getComponent(s.WdUnitActorCore);null!=o&&o.unit.getType()==l.WdUnitType.Hero&&e.onHeroExit.fire(o.hero)},e}return n(e,t),i([c],e)}(cc.Component);o.WdHeroRadar=u,cc._RF.pop()},{"../../../common/util/EventHandler":"EventHandler","../../core/object/unit/WdUnitKey":"WdUnitKey","./WdUnitActorCore":"WdUnitActorCore"}],WdHeroRip:[function(t,e,o){"use strict";cc._RF.push(e,"c20ddVxPJ9Gy7PTvKszNrL7","WdHeroRip");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroRip=void 0;var c=cc._decorator.ccclass,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){this.animator=this.getComponent(cc.Animation)},e.prototype.boot=function(t){t.isDead()?this.playIdle():this.hide()},e.prototype.hide=function(){this.node.active=!1},e.prototype.playAppear=function(){var t=this;this.node.active=!0,this.animator.play("Rip_Appear"),this.scheduleOnce(function(){t.playIdle()},.45)},e.prototype.playIdle=function(){this.animator.play("Rip_Idle")},i([c],e)}(cc.Component);o.WdHeroRip=a,cc._RF.pop()},{}],WdHeroService:[function(t,e,o){"use strict";cc._RF.push(e,"9bd33qcWXBE6pXXAHOXJ/XQ","WdHeroService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdHeroDAO"),c=t("../unit/WdStat"),a=t("../../../../rule/model/Model"),s=t("../../common/WdVec"),l=function(){function t(){}return t.prototype.getHero=function(){return this.hero},t.prototype.getBaseHeroStats=function(t){var e=this.ruleService.heroStats.get(t).life,o=new Array,r=new c.WdStat;return r.type=a.WdStatType.Life,r.minV=e,r.maxV=e,o.push(r),o},t.prototype.onReadyDungeon=function(){this.hero.clearDungeon(),this.refreshHeroStat(),this.hero.remainSkill=Math.round(this.hero.stats.getAvgSum(a.WdStatType.BonusSkill))},t.prototype.onStartArea=function(){if(0==this.hero.equips.size){var t=this.itemService.addItem(a.WdItemCategory.Normal,151,1,50);this.equipItem(a.WdEquipSlotType.Weapon,t)}},t.prototype.newHero=function(t){return this.hero=new i.WdHeroDAO,this.hero.code=t,this.hero.pos=s.WdVec.zero,this.hero.level=1,this.hero.exp=0,this.refreshHeroStat(),this.hero},t.prototype.refreshHeroStat=function(){var t=this,e=this.getBaseHeroStats(1,this.hero.level);this.hero.equips.forEach(function(o){var r=t.itemService.get(o),n=t.itemService.calculateStats(r);e=e.concat(n)});var o=this.playerService.getPlayer();e=e.concat(this.artifactService.getAllStats(o.artifacts)),this.hero.skills.forEach(function(o){e=e.concat(t.skillService.calculateStats(o))}),this.hero.stats.refresh(e)},t.prototype.equipItem=function(t,e){var o=this.hero.equips.get(t);o&&this.itemService.deleteItem(o),this.hero.equip(t,e.no),this.refreshHeroStat(),this.worldService.getEventBus().onItemEquip.fire(e)},t.prototype.equipSkill=function(t){if(this.hero.newSkills.indexOf(t)<0)console.error("this skill is not in the skill candidates");else{this.hero.remainSkill--,this.hero.equipSkill(t),this.refreshHeroStat(),this.readyNewSkill();var e=this.hero.skills.get(t);this.worldService.getEventBus().onSkillEquip.fire(e)}},t.prototype.addExp=function(t){var e=this.hero.level;this.hero.exp+=t,this.hero.level=this.calculateLevel(this.hero.exp),this.worldService.getEventBus().onHeroExpUp.fire(),e!=this.hero.level&&(this.hero.remainSkill++,this.readyNewSkill(),this.worldService.getEventBus().onHeroLevelUp.fire())},t.prototype.readyNewSkill=function(){if(0==this.hero.newSkills.length&&!(this.hero.remainSkill<=0)){var t=this.ruleService.heroStats.get(1).maxSkillCount;this.hero.getSkillCount()<t&&(this.hero.newSkills=this.skillService.newSkillCandidates(this.hero.skills))}},t.prototype.getDropBonus=function(){return this.hero.stats.getAvgSum(a.WdStatType.DropBonus)},t.prototype.calculateLevel=function(t){for(var e=0,o=Array.from(this.ruleService.heroLevels.values());e<o.length;e++){var r=o[e];if(t<r.exp)return r.level-1}return this.ruleService.maxHeroLevel},r([n.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([n.autoWired("WdSkillService")],t.prototype,"skillService",void 0),r([n.autoWired("WdArtifactService")],t.prototype,"artifactService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("WdPlayerService")],t.prototype,"playerService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdHeroService")],t)}();o.WdHeroService=l,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdVec":"WdVec","../unit/WdStat":"WdStat","./WdHeroDAO":"WdHeroDAO"}],WdHeroSkillFactory:[function(t,e,o){"use strict";cc._RF.push(e,"3b08bKK9EBMQI5mRRIaFc1x","WdHeroSkillFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroSkillFactory=void 0;var r=t("../../../../../rule/model/Model"),n=t("./handlers/WdHsCR"),i=t("./handlers/WdHsDefault"),c=t("./handlers/WdHsGhost"),a=t("./handlers/WdHsBonusLife"),s=function(){function t(){}return t.newSkill=function(t){switch(t.type){case r.WdSkillType.Meteor:return new n.WdHsCR(t,r.WdStatType.MeteorCR);case r.WdSkillType.MagicBomb:return new i.WdHsDefault(t);case r.WdSkillType.LightningStrike:return new n.WdHsCR(t,r.WdStatType.LightningStrikeCR);case r.WdSkillType.LightningShield:return new n.WdHsCR(t,r.WdStatType.LightningShieldCR);case r.WdSkillType.IcePillar:return new n.WdHsCR(t,r.WdStatType.IcePillarCR);case r.WdSkillType.Ghost:return new c.WdHsGhost(t);case r.WdSkillType.BonusLife:return new a.WdHsBonusLife(t)}return null},t}();o.WdHeroSkillFactory=s,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","./handlers/WdHsBonusLife":"WdHsBonusLife","./handlers/WdHsCR":"WdHsCR","./handlers/WdHsDefault":"WdHsDefault","./handlers/WdHsGhost":"WdHsGhost"}],WdHeroTargetMarker:[function(t,e,o){"use strict";cc._RF.push(e,"3eaea2ZglFEW45tJl4Mh0dm","WdHeroTargetMarker");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHeroTargetMarker=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/coroutine/CoContainer"),l=t("../../../common/coroutine/EaseRoutine"),u=t("../../core/common/WdVec"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tl=null,e.tr=null,e.bl=null,e.br=null,e.target=null,e.targetSize=1,e.autoTrace=!0,e.traceRoutine=null,e.playIdle=function(){var t=[cc.v2(-1,1),cc.v2(1,1),cc.v2(-1,-1),cc.v2(1,-1)];e.startRoutine().ease(l.EaseType.easeOutQuad,.2,function(){return 40*e.targetSize},function(o,r){var n=40*e.targetSize+8;e.tl.setPosition(t[0].mul(l.Ease.lerp(o,n,r))),e.tr.setPosition(t[1].mul(l.Ease.lerp(o,n,r))),e.bl.setPosition(t[2].mul(l.Ease.lerp(o,n,r))),e.br.setPosition(t[3].mul(l.Ease.lerp(o,n,r)))}).ease(l.EaseType.easeInQuad,.2,function(){return 40*e.targetSize+8},function(o,r){var n=40*e.targetSize;e.tl.setPosition(t[0].mul(l.Ease.lerp(o,n,r))),e.tr.setPosition(t[1].mul(l.Ease.lerp(o,n,r))),e.bl.setPosition(t[2].mul(l.Ease.lerp(o,n,r))),e.br.setPosition(t[3].mul(l.Ease.lerp(o,n,r)))}).do(function(){return e.playIdle()})},e}return n(e,t),e.prototype.boot=function(t){var e=this;this.scheduleOnce(function(){return e.setTarget(t.getTarget())},.2)},e.prototype.onEnable=function(){this.playIdle()},e.prototype.setTarget=function(t){var e=this,o=this.target;if(this.target=t,t&&o!=t){this.stopCoroutineSafe(this.traceRoutine);var r=this.node.getPosition(),n=this.targetSize;o&&o.getCore()||(r=null),this.autoTrace=!1,this.traceRoutine=this.startRoutine().ease(l.EaseType.easeInOutQuad,.3,function(){return null},function(o,i){var c,a,s=e.getTargetPosition(),u=cc.v2();e.node.setPosition(cc.Vec2.lerp(u,null!=r?r:s,s,i)),e.targetSize=l.Ease.lerp(n,null!==(a=null===(c=null==t?void 0:t.getCore())||void 0===c?void 0:c.targetSize)&&void 0!==a?a:e.targetSize,i)},function(){return e.autoTrace=!0})}},e.prototype.update=function(e){t.prototype.update.call(this,e),this.autoTrace&&this.node.setPosition(this.getTargetPosition())},e.prototype.getTargetPosition=function(){var t,e;if(!this.target)return cc.v2(0,1e5);var o=this.target.getPos();return o=o.add(null!==(e=null===(t=this.target.getCore())||void 0===t?void 0:t.targetAnchor)&&void 0!==e?e:u.WdVec.zero),cc.v2(o.x,o.y).subtract(this.node.parent.getPosition())},i([a(cc.Node)],e.prototype,"tl",void 0),i([a(cc.Node)],e.prototype,"tr",void 0),i([a(cc.Node)],e.prototype,"bl",void 0),i([a(cc.Node)],e.prototype,"br",void 0),i([c],e)}(s.CoContainer);o.WdHeroTargetMarker=p,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../core/common/WdVec":"WdVec"}],WdHero:[function(t,e,o){"use strict";cc._RF.push(e,"e8415apiThH2oUIjKHJ02mw","WdHero");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHero=void 0;var n=t("../../common/WdVec"),i=t("../unit/WdUnitKey"),c=t("../unit/WdUnitState"),a=t("../unit/WdUnitAction"),s=t("../../../../rule/model/Model"),l=t("../../../../common/bean/Decorators"),u=t("./WdHeroAttackCore"),p=t("../../common/WdUtil"),d=t("../unit/WdDamage"),h=t("./skill/WdHeroSkillFactory"),f=function(){function t(t){var e=this;this.direction=n.WdVec.zero,this.nextCoreTick=0,this.attached=new Array,this.skillHandlers=new Map,this.onSkillEquip=function(t){var o=e.ruleService.getSkill(t),r=h.WdHeroSkillFactory.newSkill(o);null!=r&&(e.skillHandlers.has(o.code)&&e.skillHandlers.delete(o.code),e.skillHandlers.set(o.code,r),r.onBoot(e))},this.onItemEquip=function(){e.refreshWeapon()},this.onAreaStart=function(t,o){o.isVillage()&&e.skillHandlers.clear()},this.dao=t,this.nextCoreTick=0,this.state=c.WdUnitState.Idle,this.attackCore=new u.WdHeroAttackCore(this),this.rule=this.ruleService.heroStats.get(t.code),this.refreshWeapon()}return t.prototype.getType=function(){return i.WdUnitType.Hero},t.prototype.getState=function(){return this.state},t.prototype.getCore=function(){var t,e;return null!==(e=null===(t=this.actor)||void 0===t?void 0:t.core)&&void 0!==e?e:null},t.prototype.getStats=function(){return this.dao.stats},t.prototype.getActor=function(){return this.actor},t.prototype.getKey=function(){return new i.WdUnitKey(this.getType(),this.getNo())},t.prototype.getWs=function(){return this.ws},t.prototype.getWeaponRule=function(){return this.weaponRule},t.prototype.getNo=function(){return this.dao.code},t.prototype.getCode=function(){return this.dao.code},t.prototype.getPos=function(){return this.dao.pos},t.prototype.getGatePos=function(){return this.getPos()},t.prototype.getSize=function(){return n.WdVec.one},t.prototype.getDirection=function(){return this.direction},t.prototype.getCamFocusPos=function(){return this.getPos()},t.prototype.getTalkBoxPos=function(){return this.actor.core.balloonAnchor},t.prototype.getHpRate=function(){return this.getStats().hpRate},t.prototype.getRadius=function(){return.5},t.prototype.getLevel=function(){return this.dao.level},t.prototype.getRule=function(){return this.rule},t.prototype.getDao=function(){return this.dao},t.prototype.getTarget=function(){return this.target},t.prototype.makeWalkAction=function(t){var e=new a.WdUnitAction;e.type=a.WdUnitActionType.Walk,e.to=t,e.range=5,this.direction=t.subtract(this.getPos()),this.direction=p.WdUtil.approximately(this.direction.len2(),0)?n.WdVec.zero:this.direction.normalize(),this.actor.playAction(e)},t.prototype.walkTo=function(t){this.actor.walkTo(t)},t.prototype.refreshWeapon=function(){this.weaponRule=null;var t=this.dao.equips.get(s.WdEquipSlotType.Weapon);if(t){var e=this.itemService.get(t);this.weaponRule=this.ruleService.items.get(e.code)}},t.prototype.boot=function(t){this.ws=t,this.state=this.isDead()?c.WdUnitState.Death:c.WdUnitState.Idle,this.silent=!1,this.attached=[],this.ws.eventBus.onItemEquip.removeHandler(this.onItemEquip),this.ws.eventBus.onItemEquip.addHandler(this.onItemEquip),this.ws.eventBus.onAreaStart.removeHandler(this.onAreaStart),this.ws.eventBus.onAreaStart.addHandler(this.onAreaStart),this.ws.eventBus.onSkillEquip.removeHandler(this.onSkillEquip),this.ws.eventBus.onSkillEquip.addHandler(this.onSkillEquip)},t.prototype.setActor=function(t){this.actor=t},t.prototype.clearTarget=function(){this.attackCore.clearTarget(),this.setTarget(null)},t.prototype.setSilent=function(t){this.silent=t},t.prototype.isDead=function(){return this.getStats().isDead()},t.prototype.onTick=function(t){this.isDead()||(null==this.actor||this.silent||(this.attackCoreTick(t),this.skillHandlers.forEach(function(e){e.onTick(t)})),this.getStats().onTick(t),this.attached.length>0&&this.onCcAttached(),null!=this.actor&&this.getStats().removed.length>0&&this.onCcRemoved(),this.getStats().dotDamages.length>0&&this.ccHit(this.getStats().dotDamages))},t.prototype.onCcRemoved=function(){this.actor.onCcRemoved(this.getStats().removed),this.getStats().hasCc(s.WdCcType.Hurt)||this.state!=c.WdUnitState.Hurt||this.setState(c.WdUnitState.Idle)},t.prototype.onCcAttached=function(){var t=this;this.attached.forEach(function(e){return t.actor.onCcAttached(e)}),this.attached=[],this.getStats().hasCc(s.WdCcType.Hurt)&&this.setState(c.WdUnitState.Hurt)},t.prototype.attackCoreTick=function(t){if(!(t.timestamp<this.nextCoreTick)){this.attackCore.onTick(t),this.attackCore.makeAttack(t);var e=this.attackCore.getTarget();e&&!e.isDead()?this.setTarget(e):this.updateNearestTarget(),this.nextCoreTick=t.timestamp+.05}},t.prototype.updateNearestTarget=function(){var t=i.WdUnitType.Object|i.WdUnitType.Building,e=this.actor.radar.getNearest(this,t);this.setTarget(e)},t.prototype.setState=function(t){var e=this.state;e!=t&&(this.isDead()&&t!=c.WdUnitState.Death||(this.state=t,this.actor.onChangeState(e,t)))},t.prototype.attack=function(t,e){var o=this.getStats();if(o.hpRate<.2){var r=1+o.getAvgSum(s.WdStatType.AttackBoostLessHp);r>1&&e.damages.forEach(function(t){return t.amount*=r})}var n=t.hit(e);if(n){var i=o.getAvgSum(s.WdStatType.LifeStolenPerHit),c=n/t.getStats().totalLife*o.totalLife;i>0&&!this.isDead()&&(o.addHp(Math.abs(c*i)),this.actor.onLifeStolen())}},t.prototype.hit=function(t){var e=this,o=this.getStats();if(!o.hasCc(s.WdCcType.Ghost)){t.delay>0?this.ws.tickHelper.runAfter(t.delay,function(){e.fireHit(t)}):this.fireHit(t);var r=this.ws.player.battleBook.potions;if(!this.isDead()&&r.length>0&&o.hpRate<.3){var n=r.length-1,i=r[n];r.splice(n,1),o.addHp(i.hp),this.ws.eventBus.onPotionDrink.fire(i)}}},t.prototype.fireHit=function(t){var e=this;this.isDead()||(t.damages.forEach(function(t){e.getStats().reduceHp(t.amount),null!=t.cc&&e.addCc(t.cc)}),this.onDamage(t))},t.prototype.addCc=function(t){this.getStats().addCc(t),this.attached.push(t)},t.prototype.ccHit=function(t){var e=this;if(!this.isDead()){t.forEach(function(t){e.getStats().reduceHp(t.amount)}),this.isDead()&&this.getStats().addHp(1);var o=new d.WdDamageSet;o.damages=t,this.onDamage(o)}},t.prototype.onDamage=function(t){this.actor.onHit(t),this.isDead()&&(this.skillHandlers.forEach(function(t){t.onDead()}),this.isDead()?(this.setState(c.WdUnitState.Death),this.actor.onDead(),this.ws.eventBus.onHeroDead.fire()):this.actor.onRecover())},t.prototype.setTarget=function(t){var e;this.target!=t&&(this.target=t,null===(e=this.actor)||void 0===e||e.onSetTarget(t),this.ws.eventBus.onHeroTarget.fire(t))},t.prototype.onActionStart=function(t){this.attackCore.onActionStart(t)},t.prototype.onActionDone=function(t){this.attackCore.onActionDone(t)},t.prototype.recover=function(){var t;this.getStats().recoverAll(),null===(t=this.actor)||void 0===t||t.onRecover()},t.prototype.bringBack=function(){var t;this.recover(),this.setState(c.WdUnitState.Idle),null===(t=this.actor)||void 0===t||t.onBack()},t.prototype.setPosition=function(t){var e;this.dao.pos=t.clone(),null===(e=this.actor)||void 0===e||e.onSetPosition(t.clone())},t.prototype.setFaceSide=function(t){this.actor.setFaceSide(t)},t.prototype.onTarget=function(){},t.prototype.playAction=function(t){var e;null===(e=this.actor)||void 0===e||e.playAction(t)},t.prototype.playActions=function(t){var e;null===(e=this.actor)||void 0===e||e.playActions(t)},t.prototype.isGhost=function(){return this.getStats().hasCc(s.WdCcType.Ghost)},t.prototype.kill=function(){this.getStats().kill(),this.actor.onDead()},t.prototype.lookAt=function(t){this.actor.lookAt(t)},t.prototype.getName=function(){return"Hero"},r([l.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([l.autoWired("WdItemService")],t.prototype,"itemService",void 0),t}();o.WdHero=f,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdUtil":"WdUtil","../../common/WdVec":"WdVec","../unit/WdDamage":"WdDamage","../unit/WdUnitAction":"WdUnitAction","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState","./WdHeroAttackCore":"WdHeroAttackCore","./skill/WdHeroSkillFactory":"WdHeroSkillFactory"}],WdHistoryService:[function(t,e,o){"use strict";cc._RF.push(e,"e6e90NLnZNLEqKeyQdbf7KA","WdHistoryService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdHistoryService=void 0;var n=t("../../../common/bean/Decorators"),i=t("./WdActionHistoryDAO"),c=function(){function t(){}return t.prototype.hasActionHistory=function(t){return!!this.actionRepository.read(t)},t.prototype.addActionHistory=function(t){if(!this.hasActionHistory(t)){var e=new i.WdActionHistoryDAO;e.type=t,this.actionRepository.create(e),this.worldService.world.eventBus.onActionHistory.fire(t)}},r([n.autoWired("WdActionHistoryRepository")],t.prototype,"actionRepository",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.service("WdHistoryService")],t)}();o.WdHistoryService=c,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WdActionHistoryDAO":"WdActionHistoryDAO"}],WdHsBonusLife:[function(t,e,o){"use strict";cc._RF.push(e,"65fe2sNxXlBep+zbY348fr1","WdHsBonusLife"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHsBonusLife=void 0;var r=t("../../../../../../rule/model/Model"),n=t("../../../unit/WdCc"),i=t("../../../unit/WdUnitAction"),c=t("../../../skill/WdSkillKey"),a=function(){function t(t){this.rule=t}return t.prototype.onBoot=function(t){this.hero=t},t.prototype.onTick=function(){},t.prototype.onDead=function(){if(!this.fired){var t=this.hero.getStats(),e=t.getAvgSum(r.WdStatType.BonusLifeLB),o=t.totalLife*(this.rule.v1+e);t.addHp(o);var a=new n.WdCc;a.type=this.rule.cc.type,a.effect=this.rule.cc.effect,a.remain=this.rule.cc.duration,this.hero.addCc(a);var s=this.hero.getActor().radar.getNearestEnemy(this.hero);if(null!=s){var l=new i.WdUnitAction;l.type=i.WdUnitActionType.Skill1,l.skill=c.WdSkillKey.build(this.rule.code,this.rule.level),l.target=s.getKey(),l.to=s.getPos(),this.hero.playAction(l)}this.fired=!0}},t}();o.WdHsBonusLife=a,cc._RF.pop()},{"../../../../../../rule/model/Model":"Model","../../../skill/WdSkillKey":"WdSkillKey","../../../unit/WdCc":"WdCc","../../../unit/WdUnitAction":"WdUnitAction"}],WdHsCR:[function(t,e,o){"use strict";cc._RF.push(e,"61556mmtoNNAoKjx7l6Ncst","WdHsCR");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdHsCR=void 0;var i=function(t){function e(e,o){var r=t.call(this,e)||this;return r.crType=o,r}return n(e,t),e.prototype.getCoolTime=function(){var t=this.hero.getStats().getAvgSum(this.crType);return this.rule.cool*(1-t)},e}(t("./WdHsDefault").WdHsDefault);o.WdHsCR=i,cc._RF.pop()},{"./WdHsDefault":"WdHsDefault"}],WdHsDefault:[function(t,e,o){"use strict";cc._RF.push(e,"eb94bQCjt1MVZ7YnO7k0HZd","WdHsDefault"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHsDefault=void 0;var r=t("../../../unit/WdUnitAction"),n=t("../../../skill/WdSkillKey"),i=function(){function t(t){this.rule=t}return t.prototype.onBoot=function(t){this.hero=t,this.nextFire=t.getWs().time.timestamp+this.rule.cool},t.prototype.onTick=function(t){if(!(t.timestamp<this.nextFire||this.hero.isDead())){var e=this.hero.getActor().radar.getNearestEnemy(this.hero);if(null!=e){var o=new r.WdUnitAction;o.type=r.WdUnitActionType.Skill1,o.skill=n.WdSkillKey.build(this.rule.code,this.rule.level),o.target=e.getKey(),o.to=e.getPos(),this.hero.playAction(o),this.nextFire=this.hero.getWs().time.timestamp+this.getCoolTime()}}},t.prototype.getCoolTime=function(){return this.rule.cool},t.prototype.onDead=function(){},t}();o.WdHsDefault=i,cc._RF.pop()},{"../../../skill/WdSkillKey":"WdSkillKey","../../../unit/WdUnitAction":"WdUnitAction"}],WdHsGhost:[function(t,e,o){"use strict";cc._RF.push(e,"523988VvYNNEp4yFCvCP0ml","WdHsGhost"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdHsGhost=void 0;var r=t("../../../../../../rule/model/Model"),n=t("../../../unit/WdCc"),i=function(){function t(t){this.rule=t}return t.prototype.onBoot=function(t){this.hero=t,this.nextFire=t.getWs().time.timestamp+this.rule.cool},t.prototype.onDead=function(){},t.prototype.onTick=function(t){if(!(t.timestamp<this.nextFire||this.hero.isDead())){var e=this.rule.cc.duration;e*=1+this.hero.getStats().getAvgSum(r.WdStatType.GhostDR),this.nextFire=t.timestamp+this.rule.cool;var o=new n.WdCc;o.type=this.rule.cc.type,o.effect=this.rule.cc.effect,o.remain=e,this.hero.addCc(o)}},t}();o.WdHsGhost=i,cc._RF.pop()},{"../../../../../../rule/model/Model":"Model","../../../unit/WdCc":"WdCc"}],WdIAreaPulsar:[function(t,e,o){"use strict";cc._RF.push(e,"b6dce2oZ9lMU4YOhM2rwikf","WdIAreaPulsar"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdICamTarget:[function(t,e,o){"use strict";cc._RF.push(e,"d03f8xOSqhIbItlXTJtAAfm","WdICamTarget"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdICcEffect:[function(t,e,o){"use strict";cc._RF.push(e,"908feaUOHVAqqEynqoL12XG","WdICcEffect"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdCcEffectOption=void 0;o.WdCcEffectOption=function(){this.color=cc.Color.WHITE,this.tint=cc.Color.BLACK,this.opacity=255},cc._RF.pop()},{}],WdIDropItemActor:[function(t,e,o){"use strict";cc._RF.push(e,"b6809w3ysNF96xuCfY/nwbT","WdIDropItemActor"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdIEnemyActor:[function(t,e,o){"use strict";cc._RF.push(e,"80ebbipo5dFtZoH5JBQbe2l","WdIEnemyActor"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdIHeroActor:[function(t,e,o){"use strict";cc._RF.push(e,"98e28hieO9AgoS0kcvKHYRZ","WdIHeroActor"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdIHsHandler:[function(t,e,o){"use strict";cc._RF.push(e,"6db027azn5H24AM3+YYyxqu","WdIHsHandler"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdIObjectActor:[function(t,e,o){"use strict";cc._RF.push(e,"7dd72mAxvdCmpp2j/Al4Ahf","WdIObjectActor"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdISharedRes:[function(t,e,o){"use strict";cc._RF.push(e,"3addc0F0klHvJf/K0kuFOs5","WdISharedRes"),Object.defineProperty(o,"__esModule",{value:!0}),o.WorldState=void 0,function(t){t[t.Play=0]="Play",t[t.Pause=1]="Pause",t[t.Waiting=2]="Waiting"}(o.WorldState||(o.WorldState={})),cc._RF.pop()},{}],WdIWpAttack:[function(t,e,o){"use strict";cc._RF.push(e,"7efb4M9ynxD9Le9O91y6Exd","WdIWpAttack"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],"WdItem.spec":[function(t,e,o){"use strict";cc._RF.push(e,"7a5e5KoBBdGwKHwurg54PYz","WdItem.spec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdItemTest=void 0;var c=t("testyts"),a=t("../../../../../common/bean/Decorators"),s=t("../../../../../rule/RuleService"),l=t("../../../../../common/bean/BeanContainer"),u=t("../WdItemService"),p=t("../WdItemDAO"),d=t("../../../../../rule/model/Model"),h=t("../../../common/WdUtil"),f=function(){function t(){}return t.prototype.beforeAll=function(){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return s.RuleService.readyTest(),u.WdItemService.readyTest(),[4,l.beanContainer.initialize()];case 1:return t.sent(),[2]}})})},t.prototype.newTestItem=function(t,e,o){var r=new p.WdItemDAO;return r.code=t,r.level=e,r.dna=o,r},t.prototype.baseStatTest=function(){var t=this.newTestItem(151,1,50),e=this.ruleService.items.get(t.code),o=this.itemService.getBaseStat(t);c.expect.toBeEqual(o.type,d.WdStatType.PhysicalAttack),c.expect.toBeEqual(o.minV,o.maxV),c.expect.toBeEqual(o.minV,h.WdUtil.lerp(e.v1,e.v2,t.dna/100))},t.prototype.baseStatTest2=function(){var t=this.newTestItem(181,1,50),e=this.itemService.getBaseStat(t);c.expect.toBeEqual(e.type,d.WdStatType.Defense),c.expect.toBeEqual(e.minV,e.maxV)},t.prototype.levelTest=function(){var t=this.newTestItem(151,1,50),e=this.ruleService.items.get(t.code),o=this.itemService.getBaseStat(t);c.expect.toBeEqual(o.type,d.WdStatType.PhysicalAttack),c.expect.toBeEqual(o.minV,o.maxV),c.expect.toBeEqual(o.minV,h.WdUtil.lerp(e.v1,e.v2,t.dna/100)),t.level=2;var r=this.itemService.getBaseStat(t);c.expect.toBeGreater(r.minV,o.minV)},t.prototype.ringBaseStatTest=function(){var t=this.newTestItem(331,1,50),e=this.itemService.getBaseStat(t);c.expect.toBeTrue(null===e)},t.prototype.magicStatTest1=function(){var t=p.WdItemMagic.build(1,50),e=this.ruleService.itemMagics.get(t.code),o=this.itemService.getMagicStat(t);c.expect.toBeEqual(o.type,d.WdStatType.ItemAttackBoost),c.expect.toBeEqual(o.minV,o.maxV),c.expect.toBeEqual(o.minV,h.WdUtil.lerp(e.v1,e.v2,t.dna/100));var r=this.newTestItem(151,1,50),n=this.itemService.calculateStats(r)[0];r.magics.push(t);var i=this.itemService.calculateStats(r)[0];c.expect.toBeTrue(n.minV<i.minV)},t.prototype.magicStatTest2=function(){var t=p.WdItemMagic.build(2,50),e=this.ruleService.itemMagics.get(t.code),o=this.itemService.getMagicStat(t);c.expect.toBeEqual(o.type,d.WdStatType.FireAttack),c.expect.toBeTrue(o.minV!=o.maxV),c.expect.toBeEqual(o.minV,h.WdUtil.lerp(e.v1,e.v2,t.dna/100)),c.expect.toBeEqual(o.maxV,h.WdUtil.lerp(e.v3,e.v4,t.dna/100))},t.prototype.magicAttachTest=function(){var t=this.ruleService.items.get(151),e=this.ruleService.itemMagics.get(1),o=this.ruleService.itemMagics.get(11);c.expect.toBeTrue(this.itemService.canBeAttached(e,t)),c.expect.toBeFalse(this.itemService.canBeAttached(o,t))},t.prototype.magicAttachTest2=function(){var t=this.newTestItem(151,1,50);this.itemService.addRandomMagics(t,3),c.expect.toBeEqual(t.magics.length,3)},t.prototype.lifeStolenTest=function(){var t=this.newTestItem(361,3,50);this.itemService.addMagic(t,this.ruleService.itemMagics.get(10));var e=this.itemService.calculateStats(t),o=this.ruleService.itemMagics.get(t.magics[0].code);e.forEach(function(t){c.expect.toBeLess(t.maxV,o.v2)})},r([a.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([a.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([c.BeforeAll()],t.prototype,"beforeAll",null),r([c.Test()],t.prototype,"baseStatTest",null),r([c.Test()],t.prototype,"baseStatTest2",null),r([c.Test()],t.prototype,"levelTest",null),r([c.Test()],t.prototype,"ringBaseStatTest",null),r([c.Test()],t.prototype,"magicStatTest1",null),r([c.Test()],t.prototype,"magicStatTest2",null),r([c.Test()],t.prototype,"magicAttachTest",null),r([c.Test()],t.prototype,"magicAttachTest2",null),r([c.Test()],t.prototype,"lifeStolenTest",null),r([c.TestSuite()],t)}();o.WdItemTest=f,cc._RF.pop()},{"../../../../../common/bean/BeanContainer":"BeanContainer","../../../../../common/bean/Decorators":"Decorators","../../../../../rule/RuleService":"RuleService","../../../../../rule/model/Model":"Model","../../../common/WdUtil":"WdUtil","../WdItemDAO":"WdItemDAO","../WdItemService":"WdItemService",testyts:16}],WdItemDAO:[function(t,e,o){"use strict";cc._RF.push(e,"de768wziWNG0rLDFVE/DXN2","WdItemDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdItemDAO=o.WdItemMagic=void 0;var r=t("../../../../rule/model/Model"),n=function(){function t(){this.code=0,this.dna=0}return t.build=function(e,o){var r=new t;return r.code=e,r.dna=o,r},t}();o.WdItemMagic=n;var i=function(){function t(){this.no=0,this.code=0,this.dna=0,this.level=0,this.category=r.WdItemCategory.None,this.magics=new Array}return t.prototype.getPk=function(){return this.no},t}();o.WdItemDAO=i,cc._RF.pop()},{"../../../../rule/model/Model":"Model"}],WdItemService:[function(t,e,o){"use strict";cc._RF.push(e,"19ecbwp315BorOSRjANEw1X","WdItemService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdItemService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdItemDAO"),c=t("../../../../rule/model/Model"),a=t("../../common/WdRandom"),s=t("../unit/WdStat"),l=t("../../common/WdUtil"),u=t("../../common/WdRandomUtil"),p=function(){function t(){this.items=new Map,this.no=1}return t.prototype.addDropItem=function(t){var e=new i.WdItemDAO;e.no=this.no++,e.category=t.category,e.code=t.code,e.dna=t.dna,e.magics=t.magics,e.level=t.level,this.items.set(e.no,e),this.worldService.getEventBus().onItemNew.fire(e)},t.prototype.addItem=function(t,e,o,r){var n=new i.WdItemDAO;return n.no=this.no++,n.category=t,n.code=e,n.dna=r,n.level=o,t==c.WdItemCategory.Magic?this.addRandomMagics(n,a.WdRandom.getRangeInt(1,3)):t==c.WdItemCategory.Rare&&this.addRandomMagics(n,a.WdRandom.getRangeInt(2,7)),this.items.set(n.no,n),this.worldService.getEventBus().onItemNew.fire(n),n},t.prototype.deleteItem=function(t){var e=this.items.get(t);e&&(this.worldService.getEventBus().onItemDeleted.fire(e),this.items.delete(t))},t.prototype.get=function(t){return this.items.get(t)},t.prototype.getAll=function(){return Array.from(this.items.values())},t.prototype.getItems=function(t){var e=this,o=new Array;return this.items.forEach(function(r){e.ruleService.items.get(r.code).type==t&&o.push(r)}),o},t.prototype.removeOverflow=function(t,e){var o=this.getAll();if(!(o.length<t)){o.sort(function(t,e){return t.no-e.no});var r=new Array;o.forEach(function(t){e.has(t.no)||r.push(t)});var n=r.length-t;if(!(n<=0))for(var i=0;i<n;i++)this.deleteItem(r[i].getPk())}},t.prototype.onReadyDungeon=function(){this.items.clear(),this.no=1},t.prototype.onStartArea=function(){},t.prototype.isMagicAttack=function(t){return t==c.WdStatType.FireAttack||t==c.WdStatType.ColdAttack||t==c.WdStatType.LightningAttack||t==c.WdStatType.PoisonAttack},t.prototype.calculateStats=function(t){var e=this,o=new Array,r=this.getBaseStat(t);null!=r&&o.push(r),t.magics.forEach(function(t){var n=e.getMagicStat(t);if(e.isMagicAttack(n.type)){if(null==r)return void console.error("can not attack magic stat to the no-base-stated item");n.minV=r.minV*n.minV,n.maxV=r.maxV*n.maxV}o.push(n)});var n=1;return o.forEach(function(t){t.type==c.WdStatType.ItemAttackBoost&&(n+=t.minV)}),n>1&&null!=r&&r.type==c.WdStatType.PhysicalAttack&&(r.minV=r.minV*n,r.maxV=r.maxV*n,r.magic==c.WdStatMagicType.None&&(r.magic=c.WdStatMagicType.MagicBoosted)),o},t.prototype.isWeapons=function(t){return t==c.WdItemType.Axe||t==c.WdItemType.Sword||t==c.WdItemType.Staff||t==c.WdItemType.Bow},t.prototype.isArmors=function(t){return t==c.WdItemType.Armor||t==c.WdItemType.Helmet||t==c.WdItemType.Boots||t==c.WdItemType.Gloves||t==c.WdItemType.Shield},t.prototype.getBaseStat=function(t){var e=this.ruleService.items.get(t.code),o=1+this.ruleService.itemLevels.get(t.level).boost;if(this.isArmors(e.type)){var r,n=l.WdUtil.lerp(e.v1,e.v2,t.dna/100);return(r=new s.WdStat).type=c.WdStatType.Defense,r.minV=n*o,r.maxV=n*o,r}return this.isWeapons(e.type)?((r=new s.WdStat).type=c.WdStatType.PhysicalAttack,r.minV=l.WdUtil.lerp(e.v1,e.v2,t.dna/100)*o,r.maxV=l.WdUtil.lerp(e.v3,e.v4,t.dna/100)*o,0==r.maxV&&(r.maxV=r.minV),r):null},t.prototype.getMagicStat=function(t){var e=this.ruleService.itemMagics.get(t.code),o=new s.WdStat;return o.type=e.statType,o.minV=l.WdUtil.lerp(e.v1,e.v2,t.dna/100),o.maxV=l.WdUtil.lerp(e.v3,e.v4,t.dna/100),o.magic=c.WdStatMagicType.Magic,o.cc=e.cc,0==o.maxV&&(o.maxV=o.minV),o},t.prototype.addRandomMagics=function(t,e){var o=this,r=this.ruleService.items.get(t.code),n=new Array;this.ruleService.itemMagics.forEach(function(t){o.canBeAttached(t,r)&&n.push(t)}),u.WdRandomUtil.shuffle(n);for(var i=function(){if(0==n.length)return"break";var e=n[0];c.addMagic(t,e);var o=n[0].statType,r=new Array;n.forEach(function(t){t.statType!=o&&r.push(t)}),n=r},c=this,a=0;a<e&&"break"!==i();a++);},t.prototype.addMagic=function(t,e){var o=new i.WdItemMagic;o.code=e.code,o.dna=a.WdRandom.getRangeInt(0,100),t.magics.push(o)},t.prototype.canBeAttached=function(t,e){return t.targets.has(e.type)},t.prototype.getTargetSlots=function(t){var e=new Array;return this.isWeapons(t)?(e.push(c.WdEquipSlotType.Weapon),e):t==c.WdItemType.Amulet?(e.push(c.WdEquipSlotType.Amulet),e):t==c.WdItemType.Helmet?(e.push(c.WdEquipSlotType.Helmet),e):t==c.WdItemType.Gloves?(e.push(c.WdEquipSlotType.Gloves),e):t==c.WdItemType.Armor?(e.push(c.WdEquipSlotType.Armor),e):t==c.WdItemType.Boots?(e.push(c.WdEquipSlotType.Boots),e):t==c.WdItemType.Shield?(e.push(c.WdEquipSlotType.Shield),e):t==c.WdItemType.Ring?(e.push(c.WdEquipSlotType.Ring1),e.push(c.WdEquipSlotType.Ring2),e):e},t.readyTest=function(){},r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.service("WdItemService")],t)}();o.WdItemService=p,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdRandom":"WdRandom","../../common/WdRandomUtil":"WdRandomUtil","../../common/WdUtil":"WdUtil","../unit/WdStat":"WdStat","./WdItemDAO":"WdItemDAO"}],WdMaterialDAO:[function(t,e,o){"use strict";cc._RF.push(e,"1e7b7lwLIJGfoz7Ut+xWH0F","WdMaterialDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdMaterialDAO=void 0;var r=function(){function t(){}return t.prototype.getPk=function(){return this.code},t.build=function(e,o){var r=new t;return r.code=e,r.amount=o,r},t}();o.WdMaterialDAO=r,cc._RF.pop()},{}],WdMaterialService:[function(t,e,o){"use strict";cc._RF.push(e,"99c7aGRAvNGiag2ajx+WkDK","WdMaterialService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdMaterialService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdMaterialDAO"),c=function(){function t(){this.materials=new Map,this.no=1}return t.prototype.onReadyDungeon=function(){this.materials.clear(),this.no=1},t.prototype.onStartArea=function(){},t.prototype.addToBag=function(t,e){var o=this.materials.get(t);o?o.amount+=e:(o=i.WdMaterialDAO.build(t,e),this.materials.set(t,o))},t.prototype.addToChest=function(t,e){var o=this.chestRepository.read(t);o?o.amount+=e:(o=i.WdMaterialDAO.build(t,e),this.chestRepository.create(o)),this.chestRepository.dirty=!0},t.prototype.hasEnough=function(t){for(var e=0,o=t;e<o.length;e++){var r=o[e],n=this.chestRepository.read(r.code);if(null==n||n.amount<r.amount)return!1}return!0},t.prototype.reduceMaterialAtChest=function(t){var e=this;return!!this.hasEnough(t)&&(t.forEach(function(t){var o=e.chestRepository.read(t.code);o.amount-=t.amount,0==o.amount&&e.chestRepository.delete(o.code)}),this.chestRepository.dirty=!0,this.worldService.getEventBus().onMaterialUpdate.fire(),!0)},t.prototype.getBagAll=function(){return Array.from(this.materials.values())},t.prototype.getChestAll=function(){return this.chestRepository.readAll()},t.prototype.getAtChest=function(t){return this.chestRepository.read(t)},r([n.autoWired("WdChestMaterialRepository")],t.prototype,"chestRepository",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdMaterialService")],t)}();o.WdMaterialService=c,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","./WdMaterialDAO":"WdMaterialDAO"}],WdObjectActor:[function(t,e,o){"use strict";cc._RF.push(e,"6b0e3hBNUFHNJuOaR77nWsu","WdObjectActor");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdObjectActor=void 0;var c=t("../unit/WdUnitActor"),a=t("../../core/common/WdVec"),s=t("../../core/object/unit/WdUnit"),l=cc._decorator.ccclass,u=cc._decorator.property,p=t("../../core/object/unit/WdUnitState"),d=t("../unit/ccEffect/WdCcEffectPresenter"),h=t("../../../common/bean/Decorators"),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor_=null,e.obj_=null,e.nextAnim=p.WdUnitState.None,e.ccPresenter=null,e.ccDirty=!1,e.walkTarget=a.WdVec.zero,e.onAnimEvent=function(){},e}return n(e,t),Object.defineProperty(e.prototype,"anchor",{get:function(){return this.anchor_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this.obj_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){return this.obj_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this.getPos()},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.ccPresenter=new d.WdCcEffectPresenter},e.prototype.onGoingIntoPool=function(){t.prototype.onGoingIntoPool.call(this),this.goPooler.returnGo(this.core),this.core.onAnimEventFired.removeHandler(this.onAnimEvent),this.side=s.WdUnitFaceSide.None,this.nextAnim=p.WdUnitState.None,this.obj.getWs().eventBus.onObjectActorReturn.fire(this.obj),this.obj.removeActor(),this.ccPresenter.clear(),this.damageRoutine=null},e.prototype.boot=function(t,e){this.obj_=t,this.core_=e,this.ccDirty=!0,this.setBaseColor(cc.Color.WHITE),this.setBaseTint(cc.Color.BLACK),this.setBaseAnimSpeed(1),this.onSetPosition(t.getPos()),this.core.node.setPosition(cc.Vec2.ZERO),this.core.onAnimEventFired.addHandler(this.onAnimEvent),this.core.boot(t),this.obj.setActor(this),this.node.name="Object"+this.obj.getCode()+"-"+this.obj.getNo()},e.prototype.onSetPosition=function(t){this.node.setPosition(cc.v2(t.x,t.y))},e.prototype.onHit=function(t){this.playDamageEffect(),this.worldService.presenters.mainCam.playShakePreset(t.shake)},e.prototype.onDead=function(){this.clear()},e.prototype.clear=function(){var t=this,e=this.core.getAnimLen(p.WdUnitState.Death);this.scheduleOnce(function(){return t.goPooler.returnGo(t)},e+.3),this.core.onDead()},e.prototype.playAction=function(){},e.prototype.playActions=function(){},e.prototype.stopAction=function(){},e.prototype.onChangeState=function(t,e){this.nextAnim=e},e.prototype.update=function(e){t.prototype.update.call(this,e),this.nextAnim!=p.WdUnitState.None&&(this.core.setAnimation(this.nextAnim),this.nextAnim=p.WdUnitState.None)},e.prototype.getPos=function(){var t=this.node.getPosition();return new a.WdVec(t.x,t.y)},e.prototype.onTouch=function(t){this.obj.isDead()||this.core.onTouch(t)},i([u(cc.Node)],e.prototype,"anchor_",void 0),i([h.autoWired("WorldService")],e.prototype,"worldService",void 0),i([h.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l],e)}(c.WdUnitActor);o.WdObjectActor=f,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../core/common/WdVec":"WdVec","../../core/object/unit/WdUnit":"WdUnit","../../core/object/unit/WdUnitState":"WdUnitState","../unit/WdUnitActor":"WdUnitActor","../unit/ccEffect/WdCcEffectPresenter":"WdCcEffectPresenter"}],WdObjectDAO:[function(t,e,o){"use strict";cc._RF.push(e,"1c0e4B313xM/Lhmfmo8hsXk","WdObjectDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdObjectDAO=void 0;var r=t("../../common/WdVec"),n=function(){function t(){this.no=0,this.area=null,this.code=0,this.pos=r.WdVec.zero,this.hp=0}return t.prototype.getPk=function(){return this.no},t.prototype.getIndex1=function(){return this.area.getCode()},t}();o.WdObjectDAO=n,cc._RF.pop()},{"../../common/WdVec":"WdVec"}],WdObjectFactory:[function(t,e,o){"use strict";cc._RF.push(e,"e8c5ds/yqlDp7o6A/s9KE/6","WdObjectFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdObjectFactory=void 0;var c=cc._decorator.ccclass,a=t("./WdObjectActor"),s=cc._decorator.property,l=t("../unit/WdUnitActorCore"),u=t("../../../common/bean/Decorators"),p=t("../area/WdAreaPresenter"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.object_=null,e.cores=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.children.forEach(function(e){var o=e.getComponent(l.WdUnitActorCore);o&&t.cores.set(o.code,o)})},e.prototype.newCore=function(t,e){var o=this.cores.get(t);return o?this.goPooler.fromPrefab(o,e):(console.error("Object "+t+" is not ready yet"),null)},e.prototype.generate=function(t){var e=this.worldService.presenters.areaPresenter.getUnitBucket(p.WdBucketLevel.Normal),o=this.goPooler.fromPrefab(this.object_,e),r=this.newCore(t.getCode(),o.anchor);return o.boot(t,r),o},i([s(a.WdObjectActor)],e.prototype,"object_",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdObjectFactory=d,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../area/WdAreaPresenter":"WdAreaPresenter","../unit/WdUnitActorCore":"WdUnitActorCore","./WdObjectActor":"WdObjectActor"}],WdObjectPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"2d6ad4GoeNMVIUMy2cO0MeK","WdObjectPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdObjectPresenter=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/bean/Decorators"),l=t("./WdObjectFactory"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.factory=null,e.actors=new Map,e.onAreaTearDown=function(){e.actors.forEach(function(t){e.goPooler.returnGo(t)}),e.actors.clear()},e.onAreaStart=function(){e.playAll()},e.onObjectBorn=function(t){e.playObject(t)},e.onObjectActorReturn=function(t){e.actors.delete(t.getKey().pack())},e}return n(e,t),e.prototype.boot=function(t){this.world=t,this.playAll(),t.eventBus.onObjectBorn.addHandler(this.onObjectBorn),t.eventBus.onObjectActorReturn.addHandler(this.onObjectActorReturn),t.eventBus.onAreaTearDown.addHandler(this.onAreaTearDown),t.eventBus.onAreaStart.addHandler(this.onAreaStart)},e.prototype.playAll=function(){var t=this;this.world.area.objects.forEach(function(e){t.playObject(e)})},e.prototype.playObject=function(t){var e=this.factory.generate(t);null!=e&&this.actors.set(t.getKey().pack(),e)},i([a(l.WdObjectFactory)],e.prototype,"factory",void 0),i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([s.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WdObjectPresenter=u,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WdObjectFactory":"WdObjectFactory"}],WdObjectService:[function(t,e,o){"use strict";cc._RF.push(e,"57b4aaaYWhFAbz6Ygy8Zp2q","WdObjectService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdObjectService=void 0;var n=t("../../../../common/bean/Decorators"),i=t("./WdObjectDAO"),c=function(){function t(){this.objects=new Map,this.no=1}return t.prototype.getObjects=function(){return Array.from(this.objects.values())},t.prototype.onReadyDungeon=function(){this.objects.clear(),this.no=1},t.prototype.onStartArea=function(){this.onReadyDungeon()},t.prototype.newObject=function(t,e,o){var r=new i.WdObjectDAO;return r.no=this.no++,r.area=t.clone(),r.code=e,r.pos=o.clone(),r.hp=100,this.objects.set(r.no,r),r},t.prototype.delete=function(t){this.objects.delete(t)},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdObjectService")],t)}();o.WdObjectService=c,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","./WdObjectDAO":"WdObjectDAO"}],WdObject:[function(t,e,o){"use strict";cc._RF.push(e,"4b749r0FvFIk6n2M+y+gH+A","WdObject");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdObject=void 0;var n=t("../../common/WdVec"),i=t("../unit/WdUnitKey"),c=t("../unit/WdUnitState"),a=t("../../../../common/bean/Decorators"),s=function(){function t(t){this.dao=t,this.hp=1}return t.prototype.getType=function(){return i.WdUnitType.Object},t.prototype.getState=function(){return this.state},t.prototype.getCore=function(){return this.actor.core},t.prototype.getStats=function(){return null},t.prototype.getKey=function(){return new i.WdUnitKey(this.getType(),this.getNo())},t.prototype.getWs=function(){return this.ws},t.prototype.getNo=function(){return this.dao.no},t.prototype.getCode=function(){return this.dao.code},t.prototype.getPos=function(){return this.dao.pos},t.prototype.getGatePos=function(){return this.getPos()},t.prototype.getSize=function(){return n.WdVec.one},t.prototype.getDirection=function(){return this.direction},t.prototype.getCamFocusPos=function(){return this.getPos()},t.prototype.getTalkBoxPos=function(){return this.actor.core.balloonAnchor},t.prototype.getHpRate=function(){return this.hp},t.prototype.getRadius=function(){return.5},t.prototype.getRule=function(){return this.rule},t.prototype.getDao=function(){return this.dao},t.prototype.boot=function(t){this.state=c.WdUnitState.Idle,this.rule=this.ruleService.objects.get(this.getCode()),this.ws=t},t.prototype.setActor=function(t){this.actor=t},t.prototype.removeActor=function(){this.actor=null},t.prototype.isDead=function(){return this.hp<=0},t.prototype.setState=function(t){var e=this.state;e!=t&&(this.isDead()&&t!=c.WdUnitState.Death||(this.state=t,this.actor.onChangeState(e,t)))},t.prototype.onTick=function(){},t.prototype.kill=function(){this.hp=0,this.setState(c.WdUnitState.Death),this.actor.onDead()},t.prototype.setPosition=function(t){this.dao.pos=t.clone(),this.actor.onSetPosition(t.clone())},t.prototype.setFaceSide=function(){},t.prototype.makeWalkAction=function(){},t.prototype.onTarget=function(t){this.actor.onTouch(t)},t.prototype.playAction=function(){},t.prototype.playActions=function(){},t.prototype.lookAt=function(){},t.prototype.walkTo=function(){},t.prototype.getName=function(){return""},r([a.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdObject=s,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../common/WdVec":"WdVec","../unit/WdUnitKey":"WdUnitKey","../unit/WdUnitState":"WdUnitState"}],WdPlayerDAO:[function(t,e,o){"use strict";cc._RF.push(e,"a6a87umr0hKP7CB268xtxIf","WdPlayerDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdPlayerDAO=void 0;var r=function(){function t(){this.no=0,this.exp=0,this.level=0,this.remainUnlockPoint=1,this.pickaxeLevel=1,this.battleCount=0,this.levelCount=0,this.bestScore=0,this.leaves=0,this.artifacts=new Array,this.unlocked=new Array,this.subscribeBot=!1,this.bookmark=!1,this.unlockedSet=new Set}return t.prototype.ready=function(){var t=this;this.unlockedSet=new Set,this.unlocked.forEach(function(e){t.unlockedSet.add(e)})},t.prototype.getPk=function(){return this.no},t.prototype.isUnlocked=function(t){return this.unlockedSet.has(t)},t.prototype.addUnlocked=function(t){this.unlockedSet.has(t)?console.error("already unlocked"):(this.unlocked.push(t),this.unlockedSet.add(t))},t.prototype.onDeserialized=function(){var t=this;this.unlocked.forEach(function(e){return t.unlockedSet.add(e)})},t}();o.WdPlayerDAO=r,cc._RF.pop()},{}],WdPlayerRepository:[function(t,e,o){"use strict";cc._RF.push(e,"77878KQzJ5Foo8CJIEoHK4a","WdPlayerRepository");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdPlayerRepository=void 0;var c=t("../../../common/bean/Decorators"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([c.repository("WdPlayerRepository")],e)}(t("../../../common/repository/Repository1").Repository1);o.WdPlayerRepository=a,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/repository/Repository1":"Repository1"}],WdPlayerService:[function(t,e,o){"use strict";cc._RF.push(e,"7785aQ3EqNAQKGcyjQDnjjA","WdPlayerService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdPlayerService=void 0;var n=t("../../../common/bean/Decorators"),i=t("./WdPlayerDAO"),c=function(){function t(){}return t.prototype.getPlayer=function(){return this.repository.read(1)},t.prototype.unlock=function(t){var e,o,r=this.getPlayer();if(r.remainUnlockPoint<=0)console.error("no remain unlock count");else{r.addUnlocked(t.no),r.remainUnlockPoint--;var n=this.worldService.getEventBus();null===(e=n.onUnlockPointUpdate)||void 0===e||e.fire(),null===(o=n.onUnlock)||void 0===o||o.fire(t.no),this.repository.dirty=!0}},t.prototype.reqPickaxeLevelUp=function(){return!0},t.prototype.getRemainSlot=function(t){var e=this,o=new Set;this.getPlayer().artifacts.forEach(function(r){e.ruleService.artifacts.get(r).category==t&&o.add(r)});var r=this.artifactService.getSlotCount(t);return Math.max(0,r-o.size)},t.prototype.equipArtifact=function(t){var e=this;if(this.artifactService.getArtifact(t)){var o=this.ruleService.artifacts.get(t),r=this.getPlayer(),n=new Set;r.artifacts.forEach(function(t){e.ruleService.artifacts.get(t).category==o.category&&n.add(t)}),n.has(t)?console.error("already attached "+t):n.size>=5?console.error("no empty place "+t):(r.artifacts.push(t),this.worldService.getEventBus().onEquipArtifact.fire(t),this.repository.dirty=!0)}else console.error("no artifact "+t)},t.prototype.detachArtifact=function(t){var e=this.getPlayer(),o=e.artifacts.indexOf(t);o>=0&&e.artifacts.splice(o,1),this.worldService.getEventBus().onDetachArtifact.fire(t),this.repository.dirty=!0},t.prototype.newPlayer=function(){var t=new i.WdPlayerDAO;t.no=1,t.pickaxeLevel=1,t.level=1,t.exp=0,this.repository.create(t)},t.prototype.refreshPlayerExp=function(){for(var t=this.getPlayer(),e=this.ruleService.playerExp,o=t.level+1;o<this.ruleService.maxPlayerLevel;o++){var r=e.get(o);t.exp>r.exp&&(t.level++,t.remainUnlockPoint++)}},t.prototype.subscribeBot=function(){this.getPlayer().subscribeBot=!0,this.repository.dirty=!0},t.prototype.bookmark=function(){this.getPlayer().bookmark=!0,this.repository.dirty=!0},r([n.autoWired("WdPlayerRepository")],t.prototype,"repository",void 0),r([n.autoWired("WdArtifactService")],t.prototype,"artifactService",void 0),r([n.autoWired("WdMaterialService")],t.prototype,"materialService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.service("WdPlayerService")],t)}();o.WdPlayerService=c,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WdPlayerDAO":"WdPlayerDAO"}],WdPotion:[function(t,e,o){"use strict";cc._RF.push(e,"a03143uh29LIKEnj+0nzpp5","WdPotion"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdPotion=void 0;o.WdPotion=function(){this.no=0,this.code=0,this.hp=0},cc._RF.pop()},{}],WdProjectileAgency:[function(t,e,o){"use strict";cc._RF.push(e,"7de0eV5h6BAO4Iwn2GJBH9v","WdProjectileAgency");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdProjectileAgency=void 0;var c=cc._decorator.ccclass,a=t("../../core/object/unit/WdUnitKey"),s=cc._decorator.property,l=t("../../../common/bean/Decorators"),u=t("./WdProjectile"),p=t("../../../App"),d=t("./WdProjectileGuide"),h=t("../area/WdAreaPresenter"),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.unitType_=a.WdUnitType.None,e.guidePrefab_=null,e.projectiles=new Map,e}return n(e,t),Object.defineProperty(e.prototype,"unitType",{get:function(){return this.unitType_},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;p.app.ready&&this.node.children.forEach(function(e){var o=e.getComponent(u.WdProjectile);null!=o&&t.projectiles.set(o.code,o)})},e.prototype.getSkill=function(t,e){return void 0===e&&(e=h.WdBucketLevel.Normal),this.get(1e4+t,e)},e.prototype.get=function(t,e){void 0===e&&(e=h.WdBucketLevel.Normal);var o=this.worldService.presenters.areaPresenter.getUnitBucket(e),r=this.projectiles.get(t);return r?this.goPooler.fromPrefab(r,o):(r=this.projectiles.get(0))?this.goPooler.fromPrefab(r,o):(console.error("No projectile for code:"+t),null)},e.prototype.getGuide=function(){var t=this.worldService.presenters.areaPresenter.getUnitBucket(h.WdBucketLevel.Overlay);return this.goPooler.fromPrefab(this.guidePrefab_,t)},i([s({type:cc.Enum(a.WdUnitType)})],e.prototype,"unitType_",void 0),i([s(d.WdProjectileGuide)],e.prototype,"guidePrefab_",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([c],e)}(cc.Component);o.WdProjectileAgency=f,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","../../core/object/unit/WdUnitKey":"WdUnitKey","../area/WdAreaPresenter":"WdAreaPresenter","./WdProjectile":"WdProjectile","./WdProjectileGuide":"WdProjectileGuide"}],WdProjectileGuide:[function(t,e,o){"use strict";cc._RF.push(e,"fceec6+HX5P8oI9LGBj5Z20","WdProjectileGuide");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdProjectileGuide=void 0;var c=t("../../../common/util/GoItem"),a=t("../../../common/bean/Decorators"),s=t("../../core/common/WdVec"),l=cc._decorator.property,u=t("../../../common/coroutine/EaseRoutine"),p=cc._decorator.ccclass,d=t("../../core/common/WdUtil"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.line=null,e.anchor=null,e}return n(e,t),e.prototype.onGoingIntoPool=function(){this.owner=null,this.target=null},e.prototype.play=function(t,e,o,r){this.owner=t,this.target=e,this.guideSec=o,this.onUpdateGuide=r,this.node.active=!0,this.fire()},e.prototype.update=function(e){t.prototype.update.call(this,e),null!=this.owner&&null!=this.owner.getCore()&&this.arrange()},e.prototype.canTrace=function(){if(null==this.owner||null==this.target)return!1;if(null==this.owner.getCore()||null==this.target.getCore())return!1;var t=this.worldService.world.area.getUnit(this.owner.getKey()),e=this.worldService.world.area.getUnit(this.target.getKey());return null==t||null==e},e.prototype.arrange=function(){if(!this.canTrace()&&null!=this.owner&&null!=this.owner.getCore()&&null!=this.target&&null!=this.target.getCore()){var t=this.owner.getCore().prjAnchor,e=this.target.getCore().bodyAnchor;this.owner.lookAt(new s.WdVec(e.x,e.y)),this.onUpdateGuide(e),this.node.setPosition(cc.v2(t.x,t.y));var o=e.subtract(t);o=o.normalize();var r=Math.atan2(o.y,o.x)*d.WdUtil.rad2Deg;this.anchor.angle=r-90}},e.prototype.fire=function(){var t=this;this.line.opacity=0,this.playRoutine=this.startRoutine().opacity(this.line,u.EaseType.easeOutQuad,.1,255).wait(this.guideSec-.2).opacity(this.line,u.EaseType.easeOutQuad,.1,0).do(function(){t.goPooler.returnGo(t)})},i([l(cc.Node)],e.prototype,"line",void 0),i([l(cc.Node)],e.prototype,"anchor",void 0),i([a.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([p],e)}(c.default);o.WdProjectileGuide=h,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../../common/util/GoItem":"GoItem","../../core/common/WdUtil":"WdUtil","../../core/common/WdVec":"WdVec"}],WdProjectileHitArea:[function(t,e,o){"use strict";cc._RF.push(e,"f7261v3KnFN4KUywcptm7TA","WdProjectileHitArea");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./WdProjectile"),a=cc._decorator.property,s=cc._decorator.ccclass,l=t("../../../common/bean/Decorators"),u=t("../../core/object/unit/WdAttackCalculator"),p=t("../../core/common/WdVec"),d=t("../../../rule/model/Model"),h=t("../../core/object/unit/WdUnitKey"),f=t("../unit/WdUnitActorCore"),y=t("../effect/WdPxEffect"),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fireAt=.5,e.radarDuration=.5,e.prjEffect=null,e.hitEffects=[],e.coll=null,e.onCollisionEnter=function(t){var o=t.getComponent(f.WdUnitActorCore);null!=o&&o.unit.getType()==e.target&&e.hit(o.unit)},e}return n(e,t),e.prototype.onLoad=function(){this.coll=this.getComponent(cc.CircleCollider),this.coll.enabled=!1},e.prototype.onGoingIntoPool=function(){this.coll.enabled=!1,this.traceTarget=null},e.prototype.setTraceTarget=function(t){this.traceTarget=t,this.node.setPosition(this.getTraceTargetPosition())},e.prototype.getTraceTargetPosition=function(){return this.traceTarget.convertToWorldSpaceAR(cc.Vec2.ZERO)},e.prototype.update=function(e){t.prototype.update.call(this,e),null!=this.traceTarget&&this.node.setPosition(this.getTraceTargetPosition())},e.prototype.fire=function(t,e,o,r){var n=this;if(this.owner=t,this.attack=e,this.calculator=new u.WdAttackCalculator(t),this.node.setPosition(cc.v2(r.x,r.y)),this.soundService.playFx(this.fireSound),null!=this.prjEffect){var i=this.goPooler.fromPrefab(this.prjEffect,this.node);i.node.setPosition(cc.v2(0,0)),i.play()}this.startRoutine().wait(this.fireAt).do(function(){n.soundService.playFx(n.hitSound),e.shake!=d.WdCamShake.None&&n.worldService.presenters.mainCam.playShakePreset(e.shake),n.hitEffects.forEach(function(t){var e=n.goPooler.fromPrefab(t,n.node.parent);e.node.setPosition(cc.v2(r.x,r.y)),e.play()}),n.coll.enabled=!0,n.node.setPosition(n.node.getPosition().add(cc.v2(0,.05))),n.startRoutine().wait(n.radarDuration).do(function(){n.goPooler.returnGo(n)})})},e.prototype.hit=function(t){var e=this.node.getPosition(),o=new p.WdVec(e.x,e.y);if(this.owner.getType()==h.WdUnitType.Enemy&&t.getType()==h.WdUnitType.Hero){var r=this.owner,n=t,i=this.calculator.makeDamagesFrom(this.attack,t,o);r.attack(n,i)}else this.owner.getType()==h.WdUnitType.Hero&&(n=this.owner,r=t,i=this.calculator.makeDamagesFrom(this.attack,t,o),n.attack(r,i))},i([a(cc.Float)],e.prototype,"fireAt",void 0),i([a(cc.Float)],e.prototype,"radarDuration",void 0),i([a(y.WdPxEffect)],e.prototype,"prjEffect",void 0),i([a(y.WdPxEffect)],e.prototype,"hitEffects",void 0),i([l.autoWired("SoundService")],e.prototype,"soundService",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([s],e)}(c.WdProjectile);o.default=v,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","../../core/common/WdVec":"WdVec","../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../core/object/unit/WdUnitKey":"WdUnitKey","../effect/WdPxEffect":"WdPxEffect","../unit/WdUnitActorCore":"WdUnitActorCore","./WdProjectile":"WdProjectile"}],WdProjectileLine:[function(t,e,o){"use strict";cc._RF.push(e,"d439e3ktrBMnoxvbuwYhAGc","WdProjectileLine");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdProjectileLine=void 0;var c=t("./WdProjectile"),a=cc._decorator.ccclass,s=cc._decorator.property,l=t("../effect/WdPxEffectAnimator"),u=t("../../../common/bean/Decorators"),p=t("../../core/object/unit/WdAttackCalculator"),d=t("../../core/common/WdVec"),h=t("../../core/object/unit/WdUnitKey"),f=t("../unit/WdUnitRadar"),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=12,e.anchor=null,e.hitEffect=null,e.forwardRotate=!1,e.rotationTargets=[],e.visited=new Set,e.playTime=0,e.onCollisionEnter=function(t){var o=e.getHitUnit(t);o&&e.attackTarget(o)},e}return n(e,t),e.prototype.onLoad=function(){this.radar=this.getComponentInChildren(f.WdUnitRadar)},e.prototype.fire=function(t,e,o,r){if(this.owner=t,this.attack=e,this.heart=e.ricochet,this.calculator=new p.WdAttackCalculator(t),this.node.active=!0,this.visited.clear(),this.direction=r.subtract(o).normalize(),this.playTime=0,this.node.setPosition(cc.v2(o.x,o.y)),this.forwardRotate){var n=Math.atan2(this.direction.x,this.direction.y);this.rotationTargets.forEach(function(t){t.angle=180*-n/Math.PI})}this.fireSound&&this.fireSound.length>0&&this.soundService.playFx(this.fireSound),this.radar.boot()},e.prototype.attackTarget=function(t){var e=this;if(!(this.heart<=0)||this.attack.piercing){if(null!=t&&(this.hitSound&&this.hitSound.length>0&&this.soundService.playFx(this.hitSound),this.hit(t)),this.hitEffect){var o=this.goPooler.fromPrefab(this.hitEffect,this.node.parent),r=this.core_.convertToWorldSpaceAR(cc.Vec2.ZERO);o.node.setPosition(r),o.play()}(null==t||!this.attack.piercing&&this.heart<=0)&&this.scheduleOnce(function(){e.goPooler.returnGo(e)},.05)}},e.prototype.hit=function(t){var e=this.node.getPosition().subtract(cc.v2(this.direction.x,this.direction.y).mul(5)),o=new d.WdVec(e.x,e.y);if(this.owner.getType()==h.WdUnitType.Enemy&&t.getType()==h.WdUnitType.Hero){var r=this.calculator.makeDamagesFrom(this.attack,t,o),n=t;(i=this.owner).attack(n,r)}else if(this.owner.getType()==h.WdUnitType.Hero){r=this.calculator.makeDamagesFrom(this.attack,t,o);var i=t;(n=this.owner).attack(i,r)}this.heart--,this.visited.add(t.getKey().pack());var c=this.node.getPosition();this.heart>0?this.moveToNext(new d.WdVec(c.x,c.y),t):this.attack.attackBoost*=1-this.attack.piercingReduce},e.prototype.moveToNext=function(t,e){if(this.radar){for(var o=null,r=9999999,n=0,i=Array.from(this.radar.enemies.values());n<i.length;n++){var c=i[n];if(!c.isDead()&&c.getKey().pack()!==e.getKey().pack()&&!this.visited.has(c.getKey().pack())){var a=c.getPos().subtract(t).len2();a<r&&(r=a,o=c)}}null!=o?(this.direction=o.getPos().subtract(t).normalize(),this.attack.attackBoost*=1-this.attack.ricochetReduce):this.heart=0}else console.error("need radar for the ricochets")},e.prototype.update=function(t){this.playTime>this.life_&&this.goPooler.returnGo(this);var e=this.node.getPosition(),o=new d.WdVec(e.x,e.y);o=o.add(this.direction.scalar(t*this.speed*80)),this.node.setPosition(cc.v2(o.x,o.y)),this.playTime+=t},i([s(cc.Float)],e.prototype,"speed",void 0),i([s(cc.Node)],e.prototype,"anchor",void 0),i([s(l.WdPxEffectAnimator)],e.prototype,"hitEffect",void 0),i([s(cc.Boolean)],e.prototype,"forwardRotate",void 0),i([s(cc.Node)],e.prototype,"rotationTargets",void 0),i([u.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u.autoWired("SoundService")],e.prototype,"soundService",void 0),i([a()],e)}(c.WdProjectile);o.WdProjectileLine=y,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../core/common/WdVec":"WdVec","../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../core/object/unit/WdUnitKey":"WdUnitKey","../effect/WdPxEffectAnimator":"WdPxEffectAnimator","../unit/WdUnitRadar":"WdUnitRadar","./WdProjectile":"WdProjectile"}],WdProjectileMine:[function(t,e,o){"use strict";cc._RF.push(e,"a330fsDVOxHNKthqUEb64Il","WdProjectileMine");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../common/bean/Decorators"),a=cc._decorator.ccclass,s=cc._decorator.property,l=t("../effect/WdPxEffect"),u=t("../../core/object/unit/WdAttackCalculator"),p=t("../../core/object/unit/WdUnitKey"),d=t("../effect/WdEffectType"),h=t("../../../common/coroutine/EaseRoutine"),f=t("../../core/common/WdVec"),y=t("../unit/WdUnitActorCore"),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speed=6,e.animator=null,e.hitEffect=null,e.coll=null,e.invincible=new Map,e.interval=.5,e.expired=!1,e.baseRadius=0,e.ready=!1,e.animations=new Map,e.animLengths=new Map,e.totalDuration=0,e.onCollisionEnter=function(t){var o=t.getComponent(y.WdUnitActorCore);null!=o&&o.unit.getType()==e.target&&e.fireAttack(o.unit)},e}return n(e,t),e.prototype.onLoad=function(){this.coll=this.getComponent(cc.CircleCollider),this.coll.enabled=!1,this.baseRadius=this.coll.radius},e.prototype.onGoingIntoPool=function(){this.coll.enabled=!1,this.coll.radius=this.baseRadius,this.invincible.clear()},e.prototype.playAnim=function(t,e){var o=this.animations.get(t);this.animator.play(o,0),null!=e&&this.startRoutine().wait(this.animLengths.get(t),e)},e.prototype.fire=function(t,e,o,r){var n=this;this.readyAnim(),this.owner=t,this.attack=e,this.calculator=new u.WdAttackCalculator(t),this.coll.enabled=!0;var i=r.subtract(o).len();this.playAnim(d.WdPixelAnimState.Birth,function(){n.playAnim(d.WdPixelAnimState.Play,null)}),this.node.setPosition(cc.v2(o.x,o.y)),this.startRoutine().move(this.node,h.EaseType.easeOutQuad,i/(80*this.speed),cc.v2(r.x,r.y)),this.startRoutine().wait(this.life_).do(function(){n.playAnim(d.WdPixelAnimState.Death,function(){n.goPooler.returnGo(n)})}),this.expired=!1,this.soundService.playFx(this.fireSound)},e.prototype.fireAttack=function(t){var e=this;if(null!=t){if(this.hit(t),null!=this.hitEffect&&!this.expired){this.soundService.playFx(this.hitSound);var o=this.goPooler.fromPrefab(this.hitEffect,this.node.parent);o.node.setPosition(this.core_.convertToWorldSpaceAR(cc.Vec2.ZERO)),o.play(),this.expired=!0,this.coll.radius=2*this.baseRadius,this.playAnim(d.WdPixelAnimState.Death,function(){e.goPooler.returnGo(e),e.coll.radius=e.baseRadius})}this.startRoutine().wait(.1,function(){e.coll.enabled=!1})}},e.prototype.hit=function(t){var e=this.worldService.world.time,o=this.invincible.get(t.getKey().pack());if(!(o&&e.timestamp<o)){var r=this.node.getPosition(),n=new f.WdVec(r.x,r.y);if(this.owner.getType()==p.WdUnitType.Enemy&&t.getType()==p.WdUnitType.Hero){var i=this.owner,c=t,a=this.calculator.makeDamagesFrom(this.attack,t,n);i.attack(c,a)}else this.owner.getType()==p.WdUnitType.Hero&&(c=this.owner,i=t,a=this.calculator.makeDamagesFrom(this.attack,t,n),c.attack(i,a));this.invincible.set(t.getKey().pack(),e.timestamp+this.interval)}},e.prototype.readyAnim=function(){var t=this;if(!this.ready&&this.animator){var e=this.animator.getClips();e&&(e.forEach(function(e){var o=d.WdPixelAnimState.None;e.name.indexOf(d.WdPixelAnimState.Birth.toString())>=0?o=d.WdPixelAnimState.Birth:e.name.indexOf(d.WdPixelAnimState.Play.toString())>=0?o=d.WdPixelAnimState.Play:e.name.indexOf(d.WdPixelAnimState.Death.toString())>=0&&(o=d.WdPixelAnimState.Death),o!=d.WdPixelAnimState.None&&(t.animations.set(o,e.name),t.animLengths.set(o,e.duration),t.totalDuration+=e.duration)}),this.ready=!0)}},i([s(cc.Float)],e.prototype,"speed",void 0),i([s(cc.Animation)],e.prototype,"animator",void 0),i([s(l.WdPxEffect)],e.prototype,"hitEffect",void 0),i([c.autoWired("SoundService")],e.prototype,"soundService",void 0),i([c.autoWired("WorldService")],e.prototype,"worldService",void 0),i([c.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([a],e)}(t("./WdProjectile").WdProjectile);o.default=v,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../core/common/WdVec":"WdVec","../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../core/object/unit/WdUnitKey":"WdUnitKey","../effect/WdEffectType":"WdEffectType","../effect/WdPxEffect":"WdPxEffect","../unit/WdUnitActorCore":"WdUnitActorCore","./WdProjectile":"WdProjectile"}],WdProjectileRay:[function(t,e,o){"use strict";cc._RF.push(e,"fb7c6cUZjZBUb8cJhJYvK2r","WdProjectileRay");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdProjectileRay=void 0;var c=t("./WdProjectile"),a=cc._decorator.property,s=t("../effect/WdPxEffectAnimator"),l=t("../../../common/bean/Decorators"),u=t("../../core/object/unit/WdAttackCalculator"),p=t("../../core/common/WdVec"),d=t("../../core/common/WdUtil"),h=t("../../../common/coroutine/EaseRoutine"),f=t("../unit/WdUnitRadar"),y=t("../../core/object/unit/WdUnitKey"),v=cc._decorator.ccclass,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor=null,e.ray=null,e.radar=null,e.hitEffect=null,e.color=cc.Color.YELLOW,e.onUnitEnter=function(t){if(null!=t&&t!=e.owner&&(e.hit(t),null!=e.hitEffect)){var o=t.getCore().bodyAnchor,r=e.goPooler.fromPrefab(e.hitEffect,e.node.parent);r.node.setPosition(cc.v2(o.x,o.y)),r.play()}},e}return n(e,t),e.prototype.onGoingIntoPool=function(){t.prototype.onGoingIntoPool.call(this),this.owner=null,this.radar.node.active=!1,this.node.setPosition(cc.v2(1e5,1e5))},e.prototype.fire=function(t,e,o,r){this.owner=t,this.attack=e,this.targetPos=r,this.calculator=new u.WdAttackCalculator(t),this.radar.node.active=!0,this.radar.boot(),this.radar.onUnitEnter.addHandler(this.onUnitEnter),this.arrange(),this.play(),this.fireSound&&this.soundService.playFx(this.fireSound)},e.prototype.arrange=function(){var t=this.owner.getCore().prjAnchor;this.owner.lookAt(this.targetPos),this.node.setPosition(cc.v2(t.x,t.y)),this.direction=this.targetPos.subtract(t),this.direction=this.direction.normalize();var e=Math.atan2(this.direction.y,this.direction.x)*d.WdUtil.rad2Deg;this.anchor.angle=e-90},e.prototype.hit=function(t){var e=this.node.position,o=new p.WdVec(e.x,e.y);if(null!=this.owner)if(this.owner.getType()==y.WdUnitType.Enemy&&t.getType()==y.WdUnitType.Hero){var r=this.calculator.makeDamagesFrom(this.attack,t,o),n=t;(i=this.owner).attack(n,r)}else if(this.owner.getType()==y.WdUnitType.Hero&&t.getType()==y.WdUnitType.Enemy){r=this.calculator.makeDamagesFrom(this.attack,t,o);var i=t;(n=this.owner).attack(i,r)}},e.prototype.play=function(){var t=this;this.ray.opacity=0,this.startRoutine().opacity(this.ray,h.EaseType.easeOutQuad,.1,255).wait(.2).opacity(this.ray,h.EaseType.easeOutQuad,.1,0).do(function(){t.goPooler.returnGo(t)})},i([a(cc.Node)],e.prototype,"anchor",void 0),i([a(cc.Node)],e.prototype,"ray",void 0),i([a(f.WdUnitRadar)],e.prototype,"radar",void 0),i([a(s.WdPxEffectAnimator)],e.prototype,"hitEffect",void 0),i([a(cc.Color)],e.prototype,"color",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l.autoWired("SoundService")],e.prototype,"soundService",void 0),i([v],e)}(c.WdProjectile);o.WdProjectileRay=m,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../core/common/WdUtil":"WdUtil","../../core/common/WdVec":"WdVec","../../core/object/unit/WdAttackCalculator":"WdAttackCalculator","../../core/object/unit/WdUnitKey":"WdUnitKey","../effect/WdPxEffectAnimator":"WdPxEffectAnimator","../unit/WdUnitRadar":"WdUnitRadar","./WdProjectile":"WdProjectile"}],WdProjectile:[function(t,e,o){"use strict";cc._RF.push(e,"7a03adttNRFeaSVd6azf20g","WdProjectile");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdProjectile=void 0;var c=t("../../../common/util/GoItem"),a=cc._decorator.property,s=t("../../core/object/unit/WdUnitKey"),l=t("../unit/WdUnitActorCore"),u=cc._decorator.ccclass,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.code_=0,e.life_=3,e.core_=null,e.target_=s.WdUnitType.None,e.fireSound_="",e.hitSound_="",e}return n(e,t),Object.defineProperty(e.prototype,"code",{get:function(){return this.code_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){return this.target_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fireSound",{get:function(){return this.fireSound_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hitSound",{get:function(){return this.hitSound_},enumerable:!1,configurable:!0}),e.prototype.fire=function(){},e.prototype.onAnimEvent=function(){},e.prototype.getHitUnit=function(t){return this.getHitUnitByTag(t.getComponent(l.WdUnitActorCore))},e.prototype.getHitUnitByTag=function(t){return null==t?null:this.target!=t.unit.getType()?null:t.unit.isDead()?null:t.unit},i([a(cc.Integer)],e.prototype,"code_",void 0),i([a(cc.Float)],e.prototype,"life_",void 0),i([a(cc.Node)],e.prototype,"core_",void 0),i([a({type:cc.Enum(s.WdUnitType)})],e.prototype,"target_",void 0),i([a(cc.String)],e.prototype,"fireSound_",void 0),i([a(cc.String)],e.prototype,"hitSound_",void 0),i([u],e)}(c.default);o.WdProjectile=p,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem","../../core/object/unit/WdUnitKey":"WdUnitKey","../unit/WdUnitActorCore":"WdUnitActorCore"}],WdPxEffectAnimator:[function(t,e,o){"use strict";cc._RF.push(e,"7f357HAX8ZLqK6YnnEYPxPv","WdPxEffectAnimator");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdPxEffectAnimator=void 0;var c=t("./WdEffectType"),a=t("../../../common/bean/Decorators"),s=t("../../../App"),l=cc._decorator.ccclass,u=cc._decorator.property,p=t("./WdPxEffect"),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animator=null,e.subEffects=new Array,e.animations=new Map,e.animLengths=new Map,e.totalDuration=0,e.ready=!1,e}return n(e,t),e.prototype.onLoad=function(){s.app.ready&&(null==this.animator&&(this.animator=this.getComponent(cc.Animation)),this.effectType!=c.WdEffectType.Sub&&(this.subEffects=this.subEffects.concat(this.getComponentsInChildren(p.WdPxEffect))))},e.prototype.readyAnim=function(){var t=this;if(!this.ready&&this.animator){var e=this.animator.getClips();e&&(e.forEach(function(e){var o=c.WdPixelAnimState.None;e.name.indexOf(c.WdPixelAnimState.Birth.toString())>=0?o=c.WdPixelAnimState.Birth:e.name.indexOf(c.WdPixelAnimState.Play.toString())>=0?o=c.WdPixelAnimState.Play:e.name.indexOf(c.WdPixelAnimState.Death.toString())>=0&&(o=c.WdPixelAnimState.Death),o!=c.WdPixelAnimState.None&&(t.animations.set(o,e.name),t.animLengths.set(o,e.duration),t.totalDuration+=e.duration)}),this.ready=!0)}},e.prototype.play=function(){var t=this;this.readyAnim(),this.playAnim(),this.effectType!=c.WdEffectType.Sub&&this.scheduleOnce(function(){return t.goPooler.returnGo(t)},this.totalDuration),this.subEffects.forEach(function(e){e!=t&&e.play()})},e.prototype.playAnim=function(){var t=this,e=0,o=this.animations.get(c.WdPixelAnimState.Birth),r=this.animations.get(c.WdPixelAnimState.Play),n=this.animations.get(c.WdPixelAnimState.Death);o&&(this.animator.play(o,0),e=this.getAnimLen(c.WdPixelAnimState.Birth)),r&&(0==e?this.animator.play(r,0):this.scheduleOnce(function(){return t.animator.play(r,0)},e),e=this.getAnimLen(c.WdPixelAnimState.Play)),n&&(0==e?this.animator.play(n,0):this.scheduleOnce(function(){return t.animator.play(n,0)},e))},e.prototype.getAnimLen=function(t){return this.animLengths.get(t)||0},i([u(cc.Animation)],e.prototype,"animator",void 0),i([a.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l],e)}(p.WdPxEffect);o.WdPxEffectAnimator=d,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","./WdEffectType":"WdEffectType","./WdPxEffect":"WdPxEffect"}],WdPxEffectMove:[function(t,e,o){"use strict";cc._RF.push(e,"6bd19RXtrpAoKPMAtghG7TL","WdPxEffectMove");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdPxEffectMove=void 0;var c=t("./WdPxEffect"),a=t("../../../common/bean/Decorators"),s=t("../../../App"),l=t("./WdEffectType"),u=cc._decorator.ccclass,p=cc._decorator.property,d=t("../../../common/coroutine/EaseRoutine"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.from=cc.v2(0,0),e.to=cc.v2(0,0),e.duration=1,e.easeType=d.EaseType.easeInQuad,e.subEffects=new Array,e}return n(e,t),e.prototype.onLoad=function(){s.app.ready&&this.effectType!=l.WdEffectType.Sub&&(this.subEffects=this.subEffects.concat(this.getComponentsInChildren(c.WdPxEffect)))},e.prototype.play=function(){var t=this;this.node.setPosition(this.from),this.startRoutine().move(this.node,this.easeType,this.duration,this.to),this.subEffects.forEach(function(e){e!=t&&e.play()})},i([p(cc.Vec2)],e.prototype,"from",void 0),i([p(cc.Vec2)],e.prototype,"to",void 0),i([p(cc.Float)],e.prototype,"duration",void 0),i([p({type:cc.Enum(d.EaseType)})],e.prototype,"easeType",void 0),i([a.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([u()],e)}(c.WdPxEffect);o.WdPxEffectMove=h,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","./WdEffectType":"WdEffectType","./WdPxEffect":"WdPxEffect"}],WdPxEffect:[function(t,e,o){"use strict";cc._RF.push(e,"15e01CzyM1BRrzqhUIM6YL2","WdPxEffect");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdPxEffect=void 0;var c=t("../../../common/util/GoItem"),a=t("./WdEffectType"),s=cc._decorator.property,l=cc._decorator.ccclass,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.effectType_=a.WdEffectType.None,e}return n(e,t),Object.defineProperty(e.prototype,"effectType",{get:function(){return this.effectType_},enumerable:!1,configurable:!0}),e.prototype.play=function(){},i([s({type:cc.Enum(a.WdEffectType)})],e.prototype,"effectType_",void 0),i([l],e)}(c.default);o.WdPxEffect=u,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem","./WdEffectType":"WdEffectType"}],WdRandomUtil:[function(t,e,o){"use strict";cc._RF.push(e,"65b49Tw7slNGJAtlQLbpYis","WdRandomUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdRandomUtil=void 0;var r=t("./WdRandom"),n=function(){function t(){}return t.next=function(t,e){void 0===e&&(e=null);var o=0;t.forEach(function(t){return o+=t.rate}),e||(e=r.WdRandom.get());for(var n=e.nextFloat(o),i=0,c=0,a=t;c<a.length;c++){var s=a[c];if(n<(i+=s.rate))return s}return t[0]},t.shuffle=function(t,e){var o;void 0===e&&(e=null),e||(e=r.WdRandom.get());for(var n,i=t.length;0!==i;)n=e.nextInt(i),i--,o=[t[n],t[i]],t[i]=o[0],t[n]=o[1];return t},t}();o.WdRandomUtil=n,cc._RF.pop()},{"./WdRandom":"WdRandom"}],WdRandom:[function(t,e,o){"use strict";cc._RF.push(e,"e1cabTf9IdKu4Lnmbsh7JjF","WdRandom"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdRandom=void 0;var r=t("../../../common/util/Utils"),n=function(){function t(t){this.a=16807,this.c=11,this.m=2147483647,this.seed=Math.round(t)}return t.prototype.nextInt=function(t){return this.seed=(this.a*this.seed+this.c)%this.m,Math.round(this.seed%t)},t.prototype.nextFloat=function(t){return this.nextInt(1073741824)/1073741824*t},t.prototype.rangeFloat=function(t,e){return e<=t?t:t+this.nextFloat(e-t)},t.prototype.rangeInt=function(t,e){return e<=t?t:t+this.nextInt(e-t)},t.prototype.succeed100=function(t){return this.nextInt(100)<t},t.get=function(){return null!=this.instance?this.instance:(this.instance=new t(r.Utils.currentTimeMillis()),this.instance)},t.getNextInt=function(t){return this.get().nextInt(t)},t.getNextFloat=function(t){return this.get().nextFloat(t)},t.getRangeFloat=function(t,e){return this.get().rangeFloat(t,e)},t.getRangeInt=function(t,e){return this.get().rangeInt(t,e)},t}();o.WdRandom=n,cc._RF.pop()},{"../../../common/util/Utils":"Utils"}],WdReward:[function(t,e,o){"use strict";var r;cc._RF.push(e,"d12b3sF/gFDtrhgXBPIA5Tb","WdReward"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdReward=o.WdRewardType=void 0,function(t){t[t.None="None"]="None",t[t.Coin="Coin"]="Coin",t[t.Gem="Gem"]="Gem",t[t.Material="Material"]="Material",t[t.Exp="Exp"]="Exp",t[t.Skill="Skill"]="Skill",t[t.Pickaxe="Pickaxe"]="Pickaxe",t[t.BuildingLvUp="BuildingLvUp"]="BuildingLvUp"}(r=o.WdRewardType||(o.WdRewardType={}));o.WdReward=function(){this.type=r.None,this.code=0,this.amount=0,this.param1=0,this.param2=0},cc._RF.pop()},{}],WdSkillKey:[function(t,e,o){"use strict";cc._RF.push(e,"e6be0gIA1RG2bbIbw9vuivj","WdSkillKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdSkillKey=void 0;var r=function(){function t(){}return t.build=function(e,o){var r=new t;return r.code=e,r.level=o,r},t}();o.WdSkillKey=r,cc._RF.pop()},{}],WdSkillService:[function(t,e,o){"use strict";cc._RF.push(e,"70e31Uf2NhOuqssZL5FSYds","WdSkillService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdSkillService=void 0;var c=t("../../../../common/bean/Decorators"),a=t("../../../../rule/model/Model"),s=t("../unit/WdStat"),l=t("../../common/WdRandomUtil"),u=function(){function t(){this.calculators=new Map}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){return i(this,function(){return this.calculators.set(a.WdSkillType.Repeater,this.calcRepeater),this.calculators.set(a.WdSkillType.HpBoost,this.calcHpBoost),this.calculators.set(a.WdSkillType.UnitAttackBoost,this.calcAllAttackBoost),this.calculators.set(a.WdSkillType.AttackSpeedUp,this.calcAttackSpeedUp),[2,!0]})})},t.prototype.getAvailable=function(){var t=new Set,e=this.worldService.getPlayer(),o=Array.from(this.ruleService.skills.values()),r=Array.from(this.ruleService.unlocks.values()),n=new Map;return r.forEach(function(t){t.type==a.WdResourceType.Skill&&n.set(t.code,t.no)}),o.forEach(function(o){var r=n.get(o.code);r?e.isUnlocked(r)&&t.add(o.code):t.add(o.code)}),Array.from(t)},t.prototype.calculateStats=function(t){var e=this.ruleService.getSkill(t),o=this.calculators.get(e.type);return o?o(e):new Array},t.prototype.calcRepeater=function(t){var e=new Array,o=new s.WdStat;return o.type=a.WdStatType.CoolReduction,o.minV=-t.v2,o.maxV=-t.v2,e.push(o),e},t.prototype.calcHpBoost=function(t){var e=new Array,o=new s.WdStat;return o.type=a.WdStatType.LifeBoost,o.minV=t.v1,o.maxV=t.v1,e.push(o),e},t.prototype.calcAllAttackBoost=function(t){var e=new Array,o=new s.WdStat;return o.type=a.WdStatType.UnitAttackBoost,o.minV=t.v1,o.maxV=t.v1,e.push(o),e},t.prototype.calcAttackSpeedUp=function(t){var e=new Array,o=new s.WdStat;return o.type=a.WdStatType.CoolReduction,o.minV=t.v1,o.maxV=t.v1,e.push(o),e},t.prototype.newSkillCandidates=function(t){var e=this,o=new Array,r=this.getAvailable(),n=new Array;return r.forEach(function(o){var r=e.ruleService.getSkillMaxLevel(o),i=t.get(o);i?i.level<r&&n.push(o):n.push(o)}),l.WdRandomUtil.shuffle(n),n.length>3&&(o.push(n[0]),o.push(n[1]),o.push(n[2])),o},r([c.autoWired("WorldService")],t.prototype,"worldService",void 0),r([c.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([c.service("WdSkillService")],t)}();o.WdSkillService=u,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../common/WdRandomUtil":"WdRandomUtil","../unit/WdStat":"WdStat"}],WdSpritePooler:[function(t,e,o){"use strict";cc._RF.push(e,"f766eETuJBOioL4xAwbvue8","WdSpritePooler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdSpritePooler=void 0;var c=t("../../../common/bean/Decorators"),a=t("../../../common/util/Utils"),s=function(){function t(){this.materials=new Map,this.isReady=!1}return t.prototype.initialize=function(){return n(this,void 0,Promise,function(){return i(this,function(t){switch(t.label){case 0:return this.isReady?[2,!0]:[4,this.loadResource("Material",900,this.materials)];case 1:return t.sent(),this.isReady=!0,[2,!0]}})})},t.prototype.loadResource=function(t,e,o){return n(this,void 0,void 0,function(){var r;return i(this,function(n){switch(n.label){case 0:r=!1,cc.resources.load("atlas/"+t,cc.SpriteAtlas,function(n,i){var c=i,a=c.getSpriteFrames(),s=new Set;a.forEach(function(t){var e=t.name.indexOf("_"),o=parseInt(t.name.substr(e+1));s.add(o)});for(var l=0;l<=e;l++)if(s.has(l)){var u=c.getSpriteFrame(t+"_"+l);o.set(l,u)}r=!0}),n.label=1;case 1:return r?[3,3]:[4,a.Utils.sleep(.01)];case 2:return n.sent(),[3,1];case 3:return[2]}})})},t.prototype.getItem=function(t){return this.getMaterial(t)},t.prototype.getMaterial=function(t){return this.materials.get(t)},t.prototype.getSkill=function(t){return this.getMaterial(t+720)},t.prototype.getPickaxe=function(t){return this.getMaterial(t+390)},t.prototype.getUnlock=function(t){return this.getMaterial(t+510)},r([c.service("WdSpritePooler")],t)}();o.WdSpritePooler=s,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/util/Utils":"Utils"}],"WdStat.spec":[function(t,e,o){"use strict";cc._RF.push(e,"008ddHqYWlOjoGcqGYc8VJ4","WdStat.spec");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},n=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdStatTest=void 0;var c=t("testyts"),a=t("../../../../../common/bean/Decorators"),s=t("../../../../../rule/RuleService"),l=t("../../../../../common/bean/BeanContainer"),u=t("../WdStats"),p=t("../../item/WdItemDAO"),d=t("../../../../../rule/model/Model"),h=t("../WdStat"),f=t("../WdCc"),y=t("../../../common/WdTime"),v=t("../../../common/WdUtil"),m=t("../WdUnitState"),g=function(){function t(){}return t.prototype.beforeAll=function(){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return s.RuleService.readyTest(),[4,l.beanContainer.initialize()];case 1:return t.sent(),console.error("Idle:"+m.WdUnitState2.Idle.toString()),[2]}})})},t.prototype.newTestItem=function(t,e,o){var r=new p.WdItemDAO;return r.code=t,r.level=e,r.dna=o,r},t.prototype.statTest=function(){var t=new u.WdStats,e=this.itemService.calculateStats(this.newTestItem(181,1,50));t.refresh(e),c.expect.toBeTrue(t.getAvgSum(d.WdStatType.Defense)>0)},t.prototype.slowTest=function(){var t=this.newStats();c.expect.toBeEqual(t.getHp(),100);var e=new f.WdCc;e.type=d.WdCcType.Slow,e.remain=3,e.v1=.3,t.addCc(e),c.expect.toBeEqual(t.atkSpdBoost,1),c.expect.toBeEqual(t.getHp(),100);var o=new y.WdTime;o.onTick(1),t.onTick(o),c.expect.toBeEqual(t.atkSpdBoost,.7);for(var r=0;r<3;r++)o.onTick(1),t.onTick(o);c.expect.toBeEqual(t.atkSpdBoost,1),c.expect.toBeEqual(t.removed.length,1)},t.prototype.slowOverlappedTest=function(){var t=this.newStats();c.expect.toBeEqual(t.getHp(),100);var e=new f.WdCc;e.type=d.WdCcType.Slow,e.remain=3,e.v1=.3,t.addCc(e);var o=new f.WdCc;o.type=d.WdCcType.Slow,o.remain=3,o.v1=.3,t.addCc(o);var r=new f.WdCc;r.type=d.WdCcType.Slow,r.remain=3,r.v1=.3,t.addCc(r);var n=new y.WdTime;n.onTick(1),t.onTick(n),c.expect.toBeEqual(t.ccs.get(d.WdCcType.Slow).length,3),c.expect.toBeTrue(v.WdUtil.approximately(t.atkSpdBoost,.1))},t.prototype.dotDamageTest=function(){var t=this.newStats();c.expect.toBeEqual(t.getHp(),100);var e=new f.WdCc;e.type=d.WdCcType.DotDamage,e.remain=4.5,e.v1=10,t.addCc(e);var o=new y.WdTime;o.onTick(1),t.onTick(o),c.expect.toBeEqual(t.dotDamages.length,1),c.expect.toBeEqual(t.dotDamages[0].amount,10);for(var r=0;r<4;r++)o.onTick(1),t.onTick(o),c.expect.toBeEqual(t.dotDamages.length,1),c.expect.toBeEqual(t.dotDamages[0].amount,3==r?5:10);o.onTick(1),t.onTick(o),c.expect.toBeEqual(t.removed.length,1)},t.prototype.hpReduceAddTest=function(){var t=this.newStats();c.expect.toBeEqual(t.getHp(),100),t.addHp(100),c.expect.toBeEqual(t.getHp(),100)},t.prototype.newStats=function(){var t=new h.WdStat;t.type=d.WdStatType.Life,t.minV=100,t.maxV=100;var e=new Array;e.push(t);var o=new u.WdStats(1);return o.refresh(e),o},r([a.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([a.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([c.BeforeAll()],t.prototype,"beforeAll",null),r([c.Test()],t.prototype,"statTest",null),r([c.Test()],t.prototype,"slowTest",null),r([c.Test()],t.prototype,"slowOverlappedTest",null),r([c.Test()],t.prototype,"dotDamageTest",null),r([c.Test()],t.prototype,"hpReduceAddTest",null),r([c.TestSuite()],t)}();o.WdStatTest=g,cc._RF.pop()},{"../../../../../common/bean/BeanContainer":"BeanContainer","../../../../../common/bean/Decorators":"Decorators","../../../../../rule/RuleService":"RuleService","../../../../../rule/model/Model":"Model","../../../common/WdTime":"WdTime","../../../common/WdUtil":"WdUtil","../../item/WdItemDAO":"WdItemDAO","../WdCc":"WdCc","../WdStat":"WdStat","../WdStats":"WdStats","../WdUnitState":"WdUnitState",testyts:16}],WdStats:[function(t,e,o){"use strict";cc._RF.push(e,"d3fc1IbnwZAA5Dz+S5jb6Kn","WdStats"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdStats=void 0;var r=t("../../../../rule/model/Model"),n=t("../../common/WdUtil"),i=t("./WdDamage"),c=function(){function t(t){void 0===t&&(t=.5),this.hpRate=0,this.totalLife=0,this.atkSpdBase=0,this.atkSpdBoost=0,this.moveSpdBoost=0,this.all=null,this.dirty=!1,this.removed=null,this.dotDamages=null,this.tickDot=.5,this.all=new Array,this.hpRate=1,this.atkSpdBoost=1,this.moveSpdBoost=1,this.ccs=new Map,this.removed=new Array,this.dotDamages=new Array,this.tickDot=t}return t.prototype.getHp=function(){return this.hpRate*this.totalLife},t.prototype.refresh=function(t){var e=this;this.all=[],this.all=this.all.concat(t),this.totalLife=0,this.atkSpdBase=1;var o=0;this.all.forEach(function(t){t.type==r.WdStatType.Life?e.totalLife+=t.maxV:t.type==r.WdStatType.LifeBoost?o+=t.maxV:t.type==r.WdStatType.CoolReduction&&(e.atkSpdBase+=t.maxV)}),this.totalLife*=1+o,this.atkSpdBoost=this.atkSpdBase,this.dirty=!0},t.prototype.getAllAttacks=function(){var t=new Array;return this.all.forEach(function(e){e.type!=r.WdStatType.PhysicalAttack&&e.type!=r.WdStatType.FireAttack&&e.type!=r.WdStatType.ColdAttack&&e.type!=r.WdStatType.LightningAttack&&e.type!=r.WdStatType.PoisonAttack||t.push(e)}),t},t.prototype.getAll=function(t){var e=new Array;return this.all.forEach(function(o){o.type==t&&e.push(o)}),e},t.prototype.getMinSum=function(t){var e=0;return this.getAll(t).forEach(function(t){return e+=t.minV}),e},t.prototype.getMaxSum=function(t){var e=0;return this.getAll(t).forEach(function(t){return e+=t.maxV}),e},t.prototype.getAvgSum=function(t){var e=0;return this.getAll(t).forEach(function(t){return e+=(t.minV+t.maxV)/2}),e},t.prototype.isDead=function(){return Math.floor(this.getHp())<=0},t.prototype.kill=function(){this.hpRate=0},t.prototype.reduceHp=function(t){var e=t/this.totalLife;this.hpRate-=e,this.hpRate=Math.max(0,this.hpRate)},t.prototype.addHp=function(t){var e=t/this.totalLife;this.hpRate+=e,this.hpRate=Math.min(1,this.hpRate)},t.prototype.onTick=function(t){var e=this;this.removed.length>0&&(this.removed=[]),this.dotDamages.length>0&&(this.dotDamages=[]),this.calculateDotDamage(t),this.ccs.forEach(function(o){for(var r=0;!(r>=o.length);){var i=o[r];i.remain<=n.WdUtil.epsilon?(e.removed.push(i),o.splice(r,1),e.dirty=!0):r++,i.remain-=t.deltaTime}}),this.dirty&&(this.calculateSpeed(),this.dirty=!1)},t.prototype.calculateDotDamage=function(t){var e=this,o=this.ccs.get(r.WdCcType.DotDamage);o&&0!=o.length&&o.forEach(function(o){if(!(o.nextTick>t.timestamp)){var r=Math.min(e.tickDot,o.remain);o.nextTick>0&&(r+=t.timestamp-o.nextTick);var n=new i.WdDamage;n.amount=o.v1*r,e.dotDamages.push(n),o.nextTick=t.timestamp+e.tickDot}})},t.prototype.addCc=function(t){var e=t.type,o=this.ccs.get(e);o||(o=new Array,this.ccs.set(e,o)),o.length>=this.getMaximumOverlap(e)&&(o=o.slice(0,1)),o.push(t),this.dirty=!0},t.prototype.getMaximumOverlap=function(t){return t==r.WdCcType.Slow||t==r.WdCcType.Fast?3:7},t.prototype.calculateSpeed=function(){var t=0,e=0,o=this.ccs.get(r.WdCcType.Slow);o&&o.forEach(function(o){t-=o.v1,e-=o.v1});var n=this.ccs.get(r.WdCcType.Fast);n&&n.forEach(function(o){t+=o.v1,e+=o.v1});var i=this.ccs.get(r.WdCcType.Freeze);i&&i.forEach(function(){t-=1,e-=1});var c=this.ccs.get(r.WdCcType.MoveSpeedUp);c&&c.forEach(function(t){e+=t.v1});var a=this.ccs.get(r.WdCcType.AttackSpeedUp);a&&a.forEach(function(e){t+=e.v1}),this.atkSpdBoost=this.atkSpdBase+t,this.atkSpdBoost=Math.max(0,this.atkSpdBoost),this.moveSpdBoost=1+e,this.moveSpdBoost=Math.max(0,this.moveSpdBoost)},t.prototype.recoverAll=function(){this.hpRate=1,this.ccs.forEach(function(t){t.forEach(function(t){t.remain=0})})},t.prototype.hasCc=function(t){var e=this.ccs.get(t);return!!e&&e.length>0},t}();o.WdStats=c,cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdUtil":"WdUtil","./WdDamage":"WdDamage"}],WdStat:[function(t,e,o){"use strict";cc._RF.push(e,"b2ed1BbQMdAXLrKmabuJVGb","WdStat"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdStat=void 0;var r=t("../../../../rule/model/Model"),n=function(){function t(){this.type=r.WdStatType.None,this.minV=0,this.maxV=0,this.cc=null,this.magic=r.WdStatMagicType.None}return t.build=function(e,o,n,i,c){void 0===o&&(o=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===c&&(c=r.WdStatMagicType.None);var a=new t;return a.type=e,a.minV=o,a.maxV=n,a.cc=i,a.magic=c,a},t}();o.WdStat=n,cc._RF.pop()},{"../../../../rule/model/Model":"Model"}],WdTime:[function(t,e,o){"use strict";cc._RF.push(e,"80024QOd8ZKd46dy6y3Zlgr","WdTime"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdTime=void 0;var r=function(){function t(){}return t.prototype.onTick=function(t){this.deltaTime=t,this.timestamp+=t},t}();o.WdTime=r,cc._RF.pop()},{}],WdUaHurtHandler:[function(t,e,o){"use strict";cc._RF.push(e,"37b0daJzTJGj4mtWJHh54cT","WdUaHurtHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUaHurtHandler=void 0;var r=function(){function t(t){this.done=!1,this.action=null,this.unit=t}return t.prototype.onStart=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(){},t.prototype.onDead=function(){},t}();o.WdUaHurtHandler=r,cc._RF.pop()},{}],WdUaPopupHandler:[function(t,e,o){"use strict";cc._RF.push(e,"086a7KvwgZEk6RCfLUI3Ido","WdUaPopupHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUaPopupHandler=void 0;var r=function(){function t(t){this.done=!1,this.action=null,this.unit=t}return t.prototype.onStart=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(){},t.prototype.onDead=function(){},t}();o.WdUaPopupHandler=r,cc._RF.pop()},{}],WdUaStopHandler:[function(t,e,o){"use strict";cc._RF.push(e,"a2f51/dC+hMxLMHYqTuAHt0","WdUaStopHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUaStopHandler=void 0;var r=t("../../../core/object/unit/WdUnitState"),n=function(){function t(t){this.done=!1,this.action=null,this.unit=t}return t.prototype.onStart=function(t){this.action=t,this.unit.setState(r.WdUnitState.Idle),this.done=!0},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(){},t.prototype.onDead=function(){},t}();o.WdUaStopHandler=n,cc._RF.pop()},{"../../../core/object/unit/WdUnitState":"WdUnitState"}],WdUaWalkHandler:[function(t,e,o){"use strict";cc._RF.push(e,"02453p7nhNNT5R0XJUF2H2Z","WdUaWalkHandler"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUaWalkHandler=void 0;var r=t("../../../core/object/unit/WdUnitState"),n=function(){function t(t){this.done=!1,this.action=null,this.nexTick=0,this.duration=0,this.interval=.1,this.unit=t}return t.prototype.onStart=function(t){this.action=t,this.walk()},t.prototype.walk=function(){var t=this.getTargetPos(),e=Math.max(.1,this.action.range);if(this.isArrived(t,e))return this.done=!0,void this.unit.setState(r.WdUnitState.Idle);this.unit.walkTo(t),this.nexTick=this.interval+this.duration},t.prototype.isArrived=function(t,e){return this.unit.getPos().subtract(t).len2()<e*e},t.prototype.getTargetPos=function(){var t=this.unit.getWs().area,e=this.unit.getPos(),o=this.action.to;if(!this.action.target.isEmpty()){var r=t.getUnit(this.action.target);null!=r&&(o=(o=r.getGatePos()).add(e.subtract(o).normalize().scalar(.5)))}return o},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(t){this.nexTick<this.duration&&this.walk(),this.duration+=t},t.prototype.onDead=function(){},t}();o.WdUaWalkHandler=n,cc._RF.pop()},{"../../../core/object/unit/WdUnitState":"WdUnitState"}],WdUaWrapUpHandler:[function(t,e,o){"use strict";cc._RF.push(e,"f3e398F64hJzI7v6sPrTV1D","WdUaWrapUpHandler");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUaWrapUpHandler=void 0;var n=t("../../../../common/bean/Decorators"),i=t("../../../UI/popups/WduPopups"),c=function(){function t(t){this.done=!1,this.action=null,this.unit=t}return t.prototype.onStart=function(){var t=this.worldService.world,e=this.worldService.presenters;t.area.enemies.size>0||(t.evaluateBattle(),e.ui.popups.openPopup(i.WduPopupType.WrapUp,0))},t.prototype.onAnimEvent=function(){},t.prototype.onTick=function(){},t.prototype.onDead=function(){},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),t}();o.WdUaWrapUpHandler=c,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../UI/popups/WduPopups":"WduPopups"}],WdUnitActionHandler:[function(t,e,o){"use strict";cc._RF.push(e,"1396b+tOMtKX6U4twXGkfP4","WdUnitActionHandler"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],WdUnitAction:[function(t,e,o){"use strict";cc._RF.push(e,"61b5aBqs+9JRYlVw9R62yj+","WdUnitAction"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitAction=o.WdUnitActionType=void 0;var r=t("./WdUnitKey"),n=t("../../common/WdVec"),i=t("../../../../rule/model/Model");(function(t){t[t.Walk=1]="Walk",t[t.Stop=2]="Stop",t[t.Attack1=3]="Attack1",t[t.Attack2=4]="Attack2",t[t.Attack3=5]="Attack3",t[t.Attack4=6]="Attack4",t[t.Pickaxe=7]="Pickaxe",t[t.Talk=8]="Talk",t[t.Wait=9]="Wait",t[t.Jump=10]="Jump",t[t.EnterArea=11]="EnterArea",t[t.Popup=12]="Popup",t[t.WrapUp=13]="WrapUp",t[t.Hurt=14]="Hurt",t[t.Skill1=15]="Skill1",t[t.Skill2=16]="Skill2",t[t.Skill3=17]="Skill3",t[t.Skill4=18]="Skill4"})(o.WdUnitActionType||(o.WdUnitActionType={}));o.WdUnitAction=function(){this.skill=null,this.irrevocable=!1,this.target=r.WdUnitKey.empty,this.to=n.WdVec.zero,this.range=0,this.weapon=0,this.weaponType=i.WdItemType.None,this.param1=0,this.param2=0,this.onStart=null,this.onDone=null},cc._RF.pop()},{"../../../../rule/model/Model":"Model","../../common/WdVec":"WdVec","./WdUnitKey":"WdUnitKey"}],WdUnitActorCore:[function(t,e,o){"use strict";cc._RF.push(e,"5520ezeW7ZF5qXOHknjMGGS","WdUnitActorCore");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitActorCore=void 0;var c=t("../../core/common/WdVec"),a=t("../effect/WdEffectType"),s=t("../../core/object/unit/WdUnitKey"),l=t("../../core/object/unit/WdUnit"),u=t("./WdUnitRadar"),p=t("./WdUnitCoreDecorator"),d=t("../../core/object/unit/WdUnitState"),h=t("../../../common/util/EventHandler"),f=t("./anim/WdUnitAnimatorOverride"),y=t("../../../common/util/GoItem"),v=t("./WdUnitCoreAnimEvent"),m=cc._decorator.property,g=cc._decorator.ccclass,W=t("../../../common/coroutine/EaseRoutine"),b=t("../../../common/bean/Decorators"),S=function(){this.state=d.WdUnitState.None,this.animLen=1,this.playTime=0,this.isDone=!1},_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.code_=0,e.anim=null,e.targetSize_=1,e.targetAnchor_=cc.Vec2.ZERO,e.settled_=!1,e.deadEffect_=a.WdEffectType.None,e.unitSprites=[],e.balloonAnchor_=null,e.bodyAnchor_=null,e.prjAnchor_=null,e.spawnAnchor_=null,e.meleeFxAnchor_=null,e.unit_=null,e.radar_=null,e.animEvent=null,e.coll=null,e.pColl=null,e.decorators=new Array,e.animInfo=new S,e.onAnimEventFired=new h.EventHandlerT1,e.onAnimDone=new h.EventHandlerT1,e.onAnimEvent=function(t){e.onAnimEventFired.fire(t)},e.onSoundFx=function(t){e.soundService.playFx(t)},e.onMeleeFx=function(){},e}return n(e,t),Object.defineProperty(e.prototype,"code",{get:function(){return this.code_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetSize",{get:function(){return this.targetSize_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetAnchor",{get:function(){return new c.WdVec(this.targetAnchor_.x,this.targetAnchor_.y)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"settled",{get:function(){return this.settled_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deadEffect",{get:function(){return this.deadEffect_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"balloonAnchor",{get:function(){return this.getWorldPosition(this.balloonAnchor_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bodyAnchor",{get:function(){return this.getWorldPosition(this.bodyAnchor_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"prjAnchor",{get:function(){return this.getWorldPosition(this.prjAnchor_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spawnAnchor",{get:function(){return this.getWorldPosition(this.spawnAnchor_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"meleeFxAnchor",{get:function(){return this.getWorldPosition(this.meleeFxAnchor_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unit",{get:function(){return this.unit_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hero",{get:function(){return this.unit.getType()==s.WdUnitType.Hero?this.unit:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enemy",{get:function(){return this.unit.getType()==s.WdUnitType.Enemy?this.unit:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){return this.unit.getType()==s.WdUnitType.Object?this.unit:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radar",{get:function(){return this.radar_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mainSprite",{get:function(){return 0==this.unitSprites.length?null:this.unitSprites[0]},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){var t=this;this.coll=this.getComponent(cc.Collider),this.pColl=this.getComponent(cc.PhysicsCollider),this.clips=this.getComponent(f.WdUnitAnimatorOverride),this.radar_=this.getComponentInChildren(u.WdUnitRadar),this.animEvent=this.getComponentInChildren(v.WdUnitCoreAnimEvent),this.decorators=this.decorators.concat(this.getComponentsInChildren(p.WdUnitCoreDecorator)),this.balloonAnchor_=this.node,this.bodyAnchor_=this.node,this.prjAnchor_=this.node,this.spawnAnchor_=this.node,this.meleeFxAnchor_=this.node,this.node.children.forEach(function(e){switch(e.name){case"AnchorBalloon":t.balloonAnchor_=e;break;case"Body":t.bodyAnchor_=e;break;case"Projectile":t.prjAnchor_=e;break;case"Spawn":t.spawnAnchor_=e;break;case"MeleeFx":t.meleeFxAnchor_=e}}),this.animEvent&&(this.animEvent.onEvent=this.onAnimEvent)},e.prototype.readyClips=function(){var t=this;this.anim&&this.clips.getClipMap().forEach(function(e,o){t.anim.addClip(e,o)})},e.prototype.boot=function(t){this.setTint(cc.Color.BLACK),this.setColor(cc.Color.WHITE),this.unit_=t,this.anim&&0==this.anim.getClips().length&&this.readyClips(),this.readyComponents(!0),t.isDead()?this.setAnimation(d.WdUnitState.Death):this.setAnimation(d.WdUnitState.Idle),this.decorators.forEach(function(e){e.boot(t)}),null!=this.radar&&this.radar.boot()},e.prototype.readyComponents=function(t){this.coll&&(null!=this.unit?this.coll.enabled=!this.unit.isDead():this.coll.enabled=t),this.pColl&&(null!=this.unit?this.pColl.enabled=!this.unit.isDead():this.pColl.enabled=t)},e.prototype.onGoingIntoPool=function(){this.decorators.forEach(function(t){t.onReturn()})},e.prototype.onDead=function(){null!=this.coll&&(this.coll.enabled=!1),null!=this.pColl&&(this.pColl.enabled=!1)},e.prototype.onBack=function(){null!=this.coll&&(this.coll.enabled=!0),null!=this.pColl&&(this.pColl.enabled=!0),this.setAnimation(d.WdUnitState.Idle)},e.prototype.onTouch=function(t){this.decorators.forEach(function(e){e.onTouch(t)})},e.prototype.playPop=function(t){for(var e=1.2*t,o=this.startRoutine(),r=0;r<3;r++){var n=cc.v2(0,80*e);o.move(this.node,W.EaseType.easeOutSine,.5*t,n),o.move(this.node,W.EaseType.easeInSine,.5*t,cc.Vec2.ZERO),e*=.5,t*=.5}},e.prototype.setAnimation=function(t){this.anim&&(this.anim.play(t.toString(),0),this.anim.currentClip.speed=1,this.animInfo.state=t,this.animInfo.animLen=this.getAnimLen(t),this.animInfo.playTime=0,this.animInfo.isDone=!1)},e.prototype.setTint=function(t){var e=t.clone();e.a=0,this.unitSprites.forEach(function(t){var o=t.getMaterial(0);o&&o.setProperty("btint",e)})},e.prototype.setColor=function(t){this.unitSprites.forEach(function(e){e.node.color=t})},e.prototype.setOpacity=function(t){this.unitSprites.forEach(function(e){e.node.opacity=t})},e.prototype.setSide=function(t){this.settled||(this.node.scaleX=t==l.WdUnitFaceSide.Right?1:-1)},e.prototype.getAnimLen=function(t){var e;return null!==(e=this.clips.getAnimClip(t).duration)&&void 0!==e?e:1},e.prototype.setAnimSpeed=function(t){this.anim&&null!=this.anim.currentClip&&(this.anim.currentClip.speed=t)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.anim&&this.animInfo.state!=d.WdUnitState.None&&(this.animInfo.playTime+=e*this.anim.currentClip.speed,!this.animInfo.isDone&&this.animInfo.playTime-.05>this.animInfo.animLen&&(this.animInfo.isDone=!0,this.onAnimDone.fire(this.animInfo.state)))},e.prototype.getWorldPosition=function(t){var e=t.convertToWorldSpaceAR(cc.Vec2.ZERO);return new c.WdVec(e.x,e.y)},i([m(cc.Integer)],e.prototype,"code_",void 0),i([m(cc.Animation)],e.prototype,"anim",void 0),i([m(cc.Float)],e.prototype,"targetSize_",void 0),i([m(cc.Vec2)],e.prototype,"targetAnchor_",void 0),i([m(cc.Boolean)],e.prototype,"settled_",void 0),i([m({type:cc.Enum(a.WdEffectType)})],e.prototype,"deadEffect_",void 0),i([m(cc.Sprite)],e.prototype,"unitSprites",void 0),i([b.autoWired("SoundService")],e.prototype,"soundService",void 0),i([g],e)}(y.default);o.WdUnitActorCore=_,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../../common/util/EventHandler":"EventHandler","../../../common/util/GoItem":"GoItem","../../core/common/WdVec":"WdVec","../../core/object/unit/WdUnit":"WdUnit","../../core/object/unit/WdUnitKey":"WdUnitKey","../../core/object/unit/WdUnitState":"WdUnitState","../effect/WdEffectType":"WdEffectType","./WdUnitCoreAnimEvent":"WdUnitCoreAnimEvent","./WdUnitCoreDecorator":"WdUnitCoreDecorator","./WdUnitRadar":"WdUnitRadar","./anim/WdUnitAnimatorOverride":"WdUnitAnimatorOverride"}],WdUnitActor:[function(t,e,o){"use strict";cc._RF.push(e,"7c803zXeyFEBZYNP0OWyf2e","WdUnitActor");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitActor=void 0;var i=t("../../../common/util/GoItem"),c=t("../../core/object/unit/WdUnit"),a=t("../../../common/coroutine/EaseRoutine"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.side=c.WdUnitFaceSide.None,e.baseColor=cc.Color.WHITE,e.baseTint=cc.Color.BLACK,e.baseAnimSpeed=1,e}return n(e,t),Object.defineProperty(e.prototype,"core",{get:function(){return this.core_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radar",{get:function(){return this.core.radar},enumerable:!1,configurable:!0}),e.prototype.walkTo=function(){},e.prototype.setFaceSide=function(t){this.side!=t&&(this.side=t,this.core.setSide(t))},e.prototype.lookAt=function(t){t.x>this.pos.x?this.setFaceSide(c.WdUnitFaceSide.Right):t.x<this.pos.x&&this.setFaceSide(c.WdUnitFaceSide.Left)},e.prototype.setBaseColor=function(t){this.baseColor=t,this.setColor(t)},e.prototype.setBaseTint=function(t){this.baseTint=t,this.setTint(t)},e.prototype.setColor=function(t){this.core.setColor(t)},e.prototype.setTint=function(t){this.core.setTint(t)},e.prototype.setOpacity=function(t){this.core.setOpacity(t)},e.prototype.setBaseAnimSpeed=function(t){this.baseAnimSpeed=t,this.core.setAnimSpeed(t)},e.prototype.playDamageEffect=function(){var t=this;this.setTint(cc.Color.WHITE),this.damageRoutine&&this.damageRoutine.stop(),this.damageRoutine=this.startRoutine().wait(.1).ease(a.EaseType.linear,.1,function(){return cc.Color.WHITE},function(e,o){var r=new cc.Color;r=cc.Color.lerp(r,e,t.baseTint,o),t.setTint(r)})},e}(i.default);o.WdUnitActor=s,cc._RF.pop()},{"../../../common/coroutine/EaseRoutine":"EaseRoutine","../../../common/util/GoItem":"GoItem","../../core/object/unit/WdUnit":"WdUnit"}],WdUnitAnimatorOverride:[function(t,e,o){"use strict";cc._RF.push(e,"02e30ZfcKZDtYkV0S/MWvrm","WdUnitAnimatorOverride");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitAnimatorOverride=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("./WdUnitAnimator"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.baseAnimator=null,e.clips=[],e.clipMap=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.clips.forEach(function(e){var o=e.name,r=o.indexOf("_");o=o.substr(r+1),t.clipMap.set(o,e)}),this.baseAnimator.getClipMap().forEach(function(e,o){t.clipMap.has(o)||t.clipMap.set(o,e)})},e.prototype.getAnimClip=function(t){var e=this.clipMap.get(t.toString());if(e)return e;this.baseAnimator.getAnimClip(t)},e.prototype.getClipMap=function(){return this.clipMap},i([a(s.WdUnitAnimator)],e.prototype,"baseAnimator",void 0),i([a(cc.AnimationClip)],e.prototype,"clips",void 0),i([c],e)}(cc.Component);o.WdUnitAnimatorOverride=l,cc._RF.pop()},{"./WdUnitAnimator":"WdUnitAnimator"}],WdUnitAnimator:[function(t,e,o){"use strict";cc._RF.push(e,"71ac3V9QQ1J6IAiYHOBiwI3","WdUnitAnimator");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitAnimator=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.clips=[],e.clipMap=new Map,e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.clips.forEach(function(e){t.clipMap.set(e.name,e)})},e.prototype.getAnimClip=function(t){return this.clipMap.get(t.toString())},e.prototype.getClipMap=function(){return this.clipMap},i([a(cc.AnimationClip)],e.prototype,"clips",void 0),i([c],e)}(cc.Component);o.WdUnitAnimator=s,cc._RF.pop()},{}],WdUnitCoreAnimEvent:[function(t,e,o){"use strict";cc._RF.push(e,"39ee70QxMdHr7ifPDeFpm1b","WdUnitCoreAnimEvent");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitCoreAnimEvent=void 0;var c=cc._decorator.ccclass,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onAnimEvent=function(t){this.onEvent(t)},i([c()],e)}(cc.Component);o.WdUnitCoreAnimEvent=a,cc._RF.pop()},{}],WdUnitCoreDecorator:[function(t,e,o){"use strict";cc._RF.push(e,"4eccfguy3FLv4K/wtuvVHF8","WdUnitCoreDecorator");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitCoreDecorator=void 0;var i=t("../../core/object/unit/WdUnitKey"),c=t("../../core/object/unit/WdUnitAction"),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),Object.defineProperty(e.prototype,"unit",{get:function(){return this._unit},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enemy",{get:function(){return this.unit.getType()==i.WdUnitType.Enemy?this.unit:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"obj",{get:function(){return this.unit.getType()==i.WdUnitType.Object?this.unit:null},enumerable:!1,configurable:!0}),e.prototype.boot=function(t){this._unit=t,this.onBoot()},e.prototype.onReturn=function(){},e.prototype.onBoot=function(){},e.prototype.onTouch=function(){},e.prototype.makeWalkAction=function(t){var e=new c.WdUnitAction;return e.type=c.WdUnitActionType.Walk,e.range=t,e.target=this.unit.getKey(),e},e}(t("../../../common/coroutine/CoContainer").CoContainer);o.WdUnitCoreDecorator=a,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../core/object/unit/WdUnitAction":"WdUnitAction","../../core/object/unit/WdUnitKey":"WdUnitKey"}],WdUnitDcChest:[function(t,e,o){"use strict";cc._RF.push(e,"3ed9cokm9JJmbEuQVH80fuq","WdUnitDcChest");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitDcChest=void 0;var c=t("../../unit/WdUnitCoreDecorator"),a=t("../../../../common/bean/Decorators"),s=t("../../unit/WdHeroRadar"),l=cc._decorator.ccclass,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animator=null,e.radar=null,e.onHeroEnter=function(){e.onDone()},e}return n(e,t),e.prototype.onLoad=function(){this.animator=this.getComponentInChildren(cc.Animation),this.radar=this.getComponentInChildren(s.WdHeroRadar)},e.prototype.onBoot=function(){var t="Idle",e=this.obj.getDao().value;e&&(t=e.opened?"Unlock":"Idle"),this.animator.play("Chest2_"+t,0),null!=this.radar&&this.radar.onHeroEnter.addHandler(this.onHeroEnter)},e.prototype.onReturn=function(){null!=this.radar&&this.radar.onHeroEnter.removeHandler(this.onHeroEnter)},e.prototype.onTouch=function(t){var e=this,o=this.makeWalkAction(80);o.onDone=function(){return e.onDone()},t.getActor().playAction(o)},e.prototype.getChestValue=function(){return this.obj.getDao().value},e.prototype.onDone=function(){var t=this,e=this.getChestValue();e.opened||(e.opened=!0,this.animator.play("Chest2_Unlock",0),this.startRoutine().wait(.25).do(function(){t.worldService.world.area.receiveReward(t.obj,e.rewards)}))},i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l],e)}(c.WdUnitCoreDecorator);o.WdUnitDcChest=u,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../unit/WdHeroRadar":"WdHeroRadar","../../unit/WdUnitCoreDecorator":"WdUnitCoreDecorator"}],WdUnitDcGate:[function(t,e,o){"use strict";cc._RF.push(e,"930daTCB4lPH5pf6mkcmcNG","WdUnitDcGate");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitDcGate=void 0;var s=t("../../unit/WdUnitCoreDecorator"),l=t("../../../../common/bean/Decorators"),u=t("../../../../rule/model/Model"),p=t("../../../core/object/unit/WdUnitAction"),d=cc._decorator.ccclass,h=t("../../unit/WdHeroRadar"),f=t("../../../core/object/area/WdAreaKey"),y=t("../../../core/object/unit/WdUnitKey"),v=t("../../../UI/popups/WduPopups"),m=t("../../../../App"),g=t("../../../../common/util/CommonAlertBox"),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.radar=null,e.targetArea=f.WdAreaKey.empty,e.hasAlert=!1,e.onHeroEnter=function(t){e.onWalkDone(t)},e.onWalkDone=function(t){return c(e,void 0,void 0,function(){var e;return a(this,function(o){switch(o.label){case 0:return this.hasAlert?[2]:(this.hasAlert=!0,t.getWs().area.getKey().isVillage()&&this.targetArea.isDungeon()?(this.worldService.presenters.ui.popups.openPopup(v.WduPopupType.StartDungeon,null),[3,3]):[3,1]);case 1:return[4,m.app.mainUI.showCommonAlertKey("enter.next.floor",g.AlertType.YesNo)];case 2:o.sent()==g.AlertResultType.Yes&&((e=new p.WdUnitAction).type=p.WdUnitActionType.EnterArea,e.target=this.unit.getKey(),e.param1=this.targetArea.getCode(),e.param2=u.WdObjectType.Gate,t.getActor().playAction(e)),o.label=3;case 3:return this.hasAlert=!1,[2]}})})},e}return n(e,t),e.prototype.onLoad=function(){this.radar=this.getComponentInChildren(h.WdHeroRadar)},e.prototype.onBoot=function(){var t=1;this.unit.getType()==y.WdUnitType.Object&&(t=this.obj.getDao().value.areaCode),this.targetArea=f.WdAreaKey.from(t),this.refresh(),this.radar&&this.radar.onHeroEnter.addHandler(this.onHeroEnter)},e.prototype.onReturn=function(){this.radar&&this.radar.onHeroEnter.removeHandler(this.onHeroEnter)},e.prototype.refresh=function(){},e.prototype.onTouch=function(t){var e=this,o=new p.WdUnitAction;o.type=p.WdUnitActionType.Walk,o.range=100,o.target=this.unit.getKey(),o.onDone=function(){return e.onWalkDone(t)},t.getActor().playAction(o)},i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([d],e)}(s.WdUnitCoreDecorator);o.WdUnitDcGate=W,cc._RF.pop()},{"../../../../App":"App","../../../../common/bean/Decorators":"Decorators","../../../../common/util/CommonAlertBox":"CommonAlertBox","../../../../rule/model/Model":"Model","../../../UI/popups/WduPopups":"WduPopups","../../../core/object/area/WdAreaKey":"WdAreaKey","../../../core/object/unit/WdUnitAction":"WdUnitAction","../../../core/object/unit/WdUnitKey":"WdUnitKey","../../unit/WdHeroRadar":"WdHeroRadar","../../unit/WdUnitCoreDecorator":"WdUnitCoreDecorator"}],WdUnitDcInfoPopup:[function(t,e,o){"use strict";cc._RF.push(e,"d7d36dDeNxAeYB1G9tj7j/X","WdUnitDcInfoPopup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitDcInfoPopup=void 0;var c=t("../WdUnitCoreDecorator"),a=t("../../../../common/bean/Decorators"),s=t("../../../core/object/unit/WdUnitState"),l=t("../../../UI/popups/WduPopups"),u=cc._decorator.ccclass,p=cc._decorator.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type=l.WduPopupType.BuildingInfo,e}return n(e,t),e.prototype.onBoot=function(){},e.prototype.onTouch=function(t){var e=this,o=this.makeWalkAction(160);o.onDone=function(){t.setState(s.WdUnitState.Idle),e.worldService.presenters.ui.popups.openPopup(e.type,e.unit.getKey())},t.getActor().playAction(o)},i([p({type:cc.Enum(l.WduPopupType)})],e.prototype,"type",void 0),i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([u],e)}(c.WdUnitCoreDecorator);o.WdUnitDcInfoPopup=d,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../UI/popups/WduPopups":"WduPopups","../../../core/object/unit/WdUnitState":"WdUnitState","../WdUnitCoreDecorator":"WdUnitCoreDecorator"}],WdUnitDcVillageMatChest:[function(t,e,o){"use strict";cc._RF.push(e,"f49a5gDoFBIa77qt1SQQv42","WdUnitDcVillageMatChest");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitDcVillageMatChest=void 0;var c=t("../../unit/WdUnitCoreDecorator"),a=cc._decorator.property,s=t("../../../../common/bean/Decorators"),l=cc._decorator.ccclass,u=t("../../../UI/popups/WduPopups"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animation=null,e}return n(e,t),e.prototype.onBoot=function(){this.animation.play("Chest1_Idle",0)},e.prototype.onReturn=function(){},e.prototype.onTouch=function(t){var e=this,o=this.makeWalkAction(160);o.onDone=function(){return e.showPopup()},t.getActor().playAction(o)},e.prototype.showPopup=function(){var t=this,e=this.worldService.presenters.ui.popups;this.animation.play("Chest1_Unlock",0),this.startRoutine().wait(.25).do(function(){return e.openPopup(u.WduPopupType.Chest,null,function(){t.startRoutine().wait(.4).do(function(){t.animation.play("Chest1_Idle",0)})})})},i([a(cc.Animation)],e.prototype,"animation",void 0),i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l],e)}(c.WdUnitCoreDecorator);o.WdUnitDcVillageMatChest=p,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../UI/popups/WduPopups":"WduPopups","../../unit/WdUnitCoreDecorator":"WdUnitCoreDecorator"}],WdUnitDcWaypointD:[function(t,e,o){"use strict";cc._RF.push(e,"c0ea3QXPdFNAb0oRsRyjoC9","WdUnitDcWaypointD");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitDcWaypointD=void 0;var c=t("../../unit/WdUnitCoreDecorator"),a=cc._decorator.property,s=t("../../../../common/bean/Decorators"),l=t("../../../../rule/model/Model"),u=t("../../../core/object/unit/WdUnitAction"),p=cc._decorator.ccclass,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.effect=null,e.isOpen=!1,e.onEnemyActorReturn=function(){e.refreshPortal()},e}return n(e,t),e.prototype.onBoot=function(){null!=this.unit&&this.unit.getWs().eventBus.onEnemyActorReturn.addHandler(this.onEnemyActorReturn),this.refreshPortal()},e.prototype.onReturn=function(){null!=this.unit&&this.unit.getWs().eventBus.onEnemyActorReturn.removeHandler(this.onEnemyActorReturn),this.effect.active=!1,this.isOpen=!1},e.prototype.refreshPortal=function(){var t=this.isOpen;this.isOpen=0==this.obj.getWs().area.enemies.size,this.isOpen!=t&&(this.effect.active=this.isOpen)},e.prototype.onTouch=function(t){var e=this;if(this.obj.getRule().type==l.WdObjectType.Waypoint){var o=new u.WdUnitAction;o.type=u.WdUnitActionType.Walk,o.range=20,o.target=this.unit.getKey(),o.onDone=function(){var o=new u.WdUnitAction;o.type=u.WdUnitActionType.WrapUp,o.target=e.unit.getKey(),t.getActor().playAction(o)},t.getActor().playAction(o)}},i([a(cc.Node)],e.prototype,"effect",void 0),i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([p],e)}(c.WdUnitCoreDecorator);o.WdUnitDcWaypointD=d,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../rule/model/Model":"Model","../../../core/object/unit/WdUnitAction":"WdUnitAction","../../unit/WdUnitCoreDecorator":"WdUnitCoreDecorator"}],WdUnitFactory:[function(t,e,o){"use strict";cc._RF.push(e,"f55d8mbH7RIK4acQJyrSmYs","WdUnitFactory");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitFactory=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../hero/WdHeroFactory"),l=t("../enemy/WdEnemyFactory"),u=t("../projectile/WdProjectileAgency"),p=t("../object/WdObjectFactory"),d=t("../effect/WdEffectFactory"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroFactory_=null,e.enemyFactory_=null,e.objectFactory_=null,e.effectFactory_=null,e.projectileAgencies_=[],e}return n(e,t),Object.defineProperty(e.prototype,"heroFactory",{get:function(){return this.heroFactory_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enemyFactory",{get:function(){return this.enemyFactory_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effectFactory",{get:function(){return this.effectFactory_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"projectileAgencies",{get:function(){return this.projectileAgencies_},enumerable:!1,configurable:!0}),e.prototype.getProjectileAgency=function(t){for(var e=0,o=this.projectileAgencies;e<o.length;e++){var r=o[e];if(r.unitType==t)return r}return null},i([a(s.WdHeroFactory)],e.prototype,"heroFactory_",void 0),i([a(l.WdEnemyFactory)],e.prototype,"enemyFactory_",void 0),i([a(p.WdObjectFactory)],e.prototype,"objectFactory_",void 0),i([a(d.WdEffectFactory)],e.prototype,"effectFactory_",void 0),i([a(u.WdProjectileAgency)],e.prototype,"projectileAgencies_",void 0),i([c],e)}(cc.Component);o.WdUnitFactory=h,cc._RF.pop()},{"../effect/WdEffectFactory":"WdEffectFactory","../enemy/WdEnemyFactory":"WdEnemyFactory","../hero/WdHeroFactory":"WdHeroFactory","../object/WdObjectFactory":"WdObjectFactory","../projectile/WdProjectileAgency":"WdProjectileAgency"}],WdUnitKey:[function(t,e,o){"use strict";var r;cc._RF.push(e,"ccf2cIMsIlCWKuySrX3LOTR","WdUnitKey"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitKey=o.WdUnitType=void 0,function(t){t[t.None=0]="None",t[t.Hero=1]="Hero",t[t.Enemy=2]="Enemy",t[t.Object=8]="Object",t[t.Resource=16]="Resource",t[t.DropMaterial=32]="DropMaterial",t[t.DropItem=64]="DropItem",t[t.Building=128]="Building",t[t.Pet=256]="Pet"}(r=o.WdUnitType||(o.WdUnitType={}));var n=function(){function t(t,e){this.type=r.None,this.no=0,this.type=t,this.no=e}return t.prototype.isEmpty=function(){return this.type==r.None||0==this.no},t.prototype.pack=function(){return this.type+"-"+this.no},t.unpack=function(e){var o=e.split("-");return new t(parseInt(o[0]),parseInt(o[1]))},t.build=function(e,o){return new t(e,o)},t.empty=new t(r.None,0),t}();o.WdUnitKey=n,cc._RF.pop()},{}],WdUnitRadar:[function(t,e,o){"use strict";cc._RF.push(e,"6b6faPkPdJFbYipSRv7vQOa","WdUnitRadar");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitRadar=void 0;var c=t("../../../common/bean/Decorators"),a=t("../../../common/util/EventHandler"),s=t("../../../App"),l=t("../../core/object/unit/WdUnitKey"),u=t("../../core/common/WdVec"),p=cc._decorator.ccclass,d=t("./WdUnitActorCore"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.heroes=new Map,e.enemies=new Map,e.objects=new Map,e.onUnitEnter=new a.EventHandlerT1,e.onUnitExit=new a.EventHandlerT1,e.onAreaTearDown=function(){e.clear()},e.onEnemyActorReturn=function(t){e.enemies.delete(t.getKey().pack())},e.onObjectActorReturn=function(t){e.objects.delete(t.getKey().pack())},e.onCollisionEnter=function(t){var o=t.getComponent(d.WdUnitActorCore);if(null!=o){var r=o.unit.getKey().pack();switch(o.unit.getType()){case l.WdUnitType.Hero:e.heroes.set(r,o.hero);break;case l.WdUnitType.Enemy:e.enemies.set(r,o.enemy);break;case l.WdUnitType.Object:e.objects.set(r,o.obj)}e.onUnitEnter.fire(o.unit)}},e.onCollisionExit=function(t){var o=t.getComponent(d.WdUnitActorCore);if(null!=o){var r=o.unit.getKey().pack();switch(o.unit.getType()){case l.WdUnitType.Hero:e.heroes.delete(r);break;case l.WdUnitType.Enemy:e.enemies.delete(r);break;case l.WdUnitType.Object:e.objects.delete(r)}e.onUnitExit.fire(o.unit)}},e}return n(e,t),e.prototype.onLoad=function(){this.col=this.getComponent(cc.Collider),this.col.enabled=!1},e.prototype.readyEvent=function(){var t=this.worldService.world;t.eventBus.onEnemyActorReturn.addHandler(this.onEnemyActorReturn),t.eventBus.onObjectActorReturn.addHandler(this.onObjectActorReturn),t.eventBus.onAreaTearDown.addHandler(this.onAreaTearDown)},e.prototype.clearEvent=function(){var t=this.worldService.world;t.eventBus.onEnemyActorReturn.removeHandler(this.onEnemyActorReturn),t.eventBus.onObjectActorReturn.removeHandler(this.onObjectActorReturn),t.eventBus.onAreaTearDown.removeHandler(this.onAreaTearDown)},e.prototype.clear=function(){this.heroes.clear(),this.enemies.clear(),this.objects.clear()},e.prototype.onDisable=function(){s.app.ready&&(this.clear(),this.clearEvent(),this.col.enabled=!1)},e.prototype.boot=function(){this.onUnitEnter=new a.EventHandlerT1,this.onUnitExit=new a.EventHandlerT1,this.col.enabled=!0,this.readyEvent()},e.prototype.isInRadar=function(t){var e=t.getKey().pack();return t.getType()==l.WdUnitType.Hero?this.heroes.has(e):t.getType()==l.WdUnitType.Enemy?this.enemies.has(e):t.getType()==l.WdUnitType.Object&&this.objects.has(e)},e.prototype.getNearestEnemy=function(t){return this.getNearestFromBucket(t,this.enemies)},e.prototype.getNearestFromBucket=function(t,e){var o=99999999,r=null,n=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO),i=new u.WdVec(n.x,n.y).add(t.getDirection().scalar(.5));return e.forEach(function(t){if(!t.isDead()){var e=t.getGatePos().subtract(i).len2();e<o&&(o=e,r=t)}}),r},e.prototype.getNearest=function(t,e){var o,r=new Map;return(e&l.WdUnitType.Hero)>0&&(o=this.getNearestFromBucket(t,this.heroes))&&r.set(o.getKey().pack(),o),(e&l.WdUnitType.Enemy)>0&&(o=this.getNearestFromBucket(t,this.enemies))&&r.set(o.getKey().pack(),o),(e&l.WdUnitType.Object)>0&&(o=this.getNearestFromBucket(t,this.objects))&&r.set(o.getKey().pack(),o),0==r.size?null:this.getNearestFromBucket(t,r)},i([c.autoWired("WorldService")],e.prototype,"worldService",void 0),i([p],e)}(cc.Component);o.WdUnitRadar=h,cc._RF.pop()},{"../../../App":"App","../../../common/bean/Decorators":"Decorators","../../../common/util/EventHandler":"EventHandler","../../core/common/WdVec":"WdVec","../../core/object/unit/WdUnitKey":"WdUnitKey","./WdUnitActorCore":"WdUnitActorCore"}],WdUnitRewardValue:[function(t,e,o){"use strict";cc._RF.push(e,"31c33eif8BLmKXICWVZw0k6","WdUnitRewardValue"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitRewardValue=void 0;var r=t("../../../../rule/model/Model"),n=function(){function t(){this.type=r.WdResourceType.None,this.code=0,this.amount=0}return t.build=function(e,o,r){var n=new t;return n.type=e,n.code=o,n.amount=r,n},t}();o.WdUnitRewardValue=n,cc._RF.pop()},{"../../../../rule/model/Model":"Model"}],WdUnitState:[function(t,e,o){"use strict";cc._RF.push(e,"25d8bYFeHhJbahqLwOwPhRs","WdUnitState"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitState2=o.WdUnitState=void 0,function(t){t[t.None="None"]="None",t[t.Idle="Idle"]="Idle",t[t.Run="Run"]="Run",t[t.Jump="Jump"]="Jump",t[t.Walk="Walk"]="Walk",t[t.Water="Water"]="Water",t[t.Hurt="Hurt"]="Hurt",t[t.Death="Death"]="Death",t[t.Doing="Doing"]="Doing",t[t.Mining="Mining"]="Mining",t[t.Hammer="Hammer"]="Hammer",t[t.Dig="Dig"]="Dig",t[t.Attack1="Attack1"]="Attack1",t[t.Attack2="Attack2"]="Attack2",t[t.Attack3="Attack3"]="Attack3",t[t.Attack4="Attack4"]="Attack4",t[t.Skill1="Skill1"]="Skill1",t[t.Skill2="Skill2"]="Skill2",t[t.Skill3="Skill3"]="Skill3",t[t.Skill4="Skill4"]="Skill4"}(o.WdUnitState||(o.WdUnitState={})),function(t){t[t.None=0]="None",t[t.Idle=1]="Idle"}(o.WdUnitState2||(o.WdUnitState2={})),cc._RF.pop()},{}],WdUnitUtil:[function(t,e,o){"use strict";cc._RF.push(e,"68352k9Tf5FO4G6EH2PzmSi","WdUnitUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitUtil=void 0;var r=t("../../common/WdVec"),n=t("./WdUnitState"),i=t("../../common/WdRandomUtil"),c=function(){function t(){}return t.getDistance=function(t,e){return t.getPos().subtract(e.getPos()).len()-t.getRadius()-e.getRadius()},t.getDirection=function(t,e){return e.subtract(t).normalize()},t.isAttackState=function(t){return t==n.WdUnitState.Attack1||t==n.WdUnitState.Attack2||t==n.WdUnitState.Attack3||t==n.WdUnitState.Attack4||t==n.WdUnitState.Skill1||t==n.WdUnitState.Skill2||t==n.WdUnitState.Skill3||t==n.WdUnitState.Skill4},t.isSkillState=function(t){return t==n.WdUnitState.Skill1||t==n.WdUnitState.Skill2||t==n.WdUnitState.Skill3||t==n.WdUnitState.Skill4},t.randomCirclePositions=function(t,e){void 0===e&&(e=10);for(var o=new Array,n=-e;n<=e;n++)for(var c=-e;c<=e;c++)if(0!=n||0!=c){var a=n/e,s=c/e;a*a+s*s<=1&&o.push(new r.WdVec(a,s))}return i.WdRandomUtil.shuffle(o),o.length>t&&(o=o.slice(0,t)),o},t}();o.WdUnitUtil=c,cc._RF.pop()},{"../../common/WdRandomUtil":"WdRandomUtil","../../common/WdVec":"WdVec","./WdUnitState":"WdUnitState"}],WdUnitValue:[function(t,e,o){"use strict";cc._RF.push(e,"43f9cb3zBtGLao2UK33b/+Q","WdUnitValue"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitValue=void 0;o.WdUnitValue=function(){this.data=new Map},cc._RF.pop()},{}],WdUnit:[function(t,e,o){"use strict";cc._RF.push(e,"778189rH8lIvIKY1QGDIsn2","WdUnit"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUnitFaceSide=void 0,function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right"}(o.WdUnitFaceSide||(o.WdUnitFaceSide={})),cc._RF.pop()},{}],WdUtil:[function(t,e,o){"use strict";cc._RF.push(e,"1f2a0FDo7tCaYj9ofTs0wHf","WdUtil"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdUtil=void 0;var r=t("../../../rule/model/Model"),n=function(){function t(){}return t.approximately=function(t,e){return Math.abs(t-e)<this.epsilon},t.valueForAr=function(t){switch(t){case r.WdAttackRange.Shorter:return 1;case r.WdAttackRange.Short:return 2;case r.WdAttackRange.Normal:return 3;case r.WdAttackRange.Long:return 4;case r.WdAttackRange.Longer:return 5}return 0},t.valueForAs=function(t){switch(t){case r.WdAttackSpeed.Slowest:return 3;case r.WdAttackSpeed.Slower:return 2;case r.WdAttackSpeed.Slow:return 1.5;case r.WdAttackSpeed.Normal:return 1;case r.WdAttackSpeed.Fast:return.7;case r.WdAttackSpeed.Faster:return.4;case r.WdAttackSpeed.Fastest:return.2}return 0},t.valueForWs=function(t){switch(t){case r.WdWalkSpeed.Slowest:return.5;case r.WdWalkSpeed.Slower:return 1;case r.WdWalkSpeed.Slow:return 2;case r.WdWalkSpeed.Normal:return 3;case r.WdWalkSpeed.Fast:return 4;case r.WdWalkSpeed.Faster:return 5;case r.WdWalkSpeed.Fastest:return 6}return 0},t.epsilon=.001,t.deg2Rad=2*Math.PI/360,t.rad2Deg=360/(2*Math.PI),t.lerp=function(t,e,o){return t*(1-o)+e*o},t}();o.WdUtil=n,cc._RF.pop()},{"../../../rule/model/Model":"Model"}],WdVec:[function(t,e,o){"use strict";cc._RF.push(e,"120c5StqwlDJp1+5zL9COP9","WdVec"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdVec=void 0;var r=function(){function t(t,e){this.x=0,this.y=0,void 0!==t&&(this.x=t),void 0!==e&&(this.y=e)}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.scalar=function(e){return new t(this.x*e,this.y*e)},t.prototype.normalize=function(){var e=this.len();return new t(this.x/e,this.y/e)},t.prototype.len2=function(){return this.x*this.x+this.y*this.y},t.prototype.len=function(){return Math.sqrt(this.len2())},t.prototype.rotate=function(e){var o=Math.sin(e),r=Math.cos(e);return new t(r*this.x-o*this.y,r*this.y+o*this.x)},t.prototype.round=function(){return new t(Math.round(this.x),Math.round(this.y))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.equals=function(t){return this.x==t.x&&this.y==t.y},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.pack=function(){return JSON.stringify(this)},t.build=function(e,o){return new t(e,o)},t.zero=new t(0,0),t.one=new t(1,1),t.up=new t(0,1),t.down=new t(0,-1),t.left=new t(-1,0),t.right=new t(1,0),t.leftTop=new t(-1,1),t.top=new t(0,1),t.rightTop=new t(1,1),t.leftBottom=new t(-1,-1),t.bottom=new t(0,-1),t.rightBottom=new t(1,-1),t.news=[t.up,t.left,t.right,t.down],t}();o.WdVec=r,cc._RF.pop()},{}],WdVillagePulsar:[function(t,e,o){"use strict";cc._RF.push(e,"148f1nH/39MFKRb9K487I89","WdVillagePulsar");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdVillagePulsar=void 0;var n=t("../../../../../common/bean/Decorators"),i=t("../../../common/WdVec"),c=t("../../object/WdObject"),a=t("../../object/value/WdGateValue"),s=t("../WdAreaKey"),l=function(){function t(t){this.ws=t}return t.prototype.boot=function(){this.generateGate(),this.generateChest(),this.newDeco(100,new i.WdVec(-3,7.5)),this.newDeco(100,new i.WdVec(-.6,7)),this.newDeco(100,new i.WdVec(3.5,6.5)),this.newDeco(100,new i.WdVec(1.5,7.5)),this.newDeco(100,new i.WdVec(-3.2,-6)),this.newDeco(100,new i.WdVec(-1.5,-6.5)),this.newDeco(100,new i.WdVec(-.3,-5.8))},t.prototype.onTick=function(){},t.prototype.generateGate=function(){var t=this.ws.area.getKey(),e=this.objectService.newObject(t,221,i.WdVec.build(1.5,.5).scalar(80));e.value=new a.WdGateValue(s.WdAreaKey.build(1,1).getCode());var o=new c.WdObject(e);o.boot(this.ws),this.ws.area.addObject(o,!1)},t.prototype.generateChest=function(){var t=this.objectService.newObject(this.ws.area.getKey(),51,i.WdVec.build(-.5,.5).scalar(80)),e=new c.WdObject(t);e.boot(this.ws),this.ws.area.addObject(e,!1)},t.prototype.newDeco=function(t,e){var o=this.objectService.newObject(this.ws.area.getKey(),t,e.scalar(80)),r=new c.WdObject(o);r.boot(this.ws),this.ws.area.addObject(r,!1)},r([n.autoWired("WdObjectService")],t.prototype,"objectService",void 0),t}();o.WdVillagePulsar=l,cc._RF.pop()},{"../../../../../common/bean/Decorators":"Decorators","../../../common/WdVec":"WdVec","../../object/WdObject":"WdObject","../../object/value/WdGateValue":"WdGateValue","../WdAreaKey":"WdAreaKey"}],WdWpAttackArrow:[function(t,e,o){"use strict";cc._RF.push(e,"ad2cfyUf/dKK547/P0h9GLV","WdWpAttackArrow");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpAttackArrow=void 0;var n=t("../../../../../common/bean/Decorators"),i=t("../../../../core/object/unit/WdUnitKey"),c=t("../../../../../rule/model/Model"),a=t("../../../../core/common/WdUtil"),s=t("../../../../core/object/unit/WdAttack"),l=t("../../../../core/object/unit/WdUnitState"),u=function(){function t(t,e,o){this.done=!1,this.target=null,this.remainToDone=0,this.hero=t,this.action=e,this.prjAgency=o}return t.prototype.onStart=function(){this.target=this.hero.getTarget(),null!=this.target&&this.target.getType()==i.WdUnitType.Enemy?(this.hero.getActor().attackTo(this.target,l.WdUnitState.Attack1),this.remainToDone=this.hero.getCore().getAnimLen(l.WdUnitState.Attack1)):this.done=!0},t.prototype.fire=function(t){var e,o,r,n,i,l=this,u=this.getSkills(c.WdSkillType.Repeater),p=this.getSkills(c.WdSkillType.MultiArrow),d=this.getSkills(c.WdSkillType.Ricochet),h=this.getSkills(c.WdSkillType.PiercingShot),f=a.WdUtil.valueForAs(this.hero.getWeaponRule().attackSpeed),y=1+this.hero.getDao().stats.getAvgSum(c.WdStatType.UnitAttackBoost);null!=p&&(y*=1-p.v1),null!=u&&(y*=1-u.v1);var v=new s.WdAttack;v.attacks=this.hero.getDao().stats.getAllAttacks(),v.cool=f,v.attackRate=1,v.attackBoost=y,v.power=this.hero.getWeaponRule().power,v.ricochet=Math.round(null!==(e=null==d?void 0:d.v3)&&void 0!==e?e:0)+1,v.piercing=null!=h,v.ricochetReduce=null!==(o=null==d?void 0:d.v2)&&void 0!==o?o:0,v.piercingReduce=null!==(r=null==h?void 0:h.v1)&&void 0!==r?r:0,v.shake=c.WdCamShake.Normal;for(var m=Math.round(null!==(n=null==p?void 0:p.v2)&&void 0!==n?n:0)+1,g=t.getPos().subtract(this.hero.getPos()).normalize().rotate(90*a.WdUtil.deg2Rad).scalar(40),W=Math.round(null!==(i=null==u?void 0:u.v3)&&void 0!==i?i:0)+1,b=0,S=0;S<W;S++){for(var _=g.scalar((m-1)/2*-1),A=function(){var t=_.clone();P.hero.getWs().tickHelper.runAfter(b,function(){l.fireProjectile(v,t)}),_=_.add(g)},P=this,R=0;R<m;R++)A();b+=.2}},t.prototype.getSkills=function(t){for(var e=0,o=Array.from(this.hero.getDao().skills.values());e<o.length;e++){var r=o[e],n=this.ruleService.getSkill(r);if(n.type==t)return n}return null},t.prototype.onTick=function(t){this.remainToDone-=t,this.remainToDone<0&&(this.hero.setState(l.WdUnitState.Idle),this.done=!0)},t.prototype.fireProjectile=function(t,e){var o=this.hero.getTarget();if(null!=o){var r=this.hero.getWeaponRule().code,n=this.prjAgency.get(r);if(null!=n){var i=this.hero.getPos().add(e),c=o.getCore().bodyAnchor.add(e);n.fire(this.hero,t,i,c)}else console.error("no project found for: "+r)}},t.prototype.onAnimEvent=function(t){"fire"===t&&this.fire(this.target)},t.prototype.onDead=function(){},r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WdWpAttackArrow=u,cc._RF.pop()},{"../../../../../common/bean/Decorators":"Decorators","../../../../../rule/model/Model":"Model","../../../../core/common/WdUtil":"WdUtil","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdUnitKey":"WdUnitKey","../../../../core/object/unit/WdUnitState":"WdUnitState"}],WdWpSkillBonusLife:[function(t,e,o){"use strict";cc._RF.push(e,"642335B3bxCFL0G1W4QQ9Ul","WdWpSkillBonusLife"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillBonusLife=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttackCalculator"),i=t("../../../../core/object/unit/WdAttack"),c=function(){function t(t,e){this.done=!1,this.hero=t,this.rule=e,this.calculator=new n.WdAttackCalculator(t)}return t.prototype.onStart=function(t){var e=this;this.action=t;var o=this.hero.getDao().stats.getAllAttacks(),n=Array.from(this.hero.getActor().radar.enemies.values()),c=new i.WdAttack;c.attacks=o,c.cool=1,c.attackRate=1,c.attackBoost=1,c.ricochet=1,c.shake=r.WdCamShake.High,c.power=4,n.forEach(function(t){var o=e.calculator.makeDamages(c,t);e.hero.attack(t,o)})},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillBonusLife=c,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdAttackCalculator":"WdAttackCalculator"}],WdWpSkillIcePillar:[function(t,e,o){"use strict";cc._RF.push(e,"41ffbHLh5VDTYQciqgfdlLv","WdWpSkillIcePillar"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillIcePillar=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttack"),i=t("../../../../core/object/unit/WdStat"),c=function(){function t(t,e,o){this.done=!1,this.hero=t,this.rule=e,this.prjAgency=o}return t.prototype.onStart=function(t){this.action=t;var e=this.prjAgency.getSkill(this.rule.code);if(null==e)return console.error("no project found for: "+this.rule.code),void(this.done=!0);var o=t.to,r=this.hero.getWs().area.getUnit(t.target);if(null!=r){var n=r.getPos().subtract(this.hero.getPos()),i=n.len();i>160&&(o=this.hero.getPos().add(n.normalize().scalar(i-40)))}e.fire(this.hero,this.getAttack(),o,o),this.done=!0},t.prototype.getAttack=function(){var t=this.hero.getStats(),e=new Array,o=t.getMinSum(r.WdStatType.PhysicalAttack),c=t.getMaxSum(r.WdStatType.PhysicalAttack),a=t.getAvgSum(r.WdStatType.ColdAttack);e.push(i.WdStat.build(r.WdStatType.ColdAttack,o+a,c+a,this.rule.cc));var s=new n.WdAttack;return s.attacks=e,s.attackBoost=t.atkSpdBoost*this.rule.v1,s.attackRate=1,s.cool=1,s.piercing=!1,s.power=1,s.ricochet=1,s.shake=r.WdCamShake.Normal,s},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillIcePillar=c,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdStat":"WdStat"}],WdWpSkillLightningShield:[function(t,e,o){"use strict";cc._RF.push(e,"9805aGE4sVIbK1JOhdwyyRd","WdWpSkillLightningShield"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillLightningShield=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttack"),i=t("../../../../core/object/unit/WdStat"),c=function(){function t(t,e,o){this.done=!1,this.hero=t,this.rule=e,this.prjAgency=o}return t.prototype.onStart=function(t){this.action=t;var e=this.prjAgency.getSkill(this.rule.code);if(null==e)return console.error("no project found for: "+this.rule.code),void(this.done=!0);null!=e&&e.setTraceTarget(this.hero.getActor().core.node.parent);var o=this.hero.getPos();e.fire(this.hero,this.getAttack(),o,o),this.done=!0},t.prototype.getAttack=function(){var t=this.hero.getStats(),e=new Array,o=t.getMinSum(r.WdStatType.PhysicalAttack),c=t.getMaxSum(r.WdStatType.PhysicalAttack),a=t.getAvgSum(r.WdStatType.LightningAttack);e.push(i.WdStat.build(r.WdStatType.LightningAttack,o+a,c+a,this.rule.cc));var s=new n.WdAttack;return s.attacks=e,s.attackBoost=t.atkSpdBoost*this.rule.v1,s.attackRate=1,s.cool=1,s.piercing=!1,s.power=1,s.ricochet=1,s.shake=r.WdCamShake.Normal,s},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillLightningShield=c,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdStat":"WdStat"}],WdWpSkillLightningStrike:[function(t,e,o){"use strict";cc._RF.push(e,"cf5e6BomkZP6IyOQw1P5Cux","WdWpSkillLightningStrike"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillLightningStrike=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttack"),i=t("../../../../core/object/unit/WdStat"),c=function(){function t(t,e,o){this.done=!1,this.hero=t,this.rule=e,this.prjAgency=o}return t.prototype.onStart=function(t){this.action=t;var e=this.prjAgency.getSkill(this.rule.code);if(null==e)return console.error("no project found for: "+this.rule.code),void(this.done=!0);var o=t.to,r=this.hero.getWs().area.getUnit(t.target);if(null!=r){var n=r.getPos().subtract(this.hero.getPos()),i=n.len();i>160&&(o=this.hero.getPos().add(n.normalize().scalar(i-40)))}e.fire(this.hero,this.getAttack(),o,o),this.done=!0},t.prototype.getAttack=function(){var t=this.hero.getStats(),e=new Array,o=t.getMinSum(r.WdStatType.PhysicalAttack),c=t.getMaxSum(r.WdStatType.PhysicalAttack),a=t.getAvgSum(r.WdStatType.LightningAttack);e.push(i.WdStat.build(r.WdStatType.LightningAttack,o+a,c+a,this.rule.cc));var s=new n.WdAttack;return s.attacks=e,s.attackBoost=t.atkSpdBoost*this.rule.v1,s.attackRate=1,s.cool=1,s.piercing=!1,s.power=3,s.ricochet=1,s.shake=r.WdCamShake.High,s},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillLightningStrike=c,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdStat":"WdStat"}],WdWpSkillMagicBomb:[function(t,e,o){"use strict";cc._RF.push(e,"e123a7lpsxC0ZH5JSqlDEY+","WdWpSkillMagicBomb"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillMagicBomb=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttack"),i=t("../../../../core/object/unit/WdStat"),c=t("../../../../core/object/unit/WdUnitUtil"),a=function(){function t(t,e,o){this.done=!1,this.hero=t,this.rule=e,this.prjAgency=o}return t.prototype.onStart=function(t){var e=this;this.action=t;var o=Math.round(this.rule.v2);o+=Math.round(this.hero.getStats().getAvgSum(r.WdStatType.MagicBombBM));var n=c.WdUnitUtil.randomCirclePositions(o,4),i=0;n.forEach(function(t){var o=t.scalar(240),r=e.hero.getPos().add(o),n=e.prjAgency.getSkill(e.rule.code);if(null!=n){var c=.5*i++;e.hero.getWs().tickHelper.runAfter(c,function(){n.fire(e.hero,e.getAttack(),e.hero.getPos(),r)})}else console.error("no project found for: "+e.rule.code)}),this.done=!0},t.prototype.getAttack=function(){var t=this.hero.getStats(),e=new Array,o=t.getMinSum(r.WdStatType.PhysicalAttack),c=t.getMaxSum(r.WdStatType.PhysicalAttack),a=t.getAvgSum(r.WdStatType.FireAttack);e.push(i.WdStat.build(r.WdStatType.FireAttack,o+a,c+a,this.rule.cc));var s=new n.WdAttack;return s.attacks=e,s.attackBoost=t.atkSpdBoost*this.rule.v1,s.attackRate=1,s.cool=1,s.piercing=!1,s.power=3,s.ricochet=1,s.shake=r.WdCamShake.High,s},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillMagicBomb=a,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdStat":"WdStat","../../../../core/object/unit/WdUnitUtil":"WdUnitUtil"}],WdWpSkillMeteor:[function(t,e,o){"use strict";cc._RF.push(e,"8f308smN8ZALpyEbx1B3BzR","WdWpSkillMeteor"),Object.defineProperty(o,"__esModule",{value:!0}),o.WdWpSkillMeteor=void 0;var r=t("../../../../../rule/model/Model"),n=t("../../../../core/object/unit/WdAttack"),i=t("../../../../core/object/unit/WdStat"),c=function(){function t(t,e,o){this.done=!1,this.hero=t,this.rule=e,this.prjAgency=o}return t.prototype.onStart=function(t){this.action=t;var e=this.prjAgency.getSkill(this.rule.code);if(null==e)return console.error("no project found for: "+this.rule.code),void(this.done=!0);var o=t.to,r=this.hero.getWs().area.getUnit(t.target);if(null!=r){var n=r.getPos().subtract(this.hero.getPos()),i=n.len();i>160&&(o=this.hero.getPos().add(n.normalize().scalar(i-40)))}e.fire(this.hero,this.getAttack(),o,o),this.done=!0},t.prototype.getAttack=function(){var t=this.hero.getStats(),e=new Array,o=t.getMinSum(r.WdStatType.PhysicalAttack),c=t.getMaxSum(r.WdStatType.PhysicalAttack),a=t.getAvgSum(r.WdStatType.FireAttack);e.push(i.WdStat.build(r.WdStatType.FireAttack,o+a,c+a,this.rule.cc));var s=new n.WdAttack;return s.attacks=e,s.attackBoost=t.atkSpdBoost*this.rule.v1,s.attackRate=1,s.cool=1,s.piercing=!1,s.power=4,s.ricochet=1,s.shake=r.WdCamShake.Higher,s},t.prototype.onTick=function(){},t.prototype.onAnimEvent=function(){},t.prototype.onDead=function(){},t}();o.WdWpSkillMeteor=c,cc._RF.pop()},{"../../../../../rule/model/Model":"Model","../../../../core/object/unit/WdAttack":"WdAttack","../../../../core/object/unit/WdStat":"WdStat"}],WduColorPalette:[function(t,e,o){"use strict";cc._RF.push(e,"bf802UqZK1McLLXIDrmU+x0","WduColorPalette");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduColorPalette=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../rule/model/Model"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.itemNone=cc.Color.WHITE,e.itemNormal=cc.Color.WHITE,e.itemMagic=cc.Color.WHITE,e.itemRare=cc.Color.WHITE,e.itemUnique=cc.Color.WHITE,e.itemSet=cc.Color.WHITE,e.itemTxtNormal=cc.Color.WHITE,e.itemTxtMagic=cc.Color.WHITE,e.itemTxtRare=cc.Color.WHITE,e.itemTxtUnique=cc.Color.WHITE,e.itemTxtSet=cc.Color.WHITE,e.levelUp=cc.Color.WHITE,e.afNone=cc.Color.WHITE,e.afRune=cc.Color.WHITE,e.afFood=cc.Color.WHITE,e.afSpecial=cc.Color.WHITE,e}return n(e,t),e.prototype.getItemColor=function(t){switch(t){case s.WdItemCategory.Normal:return this.itemNormal;case s.WdItemCategory.Magic:return this.itemMagic;case s.WdItemCategory.Rare:return this.itemRare;case s.WdItemCategory.Unique:return this.itemUnique;case s.WdItemCategory.Set:return this.itemSet}return this.itemNone},e.prototype.getItemTextColor=function(t){switch(t){case s.WdItemCategory.Normal:return this.itemTxtNormal;case s.WdItemCategory.Magic:return this.itemTxtMagic;case s.WdItemCategory.Rare:return this.itemTxtRare;case s.WdItemCategory.Unique:return this.itemTxtUnique;case s.WdItemCategory.Set:return this.itemTxtSet}return this.itemNone},e.prototype.getArtifactColor=function(t){switch(t){case s.WdArtifactCategory.Rune:return this.afRune;case s.WdArtifactCategory.Food:return this.afFood;case s.WdArtifactCategory.Special:return this.afSpecial}return this.afNone},e.prototype.getColorLevelUpHexColor=function(){return"#"+this.levelUp.toHEX("#rrggbb")},e.prototype.getItemTextHexColor=function(t){return"#"+this.getItemTextColor(t).toHEX("#rrggbb")},i([a(cc.Color)],e.prototype,"itemNone",void 0),i([a(cc.Color)],e.prototype,"itemNormal",void 0),i([a(cc.Color)],e.prototype,"itemMagic",void 0),i([a(cc.Color)],e.prototype,"itemRare",void 0),i([a(cc.Color)],e.prototype,"itemUnique",void 0),i([a(cc.Color)],e.prototype,"itemSet",void 0),i([a(cc.Color)],e.prototype,"itemTxtNormal",void 0),i([a(cc.Color)],e.prototype,"itemTxtMagic",void 0),i([a(cc.Color)],e.prototype,"itemTxtRare",void 0),i([a(cc.Color)],e.prototype,"itemTxtUnique",void 0),i([a(cc.Color)],e.prototype,"itemTxtSet",void 0),i([a(cc.Color)],e.prototype,"levelUp",void 0),i([a(cc.Color)],e.prototype,"afNone",void 0),i([a(cc.Color)],e.prototype,"afRune",void 0),i([a(cc.Color)],e.prototype,"afFood",void 0),i([a(cc.Color)],e.prototype,"afSpecial",void 0),i([c],e)}(cc.Component);o.WduColorPalette=l,cc._RF.pop()},{"../../../rule/model/Model":"Model"}],WduCommonStatBox:[function(t,e,o){"use strict";cc._RF.push(e,"f8f7blY0s5EsKCGjYDMBOdF","WduCommonStatBox");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduCommonStatBox=void 0;var c=cc._decorator.ccclass,a=t("./WduCommonStatCell"),s=cc._decorator.property,l=t("../../../common/bean/Decorators"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prefab=null,e.cells=new Array,e}return n(e,t),e.prototype.onLoad=function(){this.prefab.node.active=!1},e.prototype.display=function(t){var e=this;this.cells.forEach(function(t){e.goPooler.returnGo(t)}),this.cells=[];var o=t.trim().split("\n"),r=0;o.forEach(function(t){var o=e.goPooler.fromPrefab(e.prefab,e.node);o.display(t),o.node.setPosition(cc.v2(0,-r)),r+=o.getHeight(),e.cells.push(o)}),this.node.height=r},e.prototype.getHeight=function(){return this.node.height},i([s(a.WduCommonStatCell)],e.prototype,"prefab",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([l.autoWired("WdItemService")],e.prototype,"itemService",void 0),i([l.autoWired("RuleService")],e.prototype,"ruleService",void 0),i([c],e)}(cc.Component);o.WduCommonStatBox=u,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","./WduCommonStatCell":"WduCommonStatCell"}],WduCommonStatCell:[function(t,e,o){"use strict";cc._RF.push(e,"d8bd3xmPLNIDbx+KwWAIdZ1","WduCommonStatCell");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduCommonStatCell=void 0;var c=t("../../../common/util/GoItem"),a=cc._decorator.ccclass,s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){this.textLabel=this.getComponent(cc.RichText)},e.prototype.display=function(t){this.textLabel.string=t},e.prototype.getHeight=function(){return this.textLabel.node.height},i([a],e)}(c.default);o.WduCommonStatCell=s,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem"}],WduCommonStatPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"0ead2dXe6lDgJnQ7iiXnLve","WduCommonStatPresenter");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduCommonStatPresenter=void 0;var n=t("../../../common/bean/Decorators"),i=t("../../../rule/model/Model"),c=t("typescript-string-operations"),a=function(){function t(){var t=this;this.handlers=new Map,this.magicColor="",this.titlePrefix="",this.valuePrefix="",this.commonStat=function(e,o){t.writeIntValue(e,o)},this.magicAttackStat=function(e,o){t.writeIntValue(e,o),o.Append(" "),null!=e.cc&&o.Append(t.sbService.format("stat.desc.Chance",Math.round(100*e.cc.fireRate)))},this.coldAttackStat=function(e,o){t.writeIntValue(e,o),o.Append(" "),o.Append(t.sbService.format("stat.desc.Cold",e.cc.duration,e.cc.v1)),o.Append(" "),o.Append(t.sbService.format("stat.desc.Chance",Math.round(100*e.cc.fireRate)))},this.poisonAttackStat=function(e,o){t.writeIntValue(e,o),o.Append(" "),o.Append(t.sbService.format("stat.desc.Poison",e.cc.duration)),o.Append(" "),o.Append(t.sbService.format("stat.desc.Chance",Math.round(100*e.cc.fireRate)))},this.percentStat=function(e,o){if(e.type==i.WdStatType.LifeStolenPerHit){var r=(100*e.minV).toFixed(2),n=(100*e.maxV).toFixed(2);o.Append(t.valuePrefix),o.Append(r==n?r+"%":r+"-"+n+"%")}else t.writePercentValue(e,o)},this.attackBoostLessHpStat=function(e,o){var r=Math.round(100*e.minV);o.Append(t.sbService.format("stat.desc.AttackBoostLessHp",r))},this.potion=function(e,o){var r=Math.round(e.minV);o.Append(t.sbService.get("potion.name."+r))}}return t.prototype.ready=function(){this.handlers.size>0||(this.handlers.set(i.WdStatType.Life,this.commonStat),this.handlers.set(i.WdStatType.PhysicalAttack,this.commonStat),this.handlers.set(i.WdStatType.FireAttack,this.magicAttackStat),this.handlers.set(i.WdStatType.LightningAttack,this.magicAttackStat),this.handlers.set(i.WdStatType.ColdAttack,this.coldAttackStat),this.handlers.set(i.WdStatType.PoisonAttack,this.poisonAttackStat),this.handlers.set(i.WdStatType.ItemAttackBoost,this.percentStat),this.handlers.set(i.WdStatType.Defense,this.commonStat),this.handlers.set(i.WdStatType.PhysicalResist,this.percentStat),this.handlers.set(i.WdStatType.MagicResist,this.percentStat),this.handlers.set(i.WdStatType.MagicDurationReduction,this.percentStat),this.handlers.set(i.WdStatType.LifeStolenPerHit,this.percentStat),this.handlers.set(i.WdStatType.CoolReduction,this.percentStat),this.handlers.set(i.WdStatType.WalkBoost,this.percentStat),this.handlers.set(i.WdStatType.DropBonus,this.percentStat),this.handlers.set(i.WdStatType.ArtifactDropBonus,this.percentStat),this.handlers.set(i.WdStatType.BonusSkill,this.commonStat),this.handlers.set(i.WdStatType.Potion,this.potion),this.handlers.set(i.WdStatType.AttackBoostLessHp,this.attackBoostLessHpStat),this.handlers.set(i.WdStatType.BonusChest,this.percentStat),this.handlers.set(i.WdStatType.BonusBarrel,this.percentStat),this.handlers.set(i.WdStatType.CircleSpeed,this.percentStat),this.handlers.set(i.WdStatType.GhostDR,this.percentStat),this.handlers.set(i.WdStatType.MeteorCR,this.percentStat),this.handlers.set(i.WdStatType.BonusLifeLB,this.percentStat),this.handlers.set(i.WdStatType.MagicBombBM,this.commonStat),this.handlers.set(i.WdStatType.IcePillarCR,this.percentStat),this.handlers.set(i.WdStatType.LightningStrikeCR,this.percentStat),this.handlers.set(i.WdStatType.LightningShieldCR,this.percentStat),this.magicColor=this.worldService.presenters.palette.getItemTextHexColor(i.WdItemCategory.Magic))},t.prototype.getTextFor=function(t){this.ready();var e=this.itemService.calculateStats(t);return this.getText(e)},t.prototype.getItemName=function(t){this.ready();var e=new c.StringBuilder;if(t.category==i.WdItemCategory.Magic||t.category==i.WdItemCategory.Rare){var o=this.worldService.presenters.palette;e.Append("<color="+o.getItemTextHexColor(t.category)+">")}return e.Append(this.sbService.get("item."+t.code+".name")),t.category!=i.WdItemCategory.Normal&&e.Append("</color>"),e.ToString()},t.prototype.getText=function(t){var e=this;this.ready();var o=new c.StringBuilder;return t.forEach(function(t){t.magic==i.WdStatMagicType.Magic&&o.Append("<color="+e.magicColor+">"),o.Append(e.titlePrefix),o.Append(e.sbService.get("stat.name."+t.type)),o.Append(" "),t.magic==i.WdStatMagicType.MagicBoosted&&o.Append("<color="+e.magicColor+">");var r=e.handlers.get(t.type);r&&r(t,o),t.magic!=i.WdStatMagicType.None&&o.Append("</color>"),o.Append("\n")}),o.ToString()},t.prototype.writeIntValue=function(t,e){var o=Math.round(t.minV),r=Math.round(t.maxV);e.Append(this.valuePrefix),e.Append(o==r?""+o:o+"-"+r)},t.prototype.writePercentValue=function(t,e){var o=Math.round(100*t.minV),r=Math.round(100*t.maxV);e.Append(this.valuePrefix),e.Append(o==r?o+"%":o+"-"+r+"%")},r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([n.autoWired("StringBundleService")],t.prototype,"sbService",void 0),t}();o.WduCommonStatPresenter=a,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","typescript-string-operations":17}],WduDashboard:[function(t,e,o){"use strict";cc._RF.push(e,"47b2cIgU/xMHp1b8Q1nN+Pm","WduDashboard");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduDashboard=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("./WduMinimap"),l=t("./WduNavDungeon"),u=t("../../../common/coroutine/CoContainer"),p=t("../../../common/coroutine/EaseRoutine"),d=cc.Label,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.miniMap_=null,e.dungeonNav_=null,e.killCount_=null,e.hideStack=new Set,e.routine=null,e}return n(e,t),e.prototype.boot=function(t){var e=this;this.world=t,this.miniMap_.boot(t),this.dungeonNav_.boot(t),this.node.opacity=t.hero.isDead()?0:255,t.eventBus.onAreaStart.addHandler(function(){return e.refresh()}),t.eventBus.onHeroDead.addHandler(function(){return e.hide("HeroBack",.5)}),t.eventBus.onHeroBack.addHandler(function(){return e.show("HeroBack",.5)}),t.eventBus.onEnemyDead.addHandler(function(){return e.refresh()}),this.refresh()},e.prototype.refresh=function(){this.killCount_.string=this.world.area.enemyKillCount+"/"+this.world.area.rule.enemyCount},e.prototype.hide=function(t,e){var o=this;0==this.hideStack.size&&(this.stopCoroutineSafe(this.routine),e<=0?this.node.opacity=0:this.routine=this.startRoutine().opacity(this.node,p.EaseType.easeOutQuad,.2,0).do(function(){return o.node.active=!1})),this.hideStack.add(t)},e.prototype.show=function(t,e){this.hideStack.has(t)?(this.hideStack.delete(t),0==this.hideStack.size&&(this.stopCoroutineSafe(this.routine),e<=0?this.node.opacity=255:(this.node.active=!0,this.routine=this.startRoutine().opacity(this.node,p.EaseType.easeOutQuad,.2,255)))):console.error("No key for Dashboard: "+t)},e.prototype.onClickShare=function(){},i([a(s.WduMinimap)],e.prototype,"miniMap_",void 0),i([a(l.WduNavDungeon)],e.prototype,"dungeonNav_",void 0),i([a(d)],e.prototype,"killCount_",void 0),i([c],e)}(u.CoContainer);o.WduDashboard=h,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine","./WduMinimap":"WduMinimap","./WduNavDungeon":"WduNavDungeon"}],WduGauge:[function(t,e,o){"use strict";cc._RF.push(e,"55f15tIk/dPGK7r96F7mpbt","WduGauge");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduGauge=void 0;var c=t("../../../common/coroutine/CoContainer"),a=t("../../../common/coroutine/EaseRoutine"),s=cc._decorator.ccclass,l=cc._decorator.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.overlay=null,e.overlayDelay=.1,e.overlayDuration=.1,e.lastValue=0,e}return n(e,t),e.prototype.onLoad=function(){this.progress=this.getComponent(cc.ProgressBar)},e.prototype.setValue=function(t,e){var o=this;if(this.progress.progress=t,!e)return this.lastValue=t,void(this.overlay.node.active=!1);var r=this.lastValue-t,n=r*this.node.width,i=this.overlay.node;if(this.lastValue=t,!(Math.abs(n)<1||r<0)){var c=cc.v2(.5*-this.node.width,0);c.x+=t*this.node.width,i.width=n,i.setPosition(c),this.gaugeRoutine&&this.gaugeRoutine.stop(),this.overlay.node.active=!0,this.gaugeRoutine=this.startRoutine().wait(this.overlayDelay).ease(a.EaseType.easeOutQuad,this.overlayDuration,function(){return o.overlay.node.width},function(t,e){o.overlay.node.width=t+(0-t)*e}).do(function(){o.overlay.node.active=!1,o.gaugeRoutine=null})}},i([l(cc.Sprite)],e.prototype,"overlay",void 0),i([s],e)}(c.CoContainer);o.WduGauge=u,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine"}],WduHistoryActive:[function(t,e,o){"use strict";cc._RF.push(e,"c50c1qPm0VA+pEJyntlPEWd","WduHistoryActive");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduHistoryActive=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../core/history/WdActionHistoryDAO"),l=t("../../../common/bean/Decorators"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e.type=s.WdActionHistoryType.None,e.isReady=!1,e.onActionHistory=function(){e.refresh()},e}return n(e,t),e.prototype.boot=function(t){t.eventBus.onActionHistory.addHandler(this.onActionHistory),this.isReady=!0,this.refresh()},e.prototype.onEnable=function(){this.isReady&&this.refresh()},e.prototype.refresh=function(){this.target.active=!this.historyService.hasActionHistory(this.type)},i([a(cc.Node)],e.prototype,"target",void 0),i([a({type:cc.Enum(s.WdActionHistoryType)})],e.prototype,"type",void 0),i([l.autoWired("WdHistoryService")],e.prototype,"historyService",void 0),i([c],e)}(t("../../../common/coroutine/CoContainer").CoContainer);o.WduHistoryActive=u,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/CoContainer":"CoContainer","../../core/history/WdActionHistoryDAO":"WdActionHistoryDAO"}],WduMinimapTag:[function(t,e,o){"use strict";cc._RF.push(e,"9f6dfChC6NOW6vP2pmd+VhN","WduMinimapTag");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduMinimapTag=void 0;var c=cc._decorator.ccclass,a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([c],e)}(t("../../../common/util/GoItem").default);o.WduMinimapTag=a,cc._RF.pop()},{"../../../common/util/GoItem":"GoItem"}],WduMinimap:[function(t,e,o){"use strict";cc._RF.push(e,"6ef08WxwudKTZPwLOv0uY5D","WduMinimap");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduMinimap=void 0;var c=cc._decorator.ccclass,a=t("./WduMinimapTag"),s=cc._decorator.property,l=t("../../../common/bean/Decorators"),u=t("../../core/object/unit/WdUnitKey"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor=null,e.enemyPrefab=null,e.heroPrefab=null,e.objectPrefab=null,e.matPrefab=null,e.tags=new Map,e.nextRefresh=0,e.onUnitEnter=function(t){if(!e.tags.has(t.getKey().pack())){var o=e.getPrefab(t.getType());if(o){var r=e.goPooler.fromPrefab(o,e.anchor);e.tags.set(t.getKey().pack(),r)}}},e.onUnitExit=function(t){e.removeTag(t)},e.onEnemyDead=function(t){e.removeTag(t),e.refreshUI()},e.onObjectDead=function(t){e.removeTag(t),e.refreshUI()},e.onAreaStart=function(){e.display(),e.refreshUI()},e}return n(e,t),Object.defineProperty(e.prototype,"mainCam",{get:function(){return this.worldService.presenters.mainCam},enumerable:!1,configurable:!0}),e.prototype.boot=function(t){this.world=t,t.eventBus.onAreaStart.addHandler(this.onAreaStart),t.eventBus.onEnemyDead.addHandler(this.onEnemyDead),t.eventBus.onObjectDead.addHandler(this.onObjectDead),this.mainCam.radar.onUnitEnter.addHandler(this.onUnitEnter),this.mainCam.radar.onUnitExit.addHandler(this.onUnitExit),this.display()},e.prototype.getPrefab=function(t){switch(t){case u.WdUnitType.Enemy:return this.enemyPrefab;case u.WdUnitType.Hero:return this.heroPrefab;case u.WdUnitType.Object:return this.objectPrefab;case u.WdUnitType.DropMaterial:return this.matPrefab}return null},e.prototype.removeTag=function(t){var e=t.getKey().pack(),o=this.tags.get(e);o&&(this.goPooler.returnGo(o),this.tags.delete(e))},e.prototype.traceAll=function(){var t=this,e=this.world.hero;this.anchor.setPosition(this.unitPosInMinimap(e).mul(-1)),this.tags.forEach(function(e,o){var r=u.WdUnitKey.unpack(o),n=t.world.area.getUnit(r);null!=n&&e.node.setPosition(t.unitPosInMinimap(n))})},e.prototype.update=function(t){this.world&&(this.nextRefresh-=t,this.nextRefresh<0&&(this.traceAll(),this.nextRefresh=.1))},e.prototype.unitPosInMinimap=function(t){var e=t.getPos().scalar(.01).round().scalar(5);return cc.v2(e.x,e.y)},e.prototype.display=function(){var t=this.world.area.getKey();this.node.active=t.act>0,this.clear(),this.refreshUI();var e=this.goPooler.fromPrefab(this.heroPrefab,this.anchor);this.tags.set(this.world.hero.getKey().pack(),e)},e.prototype.refreshUI=function(){},e.prototype.clear=function(){this.goPooler.returnGos(Array.from(this.tags.values())),this.tags.clear()},i([s(cc.Node)],e.prototype,"anchor",void 0),i([s(a.WduMinimapTag)],e.prototype,"enemyPrefab",void 0),i([s(a.WduMinimapTag)],e.prototype,"heroPrefab",void 0),i([s(a.WduMinimapTag)],e.prototype,"objectPrefab",void 0),i([s(a.WduMinimapTag)],e.prototype,"matPrefab",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l.autoWired("WdAreaService")],e.prototype,"areaService",void 0),i([l.autoWired("RuleService")],e.prototype,"ruleService",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([c],e)}(cc.Component);o.WduMinimap=p,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../core/object/unit/WdUnitKey":"WdUnitKey","./WduMinimapTag":"WduMinimapTag"}],WduNavDungeon:[function(t,e,o){"use strict";cc._RF.push(e,"531d1z70dtPTY+0M4cra6zN","WduNavDungeon");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduNavDungeon=void 0;var c=cc._decorator.ccclass,a=t("../../../common/coroutine/CoContainer"),s=cc._decorator.property,l=t("./WduSkillButton"),u=t("../../../common/bean/Decorators"),p=t("../popups/WduPopups"),d=t("../../../common/util/Bec"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.skillButton=null,e.delayOnNodes=[],e.worldService=null,e}return n(e,t),e.prototype.boot=function(t){this.skillButton.boot(t),this.refreshUI()},e.prototype.onClickHero=function(){this.openPopup(p.WduPopupType.Hero,null)},e.prototype.onClickSkill=function(){this.openPopup(p.WduPopupType.NewSkill,null)},e.prototype.onClickSetting=function(){this.openPopup(p.WduPopupType.Setting,null)},e.prototype.openPopup=function(t,e){d.Bec.can()&&this.worldService.presenters.ui.popups.openPopup(t,e)},e.prototype.setEnable=function(t){this.node.active=t,this.refreshUI()},e.prototype.refreshUI=function(){var t=this.worldService.getPlayer().battleCount>=2;this.delayOnNodes.forEach(function(e){e.active=t})},i([s(l.WduSkillButton)],e.prototype,"skillButton",void 0),i([s(cc.Node)],e.prototype,"delayOnNodes",void 0),i([u.autoWired("WorldService")],e.prototype,"worldService",void 0),i([c],e)}(a.CoContainer);o.WduNavDungeon=h,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/CoContainer":"CoContainer","../../../common/util/Bec":"Bec","../popups/WduPopups":"WduPopups","./WduSkillButton":"WduSkillButton"}],WduNewSkillPopup:[function(t,e,o){"use strict";cc._RF.push(e,"f9f30uLp+tKbKnHJAqu8RKZ","WduNewSkillPopup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduNewSkillPopup=void 0;var c=t("../../../../common/util/Popup"),a=t("./WduSkillMenuItem"),s=cc._decorator.property,l=t("../../../../common/bean/Decorators"),u=t("../WduPopups"),p=t("../../../core/world/WdISharedRes"),d=t("../../../../common/util/Bec"),h=cc._decorator.ccclass,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prefab=null,e.content=null,e.items=new Array,e.onSkillEquip=function(){e.hide()},e.onClickItem=function(t){e.heroService.equipSkill(t)},e}return n(e,t),e.prototype.onLoad=function(){this.prefab.node.active=!1},e.prototype.getKey=function(){return u.WduPopupType.NewSkill},e.prototype.onDisplay=function(){this.refresh();var t=this.worldService.world;t.eventBus.onSkillEquip.addHandler(this.onSkillEquip),t.setState(p.WorldState.Pause)},e.prototype.onHide=function(){var t=this.worldService.world;t.eventBus.onSkillEquip.removeHandler(this.onSkillEquip),t.setState(p.WorldState.Play)},e.prototype.getPopupEaser=function(){var t,e,o=null!==(e=null===(t=this.worldService.presenters.ui.popups.getTop())||void 0===t?void 0:t.node)&&void 0!==e?e:null;return new c.PopupPanelEaserPop(this,o)},e.prototype.refresh=function(){var t=this;this.items.forEach(function(e){t.goPooler.returnGo(e)}),this.items=[];var e=this.worldService.world.hero;this.heroService.readyNewSkill();var o=cc.Vec2.ZERO;o.x=-150,e.getDao().newSkills.forEach(function(e){var r=t.goPooler.fromPrefab(t.prefab,t.content);r.display(e,t.onClickItem),t.items.push(r),r.node.setPosition(o),o.x+=150})},e.prototype.onClickHide=function(){d.Bec.can()&&this.hide()},i([s(a.WduSkillMenuItem)],e.prototype,"prefab",void 0),i([s(cc.Node)],e.prototype,"content",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l.autoWired("WdHeroService")],e.prototype,"heroService",void 0),i([l.autoWired("RuleService")],e.prototype,"ruleService",void 0),i([l.autoWired("GoPooler")],e.prototype,"goPooler",void 0),i([h],e)}(c.PopupBaseBP);o.WduNewSkillPopup=f,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/util/Bec":"Bec","../../../../common/util/Popup":"Popup","../../../core/world/WdISharedRes":"WdISharedRes","../WduPopups":"WduPopups","./WduSkillMenuItem":"WduSkillMenuItem"}],WduPickaxeStatPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"d1e1dPw/o1CwaCkIaMBIHUz","WduPickaxeStatPresenter");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduPickaxeStatPresenter=void 0;var n=t("../../../common/bean/Decorators"),i=t("../../../rule/model/Model"),c=t("typescript-string-operations"),a=function(){function t(){this.magicColor=""}return t.prototype.ready=function(){this.magicColor&&0!=this.magicColor.length||(this.magicColor=this.worldService.presenters.palette.getItemTextHexColor(i.WdItemCategory.Magic))},t.prototype.getText=function(t){var e=this.ruleService.pickaxes.get(t-1),o=this.ruleService.pickaxes.get(t),r=o.moreDropRate-e.moreDropRate,n=new c.StringBuilder;return n.Append(this.sbService.get("px.stat.more.drop")),n.Append(" "),n.Append("<color="+this.magicColor+">+"),n.Append(o.moreDrop.toString()),n.Append("</color>"),n.AppendLine(""),n.Append(this.sbService.get("px.stat.more.drop.rate")),n.Append(" "),n.Append("<color="+this.magicColor+">"),n.Append(o.moreDropRate.toString()),n.Append("%</color>"),r>0&&(n.Append(" (<color="+this.magicColor+">+"),n.Append(r.toString()),n.Append("%</color>)")),n.AppendLine(""),n.ToString()},r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("StringBundleService")],t.prototype,"sbService",void 0),r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.WduPickaxeStatPresenter=a,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","typescript-string-operations":17}],WduPopups:[function(t,e,o){"use strict";cc._RF.push(e,"83de3C5Pv9EDZjX0VwaV+Ok","WduPopups");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduPopups=o.WduPopupType=void 0;var c,a=t("../../../common/coroutine/CoContainer"),s=t("../../../common/bean/Decorators"),l=t("../../../common/util/Popup"),u=t("../../../common/coroutine/EaseRoutine"),p=t("../../core/common/WdRandom"),d=t("../../core/common/WdUtil"),h=cc._decorator.ccclass;(function(t){t[t.None=0]="None",t[t.Bag=1]="Bag",t[t.Chest=2]="Chest",t[t.Hero=3]="Hero",t[t.Reward=4]="Reward",t[t.ItemStat=5]="ItemStat",t[t.NewSkill=6]="NewSkill",t[t.Artifact=7]="Artifact",t[t.SkillStat=8]="SkillStat",t[t.Setting=9]="Setting",t[t.StartDungeon=10]="StartDungeon",t[t.WrapUp=11]="WrapUp",t[t.Menu=12]="Menu",t[t.Tutorial=13]="Tutorial",t[t.ArtifactStat=14]="ArtifactStat",t[t.Building=15]="Building",t[t.BuildingMenu=16]="BuildingMenu",t[t.Build=17]="Build",t[t.Craft=18]="Craft",t[t.BuildingInfo=19]="BuildingInfo",t[t.BuildingLevelUp=20]="BuildingLevelUp",t[t.Unlock=21]="Unlock",t[t.UnlockInfo=22]="UnlockInfo",t[t.MaterialInfo=23]="MaterialInfo",t[t.NewScore=24]="NewScore",t[t.ArtifactAds=25]="ArtifactAds",t[t.SwitchApp=26]="SwitchApp"})(c=o.WduPopupType||(o.WduPopupType={}));var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.popups=new Map,e.opened=new Array,e.shakeRoutine=null,e.onAreaTearDown=function(){e.hideAll()},e.onHeroDead=function(){e.hideAll(),e.scheduleOnce(function(){e.openPopup(c.WrapUp,null)},2.5)},e.onEnemyDead=function(){var t=e.worldService.world.area;t.enemyKillCount==t.rule.enemyCount&&(e.hideAll(),e.scheduleOnce(function(){e.openPopup(c.WrapUp,null)},2.5))},e}return n(e,t),e.prototype.onLoad=function(){var t=this;this.node.children.forEach(function(e){var o=e.getComponent(l.PopupBase);null!=o&&t.popups.set(o.getKey(),o)})},e.prototype.boot=function(t){t.eventBus.onAreaTearDown.addHandler(this.onAreaTearDown),t.eventBus.onHeroDead.addHandler(this.onHeroDead),t.eventBus.onEnemyDead.addHandler(this.onEnemyDead)},e.prototype.getPopup=function(t){return this.popups.get(t)},e.prototype.openPopup=function(t,e,o){var r=this;void 0===o&&(o=null);var n=this.worldService.presenters.ui.dashboard,i=this.getPopup(t);i?(n.hide("Popup: "+t,.15),i.display(e,function(){var e=r.opened.indexOf(t);e>=0&&r.opened.splice(e,1),n.show("Popup: "+t,.15),o&&o()}),this.opened.push(t)):console.error("no popup found "+t)},e.prototype.hideAll=function(){var t=this,e=new Array;(e=e.concat(this.opened)).forEach(function(e){var o=t.getPopup(e);o.isShown&&o.hide()}),this.opened=[]},e.prototype.getTop=function(){if(0==this.opened.length)return null;var t=this.opened[this.opened.length-1];return this.getPopup(t)},e.prototype.playShake=function(t,e,o){this.shakeRoutine&&this.shakeRoutine.stop(),this.shake(t,.023*e,o)},e.prototype.shake=function(t,e,o){var r=this;this.shakeRoutine=this.startRoutine();for(var n=function(n){var c=1-u.Ease.easeInQuad(0,1,n/o);c=Math.max(.2,c);var a=cc.Vec2.RIGHT.mul(p.WdRandom.getRangeFloat(.9*t,t)*c);a=a.rotate(p.WdRandom.getRangeFloat(0,360)*d.WdUtil.deg2Rad),i.shakeRoutine.ease(u.EaseType.easeOutSine,e*c,function(){return r.node.getPosition()},function(t,e){var o=cc.v2();cc.Vec2.lerp(o,t,a,e),r.node.setPosition(o)})},i=this,c=0;c<o;c++)n(c);this.shakeRoutine.ease(u.EaseType.easeOutSine,e*(1/o),function(){return r.node.getPosition()},function(t,e){var o=cc.v2();cc.Vec2.lerp(o,t,cc.Vec2.ZERO,e),r.node.setPosition(o)}).wait(0,function(){return r.shakeRoutine=null})},i([s.autoWired("WorldService")],e.prototype,"worldService",void 0),i([h],e)}(a.CoContainer);o.WduPopups=f,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine","../../../common/util/Popup":"Popup","../../core/common/WdRandom":"WdRandom","../../core/common/WdUtil":"WdUtil"}],WduSkillButton:[function(t,e,o){"use strict";cc._RF.push(e,"a5eacTAXZNECYPR8Ig1CSl3","WduSkillButton");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduSkillButton=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/bean/Decorators"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.remainText=null,e}return n(e,t),e.prototype.boot=function(t){var e=this;this.world=t,this.world=t,this.world.eventBus.onAreaStart.addHandler(function(){return e.refresh()}),this.world.eventBus.onHeroLevelUp.addHandler(function(){return e.refresh()}),this.world.eventBus.onSkillEquip.addHandler(function(){return e.refresh()}),this.refresh()},e.prototype.refresh=function(){var t=this.world.hero.getDao();if(this.heroService.readyNewSkill(),t.newSkills.length>0){this.node.active=!0;var e=t.remainSkill;this.remainText.string=e>1?e.toString():""}else this.node.active=!1},i([a(cc.Label)],e.prototype,"remainText",void 0),i([s.autoWired("WdHeroService")],e.prototype,"heroService",void 0),i([c],e)}(cc.Component);o.WduSkillButton=l,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators"}],WduSkillMenuItem:[function(t,e,o){"use strict";cc._RF.push(e,"0f3denZJ99Lh5xtK7W/vx5w","WduSkillMenuItem");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduSkillMenuItem=void 0;var c=t("../../../../common/util/GoItem"),a=cc._decorator.ccclass,s=cc._decorator.property,l=t("../../../../common/bean/Decorators"),u=t("../../../../common/util/Bec"),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e}return n(e,t),e.prototype.display=function(t,e){this.code=t,this.onClick=e,this.icon.spriteFrame=this.spritePooler.getSkill(t)},e.prototype.onClickItem=function(){u.Bec.can()&&this.onClick&&this.onClick(this.code)},i([s(cc.Sprite)],e.prototype,"icon",void 0),i([l.autoWired("StringBundleService")],e.prototype,"sbService",void 0),i([l.autoWired("WdSpritePooler")],e.prototype,"spritePooler",void 0),i([a],e)}(c.default);o.WduSkillMenuItem=p,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/util/Bec":"Bec","../../../../common/util/GoItem":"GoItem"}],WduSkillStatPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"c5c48KACZZP6qtJkcnVgu6X","WduSkillStatPresenter");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduSkillStatPresenter=void 0;var n=t("../../../common/bean/Decorators"),i=t("../../../rule/model/Model"),c=t("../../core/common/WdUtil"),a=t("../../core/object/skill/WdSkillKey"),s=t("typescript-string-operations"),l=function(){function t(){var t=this;this.handlers=new Map,this.s="",this.onRepeater=function(e){var o=t.getIntValue(t.rulePrev.v3,t.rule.v3),r=t.getPercentValue(-t.rulePrev.v1,-t.rule.v1),n=t.getPercentValue(-t.rulePrev.v2,-t.rule.v2);e.AppendLineFormat(t.sbService.get("skill.stat.more.repeat"),o),e.AppendLineFormat(t.sbService.get("skill.stat.attackSpeedDown"),r),e.AppendLineFormat(t.sbService.get("skill.stat.attackDown"),n)},this.onMultiArrow=function(e){var o=t.getIntValue(t.rulePrev.v2,t.rule.v2),r=t.getPercentValue(-t.rulePrev.v1,-t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.more.arrow"),o),e.AppendLineFormat(t.sbService.get("skill.stat.attackSpeedDown"),r)},this.onRicochet=function(e){var o=t.getIntValue(t.rulePrev.v3,t.rule.v3),r=t.getPercentValue(-t.rulePrev.v2,-t.rule.v2);e.AppendLineFormat(t.sbService.get("skill.stat.ricochet"),o),e.AppendLineFormat(t.sbService.get("skill.stat.ricochet.damageDown"),r)},this.onPiercingShot=function(e){var o=t.getPercentValue(-t.rulePrev.v1,-t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.ricochet.damageDown"),o)},this.onHeroAttackBoost=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.attackUp"),o)},this.onAttackSpeedUp=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.attackSpeedUp"),o)},this.onHpBoost=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.lifeUp"),o)},this.onColdCircle=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1),r=t.getPercentValue(t.rulePrev.cc.fireRate,t.rule.cc.fireRate),n=t.getFloatValue(t.rulePrev.cc.duration,t.rule.cc.duration),i=t.getPercentValue(t.rulePrev.cc.v1,t.rule.cc.v1);e.AppendLineFormat(t.sbService.get("skill.stat.magic.damage"),o),e.AppendLineFormat(t.sbService.get("skill.stat.cold"),r,n,i)},this.onFireCircle=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.magic.damage"),o)},this.onLightningCircle=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1),r=t.getPercentValue(t.rulePrev.cc.fireRate,t.rule.cc.fireRate),n=t.getFloatValue(t.rulePrev.cc.duration,t.rule.cc.duration);e.AppendLineFormat(t.sbService.get("skill.stat.magic.damage"),o),e.AppendLineFormat(t.sbService.get("skill.stat.cc.hurt"),r,n)},this.onPoisonCircle=function(e){var o=t.getFloatValue(t.rulePrev.cc.duration,t.rule.cc.duration),r=t.percentValue(Math.round(100*t.rule.v1));e.AppendLineFormat(t.sbService.get("skill.stat.poison.damage"),o,r)},this.onGhost=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool),r=t.getFloatValue(t.rulePrev.cc.duration,t.rule.cc.duration);e.AppendLineFormat(t.sbService.get("skill.stat.ghost"),o,r)},this.onLightningStrike=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool);e.AppendLineFormat(t.sbService.get("skill.stat.lightningstrike"),o),t.onLightningCircle(e)},this.onMagicBomb=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool),r=t.getPercentValue(t.rulePrev.v1,t.rule.v1),n=t.getIntValue(t.rulePrev.v2,t.rule.v2);e.AppendLineFormat(t.sbService.get("skill.stat.magicbomb"),o,n),e.AppendLineFormat(t.sbService.get("skill.stat.magic.damage"),r)},this.onIcePillar=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool);e.AppendLineFormat(t.sbService.get("skill.stat.icepillar"),o),t.onColdCircle(e)},this.onLightningShield=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool);e.AppendLineFormat(t.sbService.get("skill.stat.lightningshield"),o),t.onLightningCircle(e)},this.onMeteor=function(e){var o=t.getFloatValue(t.rulePrev.cool,t.rule.cool);e.AppendLineFormat(t.sbService.get("skill.stat.meteor"),o);var r=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.magic.damage"),r)},this.onBonusLife=function(e){var o=t.getPercentValue(t.rulePrev.v1,t.rule.v1);e.AppendLineFormat(t.sbService.get("skill.stat.bonuslife"),o)}}return t.prototype.ready=function(){if(!(this.handlers.size>0)){var t=this.worldService.presenters.palette;this.magicColor=t.getItemTextHexColor(i.WdItemCategory.Magic),this.lvUpColor=t.getColorLevelUpHexColor(),this.handlers.set(i.WdSkillType.Repeater,this.onRepeater),this.handlers.set(i.WdSkillType.MultiArrow,this.onMultiArrow),this.handlers.set(i.WdSkillType.Ricochet,this.onRicochet),this.handlers.set(i.WdSkillType.PiercingShot,this.onPiercingShot),this.handlers.set(i.WdSkillType.UnitAttackBoost,this.onHeroAttackBoost),this.handlers.set(i.WdSkillType.AttackSpeedUp,this.onAttackSpeedUp),this.handlers.set(i.WdSkillType.HpBoost,this.onHpBoost),this.handlers.set(i.WdSkillType.ColdCircle,this.onColdCircle),this.handlers.set(i.WdSkillType.FireCircle,this.onFireCircle),this.handlers.set(i.WdSkillType.LightningCircle,this.onLightningCircle),this.handlers.set(i.WdSkillType.PoisonCircle,this.onPoisonCircle),this.handlers.set(i.WdSkillType.Ghost,this.onGhost),this.handlers.set(i.WdSkillType.LightningStrike,this.onLightningStrike),this.handlers.set(i.WdSkillType.MagicBomb,this.onMagicBomb),this.handlers.set(i.WdSkillType.IcePillar,this.onIcePillar),this.handlers.set(i.WdSkillType.LightningShield,this.onLightningShield),this.handlers.set(i.WdSkillType.Meteor,this.onMeteor),this.handlers.set(i.WdSkillType.BonusLife,this.onBonusLife)}},t.prototype.intValue=function(t){var e=Math.round(t).toString();return"<color="+this.magicColor+">"+e+"</color>"},t.prototype.percentValue=function(t){var e=Math.round(t).toString();return"<color="+this.s+this.magicColor+">"+e+"%</color>"},t.prototype.floatValue=function(t){return"<color="+this.magicColor+">"+t.toFixed(1)+"</color>"},t.prototype.intValue2=function(t,e){var o=Math.round(t).toString(),r=Math.round(e).toString();if(o===r)return this.intValue(e);var n=Math.round(e-t),i=n>0?"+":"";return"<color="+this.magicColor+">"+r+"</color><color="+this.lvUpColor+">("+i+n+")</color>"},t.prototype.percentValue2=function(t,e){if(Math.round(t)==Math.round(e))return this.percentValue(e);var o=Math.round(e-t),r=o>0?"+":"";return"<color="+this.magicColor+">"+e+"%</color><color="+this.lvUpColor+">("+r+o+"%)</color>"},t.prototype.floatValue2=function(t,e){if(c.WdUtil.approximately(t,e))return this.floatValue(e);var o=e-t,r=o>0?"+":"";return"<color="+this.magicColor+">"+e.toFixed(1)+"</color><color="+this.lvUpColor+">("+r+o.toFixed(1)+")</color>"},t.prototype.getIntValue=function(t,e){return this.rule.level>1?this.intValue2(Math.round(t),Math.round(e)):this.intValue(Math.round(e))},t.prototype.getPercentValue=function(t,e){return this.rule.level>1?this.percentValue2(Math.round(100*t),Math.round(100*e)):this.percentValue(Math.round(100*e))},t.prototype.getFloatValue=function(t,e){return this.rule.level>1?this.floatValue2(t,e):this.floatValue(e)},t.prototype.getSkillName=function(t,e){return this.ready(),this.sbService.get("skill."+t+".name")+" Lv."+e},t.prototype.getStatText=function(t,e,o){void 0===o&&(o=!0),this.ready(),this.rule=this.ruleService.getSkill(a.WdSkillKey.build(t,e)),this.rulePrev=e>1?this.ruleService.getSkill(a.WdSkillKey.build(t,e-1)):this.rule;var r=new s.StringBuilder;o&&(r.AppendLine(this.sbService.get("skill."+t+".desc")),r.AppendLine(""));var n=this.handlers.get(this.rule.type);return n&&n(r),r.ToString()},r([n.autoWired("RuleService")],t.prototype,"ruleService",void 0),r([n.autoWired("WorldService")],t.prototype,"worldService",void 0),r([n.autoWired("WdSkillService")],t.prototype,"skillService",void 0),r([n.autoWired("StringBundleService")],t.prototype,"sbService",void 0),t}();o.WduSkillStatPresenter=l,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../rule/model/Model":"Model","../../core/common/WdUtil":"WdUtil","../../core/object/skill/WdSkillKey":"WdSkillKey","typescript-string-operations":17}],WduTouchPad:[function(t,e,o){"use strict";cc._RF.push(e,"4f956hmn+pML59CiXqqGGIW","WduTouchPad");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduTouchPad=void 0;var c,a=cc._decorator.ccclass,s=cc._decorator.property,l=t("../../../common/util/MyCanvasScaler"),u=t("../../../App");(function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down"})(c||(c={}));var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor=null,e.core=null,e.screen=null,e.length=64,e.anchorPos=cc.Vec2.ZERO,e.direction=cc.Vec2.ZERO,e.isMoving=!1,e.isKeyMoving=!1,e.camMode=!1,e.touchThreshold=10,e.onMove=null,e.onDone=null,e.onTouch=null,e.hiddenCount=0,e.shownAlpha=255,e.hiddenAlpha=64,e.keys=new Set,e.hasTouch=!1,e}return n(e,t),e.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onInTouchBegin,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onInTouchMove,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this.onInTouchEnd,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onInTouchEnd,this,!0),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)},e.prototype.boot=function(t,e,o){this.onMove=t,this.onDone=e,this.onTouch=o,this.isMoving=!1,this.isKeyMoving=!1,this.clear()},e.prototype.setShownAlpha=function(t){this.shownAlpha=t},e.prototype.setHiddenAlpha=function(t){this.hiddenAlpha=t,this.isMoving||(this.node.opacity=t)},e.prototype.getTouchPos=function(t){var e=t.getLocation(),o=this.node.convertToNodeSpaceAR(cc.v3(e.x,e.y,0));return cc.v2(o.x,o.y)},e.prototype.onInTouchBegin=function(t){this.hasTouch=!0;var e=this.getTouchPos(t);e.y>0||(t.stopPropagationImmediate(),this.camMode||(this.node.opacity=this.shownAlpha),this.anchorPos=e.clone(),this.anchor.setPosition(this.anchorPos))},e.prototype.onInTouchMove=function(t){var e=this.getTouchPos(t);if(this.hasTouch&&this.anchorPos.clone().subtract(e).lengthSqr()>this.touchThreshold*this.touchThreshold&&(this.hasTouch=!1,this.isMoving=!0),this.isMoving){var o=e.subtract(this.anchorPos),r=o.mag(),n=1;r>this.length&&(n=this.length/r),this.core.setPosition(o.mul(n)),this.direction=o.normalize()}},e.prototype.onInTouchEnd=function(){if(this.hasTouch)return this.onTouch&&this.onTouch(),this.hasTouch=!1,void this.clear();this.isMoving?(this.isMoving=!1,this.clear(),this.onDone()):this.clear()},e.prototype.clearAlpha=function(){return this.camMode?0:this.hiddenAlpha},e.prototype.useKeyboard=function(){return cc.sys.os!=cc.sys.OS_IOS&&cc.sys.os!=cc.sys.OS_ANDROID&&cc.sys.os!=cc.sys.OS_WP8&&cc.sys.os!=cc.sys.OS_BADA},e.prototype.clear=function(){this.direction=cc.v2(),this.node.opacity=this.clearAlpha();var t=.5*this.screen.getCropSize().height,e=u.app.mainUI.getCanvasScaler().getCropSize();e.width<e.height?(this.anchor.setPosition(cc.v2(0,280-t)),this.core.setPosition(cc.v2())):(this.anchor.setPosition(cc.v2(.5*-e.width+160,160-t)),this.core.setPosition(cc.v2()))},e.prototype.update=function(){u.app.mainUI.getPopups().size>0||this.hiddenCount>0?(this.isMoving||this.isKeyMoving)&&(this.isMoving=!1,this.isKeyMoving=!1,this.clear(),this.onDone()):(this.useKeyboard()&&this.keyboardMove(),this.isMoving&&this.onMove(this.direction))},e.prototype.keyboardMove=function(){var t=this;0!=this.keys.size?(this.direction=cc.v2(),this.keys.forEach(function(e){switch(e){case c.Left:t.direction.x-=1;break;case c.Right:t.direction.x+=1;break;case c.Up:t.direction.y+=1;break;case c.Down:t.direction.y-=1}}),this.direction.magSqr()>0&&(this.direction=this.direction.normalize(),this.onMove(this.direction),this.isKeyMoving=!0)):this.isKeyMoving&&(this.isKeyMoving=!1,this.onDone())},e.prototype.onKeyDown=function(t){switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:this.keys.add(c.Left);break;case cc.macro.KEY.s:case cc.macro.KEY.down:this.keys.add(c.Down);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this.keys.add(c.Right);break;case cc.macro.KEY.w:case cc.macro.KEY.up:this.keys.add(c.Up);break;case cc.macro.KEY.space:this.onTouch&&this.onTouch()}},e.prototype.onKeyUp=function(t){switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:this.keys.delete(c.Left);break;case cc.macro.KEY.s:case cc.macro.KEY.down:this.keys.delete(c.Down);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this.keys.delete(c.Right);break;case cc.macro.KEY.w:case cc.macro.KEY.up:this.keys.delete(c.Up)}},e.prototype.onDisable=function(){(this.isMoving||this.isKeyMoving)&&(this.isMoving=!1,this.isKeyMoving=!1,this.clear(),this.onDone())},e.prototype.hide=function(){this.hiddenCount++,this.node.active=!1},e.prototype.show=function(){this.hiddenCount--,0==this.hiddenCount&&(this.node.active=!0)},i([s(cc.Node)],e.prototype,"anchor",void 0),i([s(cc.Node)],e.prototype,"core",void 0),i([s(l.MyCanvasScaler)],e.prototype,"screen",void 0),i([s(cc.Float)],e.prototype,"length",void 0),i([a],e)}(cc.Component);o.WduTouchPad=p,cc._RF.pop()},{"../../../App":"App","../../../common/util/MyCanvasScaler":"MyCanvasScaler"}],WduTransitionPanelBlind:[function(t,e,o){"use strict";cc._RF.push(e,"832dfq18HxLarEujcqXNhlE","WduTransitionPanelBlind");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduTransitionPanelBlind=void 0;var c=t("./WduTransitionPanel"),a=cc._decorator.ccclass,s=t("../../../App"),l=cc._decorator.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.anchor=null,e}return n(e,t),e.prototype.show=function(t){this.node.active=!0,this.screenSize=s.app.mainUI.getCanvasScaler().getOriginSize(),this.anchor.setPosition(cc.v2(0,this.screenSize.height)),this.node.active=!0,this.stopCoroutineSafe(this.moveRoutine),this.moveTo(-720,t)},e.prototype.hide=function(t){var e=this;this.stopCoroutineSafe(this.moveRoutine),this.moveTo(this.screenSize.height,function(){e.node.active=!1,t&&t()})},e.prototype.moveTo=function(t,e){var o=this,r=this.anchor.y,n=Math.ceil(Math.abs(t-r)/80),i=r<t?80:-80;this.moveRoutine=this.startRoutine();for(var c=0;c<n;c++)this.moveRoutine.waitNoTimeScaled(.02,function(){o.anchor.y+=i});this.moveRoutine.do(e)},i([l(cc.Node)],e.prototype,"anchor",void 0),i([a],e)}(c.WduTransitionPanel);o.WduTransitionPanelBlind=u,cc._RF.pop()},{"../../../App":"App","./WduTransitionPanel":"WduTransitionPanel"}],WduTransitionPanelDefault:[function(t,e,o){"use strict";cc._RF.push(e,"ba036/2K6dDsJ/PJZuz9QiJ","WduTransitionPanelDefault");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduTransitionPanelDefault=void 0;var c=t("./WduTransitionPanel"),a=t("../../../common/coroutine/EaseRoutine"),s=cc._decorator.ccclass,l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.show=function(t){var e=this;void 0===t&&(t=null),this.stopCoroutineSafe(this.showRoutine),this.node.opacity=0,this.node.active=!0,this.startRoutine().easeNoTimeScaled(a.EaseType.easeOutQuad,.25,function(){return e.node.opacity},function(t,o){e.node.opacity=a.Ease.lerp(t,255,o)},t)},e.prototype.hide=function(t){var e=this;void 0===t&&(t=null),this.stopCoroutineSafe(this.showRoutine),this.node.opacity=255,this.node.active=!0,this.startRoutine().waitNoTimeScaled(.05).easeNoTimeScaled(a.EaseType.easeInQuad,.5,function(){return e.node.opacity},function(t,o){e.node.opacity=a.Ease.lerp(t,0,o)},function(){e.node.active=!1,t&&t()})},i([s],e)}(c.WduTransitionPanel);o.WduTransitionPanelDefault=l,cc._RF.pop()},{"../../../common/coroutine/EaseRoutine":"EaseRoutine","./WduTransitionPanel":"WduTransitionPanel"}],WduTransitionPanel:[function(t,e,o){"use strict";cc._RF.push(e,"bb9eeyqzMVKDIrFzJ2aY3cf","WduTransitionPanel");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.WduTransitionPanel=void 0;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.show=function(){},e.prototype.hide=function(){},e}(t("../../../common/coroutine/CoContainer").CoContainer);o.WduTransitionPanel=i,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer"}],WduTutorialPopup:[function(t,e,o){"use strict";cc._RF.push(e,"f425a+UOilMHZx56s1Nbjaw","WduTutorialPopup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduTutorialPopup=void 0;var c=t("../../../../common/util/Popup"),a=t("../../../../common/bean/Decorators"),s=t("../WduPopups"),l=cc._decorator.ccclass,u=t("../../../../common/util/Bec"),p=t("../../../core/world/WdISharedRes"),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){},e.prototype.getKey=function(){return s.WduPopupType.Tutorial},e.prototype.onDisplay=function(t){this.type=t,this.worldService.world.setState(p.WorldState.Pause),this.refresh()},e.prototype.onHide=function(){this.worldService.world.setState(p.WorldState.Play),this.historyService.addActionHistory(this.type)},e.prototype.getPopupEaser=function(){var t,e,o=null!==(e=null===(t=this.worldService.presenters.ui.popups.getTop())||void 0===t?void 0:t.node)&&void 0!==e?e:null;return new c.PopupPanelEaserPop(this,o)},e.prototype.refresh=function(){},e.prototype.onClickBlackPanel=function(){},e.prototype.onClickHide=function(){u.Bec.can()&&this.hide()},i([a.autoWired("WorldService")],e.prototype,"worldService",void 0),i([a.autoWired("WdHistoryService")],e.prototype,"historyService",void 0),i([l],e)}(c.PopupBaseBP);o.WduTutorialPopup=d,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/util/Bec":"Bec","../../../../common/util/Popup":"Popup","../../../core/world/WdISharedRes":"WdISharedRes","../WduPopups":"WduPopups"}],WduUIPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"07508Erk25MVpSVtnjneFus","WduUIPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduUIPresenter=void 0;var c=cc._decorator.ccclass,a=t("./dashboard/WduDashboard"),s=cc._decorator.property,l=t("./popups/WduPopups"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dashboard_=null,e.popups_=null,e}return n(e,t),Object.defineProperty(e.prototype,"dashboard",{get:function(){return this.dashboard_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"popups",{get:function(){return this.popups_},enumerable:!1,configurable:!0}),e.prototype.boot=function(t){this.dashboard.boot(t),this.popups.boot(t)},i([s(a.WduDashboard)],e.prototype,"dashboard_",void 0),i([s(l.WduPopups)],e.prototype,"popups_",void 0),i([c],e)}(cc.Component);o.WduUIPresenter=u,cc._RF.pop()},{"./dashboard/WduDashboard":"WduDashboard","./popups/WduPopups":"WduPopups"}],WduUnlockButton:[function(t,e,o){"use strict";cc._RF.push(e,"3e763luF/xOw4AvKZEJ/fY0","WduUnlockButton");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduUnlockButton=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/bean/Decorators"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.alertIcon=null,e.expGauge=null,e}return n(e,t),e.prototype.boot=function(t){var e=this;this.world=t,this.world.eventBus.onUnlockPointUpdate.addHandler(function(){return e.refresh()}),this.world.eventBus.onAreaStart.addHandler(function(){return e.refresh()}),this.refresh()},e.prototype.refresh=function(){var t=this.world.player;if(this.ruleService.unlocks.size<=t.unlocked.length?this.alertIcon.active=!1:this.alertIcon.active=t.remainUnlockPoint>0,this.ruleService.playerExp.has(t.level+1)){var e=this.ruleService.playerExp.get(t.level),o=this.ruleService.playerExp.get(t.level+1).exp-e.exp,r=(t.exp-e.exp)/o;this.expGauge.progress=(4+Math.round(7*r))/16}else this.expGauge.progress=1},i([a(cc.Node)],e.prototype,"alertIcon",void 0),i([a(cc.ProgressBar)],e.prototype,"expGauge",void 0),i([s.autoWired("RuleService")],e.prototype,"ruleService",void 0),i([c],e)}(cc.Component);o.WduUnlockButton=l,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators"}],WduUvScrollBoard:[function(t,e,o){"use strict";cc._RF.push(e,"06b9d3+k7pBUb4X3dHZow3G","WduUvScrollBoard");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduUvScrollBoard=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/coroutine/CoContainer"),l=t("../../../common/coroutine/EaseRoutine"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.velocity=cc.v2(0,-1),e.sprite=null,e.offset=cc.v2(),e.alphaRoutine=null,e}return n(e,t),e.prototype.onLoad=function(){this.sprite=this.getComponent(cc.Sprite)},e.prototype.update=function(e){t.prototype.update.call(this,e),this.offset=this.offset.add(this.velocity.mul(e)),this.offset.x%=1,this.offset.y%=1,this.sprite.getMaterial(0).setProperty("uvOffset",this.offset)},e.prototype.show=function(t){this.node.active=!0,this.node.opacity=0,this.stopCoroutineSafe(this.alphaRoutine),this.alphaRoutine=this.startRoutine().waitNoTimeScaled(.1).opacityNoTimeScaled(this.node,l.EaseType.easeOutQuad,.25,255,t)},e.prototype.hide=function(t){var e=this;this.stopCoroutineSafe(this.alphaRoutine),this.alphaRoutine=this.startRoutine().waitNoTimeScaled(.1).opacityNoTimeScaled(this.node,l.EaseType.easeOutQuad,.25,0,function(){e.node.active=!1,t&&t()})},i([a(cc.Vec2)],e.prototype,"velocity",void 0),i([c],e)}(s.CoContainer);o.WduUvScrollBoard=u,cc._RF.pop()},{"../../../common/coroutine/CoContainer":"CoContainer","../../../common/coroutine/EaseRoutine":"EaseRoutine"}],WduWrapUpPopup:[function(t,e,o){"use strict";cc._RF.push(e,"d49f3jJwaZCirvLP3botbtW","WduWrapUpPopup");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WduWrapUpPopup=void 0;var c=t("../../../../common/util/Popup"),a=cc._decorator.ccclass,s=cc._decorator.property,l=t("../../../../common/bean/Decorators"),u=t("../WduPopups"),p=t("../../../../common/util/Bec"),d=t("../../../core/object/area/WdAreaKey"),h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.killCount=null,e.ripIcon=null,e.portalIcon=null,e}return n(e,t),e.prototype.getKey=function(){return u.WduPopupType.WrapUp},e.prototype.onDisplay=function(){this.refreshUI()},e.prototype.onHide=function(){},e.prototype.getPopupEaser=function(){var t,e,o=null!==(e=null===(t=this.worldService.presenters.ui.popups.getTop())||void 0===t?void 0:t.node)&&void 0!==e?e:null;return new c.PopupPanelEaserPop(this,o)},e.prototype.refreshUI=function(){var t=this.worldService.world;t.hero.isDead()?(this.ripIcon.active=!0,this.portalIcon.active=!1):(this.ripIcon.active=!1,this.portalIcon.active=!0);var e=t.area.enemyKillCount;e<t.area.rule.enemyCount?this.killCount.string=e+" KILL":this.killCount.string="YOU WON!"},e.prototype.onClickReStart=function(){p.Bec.can()&&(this.worldService.world.changeArea(new d.WdAreaKey(1,1)),this.hide())},e.prototype.onClickBlackPanel=function(){},i([s(cc.Label)],e.prototype,"killCount",void 0),i([s(cc.Node)],e.prototype,"ripIcon",void 0),i([s(cc.Node)],e.prototype,"portalIcon",void 0),i([l.autoWired("WorldService")],e.prototype,"worldService",void 0),i([l.autoWired("StringBundleService")],e.prototype,"sbService",void 0),i([a],e)}(c.PopupBaseBP);o.WduWrapUpPopup=h,cc._RF.pop()},{"../../../../common/bean/Decorators":"Decorators","../../../../common/util/Bec":"Bec","../../../../common/util/Popup":"Popup","../../../core/object/area/WdAreaKey":"WdAreaKey","../WduPopups":"WduPopups"}],WorldDAO:[function(t,e,o){"use strict";cc._RF.push(e,"6a849CeCMZBCopbWSs4jbCz","WorldDAO"),Object.defineProperty(o,"__esModule",{value:!0}),o.WorldDAO=void 0;var r=function(){function t(){this.no=0,this.lastPlay=0,this.playTime=0}return t.prototype.getPk=function(){return this.no},t}();o.WorldDAO=r,cc._RF.pop()},{}],WorldMachine:[function(t,e,o){"use strict";cc._RF.push(e,"36f7cpjO01Ip60doAxIFbLj","WorldMachine");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WorldMachine=void 0;var c=cc._decorator.ccclass,a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.world=null,e}return n(e,t),e.prototype.boot=function(t){this.world=t,this.world.boot(this)},e.prototype.update=function(t){null!=this.world&&this.world.onTick(t)},e.prototype.runAfter=function(t,e){this.scheduleOnce(function(){return e()},t)},i([c],e)}(cc.Component);o.WorldMachine=a,cc._RF.pop()},{}],WorldPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"14045xjPCdAro6eZkOijso3","WorldPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__awaiter||function(t,e,o,r){return new(o||(o=Promise))(function(n,i){function c(t){try{s(r.next(t))}catch(e){i(e)}}function a(t){try{s(r.throw(t))}catch(e){i(e)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(c,a)}s((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){var o,r,n,i,c={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(t){return function(e){return s([t,e])}}function s(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,r&&(n=2&i[0]?r.return:i[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,i[1])).done)return n;switch(r=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(n=(n=c.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){c.label=i[1];break}if(6===i[0]&&c.label<n[1]){c.label=n[1],n=i;break}if(n&&c.label<n[2]){c.label=n[2],c.ops.push(i);break}n[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(a){i=[6,a],r=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.WorldPresenter=void 0;var s=cc._decorator.ccclass,l=t("./presenter/area/WdAreaPresenter"),u=cc._decorator.property,p=t("../common/bean/Decorators"),d=t("./WorldMachine"),h=t("./presenter/unit/WdUnitFactory"),f=t("./presenter/hero/WdHeroPresenter"),y=t("./presenter/enemy/WdEnemyPresenter"),v=t("./UI/WduUIPresenter"),m=t("./UI/common/WduColorPalette"),g=t("./presenter/object/WdObjectPresenter"),W=t("./presenter/dropItem/WdDropItemPresenter"),b=t("../App"),S=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.machine=null,e.areaPresenter_=null,e.heroPresenter_=null,e.enemyPresenter_=null,e.objectPresenter_=null,e.dropItemPresenter_=null,e.unitFactory_=null,e.ui_=null,e.palette_=null,e}return n(e,t),Object.defineProperty(e.prototype,"areaPresenter",{get:function(){return this.areaPresenter_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heroPresenter",{get:function(){return this.heroPresenter_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enemyPresenter",{get:function(){return this.enemyPresenter_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"objectPresenter",{get:function(){return this.objectPresenter_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dropItemPresenter",{get:function(){return this.dropItemPresenter_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unitFactory",{get:function(){return this.unitFactory_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mainCam",{get:function(){return this.heroPresenter.cam},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ui",{get:function(){return this.ui_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"palette",{get:function(){return this.palette_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"world",{get:function(){return this.worldService.world},enumerable:!1,configurable:!0}),e.prototype.start=function(){return c(this,void 0,void 0,function(){return a(this,function(){return this.worldService.presenters=this,this.worldService.boot(),this.machine.boot(this.world),this.areaPresenter.boot(this.world),this.heroPresenter.boot(this.world),this.enemyPresenter.boot(this.world),this.objectPresenter.boot(this.world),this.dropItemPresenter.boot(this.world),this.ui.boot(this.world),b.app.mainUI.playFadeIn(),[2]})})},e.prototype.update=function(){},i([u(d.WorldMachine)],e.prototype,"machine",void 0),i([u(l.default)],e.prototype,"areaPresenter_",void 0),i([u(f.WdHeroPresenter)],e.prototype,"heroPresenter_",void 0),i([u(y.WdEnemyPresenter)],e.prototype,"enemyPresenter_",void 0),i([u(g.WdObjectPresenter)],e.prototype,"objectPresenter_",void 0),i([u(W.WdDropItemPresenter)],e.prototype,"dropItemPresenter_",void 0),i([u(h.WdUnitFactory)],e.prototype,"unitFactory_",void 0),i([u(v.WduUIPresenter)],e.prototype,"ui_",void 0),i([u(m.WduColorPalette)],e.prototype,"palette_",void 0),i([p.autoWired("WorldService")],e.prototype,"worldService",void 0),i([s],e)}(cc.Component);o.WorldPresenter=S,cc._RF.pop()},{"../App":"App","../common/bean/Decorators":"Decorators","./UI/WduUIPresenter":"WduUIPresenter","./UI/common/WduColorPalette":"WduColorPalette","./WorldMachine":"WorldMachine","./presenter/area/WdAreaPresenter":"WdAreaPresenter","./presenter/dropItem/WdDropItemPresenter":"WdDropItemPresenter","./presenter/enemy/WdEnemyPresenter":"WdEnemyPresenter","./presenter/hero/WdHeroPresenter":"WdHeroPresenter","./presenter/object/WdObjectPresenter":"WdObjectPresenter","./presenter/unit/WdUnitFactory":"WdUnitFactory"}],WorldRepository:[function(t,e,o){"use strict";cc._RF.push(e,"34025S8aE1HYKp47qfvxTUo","WorldRepository");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WorldRepository=void 0;var c=t("../../../common/repository/Repository1"),a=t("../../../common/bean/Decorators"),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),i([a.repository("WorldRepository")],e)}(c.Repository1);o.WorldRepository=s,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/repository/Repository1":"Repository1"}],WorldService:[function(t,e,o){"use strict";cc._RF.push(e,"5f4560blBNLqYcSeV/D8vWL","WorldService");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.WorldService=void 0;var n=t("../../../common/bean/Decorators"),i=t("./World"),c=t("./WorldDAO"),a=t("../../../common/util/Utils"),s=function(){function t(){}return t.prototype.getEventBus=function(){return this.world.eventBus},t.prototype.getPlayer=function(){return this.world.player},t.prototype.newWorld=function(){var t=new c.WorldDAO;return t.no=this.repository.getMaxPK()+1,t.lastPlay=a.Utils.currentTimeMillis()/1e3,t.playTime=0,this.repository.create(t),new i.World(t)},t.prototype.getAll=function(){return this.repository.readAll()},t.prototype.boot=function(){var t=this.getAll();0==t.length?this.world=this.newWorld():(t.sort(function(t,e){return e.lastPlay-t.lastPlay}),this.world=new i.World(t[0]))},r([n.autoWired("WorldRepository")],t.prototype,"repository",void 0),r([n.service("WorldService")],t)}();o.WorldService=s,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/util/Utils":"Utils","./World":"World","./WorldDAO":"WorldDAO"}],WorldUIPresenter:[function(t,e,o){"use strict";cc._RF.push(e,"b9930ufOn9CkbVz7zpLWril","WorldUIPresenter");var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../common/util/UIPresenterBase"),a=cc._decorator.ccclass,s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onLoad=function(){this.getColorPanel().init(cc.Color.BLACK,255),this.initScene(!1)},i([a],e)}(c.default);o.default=s,cc._RF.pop()},{"../common/util/UIPresenterBase":"UIPresenterBase"}],World:[function(t,e,o){"use strict";cc._RF.push(e,"4e40eCxDJtDUIMgW0vmZI1u","World");var r=this&&this.__decorate||function(t,e,o,r){var n,i=arguments.length,c=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(i<3?n(c):i>3?n(e,o,c):n(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.World=void 0;var n=t("./WdISharedRes"),i=t("./WdEventBus"),c=t("../common/WdRandom"),a=t("../common/WdTime"),s=t("../object/hero/WdHero"),l=t("../object/area/WdArea"),u=t("../object/area/WdAreaKey"),p=t("../../../common/bean/Decorators"),d=t("../../../common/util/Utils"),h=t("../common/WdRandomUtil"),f=t("../object/material/WdMaterialDAO"),y=t("../common/WdVec"),v=t("../../../rule/model/Model"),m=function(){function t(t){var e=this;this.dataServices=new Array,this.onHeroDead=function(){e.evaluateBattle()},this.onEnemyDead=function(){e.player.exp++},this.dao=t,this.random=new c.WdRandom(d.Utils.currentTimeMillis()),this.eventBus=new i.WdEventBus,this.eventBus.onHeroDead.addHandler(this.onHeroDead),this.eventBus.onEnemyDead.addHandler(this.onEnemyDead),this.time=new a.WdTime}return Object.defineProperty(t.prototype,"player",{get:function(){return this.playerService.getPlayer()},enumerable:!1,configurable:!0}),t.prototype.readyHero=function(){var t=this.heroService.newHero(1);this.heroService.refreshHeroStat(),this.hero=new s.WdHero(t),this.hero.boot(this)},t.prototype.evaluateBattle=function(){var t=this.player.battleBook,e=this.materialService.getBagAll(),o=new Array;e.forEach(function(t){for(var e=0;e<t.amount;e++)o.push(t.code)}),h.WdRandomUtil.shuffle(o);var r=this.hero.isDead()?.3:1,n=Math.round(o.length*r),i=new Map,c=new Map;e.forEach(function(t){c.set(t.code,f.WdMaterialDAO.build(t.code,t.amount))});for(var a=0;a<n;a++){var s=o[a];i.has(s)?i.get(s).amount++:i.set(s,f.WdMaterialDAO.build(s,1)),c.get(s).amount--,c.get(s).amount<=0&&c.delete(s)}t.keepMats=Array.from(i.values()),t.loseMats=Array.from(c.values()),0==this.area.enemies.size?this.player.levelCount+=this.area.getKey().level:this.player.levelCount+=this.area.getKey().level-1},t.prototype.setState=function(t){this.state=t,this.eventBus.onChangeState.fire()},t.prototype.boot=function(t){this.dataServices.push(this.heroService),this.dataServices.push(this.dropItemService),this.dataServices.push(this.enemyService),this.dataServices.push(this.itemService),this.dataServices.push(this.materialService),this.dataServices.push(this.objectService),this.tickHelper=t,this.time.timestamp=this.dao.playTime;var e=u.WdAreaKey.build(0,1);null==this.playerService.getPlayer()&&(this.playerService.newPlayer(),e=u.WdAreaKey.build(1,1)),this.readyHero(),this.setArea(e)},t.prototype.setArea=function(t){var e,o=this.area;o&&o.onTearDown(o.getKey());var r=null!==(e=null==o?void 0:o.getKey())&&void 0!==e?e:u.WdAreaKey.empty;this.readyArea(r,t),this.hero.setPosition(y.WdVec.build(.49,-1.5).scalar(80)),this.hero.bringBack(),this.eventBus.onHeroBack.fire(),this.hero.recover(),this.eventBus.onAreaStart.fire(r,t,this.lastGate)},t.prototype.wrapUpBattle=function(){var t=this;this.evaluateBattle();var e=new Array;e=e.concat(this.player.battleBook.keepMats),this.player.battleBook.getAll&&(e=e.concat(this.player.battleBook.loseMats)),e.forEach(function(e){t.ruleService.materials.get(e.code).category==v.WdResourceCategory.Artifact?t.artifactService.newArtifact(e.code):t.materialService.addToChest(e.code,e.amount)}),this.playerService.refreshPlayerExp()},t.prototype.readyArea=function(t,e){t.isDungeon()&&e.isVillage()&&this.wrapUpBattle(),this.dataServices.forEach(function(t){t.onReadyDungeon()}),this.dataServices.forEach(function(t){t.onStartArea(e)});var o=this.areaService.newArea(t,e);this.area=new l.WdArea(o),this.area.boot(this)},t.prototype.changeArea=function(t){var e,o;this.nextArea=t,this.remainToNextArea=.25,this.eventBus.onAreaEnd.fire(null!==(o=null===(e=this.area)||void 0===e?void 0:e.getKey())&&void 0!==o?o:u.WdAreaKey.empty,t)},t.prototype.onTick=function(t){var e,o;this.state!=n.WorldState.Waiting&&this.state!=n.WorldState.Pause&&(null===(e=this.hero)||void 0===e||e.onTick(this.time),null===(o=this.area)||void 0===o||o.onTick(this.time),this.dao.playTime+=t,this.time.onTick(t),null!=this.nextArea&&(this.remainToNextArea-=t,this.remainToNextArea<=0&&(this.setArea(this.nextArea),this.nextArea=null,this.remainToNextArea=0)))},r([p.autoWired("WdHeroService")],t.prototype,"heroService",void 0),r([p.autoWired("WdDropItemService")],t.prototype,"dropItemService",void 0),r([p.autoWired("WdEnemyService")],t.prototype,"enemyService",void 0),r([p.autoWired("WdItemService")],t.prototype,"itemService",void 0),r([p.autoWired("WdObjectService")],t.prototype,"objectService",void 0),r([p.autoWired("WdPlayerService")],t.prototype,"playerService",void 0),r([p.autoWired("WdAreaService")],t.prototype,"areaService",void 0),r([p.autoWired("WdMaterialService")],t.prototype,"materialService",void 0),r([p.autoWired("WdArtifactService")],t.prototype,"artifactService",void 0),r([p.autoWired("RuleService")],t.prototype,"ruleService",void 0),t}();o.World=m,cc._RF.pop()},{"../../../common/bean/Decorators":"Decorators","../../../common/util/Utils":"Utils","../../../rule/model/Model":"Model","../common/WdRandom":"WdRandom","../common/WdRandomUtil":"WdRandomUtil","../common/WdTime":"WdTime","../common/WdVec":"WdVec","../object/area/WdArea":"WdArea","../object/area/WdAreaKey":"WdAreaKey","../object/hero/WdHero":"WdHero","../object/material/WdMaterialDAO":"WdMaterialDAO","./WdEventBus":"WdEventBus","./WdISharedRes":"WdISharedRes"}]},{},["App","Radio","BeanContainer","Decorators","CoContainer","Coroutine","EaseRoutine","WaitRoutine","Setting","Repository","Repository1","Repository2","Table","Repository.spec","GoPooler","SettingService","SoundService","StringBundleService","AverageFilter","Bec","BlackPanel","CcUtils","ColorPanel","CommonAlertBox","EventHandler","GoItem","MyCanvasScaler","OrderByY","Popup","Screenshot","SoundBucket","TextLocale","UIPresenterBase","Utils","WaitingPanel","EventHandler.spec","IntroPresenter","RuleService","Model","Act","Artifact","Drop","Enemy","EnemyLevel","HeroLevel","HeroStat","Item","ItemLevel","ItemMagic","Material","Object","Pickaxe","PlayerExp","Potion","Skill","Unlock","RuleService.spec","WduUIPresenter","WduColorPalette","WduCommonStatBox","WduCommonStatCell","WduCommonStatPresenter","WduGauge","WduHistoryActive","WduPickaxeStatPresenter","WduSkillStatPresenter","WduUvScrollBoard","WduDashboard","WduMinimap","WduMinimapTag","WduNavDungeon","WduSkillButton","WduUnlockButton","WduPopups","WduNewSkillPopup","WduSkillMenuItem","WduTutorialPopup","WduWrapUpPopup","WduTouchPad","WorldMachine","WorldPresenter","WorldUIPresenter","WdRandom","WdRandomUtil","WdTime","WdUtil","WdVec","WdActionHistoryDAO","WdActionHistoryRepository","WdHistoryService","WdArea","WdAreaDAO","WdAreaKey","WdAreaService","WdDungeonPulsar","WdIAreaPulsar","WdVillagePulsar","WdArtifactDAO","WdArtifactRepository","WdArtifactService","WdDataService","WdReward","WdDropItem","WdDropItemDAO","WdDropItemService","WdIDropItemActor","WdEnemy","WdEnemyAI","WdEnemyAttackCore","WdEnemyDAO","WdEnemyService","WdIEnemyActor","WdHero","WdHeroAttackCore","WdHeroDAO","WdHeroService","WdIHeroActor","WdHeroSkillFactory","WdIHsHandler","WdHsBonusLife","WdHsCR","WdHsDefault","WdHsGhost","WdItemDAO","WdItemService","WdItem.spec","WdChestMaterialRepository","WdMaterialDAO","WdMaterialService","WdIObjectActor","WdObject","WdObjectDAO","WdObjectService","WdChestValue","WdGateValue","WdSkillKey","WdSkillService","WdAttack","WdAttackCalculator","WdCc","WdDamage","WdStat","WdStats","WdUnit","WdUnitAction","WdUnitKey","WdUnitRewardValue","WdUnitState","WdUnitUtil","WdUnitValue","WdAttackCalculator.spec","WdStat.spec","WdBattleBook","WdPlayerDAO","WdPlayerRepository","WdPlayerService","WdPotion","WdEventBus","WdISharedRes","World","WorldDAO","WorldRepository","WorldService","WdAreaPresenter","WdFloorBuilding","WdFloorDungeon","WdCamera","WdICamTarget","WdSpritePooler","WduTransitionPanel","WduTransitionPanelBlind","WduTransitionPanelDefault","WdDropItemActor","WdDropItemFactory","WdDropItemPresenter","WdEffectFactory","WdEffectType","WdPxEffect","WdPxEffectAnimator","WdPxEffectMove","WdEnemyActor","WdEnemyFactory","WdEnemyPresenter","WdEaAttackHandler","WdEaHandler","WdEmAttack10","WdEmAttack21","WdEmAttack22","WdEmAttackFactory","WdEmMeleeAttack","WdEmProjectileAttack","WdHeroActor","WdHeroArrow","WdHeroCircle","WdHeroCircleOrb","WdHeroFactory","WdHeroLevelUp","WdHeroPresenter","WdHeroRip","WdHeroTargetMarker","WdHaAttackHandler","WdHaEnterAreaHandler","WdHaHandler","WdHaSkillHandler","WdWpAttackArrow","WdWpSkillBonusLife","WdWpSkillIcePillar","WdWpSkillLightningShield","WdWpSkillLightningStrike","WdWpSkillMagicBomb","WdWpSkillMeteor","WdObjectActor","WdObjectFactory","WdObjectPresenter","WdUnitDcChest","WdUnitDcGate","WdUnitDcVillageMatChest","WdUnitDcWaypointD","WdProjectile","WdProjectileAgency","WdProjectileGuide","WdProjectileHitArea","WdProjectileLine","WdProjectileMine","WdProjectileRay","WdHeroRadar","WdIWpAttack","WdUnitActor","WdUnitActorCore","WdUnitCoreAnimEvent","WdUnitCoreDecorator","WdUnitFactory","WdUnitRadar","WdUaHurtHandler","WdUaPopupHandler","WdUaStopHandler","WdUaWalkHandler","WdUaWrapUpHandler","WdUnitActionHandler","WdUnitAnimator","WdUnitAnimatorOverride","WdCcEffectCold","WdCcEffectGhost","WdCcEffectPoison","WdCcEffectPresenter","WdICcEffect","WdUnitDcInfoPopup"]);